(()=>{"use strict";var e=Object.defineProperty;class t{constructor(){((t,s,n)=>{((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n)})(this,"listeners",{})}emit(e,t){const s=this.listeners[e];s&&(this.listeners[e]=s.filter((e=>!e.once)),s.map((e=>e.fn(t))).map((e=>"function"==typeof e&&(null==e?void 0:e()))))}off(e,t){const s=this.listeners[e];s&&(this.listeners[e]=s.filter((e=>e.fn!==t)))}on(e,t){this.add(e,t,!1)}once(e,t){this.add(e,t,!0)}reset(){this.listeners={}}add(e,t,s){const n=this.listeners[e],i={fn:t,once:s};n?n.push(i):this.listeners[e]=[i]}}var s=Object.defineProperty,n=(e,t,n)=>((e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),i=(e,t,s)=>new Promise(((n,i)=>{var a=e=>{try{r(s.next(e))}catch(e){i(e)}},o=e=>{try{r(s.throw(e))}catch(e){i(e)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,o);r((s=s.apply(e,t)).next())}));const a=document.querySelector("#vindral-container"),o=document.querySelector("#playback-state"),r=new class extends t{constructor(e){super(),n(this,"state","not casting"),n(this,"config"),n(this,"unloaded",!1),n(this,"updateAuthenticationToken",(e=>{this.config&&(this.config.options.authenticationToken=e,this.send({type:"updateAuthToken",token:e}))})),n(this,"unload",(()=>{var e;this.unloaded=!0,null==(e=this.getSession())||e.removeMessageListener("urn:x-cast:com.vindral.castdata",this.onMessage)})),n(this,"init",(()=>i(this,null,(function*(){return new Promise(((e,t)=>{let s=!1;const n=setTimeout((()=>{s=!0,t()}),1e4);window.__onGCastApiAvailable=i=>{if(!s)return clearTimeout(n),i?void setTimeout((()=>{try{this.onGCastApiAvailable(),e()}catch(e){t()}}),1e3):t();s=!1},this.castLibrariesAdded()&&window.cast?window.__onGCastApiAvailable(!0):this.verifyCastLibraries()}))})))),n(this,"start",(()=>i(this,null,(function*(){var e;yield null==(e=this.getInstance())?void 0:e.requestSession()})))),n(this,"stop",(()=>{var e;null==(e=this.getSession())||e.endSession(!0)})),n(this,"getReceiverName",(()=>{var e,t;return(null==(t=null==(e=this.getSession())?void 0:e.getCastDevice())?void 0:t.friendlyName)||void 0})),n(this,"onGCastApiAvailable",(()=>{var e;const t=this.getInstance();if(!t)throw"cast context should exist";const s=t.getSessionState(),n=(null==(e=this.config)?void 0:e.receiverApplicationId)||"A5452297";t.setOptions({receiverApplicationId:n,autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,resumeSavedSession:!0}),t.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged),s===cast.framework.SessionState.SESSION_STARTED&&setTimeout((()=>{this.state="casting",this.emit("resumed")}))})),n(this,"send",(e=>{var t;null==(t=this.getSession())||t.sendMessage("urn:x-cast:com.vindral.castdata",e)})),n(this,"onMessage",((e,t)=>{if("urn:x-cast:com.vindral.castdata"===e)try{const e=JSON.parse(t);switch(e.type){case"metadata":this.emit("metadata",e.metadata);break;case"serverWallclockTime":this.emit("server wallclock time",e.serverWallclockTime)}}catch(e){}})),n(this,"onSessionStarted",(()=>{var e;null==(e=this.getSession())||e.addMessageListener("urn:x-cast:com.vindral.castdata",this.onMessage),this.send({type:"start",config:this.config})})),n(this,"onSessionStateChanged",(e=>{if(!this.unloaded)switch(e.sessionState){case cast.framework.SessionState.SESSION_START_FAILED:this.state="not casting",this.emit("failed");break;case cast.framework.SessionState.SESSION_ENDED:this.state="not casting",this.emit("disconnected");break;case cast.framework.SessionState.SESSION_ENDING:break;case cast.framework.SessionState.SESSION_RESUMED:this.onSessionStarted(),this.state="casting",this.emit("resumed");break;case cast.framework.SessionState.SESSION_STARTED:this.onSessionStarted(),this.state="casting",this.emit("connected");case cast.framework.SessionState.SESSION_STARTING:}})),n(this,"getInstance",(()=>{var e;return null==(e=window.cast)?void 0:e.framework.CastContext.getInstance()})),n(this,"getSession",(()=>{var e;return null==(e=this.getInstance())?void 0:e.getCurrentSession()})),n(this,"castLibrariesAdded",(()=>!(!document.querySelector("#vindralCastFrameworkLib")||!document.querySelector("#vindralCastSenderLib")))),n(this,"verifyCastLibraries",(()=>{if(this.castLibrariesAdded())return;const e=document.createElement("script");e.type="text/javascript",e.id="vindralCastFrameworkLib",e.src="//www.gstatic.com/cast/sdk/libs/sender/1.0/cast_framework.js",document.head.appendChild(e);const t=document.createElement("script");t.type="text/javascript",t.id="vindralCastSenderLib",t.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js",document.head.appendChild(t)})),this.config=e}get casting(){return"casting"===this.state}get volume(){var e,t;return null!=(t=null==(e=this.getSession())?void 0:e.getVolume())?t:0}set volume(e){var t;null==(t=this.getSession())||t.setVolume(e)}get language(){var e,t;return null==(t=null==(e=this.config)?void 0:e.options)?void 0:t.language}set language(e){this.config&&(this.config.options.language=e,this.send({type:"setLanguage",language:e}))}get channelId(){var e;return(null==(e=this.config)?void 0:e.options.channelId)||""}set channelId(e){this.config&&(this.config.options.channelId=e,this.send({type:"setChannelId",channelId:e}))}}({receiverApplicationId:"A5452297",options:{url:"https://lb.cdn.vindral.com",channelId:"vindral_demo1_ci_099ee1fa-80f3-455e-aa23-3d184e93e04f"}});o.textContent="initializing",r.on("connected",(()=>o.textContent="connected")),r.on("resumed",(()=>o.textContent="resumed")),r.on("disconnected",(()=>o.textContent="disconnected")),r.on("failed",(()=>o.textContent="failed")),r.on("metadata",(e=>console.log("metadata",e))),r.on("server wallclock time",(e=>console.log("server wallclock time",e))),r.init().then((()=>{const e=document.createElement("google-cast-launcher");a.appendChild(e),o.textContent="initialized"})).catch((e=>{o.textContent="unable to initialize cast"}))})();