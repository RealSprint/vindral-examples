(()=>{"use strict";var t,e,i={4896:(t,e,i)=>{i.d(e,{A:()=>b,i:()=>A,p:()=>v,t:()=>m});var n=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,h=(t,e,i)=>e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,c=(t,e)=>{for(var i in e||(e={}))a.call(e,i)&&h(t,i,e[i]);if(o)for(var i of o(e))l.call(e,i)&&h(t,i,e[i]);return t},d=(t,e,i)=>h(t,"symbol"!=typeof e?e+"":e,i),u=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{a(i.next(t))}catch(t){s(t)}},o=t=>{try{a(i.throw(t))}catch(t){s(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,o);a((i=i.apply(t,e)).next())}));const m=t=>{try{return JSON.parse(t)}catch(t){return}};class p extends Error{constructor({status:t,url:e,body:i}){const n=m(i),s=(t=>"object"==typeof t&&null!==t&&"message"in t)(n)?n.message:`Url ${e.toString()}, Status code: ${t}, Body: ${i}`;super(s),d(this,"status"),d(this,"body"),d(this,"url"),this.status=t,this.body=i,this.url=e,Object.setPrototypeOf(this,new.target.prototype)}}const A=t=>"number"==typeof t.status,g=(t,e)=>u(void 0,null,(function*(){const i=yield fetch(t.toString(),c({mode:"cors"},e));if(!i.ok)throw new p({status:i.status,url:t,body:yield i.text()});return i})),f=(t,e)=>u(void 0,null,(function*(){return yield(yield g(t,c({},e))).json()})),v=(t,e)=>u(void 0,null,(function*(){return g(t,c({method:"POST"},e))}));class b{constructor(t){d(this,"baseUrl"),d(this,"tokenFactory"),this.baseUrl=new URL("/api/v2/",t.publicEndpoint).toString(),this.tokenFactory=t.tokenFactory}connect(t){return u(this,null,(function*(){const{channelId:e,channelGroupId:i}=t,n={channelId:e,channelGroupId:i},o=new URL((t=>t.channelGroupId?`connect/?channelId=${t.channelId}&channelGroupId=${t.channelGroupId}`:`connect/?channelId=${t.channelId}`)(t),this.baseUrl),a=this.getAuthToken(n),l=yield f(o,{headers:this.getHeaders(a)});return{channels:l.channels.map((t=>{const e=this.toChannel(t,n);return((t,e)=>s(t,r(e)))(c({},e),{renditions:t.renditions,overrides:t.overrides})})),edges:l.edges,logsUrl:l.logsUrl,statsUrl:l.statsUrl,telemetry:l.telemetry}}))}getChannel(t){return u(this,null,(function*(){const e={channelId:t},i=new URL(`channel/${t}`,this.baseUrl),n=this.getAuthToken(e),s=yield f(i,{headers:this.getHeaders(n)});return this.toChannel(s,e,n)}))}getChannels(t){return u(this,null,(function*(){const e={channelGroupId:t},i=new URL(`channels/${t}`,this.baseUrl),n=this.getAuthToken(e),s=yield f(i,{headers:this.getHeaders(n)});return this.toChannels(s,e,n)}))}getHeaders(t){var e;return null!=(e=(t=>t?{Authorization:`Bearer ${t}`}:void 0)(t))?e:{}}getAuthToken(t){return this.tokenFactory?this.tokenFactory(t):void 0}toChannels(t,e,i){return t.map((t=>this.toChannel(t,e,i)))}toChannel(t,e,i){const{baseUrl:n,sizes:s}=t.thumbnail,r=n||new URL(((t,e)=>e?t.channelGroupId?`thumbnail/?channelGroupId=${t.channelGroupId}&auth.token=${e}&auth.type=jwt`:t.channelId?`thumbnail/?channelId=${t.channelId}&auth.token=${e}&auth.type=jwt`:"thumbnail":"thumbnail")(e,i),this.baseUrl),o=s.map((n=>new URL(`?channelId=${t.channelId}&width=${n.width}&height=${n.height}${w(e,i)}`,r).toString()));return{channelId:t.channelId,name:t.name,isLive:t.isLive,thumbnailUrls:o}}}const w=(t,e)=>e?t.channelGroupId?`&channelGroupId=${t.channelGroupId}&auth.token=${e}&auth.type=jwt`:`&auth.token=${e}&auth.type=jwt`:""},7848:(t,e,i)=>{i.d(e,{E:()=>s});var n=Object.defineProperty;class s{constructor(){((t,e,i)=>{((t,e,i)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i)})(this,"listeners",{})}emit(t,e){const i=this.listeners[t];i&&(this.listeners[t]=i.filter((t=>!t.once)),i.map((t=>t.fn(e))).map((t=>"function"==typeof t&&(null==t?void 0:t()))))}off(t,e){const i=this.listeners[t];i&&(this.listeners[t]=i.filter((t=>t.fn!==e)))}on(t,e){this.add(t,e,!1)}once(t,e){this.add(t,e,!0)}reset(){this.listeners={}}add(t,e,i){const n=this.listeners[t],s={fn:e,once:i};n?n.push(s):this.listeners[t]=[s]}}},4088:(t,e,i)=>{i.d(e,{F:()=>k,L:()=>Z,V:()=>pn,d:()=>pt,i:()=>_,n:()=>$});var n=i(7848),s=i(4896),r=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=t=>{throw TypeError(t)},u=(t,e,i)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,m=(t,e)=>{for(var i in e||(e={}))h.call(e,i)&&u(t,i,e[i]);if(l)for(var i of l(e))c.call(e,i)&&u(t,i,e[i]);return t},p=(t,e)=>o(t,a(e)),A=(t,e,i)=>u(t,"symbol"!=typeof e?e+"":e,i),g=(t,e,i)=>e.has(t)||d("Cannot "+i),f=(t,e,i)=>(g(t,e,"read from private field"),i?i.call(t):e.get(t)),v=(t,e,i)=>e.has(t)?d("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),b=(t,e,i,n)=>(g(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),w=(t,e,i)=>(g(t,e,"access private method"),i),S=(t,e,i,n)=>({set _(n){b(t,e,n,i)},get _(){return f(t,e,n)}}),y=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{a(i.next(t))}catch(t){s(t)}},o=t=>{try{a(i.throw(t))}catch(t){s(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,o);a((i=i.apply(t,e)).next())}));class E{constructor(t){A(this,"maxSize",0),A(this,"size",0),A(this,"buffers",[]),A(this,"_borrowedBuffers",0),A(this,"get",(t=>{const e=this.buffers.shift();return this._borrowedBuffers++,this.size<t||!e?(this.buffers=[],this.size=t,new ArrayBuffer(t)):e})),A(this,"reclaim",(t=>{this._borrowedBuffers=Math.max(0,this._borrowedBuffers-1),!(t.byteLength<this.size)&&(this.buffers.length>=this.maxSize||this.buffers.push(t))})),this.maxSize=t}get bufferSize(){return this.size}get poolSize(){return this.buffers.length}get borrowedBuffers(){return this._borrowedBuffers}}class k{constructor(t=50){A(this,"maxSize"),A(this,"values",[]),A(this,"push",(t=>{this.isFull()&&this.pop(),this.values.push(t)})),A(this,"clear",(()=>{this.values=[]})),A(this,"pop",(()=>this.values.shift())),A(this,"peekFirst",(()=>this.values[0])),A(this,"peekLast",(()=>this.values[this.values.length-1])),A(this,"isFull",(()=>this.values.length>=this.maxSize)),A(this,"isEmpty",(()=>0===this.values.length)),A(this,"items",(()=>this.values)),A(this,"filterPop",(t=>{for(;this.peekFirst()&&!t(this.peekFirst());)this.pop()})),this.maxSize=t}}class C{constructor(t,e=0){A(this,"buffer"),A(this,"bytes"),A(this,"bitOffset"),A(this,"peekBit",(()=>this.getBit(this.bytes,this.bitOffset))),A(this,"readBit",(()=>{const t=this.peekBit();return this.bitOffset++,t})),A(this,"readBits",(t=>{let e=0;for(let i=0;i<t;i++)e=e<<1|(this.getBit(this.bytes,this.bitOffset++)?1:0);return e})),A(this,"readSignedExpGolomb",(()=>{const t=this.readUnsignedExpGolomb();return 1&t?(t+1)/2:-t/2})),A(this,"readUnsignedExpGolomb",(()=>{let t=0;for(;0===this.getBit(this.bytes,this.bitOffset++);)t++;let e=1<<t;for(let i=t-1;i>=0;i--)e|=this.getBit(this.bytes,this.bitOffset++)<<i;return e-1})),A(this,"getBit",((t,e)=>t[e>>3]>>7-(7&e)&1)),this.buffer=t,this.bytes=new Uint8Array(this.buffer),this.bitOffset=e}}function T(){const t=self.MediaSource,e=self.ManagedMediaSource;return null!=t?t:e}const x=new RegExp("(android|bbd+|meego).+mobile|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/","i"),I=navigator.userAgent.toLowerCase(),R=x.test(I),L=()=>{const t=document.createElement("video");return""!==t.canPlayType("application/vnd.apple.mpegURL")||""!==t.canPlayType("audio/mpegurl")},P=()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){return!1}return!1},M=()=>"MacIntel"===navigator.platform&&0===navigator.maxTouchPoints,B=()=>"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,_=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;function U(){var t,e;if(/(iPhone|iPod|iPad)/i.test(I))return null==(e=null==(t=null==I?void 0:I.match(/OS [\d_]+/i))?void 0:t[0])?void 0:e.substring(3).split("_").map((t=>parseInt(t)))[0]}class N{constructor(t=100,e=100){A(this,"resizeSteps"),A(this,"internalBuffer"),A(this,"view"),A(this,"uint8"),A(this,"_position",0),A(this,"_end",0),this.resizeSteps=e,this.internalBuffer=new ArrayBuffer(t),this.view=new DataView(this.internalBuffer),this.uint8=new Uint8Array(this.internalBuffer)}position(){return this._position}seek(t){this._position=Math.max(0,Math.min(this._end,t))}seekToEnd(){this._position=this._end}writeUint8(t){this.writeAndMove(t,1)}writeUint16(t){this.writeAndMove(t,2)}writeUint24(t){this.writeAndMove(t,3)}writeUint32(t){this.writeAndMove(t,4)}writeUint32At(t,e){this.view.setUint32(t,e)}writeBytes(t){this.resizeIfNeeded(this.position()+t.byteLength),this.uint8.set(t,this.position()),this._position+=t.byteLength,this._end=Math.max(this._end,this._position)}buffer(){return this.internalBuffer.slice(0,this._end)}write(t,e){switch(this.resizeIfNeeded(this.position()+e),e){case 1:this.view.setUint8(this.position(),t);break;case 2:this.view.setUint16(this.position(),t);break;case 3:this.view.setUint8(this.position(),t>>16&255),this.view.setUint8(this.position()+1,t>>8&255),this.view.setUint8(this.position()+2,255&t);break;case 4:this.view.setUint32(this.position(),t)}}writeAndMove(t,e){this.write(t,e),this._position+=e,this._end=Math.max(this._end,this._position)}resizeIfNeeded(t){if(t>this.internalBuffer.byteLength){const e=new ArrayBuffer(t+this.resizeSteps),i=new Uint8Array(e);i.set(this.uint8),this.internalBuffer=e,this.view=new DataView(this.internalBuffer),this.uint8=i}}}class D{constructor(t,e,i){A(this,"onSuccess"),A(this,"onError"),A(this,"doExecute"),this.doExecute=t,this.onSuccess=e,this.onError=i}execute(t){try{this.doExecute(t),this.onSuccess()}catch(t){this.onError(t)}}}const F=t=>t.reduce(((t,e)=>t+e),0)/t.length,O=t=>({last:t[t.length-1]||0,average:0===t.length?0:F(t),max:0===t.length?0:Math.max(...t),min:0===t.length?0:Math.min(...t)});class W{constructor(t=10){A(this,"rates"),A(this,"_total",0),A(this,"accumulatedValues",0),A(this,"lastTickTime",Date.now()),A(this,"add",(t=>{this.accumulatedValues+=t,this._total+=t})),A(this,"tick",(()=>{const t=this.accumulatedValues/((Date.now()-this.lastTickTime)/1e3);this.rates.push(t),this.accumulatedValues=0,this.lastTickTime=Date.now()})),this.rates=new k(t)}get total(){return this._total}get average(){return this.rates.isEmpty()?0:F(this.rates.items())}}const G=(t,e)=>{if(t===e)return!0;if(null==t||"object"!=typeof t||null==e||"object"!=typeof e)return!1;let i=0,n=0;for(const e in t)i+=1;for(const i in e)if(n+=1,!(i in t)||!G(t[i],e[i]))return!1;return i==n},z=["off","error","warn","info","debug","trace"];var H,V,X,Q,j;const q=class t{constructor({context:t,logLevel:e,debug:i}){v(this,H,new Map),v(this,V,""),v(this,X,!1),v(this,Q,"off"),A(this,"trace",((...t)=>{})),A(this,"debug",((...t)=>{})),A(this,"info",((...t)=>{})),A(this,"warn",((...t)=>{})),A(this,"error",((...t)=>{})),A(this,"table",((...t)=>{})),A(this,"count",((...t)=>{})),b(this,V,t),b(this,Q,e),b(this,X,i||!1),this.setLevel(e),this.setDebug(f(this,X))}setDebug(t){b(this,X,t);for(const[e,i]of f(this,H))i.setDebug(t);t?(this.table=console.table.bind(console),this.count=console.count.bind(console)):(this.table=()=>{},this.count=()=>{})}setLevel(t){b(this,Q,t);for(const[e,i]of f(this,H))i.setLevel(t);const e=z.indexOf(t);for(const[t,i]of z.entries())"off"!==i&&(this[i]=t<=e?console[i].bind(console,"%c%s %c%s","font-weight:bold;",i.toUpperCase(),"font-weight:normal;",f(this,V)):()=>{})}createContext(e){const i=f(this,H).get(e);if(!i){const i=new t({context:`${e}`,logLevel:f(this,Q),debug:f(this,X)});return f(this,H).set(e,i),i}return i}static get(){return f(t,j)||b(t,j,new t({context:"Vindral",logLevel:"off"})),f(t,j)}};H=new WeakMap,V=new WeakMap,X=new WeakMap,Q=new WeakMap,j=new WeakMap,v(q,j);let Z=q;const $=()=>{},J=(t,e)=>{const i=m({},t);return"object"!=typeof i||e.forEach((t=>{delete i[t]})),i},Y=(t,e=Date.now())=>{const i=t.length;if(i>0){const n=t[i-1];n.end||(n.end=e)}},K=(t,e=Date.now())=>{Y(t),t.push({start:e})},tt=t=>t.reduce(((t,e)=>{var i;return t+((null!=(i=e.end)?i:Date.now())-e.start)}),0),et=(t,e,i=Date.now())=>t.reduce(((t,n)=>{var s;const r=Math.max(i-e,n.start),o=null!=(s=n.end)?s:i;return Math.max(0,o-r)+t}),0),it=class{constructor(){A(this,"pendingTimeouts",new Set),A(this,"pendingIntervals",new Set),A(this,"clearTimeout",(t=>{this.pendingTimeouts.delete(t)&&window.clearTimeout(t)})),A(this,"clearInterval",(t=>{this.pendingIntervals.delete(t)&&window.clearInterval(t)})),A(this,"setTimeout",((t,e,...i)=>{const n=window.setTimeout((()=>{t(...i),this.clearTimeout(n)}),e);return this.pendingTimeouts.add(n),n})),A(this,"setInterval",((t,e,...i)=>{const n=window.setInterval((()=>{t(...i)}),e);return this.pendingIntervals.add(n),n})),A(this,"unload",(()=>{this.pendingIntervals.forEach(this.clearInterval),this.pendingTimeouts.forEach(this.clearTimeout)}))}};A(it,"create",(()=>new it));let nt=it;const st=()=>{const t=[...Array(256).keys()].map((t=>t.toString(16).padStart(2,"0"))),e=crypto.getRandomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,[...e.entries()].map((([e,i])=>[4,6,8,10].includes(e)?`-${t[i]}`:t[i])).join("")},rt=t=>y(void 0,null,(function*(){return new Promise((e=>setTimeout(e,t)))})),ot=(t,...e)=>y(void 0,[t,...e],(function*(t,e=new Error("Timeout")){return new Promise(((i,n)=>setTimeout((()=>n(e)),t)))})),at=t=>"width"in t&&"number"==typeof t.width,lt=t=>"sampleRate"in t&&"number"==typeof t.sampleRate,ht=t=>{switch(t.codec){case"opus":return'audio/mp4; codecs="opus"';case"mp3":return"audio/mpeg";case"webvtt":return"text/vtt";case"aac":return t.codecString?`audio/mp4; codecs="${t.codecString}"`:"audio/mp4";case"h264":case"av1":return t.codecString?`video/mp4; codecs="${t.codecString}"`:"video/mp4"}},ct=()=>Number.MAX_SAFE_INTEGER,dt=()=>({width:Number.MAX_SAFE_INTEGER,height:Number.MAX_SAFE_INTEGER}),ut=t=>!("object"!=typeof t||null===t||!("type"in t));class mt extends Error{constructor(t,e,i={}){super(t),A(this,"props"),A(this,"extra",{}),A(this,"code",(()=>this.props.code)),A(this,"isFatal",(()=>this.props.isFatal)),A(this,"source",(()=>this.props.source)),A(this,"type",(()=>{var t;return null!=(t=this.props.type)?t:"external"})),A(this,"toStringifiable",(()=>{var t;const e=this.source(),i=e instanceof Error?e.stack:this.stack;return p(m({},this.extra),{code:this.props.code,isFatal:this.props.isFatal,type:this.props.type,message:this.message,sourceMessage:null==(t=this.source())?void 0:t.message,stack:i})})),this.props=e,this.extra=i,Object.setPrototypeOf(this,new.target.prototype)}}const pt=(t,e)=>new mt("Decoder Error",{isFatal:t,code:"decoder_error",source:e,type:"internal"}),At=(t,e)=>new mt("Audio Player Error",{isFatal:t,code:"audio_player_error",source:e,type:"internal"}),gt=(t,e,i,n)=>new mt("MediaSource Error",{isFatal:t,code:"media_source_error",source:e,type:"internal"},{type:n,consecutiveErrorsCount:i}),ft=(t,e)=>new mt(`No track context for ${t}${e?`, rendition id ${e}`:""}`,{isFatal:!1,code:"no_track_context",type:"internal"}),vt=t=>new mt("Disconnected From Edge Server",{type:"external",source:t,isFatal:!1,code:"disconnected_by_edge"}),bt=t=>new mt("Authentication Failed",{isFatal:!0,code:"authentication_error",source:t}),wt=(t,e)=>new mt("Channel not found",{isFatal:!1,code:"channel_not_found",source:e,type:t}),St=t=>new mt(t,{isFatal:!0,code:"access_forbidden"}),yt=(t,e=0)=>{for(let i=e;i<t.byteLength-4;i++){const e=1===t.getUint32(i),n=1==(t.getUint8(i)<<16|t.getUint16(i+1));if(e||n)return{position:i,nalPrefixSize:e?4:3}}},Et=t=>{const e=[],i=[];if(!(t=>0!==(t=>{const e=t.getUint32(0,!1);let i=0;return 1==(t.getUint8(0)<<16|t.getUint16(1,!1))?i+=3:1===e&&(i+=4),i})(new DataView(t,0)))(t)){const n=new DataView(t,0),s=31&n.getUint8(5);let r=6;for(let i=0;i<s;i++){const i=n.getUint16(r);e.push(t.slice(r+2,r+2+i)),r+=i+2}const o=n.getUint8(r);r+=1;for(let e=0;e<o;e++){const e=n.getUint16(r);i.push(t.slice(r+2,r+2+e)),r+=e+2}return{sequenceParameterSets:e,pictureParameterSets:i}}return((t,e)=>{const i=new DataView(t,0);let n=yt(i);for(;n;){const{position:s,nalPrefixSize:r}=n,o=yt(i,s+4),a=o?o.position-s-r:void 0;if(!e(new DataView(t,s+r,a)))return;n=o}})(t,(t=>{const n=t.byteOffset+t.byteLength;switch((t=>31&t)(t.getUint8(0))){case 8:i.push(t.buffer.slice(t.byteOffset,n));break;case 7:e.push(t.buffer.slice(t.byteOffset,n))}return!0})),{sequenceParameterSets:e,pictureParameterSets:i}},kt=[{numerator:0,denumerator:0},{numerator:1,denumerator:1},{numerator:12,denumerator:11},{numerator:10,denumerator:11},{numerator:16,denumerator:11},{numerator:40,denumerator:33},{numerator:24,denumerator:11},{numerator:20,denumerator:11},{numerator:32,denumerator:11},{numerator:80,denumerator:33},{numerator:18,denumerator:11},{numerator:15,denumerator:11},{numerator:64,denumerator:33},{numerator:160,denumerator:99},{numerator:4,denumerator:3},{numerator:3,denumerator:2},{numerator:2,denumerator:1}];function Ct(t){const e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(let e=0,n=t.length;e<n;e++)i[e]=t.charCodeAt(e);return new Uint8Array(e)}const Tt={ftyp:Ct("ftyp"),mvhd:Ct("mvhd"),moov:Ct("moov"),trak:Ct("trak"),tkhd:Ct("tkhd"),mdia:Ct("mdia"),mdhd:Ct("mdhd"),hdlr:Ct("hdlr"),minf:Ct("minf"),vmhd:Ct("vmhd"),smhd:Ct("smhd"),dinf:Ct("dinf"),dref:Ct("dref"),stbl:Ct("stbl"),stsd:Ct("stsd"),avc1:Ct("avc1"),av01:Ct("av01"),av1C:Ct("av1C"),avcC:Ct("avcC"),esds:Ct("esds"),colr:Ct("colr"),nclx:Ct("nclx"),mvex:Ct("mvex"),trex:Ct("trex"),udta:Ct("udta"),meta:Ct("meta"),ilst:Ct("ilst"),moof:Ct("moof"),mfhd:Ct("mfhd"),traf:Ct("traf"),tfhd:Ct("tfhd"),tfdt:Ct("tfdt"),trun:Ct("trun"),mdat:Ct("mdat"),mp4a:Ct("mp4a"),Opus:Ct("Opus"),prft:Ct("prft"),dOps:Ct("dOps"),emsg:Ct("emsg")},xt=Ct("iso6"),It=new Uint8Array([0,0,2,0]),Rt=[xt,new Uint8Array([105,115,111,109]),new Uint8Array([105,115,111,50]),new Uint8Array([97,118,99,49]),new Uint8Array([109,112,52,49])],Lt=[xt,new Uint8Array([105,115,111,109]),new Uint8Array([105,115,111,50]),new Uint8Array([97,118,48,49]),new Uint8Array([109,112,52,49])],Pt=[xt,new Uint8Array([105,115,111,109]),new Uint8Array([105,115,111,50]),new Uint8Array([109,112,52,49])];class Mt{constructor(){A(this,"writer",new N)}}const Bt=(t,e,i)=>{t.writer.writeUint32(i+8),t.writer.writeBytes(e)},_t=(t,e,i,n,s)=>{Bt(t,e,i+4),t.writer.writeUint8(n),t.writer.writeUint24(s)},Ut=(t,e)=>{Bt(t,Tt.ftyp,xt.byteLength+It.byteLength+e.reduce(((t,e)=>t+e.byteLength),0)),t.writer.writeBytes(xt),t.writer.writeBytes(It),e.forEach((e=>t.writer.writeBytes(e)))},Nt=t=>"sequenceParameterSets"in t,Dt=t=>"sequenceHeader"in t,Ft=t=>"video"==t.type,Ot=t=>"audio"==t.type,Wt=(t,e,i)=>{let n=3;for(t.writer.writeUint8(e);n>0;n--)t.writer.writeUint8(i>>7*n|128);t.writer.writeUint8(127&i)},Gt=(t,e)=>{const i=t.writer.position();Bt(t,Tt.minf,0),Ft(e)?(_t(t,Tt.vmhd,8,0,1),t.writer.writeUint32(0),t.writer.writeUint32(0)):Ot(e)&&(_t(t,Tt.smhd,4,0,0),t.writer.writeUint16(0),t.writer.writeUint16(0)),(t=>{const e=t.writer.position();Bt(t,Tt.dinf,0),_t(t,Tt.dref,16,0,0),t.writer.writeUint32(1),_t(t,Ct("url "),0,0,1),t.writer.writeUint32At(e,t.writer.position()-e)})(t),((t,e)=>{const i=t.writer.position();Bt(t,Tt.stbl,0);const n=t.writer.position();_t(t,Tt.stsd,0,0,0),t.writer.writeUint32(1),Ft(e)?((t,e)=>{const i=t.writer.position(),n=Dt(e)?Tt.av01:Tt.avc1;Bt(t,n,0),t.writer.writeUint32(0),t.writer.writeUint16(0),t.writer.writeUint16(1),t.writer.writeUint16(0),t.writer.writeUint16(0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint16(e.width),t.writer.writeUint16(e.height),t.writer.writeUint32(4718592),t.writer.writeUint32(4718592),t.writer.writeUint32(0),t.writer.writeUint16(1),t.writer.writeUint8(0),t.writer.writeBytes(new Uint8Array(31)),t.writer.writeUint16(24),t.writer.writeUint16(-1),Nt(e)?((t,e)=>{const i=t.writer.position();Bt(t,Tt.avcC,0),t.writer.writeUint8(1),t.writer.writeUint8(e.sequenceParameterSets[0][1]),t.writer.writeUint8(e.sequenceParameterSets[0][2]),t.writer.writeUint8(e.sequenceParameterSets[0][3]),t.writer.writeUint8(255),t.writer.writeUint8(224|e.sequenceParameterSets.length),e.sequenceParameterSets.forEach((e=>{t.writer.writeUint16(e.byteLength),t.writer.writeBytes(e)})),t.writer.writeUint8(e.pictureParameterSets.length),e.pictureParameterSets.forEach((e=>{t.writer.writeUint16(e.byteLength),t.writer.writeBytes(e)})),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e):Dt(e)&&(((t,e)=>{var i,n;const s=t.writer.position();Bt(t,Tt.av1C,0);const{seqProfile:r,operatingPoints:o,colorConfig:a}=e.parsedSequenceHeader,l=o[0];t.writer.writeUint8(129),t.writer.writeUint8(r<<5|(null!=(i=null==l?void 0:l.seqLevelIdx)?i:0)),t.writer.writeUint8((null!=(n=null==l?void 0:l.tier)?n:0)|(a.highBitDepth?1:0)|(12===a.bitDepth?1:0)<<5|(a.monoChrome?1:0)<<4|a.subsamplingX<<3|a.subsamplingY<<2|65535&a.chromaSamplePosition),t.writer.writeUint8(0),t.writer.writeBytes(e.sequenceHeader),t.writer.writeUint32At(s,t.writer.position()-s)})(t,e),e.parsedSequenceHeader.colorConfig&&(Bt(t,Ct("colr"),11),t.writer.writeBytes(Tt.nclx),t.writer.writeUint16(e.parsedSequenceHeader.colorConfig.colorPrimaries),t.writer.writeUint16(e.parsedSequenceHeader.colorConfig.transferCharacteristics),t.writer.writeUint16(e.parsedSequenceHeader.colorConfig.matrixCoefficients),t.writer.writeUint8(e.parsedSequenceHeader.colorConfig.colorRange?1:0))),e.pixelAspectRatio&&(Bt(t,Ct("pasp"),8),t.writer.writeUint32(e.pixelAspectRatio.numerator),t.writer.writeUint32(e.pixelAspectRatio.denumerator)),e.bitrate&&(Bt(t,Ct("btrt"),12),t.writer.writeUint32(0),t.writer.writeUint32(e.bitrate),t.writer.writeUint32(e.bitrate)),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e):Ot(e)&&((t,e)=>{const i=t.writer.position();switch(Bt(t,Ct((t=>{switch(t){case"aac":case"mp3":return"mp4a";case"opus":return"Opus"}})(e.codec)),0),t.writer.writeUint32(0),t.writer.writeUint16(0),t.writer.writeUint16(1),t.writer.writeUint16(0),t.writer.writeUint16(0),t.writer.writeUint32(0),t.writer.writeUint16(e.channelCount),t.writer.writeUint16(16),t.writer.writeUint32(0),t.writer.writeUint16(e.sampleRate),t.writer.writeUint16(0),e.codec){case"aac":case"mp3":((t,e)=>{const i=e.decoderConfig.byteLength>0?e.decoderConfig.byteLength+5:0,n=t.writer.position();_t(t,Tt.esds,0,0,0),Wt(t,3,21+i+5+1),t.writer.writeUint16(e.trackId),t.writer.writeUint8(0),Wt(t,4,13+i);const s="mp3"===e.codec&&e.sampleRate>24e3?107:64;t.writer.writeUint8(s),t.writer.writeUint8(21),t.writer.writeUint24(0),t.writer.writeUint32(e.bitrate||0),t.writer.writeUint32(e.bitrate||0),e.decoderConfig.byteLength>0&&(Wt(t,5,e.decoderConfig.byteLength),t.writer.writeBytes(e.decoderConfig)),Wt(t,6,1),t.writer.writeUint8(2),t.writer.writeUint32At(n,t.writer.position()-n)})(t,e);break;case"opus":((t,e)=>{const i=t.writer.position();Bt(t,Ct("dOps"),0),t.writer.writeUint8(0);const n=e.decoderConfig,s=new DataView(n.buffer,n.byteOffset,n.byteLength);t.writer.writeUint8(s.getUint8(9)),t.writer.writeUint16(s.getUint16(10,!0)),t.writer.writeUint32(s.getUint32(12,!0)),t.writer.writeUint16(s.getUint16(16,!0)),t.writer.writeBytes(e.decoderConfig.slice(18)),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e)}e.bitrate&&(Bt(t,Ct("btrt"),12),t.writer.writeUint32(0),t.writer.writeUint32(e.bitrate),t.writer.writeUint32(e.bitrate)),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(n,t.writer.position()-n),_t(t,Ct("stts"),4,0,0),t.writer.writeUint32(0),_t(t,Ct("stsc"),4,0,0),t.writer.writeUint32(0),_t(t,Ct("stsz"),8,0,0),t.writer.writeUint32(0),t.writer.writeUint32(0),_t(t,Ct("stco"),4,0,0),t.writer.writeUint32(0),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(i,t.writer.position()-i)},zt=(t,e,i)=>{const n=t.writer.position();Bt(t,Tt.trak,0),((t,e,i)=>{const n=t.writer.position();_t(t,Tt.tkhd,0,0,3),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(e.trackId),t.writer.writeUint32(0),t.writer.writeUint32(e.duration*i/e.timescale),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint16(0),t.writer.writeUint16(Ot(e)?1:0),t.writer.writeUint16(Ot(e)?256:0),t.writer.writeUint16(0),t.writer.writeBytes(new Uint8Array([0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0])),Ft(e)?(t.writer.writeUint32(65536*e.width),t.writer.writeUint32(65536*e.height)):Ot(e)&&(t.writer.writeUint32(0),t.writer.writeUint32(0)),t.writer.writeUint32At(n,t.writer.position()-n)})(t,e,i),((t,e)=>{const i=t.writer.position();Bt(t,Tt.mdia,0),((t,e)=>{_t(t,Tt.mdhd,20,0,0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(e.timescale),t.writer.writeUint32(e.duration);const i=e.lang||"und",n=(31&i.charCodeAt(0))<<10|(31&i.charCodeAt(1))<<5|31&i.charCodeAt(2);t.writer.writeUint16(n),t.writer.writeUint16(0)})(t,e),((t,e)=>{const i=t.writer.position();_t(t,Tt.hdlr,0,0,0),t.writer.writeUint32(0),t.writer.writeBytes(Ct(Ft(e)?"vide":"soun")),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeBytes(Ct(Ft(e)?"VideoHandler\0":"SoundHandler\0")),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),Gt(t,e),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(n,t.writer.position()-n)},Ht=(t,e,i,n)=>{const s=t.writer.position();Bt(t,Tt.moov,0),((t,e,i)=>{_t(t,Tt.mvhd,96,0,0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(i),t.writer.writeUint32(0),t.writer.writeUint32(65536),t.writer.writeUint16(256),t.writer.writeBytes(new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),t.writer.writeUint32(2)})(t,0,i),e.forEach((e=>zt(t,e,i))),((t,e)=>{const i=t.writer.position();Bt(t,Tt.mvex,0),e.forEach((e=>((t,e)=>{_t(t,Tt.trex,20,0,0),t.writer.writeUint32(e.trackId),t.writer.writeUint32(1),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(0)})(t,e))),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(s,t.writer.position()-s)},Vt=t=>t.isSync?33554432:16842752,Xt=(t,e)=>{const i=t.writer.position();Bt(t,Tt.moof,0),((t,e)=>{_t(t,Tt.mfhd,4,0,0),t.writer.writeUint32(e)})(t,e.sequenceNumber),((t,e)=>{const i=t.writer.position();Bt(t,Tt.traf,0),((t,e)=>{const i=t.writer.position();_t(t,Tt.tfhd,16,0,56),t.writer.writeUint32(e.trackId),t.writer.writeUint32(e.defaultDuration||0),t.writer.writeUint32(e.defaultSize||0),t.writer.writeUint32(e.defaultFlags||0),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),((t,e)=>{const i=t.writer.position();_t(t,Tt.tfdt,8,1,0);const n=Math.floor(e.timestamp/4294967296),s=(4294967295&e.timestamp)>>>0;t.writer.writeUint32(n),t.writer.writeUint32(s),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),((t,e)=>{const i=e.samples.some((t=>!!t.compositionTimeOffset)),n=Vt(e.samples[0])!==e.defaultFlags;let s=1;n&&(s|=4),i&&(s|=2048);const r=t.writer.position();_t(t,Tt.trun,16,1,s),t.writer.writeUint32(e.samples.length);const o=t.writer.position();t.writer.writeUint32(0),n&&t.writer.writeUint32(Vt(e.samples[0])),i&&e.samples.forEach((e=>t.writer.writeUint32(e.compositionTimeOffset||0))),t.writer.writeUint32At(o,t.writer.position()+8),t.writer.writeUint32At(r,t.writer.position()-r)})(t,e),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(i,t.writer.position()-i)},Qt=(t,e)=>{const i=new Mt,n=t.filter((t=>Ft(t)&&Nt(t))).length>0;return t.filter((t=>Ft(t)&&Dt(t))).length>0?Ut(i,Lt):Ut(i,n?Rt:Pt),Ht(i,t,1e3),i.writer.buffer()},jt=t=>{const e=new Mt;if(1!==t.samples.length)throw new Error("Only one sample is supported");return Xt(e,t),((t,e)=>{Bt(t,Tt.mdat,e.samples[0].data.length),t.writer.writeBytes(e.samples[0].data)})(e,t),e.writer.buffer()},qt=t=>{const{sequenceParameterSets:e,pictureParameterSets:i}=Et(t),n=e[0],s=i[0];if(!n||!s)throw new Error("No sps or pps provided");return(t=>{var e;const i=new DataView(t),n=i.getUint8(1),s=i.getUint8(2),r=i.getUint8(3),o=new C(t,32);o.readUnsignedExpGolomb();let a=1;switch(n){case 100:case 110:case 122:case 244:case 44:case 83:case 86:case 118:case 128:case 138:case 144:if(a=o.readUnsignedExpGolomb(),3===a&&o.readBits(1),o.readUnsignedExpGolomb(),o.readUnsignedExpGolomb(),o.readBit(),o.readBit())for(let t=0;t<(3!=a?8:12);t++)if(o.readBit()){const e=t<6?16:64;let i=0,n=8,s=8;for(let t=0;t<e;t++)0!=s&&(i=o.readSignedExpGolomb(),s=(n+i+256)%256),n=0==s?n:s}}o.readUnsignedExpGolomb();const l=o.readUnsignedExpGolomb();if(0==l)o.readUnsignedExpGolomb();else if(1==l)throw new Error("Unhandled case");o.readUnsignedExpGolomb(),o.readBit();const h=o.readUnsignedExpGolomb(),c=o.readUnsignedExpGolomb(),d=o.readBit();0===d&&o.readBit(),o.readBit();let u=h+1,m=c+1;if(m*=2-d,m*=16,u*=16,o.readBit()){const t=1<<(1==a||2==a?1:0),e=2-d<<(1==a?1:0);u-=o.readUnsignedExpGolomb()*t+o.readUnsignedExpGolomb()*t,m-=o.readUnsignedExpGolomb()*e+o.readUnsignedExpGolomb()*e}let p={numerator:1,denumerator:1};return o.readBit()&&o.readBit()&&(p=null!=(e=kt[o.readBits(8)])?e:{numerator:0,denumerator:0}),{width:u,height:m,pixelAspectRatio:p,profileIdc:n,constraintFlags:s,levelIdc:r}})(n)},Zt=t=>{const e=new C(t);return 1===e.peekBit()&&e.readBits(32),$t(e),Jt(e)},$t=t=>{const e=t.readBits(8);if(e>>7&1)return;const i=e>>3&15,n=e>>2&1,s=e>>1&1;return 1==n&&t.readBits(8),1==s&&(t=>{let e=0;for(let i=0;i<8;i++){const n=t.readBits(8);if(e|=(127&n)<<7*i,128&~n)break}})(t),{headerLength:1+n,type:i}},Jt=t=>{const e=t.readBits(3),i=0!==t.readBit(),n=0!==t.readBit();let s,r=!1,o=!1,a=!1,l=0,h=0;const c=[];if(n)t.readBits(5);else{if(o=0!==t.readBit(),o&&(s=(t=>{const e=t.readBits(32),i=t.readBits(32),n=0!==t.readBit();let s=0;return n&&(s=(t=>{let e=0;for(;e<100&&0===t.readBit();)e++;return e>=32?0:t.readBits(e)+(1<<e)-1})(t)+1),{timescale:i,equalPictureInterval:n,numUnitsInDisplayTick:e,numTicksPerPicture:s}})(t),r=0!==t.readBit(),r))throw new Error("Not implemented");a=0!==t.readBit();const e=t.readBits(5)+1;for(let i=0;i<e;i++){const e=t.readBits(12),i=t.readBits(5);let n=0;if(i>7&&(n=t.readBit()),r)throw new Error("decoderModelInfoPresentFlag==1");a&&0!==t.readBit()&&t.readBits(4),c.push({tier:n,operatingPointIdc:e,seqLevelIdx:i})}}const d=t.readBits(4)+1,u=t.readBits(4)+1,m=t.readBits(d)+1,p=t.readBits(u)+1;let A=!1;A=!n&&0!==t.readBit(),A&&(l=t.readBits(4)+2,h=t.readBits(3)+1);const g=0!==t.readBit(),f=0!==t.readBit(),v=0!==t.readBit();let b=!1,w=!1,S=!1,y=!1,E=!1,k=!1,C=!1,T=2,x=2,I=0;return n||(b=0!==t.readBit(),w=0!==t.readBit(),S=0!==t.readBit(),y=0!==t.readBit(),E=0!==t.readBit(),E&&(k=0!==t.readBit(),C=0!==t.readBit()),T=0!==t.readBit()?2:t.readBit(),x=T>0?t.readBit()>0?2:t.readBit():2,I=E?t.readBits(3):0),{seqProfile:e,stillPicture:i,reducedStillPictureHeader:n,timingInfoPresentFlag:o,timingInfo:null!=s?s:{equalPictureInterval:!1,numUnitsInDisplayTick:0,timescale:0,numTicksPerPicture:0},decoderModelInfoPresentFlag:r,initialDisplayDelayPresentFlag:a,operatingPoints:c,frameWidthBits:d,frameHeightBits:u,maxFrameWidth:m,maxFrameHeight:p,frameIdNumbersPresentFlag:A,deltaFrameIdLength:l,additionalFrameIdLength:h,use_128x128Superblock:g,enableFilterIntra:f,enableIntraEdgeFilter:v,enableInterintraCompound:b,enableMaskedCompound:w,enableWarpedMotion:S,enableDualFilter:y,enableOrderHint:E,enableJntComp:k,enableRefFrameMvs:C,seqForceScreenContentTools:T,seqForceIntegerMv:x,orderHintBits:I,enableSuperres:0!==t.readBit(),enableCdef:0!==t.readBit(),enableRestoration:0!==t.readBit(),colorConfig:Yt(t,e),filmGrainParamsPresent:0!==t.readBit()}},Yt=(t,e)=>{const i=0!==t.readBit();let n=8,s=!1;2===e&&i?n=0!==t.readBit()?12:10:e<=2&&(n=i?10:8),s=1!==e&&0!==t.readBit();const r=s?1:3;let o=2,a=2,l=2,h=!1,c=0,d=0,u=0,m=!1;return 0!==t.readBit()&&(o=t.readBits(8),a=t.readBits(8),l=t.readBits(8)),s?(h=0!==t.readBit(),c=1,d=1,u=0,m=!1,{highBitDepth:i,bitDepth:n,monoChrome:s,chromaSamplePosition:u,colorPrimaries:o,colorRange:h,matrixCoefficients:l,numPlanes:r,separateUvDeltaQ:m,subsamplingX:c,subsamplingY:d,transferCharacteristics:a}):1===o&&13==a&&0==l?(h=!0,c=0,d=0,{highBitDepth:i,bitDepth:n,monoChrome:s,chromaSamplePosition:u,colorPrimaries:o,colorRange:h,matrixCoefficients:l,numPlanes:r,separateUvDeltaQ:m,subsamplingX:c,subsamplingY:d,transferCharacteristics:a}):(h=0!==t.readBit(),0===e?(c=1,d=1):1===e?(c=0,d=0):12===n?(c=t.readBit(),d=0!==c?t.readBit():0):(c=1,d=0),0!==c&&0!==d&&(u=t.readBits(2)),m=0!==t.readBit(),{highBitDepth:i,bitDepth:n,monoChrome:s,chromaSamplePosition:u,colorPrimaries:o,colorRange:h,matrixCoefficients:l,numPlanes:r,separateUvDeltaQ:m,subsamplingX:c,subsamplingY:d,transferCharacteristics:a})},Kt=t=>!!(1&t),te=()=>"wakeLock"in navigator&&-1===window.navigator.userAgent.indexOf("Samsung");class ee{constructor(){A(this,"enabled",!1),A(this,"wakeLockVideo"),A(this,"_wakeLock",null),A(this,"handleVisibilityChange",(()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable()})),te()&&(this._wakeLock=null,document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange))}_addSourceToVideo(t,e,i){const n=document.createElement("source");n.src=i,n.type=`video/${e}`,t.appendChild(n)}get isEnabled(){return this.enabled}attach(t){if(!te()){if(!this.wakeLockVideo){const t=document.createElement("video");this.wakeLockVideo=t,this.wakeLockVideo.setAttribute("title","Live Stream"),this.wakeLockVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.wakeLockVideo,"mp4","data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"),Object.assign(this.wakeLockVideo.style,{position:"absolute",left:"-100%",top:"-100%"}),this.wakeLockVideo.addEventListener("loadedmetadata",(()=>{t.addEventListener("timeupdate",(()=>{t.currentTime>.5&&(t.currentTime=Math.random())}))}))}t&&t.appendChild(this.wakeLockVideo)}}enable(){return y(this,null,(function*(){var t,e;return te()?navigator.wakeLock.request("screen").then((t=>{this._wakeLock=t,this.enabled=!0,this._wakeLock.addEventListener("release",(()=>{}))})).catch((()=>{this.enabled=!1})):(null!=(e=null==(t=this.wakeLockVideo)?void 0:t.play())?e:Promise.resolve()).then((t=>(this.enabled=!0,t))).catch((()=>{this.enabled=!1}))}))}disable(){var t,e;te()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):(null==(t=this.wakeLockVideo)||t.pause(),null==(e=this.wakeLockVideo)||e.remove()),this.enabled=!1}unload(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange),this.disable()}}const ie=/\r\n|\r|\n/;var ne,se,re,oe,ae;class le{constructor(t){v(this,ne),v(this,se),b(this,ne,t),b(this,se,0)}skipEmptyLines(){let t=0;for(;""===f(this,ne)[f(this,se)];)S(this,se)._++,t++;return t}readLine(){return f(this,ne)[S(this,se)._++]}takeUntilEmptyLine(){const t=[];for(;""!==f(this,ne)[f(this,se)];){const e=this.readLine();if(void 0===e)break;t.push(e)}return t}linesLeft(){return f(this,ne).length-f(this,se)}}ne=new WeakMap,se=new WeakMap;class he{constructor(){v(this,re)}parse(t){const e=[],i=t.split(ie),n=new le(i),s=n.readLine();if(!s||!s.startsWith("WEBVTT"))throw new Error("missing 'WEBVTT' signature");for(;""!==n.readLine(););for(;n.linesLeft()>0;){const t=w(this,re,oe).call(this,n);e.push(t),n.skipEmptyLines()}return e}}re=new WeakSet,oe=function(t){t.skipEmptyLines();const e=t.takeUntilEmptyLine(),i=new le(e);let n,s=i.readLine();if(null!=s&&s.includes("--\x3e")||(n=s,s=i.readLine()),void 0===s)throw new Error("expected cue line");const[r,o]=s.split("--\x3e").map((t=>t.trim()));if(!r||!o)throw new Error(`a cue needs both start and end time start: ${r} end: ${o}`);const[a,l]=o.split(" ",1).map((t=>t.trim()));if(!a)throw new Error(`missing end time: ${a}`);const h=i.readLine();if(!h)throw new Error("missing text");return{id:n,startTime:w(this,re,ae).call(this,r),endTime:w(this,re,ae).call(this,a),text:h}},ae=function(t){const e=t.split(":");if(2==e.length){const[t=0,i=0]=e.map((t=>parseFloat(t)));return 60*t+i}const[i=0,n=0,s=0]=e.map((t=>parseFloat(t)));return 60*i*60+60*n+s};class ce extends n.E{constructor({type:t,autoplay:e,muted:i,logger:n,poster:s}){super(),A(this,"element"),A(this,"logger"),A(this,"seekTimes",new k(10)),A(this,"seekStartTime"),A(this,"_userProvidedMuted"),A(this,"timers",new nt),A(this,"_userHasProvidedInput",!1),A(this,"_isPaused",!0),A(this,"isActivated",!1),A(this,"dummy"),A(this,"_iosHackEnterPiPMode",(()=>{const t=this.element.parentElement,e=this.element.clientWidth/this.element.clientHeight;this.element.style.position="fixed",this.element.style.opacity="0",this.element.style.pointerEvents="none",t&&(this.dummy=document.createElement("video"),this.dummy.style.paddingBottom="calc(100% / "+e+")",this.dummy.style.width="100%",this.dummy.style.height="0px",t.appendChild(this.dummy))})),A(this,"_iosHackExitPiPMode",(()=>{this.element.style.position="relative",this.element.style.opacity="1",this.element.style.pointerEvents="auto",this.dummy&&(this.dummy.remove(),this.dummy=void 0)})),A(this,"attach",(t=>{this.element.remove(),t.appendChild(this.element)})),A(this,"load",(()=>{this.timers.setInterval(this.onPlayPause,500),this.timers.setTimeout((()=>{this.timers.setInterval(this.onBufferStateChange,500)}),1e4)})),A(this,"unload",(()=>{this.timers.unload()})),A(this,"getPlaybackRate",(()=>this.element.playbackRate)),A(this,"getPlaybackState",(()=>this.element.readyState>=this.element.HAVE_FUTURE_DATA?"playing":"buffering")),A(this,"setPlaybackRate",(t=>{this.element.playbackRate=t})),A(this,"getBuffer",(()=>{const t=[],e=this.element.buffered;if(!e)return[];for(let i=0;i<e.length;i++)t.push({start:1e3*e.start(i),end:1e3*e.end(i)});return t})),A(this,"pause",(()=>{this._isPaused=!1,this.element.pause()})),A(this,"tryPlay",(()=>{this.element.muted=this._userProvidedMuted,this._play().catch($)})),A(this,"play",(()=>{this.element.muted=this._userProvidedMuted,this._play().catch((t=>{if(t instanceof Error){const e=new mt("Media Play Error",{source:t,isFatal:!1,code:"media_play_error"});this.emit("error",e)}}))})),A(this,"_play",(()=>y(this,null,(function*(){try{yield this.element.play(),this._userHasProvidedInput=!this.muted||this._userProvidedMuted}catch(t){if(!(t instanceof Error&&"NotAllowedError"===t.name))throw t;if(this._userHasProvidedInput=!1,!this.element.muted)return this.element.muted=!0,this.emit("needs user input",{forAudio:!0,forVideo:!1}),this._play();this.emit("needs user input",{forAudio:!0,forVideo:!0})}})))),A(this,"onEvent",(t=>{this.logger.trace(t.type,{state:this.element.readyState,event:t,playbackState:this.getPlaybackState()})})),A(this,"onVolumeChange",(()=>{this.logger.info("volume state",{isMuted:this.element.muted,volume:this.element.volume}),this.emit("volume state",{isMuted:this.element.muted,volume:this.element.volume})})),A(this,"onPlayPause",(()=>{this._isPaused!==this.element.paused&&(this._isPaused=this.element.paused,this.logger.info("player pause change",{paused:this.element.paused}),this.emit("media element state",this.element.paused?"paused":"playing"))})),A(this,"onBufferStateChange",(()=>{this.emit("buffer state",{isPaused:this.element.paused,buffered:this.getBuffer(),currentTime:this.currentTime,playbackState:this.getPlaybackState()})})),A(this,"onSeekStart",(()=>{this.seekStartTime=Date.now()})),A(this,"onSeekEnd",(()=>{this.seekStartTime&&(this.seekTimes.push(Date.now()-this.seekStartTime),this.seekStartTime=void 0)})),this.logger=n,this._userProvidedMuted=i,this.element=document.createElement(t),this.element instanceof HTMLVideoElement&&(this.element.playsInline=!0),this.element.controls=!1,this.element.autoplay=e,this.element.muted=i,this.element.style.display="block",this.element.style.width="100%",this.element.disableRemotePlayback=!0,this.element.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="),this.onPlayPause(),setTimeout((()=>{!this.element||!s||this.element.setAttribute("poster",s)}),0),this.element.addEventListener("stalled",this.onEvent),this.element.addEventListener("canplay",this.onEvent),this.element.addEventListener("loadeddata",this.onEvent),this.element.addEventListener("loadedmetadata",this.onEvent),this.element.addEventListener("canplaythrough",this.onEvent),this.element.addEventListener("waiting",this.onEvent),this.element.addEventListener("playing",this.onPlayPause),this.element.addEventListener("pause",this.onPlayPause),this.element.addEventListener("seeked",this.onSeekEnd),this.element.addEventListener("seeking",this.onSeekStart),this.element.addEventListener("volumechange",this.onVolumeChange),this.element.addEventListener("timeupdate",this.onBufferStateChange),this.element.addEventListener("progress",this.onBufferStateChange)}get seekTime(){return this.seekTimes.isEmpty()?0:F(this.seekTimes.items())}get isSeeking(){return this.element.seeking}get currentTime(){return isNaN(this.element.currentTime)?0:1e3*this.element.currentTime}set currentTime(t){Number.isFinite(t)&&(this.element.currentTime=t/1e3)}get playbackRate(){return this.element.playbackRate}set playbackRate(t){this.element.playbackRate=t}get volume(){return this.element.volume}set volume(t){this.element.volume=t}get muted(){return this.element.muted}set muted(t){this._userProvidedMuted=t,this.element.muted=t}get userHasProvidedInput(){return this._userHasProvidedInput}get isPaused(){return this._isPaused}}const de=["minBufferTime","maxBufferTime","burstEnabled","sizeBasedResolutionCapEnabled","separateVideoSocketEnabled","videoCodecs"];class ue{constructor(t){A(this,"options"),A(this,"overrides",new Map),this.options=t}getOptions(){return this.options}addOverrides(t,e){this.overrides.set(t,e)}set(t,e){this.options[t]=e}get(t,e){var i,n;if(e&&(n=t,de.includes(n))){const n=null==(i=this.overrides.get(e))?void 0:i[t];if(void 0!==n)return n}return this.options[t]}getOverride(t,e){var i;return null==(i=this.overrides.get(e))?void 0:i[t]}}const me={sizeBasedResolutionCapEnabled:!0,pictureInPictureEnabled:!0,abrEnabled:!0,burstEnabled:!1,mseEnabled:!0,mseOpusEnabled:!1,muted:!1,minBufferTime:1500,maxBufferTime:1500,logLevel:"off",maxSize:dt(),maxVideoBitRate:ct(),maxAudioBitRate:ct(),tags:[],media:"audio+video",poster:!0,reconnectHandler:t=>t.reconnectRetries<30,iosWakeLockEnabled:!1,telemetryEnabled:!0,iosMediaElementEnabled:!1,pauseSupportEnabled:!0,advanced:{wasmDecodingConstraint:{bitRate:Number.MAX_SAFE_INTEGER,width:1280,height:1280}},videoCodecs:["av1","h264"]},pe={cooldownTime:3e3,maxBufferingEvents:{last10Seconds:0},maxBufferingRatio:{last10Seconds:0},maxRecentDowngradesCount:3,maxDowngradeLookbackMs:6e4,minTimeSpentPlaying:{factor:.5,ratio:.1},maxCooldownRatio:2},Ae=t=>e=>e>t,ge=class{constructor(t,e,i,n){A(this,"qualityOfServiceSource"),A(this,"config"),A(this,"emitter"),A(this,"logger"),A(this,"isSuspended",!1),A(this,"lastAdaptTime",Date.now()),A(this,"isEnabled",!0),A(this,"load",(()=>{this.emitter.on("buffer state",this.onBufferState),this.emitter.on("adapted level",this.onAdaptedLevel)})),A(this,"unload",(()=>{this.emitter.off("buffer state",this.onBufferState),this.emitter.off("adapted level",this.onAdaptedLevel)})),A(this,"suspend",(()=>{this.isSuspended=!0})),A(this,"unsuspend",(()=>{this.reset(),this.isSuspended=!1})),A(this,"reset",((t=0)=>{this.lastAdaptTime=Date.now()+t})),A(this,"getStatistics",(()=>({isAbrEnabled:this.isEnabled}))),A(this,"isQoSOk",(t=>{const e=this.qualityOfServiceSource.getLevelStats(t),{upgradesFromLevel:i,downgradesFromLevel:n}=null!=e?e:{upgradesFromLevel:[],downgradesFromLevel:[]},s=Date.now()-this.config.maxDowngradeLookbackMs,r=n.filter(Ae(s)).length,o=i.filter(Ae(s)).length;if(r-o>this.config.maxRecentDowngradesCount)return this.logger.debug("Recent downgrades count is over maximum",{downgrades:r-o,maxRecentDowngradesCount:this.config.maxRecentDowngradesCount}),!1;const a=this.qualityOfServiceSource.timeSpentPlayingInAtLeastLevelRatio(t),l=a*(this.qualityOfServiceSource.timeActive()-this.qualityOfServiceSource.timeSpentBuffering())/this.config.maxDowngradeLookbackMs;if(r>1&&l<this.config.minTimeSpentPlaying.factor)return this.logger.debug("Time spent playing is too low",{recentDowngrades:r,timeSpentPlayingInAtLeastLevelRatio:a}),!1;if(r>1&&a<this.config.minTimeSpentPlaying.ratio)return this.logger.debug("Time spent playing in at least this level is too low",{recentDowngrades:r,timeSpentPlayingInAtLeastLevelRatio:a}),!1;const h=Math.max(0,n.length-i.length-l),c=Date.now()-this.config.maxDowngradeLookbackMs*h,d=n.filter(Ae(c)).length;return!(d&&h>this.config.maxCooldownRatio&&(this.logger.debug("Too many downgrades compared to time spent playing",{downgradesWithinCooldownTime:d,cooldownRatio:h}),1))})),A(this,"onBufferState",(t=>{if(!this.isEnabled||this.isSuspended||this.lastAdaptTime+this.config.cooldownTime>Date.now())return;const{bufferFullness:e,general:i}=this.qualityOfServiceSource.getMetrics(),n=this.qualityOfServiceSource.getBufferFullnessRegression();if(!n)return;const{slope:s}=n,r=n.predict(15),o=s<0,a=n.predict(15)<.4&&n.slope<0,l=n.predict(15)>.6,h=this.qualityOfServiceSource.timeSpentBufferingLast(3e4),c=this.qualityOfServiceSource.timeSpentActiveLast(3e4);e<.15&&h/c>.8?this.adaptLevel("reconnect"):i.decodeRate<=1?this.adaptLevel("downgrade"):a||e<.15?o&&e<.4&&r<.2&&this.adaptLevel("buffering"===t.playbackState?"double downgrade":"downgrade"):e>.5&&l&&!this.tooMuchTimeBuffering(1e4)&&!this.tooManyBufferingEvents(1e4)&&this.adaptLevel("upgrade")})),A(this,"onAdaptedLevel",(()=>{this.reset()})),A(this,"adaptLevel",(t=>this.emitter.emit("adapt level",t))),this.qualityOfServiceSource=i,this.config=m(m({},pe),n),this.emitter=t,this.logger=e}tooMuchTimeBuffering(t){return this.qualityOfServiceSource.timeSpentBufferingLast(t)/this.qualityOfServiceSource.timeSpentActiveLast(t)>this.config.maxBufferingRatio.last10Seconds}tooManyBufferingEvents(t){return this.qualityOfServiceSource.timeSpentBufferingLast(t)>this.config.maxBufferingEvents.last10Seconds}};A(ge,"create",((t,e,i,n={})=>new ge(t,e,i,n)));let fe=ge;const ve={minBufferTime:1500,maxBufferTime:1500,cooldownTime:3e4,maxBufferingEvents:{last30Seconds:3},maxBufferingRatio:{last30Seconds:.15}},be=class t{constructor(e,i,n,s,r){A(this,"qualityOfServiceSource"),A(this,"targetBufferTimeTarget"),A(this,"config"),A(this,"emitter"),A(this,"logger"),A(this,"isSuspended",!1),A(this,"lastIncreaseTime",Date.now()),A(this,"bufferTimeAdjustmentCount",0),A(this,"load",(()=>{this.emitter.on("buffer state",this.onBufferState)})),A(this,"unload",(()=>{this.emitter.off("buffer state",this.onBufferState)})),A(this,"suspend",(()=>{this.isSuspended=!0})),A(this,"unsuspend",(()=>{this.reset(),this.isSuspended=!1})),A(this,"reset",(()=>{this.lastIncreaseTime=Date.now()})),A(this,"getStatistics",(()=>({bufferTimeAdjustmentCount:this.bufferTimeAdjustmentCount}))),A(this,"onBufferState",(e=>{const{minBufferTime:i,maxBufferTime:n,cooldownTime:s}=this.config;if(this.isSuspended||this.lastIncreaseTime+s>Date.now()||this.targetBufferTimeTarget.targetBufferTime>=n)return;const r=this.qualityOfServiceSource.timeSpentBufferingLast(3e4),o=this.qualityOfServiceSource.bufferingEventsLast(3e4),a=r/this.qualityOfServiceSource.timeSpentActiveLast(3e4),l=Math.ceil(Math.max((n-i)/(t.BUFFER_TIME_MAX_STEPS-1),t.BUFFER_TIME_STEP_SIZE));(a>this.config.maxBufferingRatio.last30Seconds||o>this.config.maxBufferingEvents.last30Seconds)&&(this.targetBufferTimeTarget.targetBufferTime=Math.min(n,this.targetBufferTimeTarget.targetBufferTime+l),this.bufferTimeAdjustmentCount++,this.reset())})),this.qualityOfServiceSource=n,this.targetBufferTimeTarget=s,this.config=m(m({},ve),r),this.emitter=e,this.logger=i}updateConfig(t){this.config=m(m({},this.config),t)}};A(be,"BUFFER_TIME_STEP_SIZE",500),A(be,"BUFFER_TIME_MAX_STEPS",3),A(be,"create",((t,e,i,n,s={})=>new be(t,e,i,n,s)));let we=be;class Se extends n.E{constructor(t,e){super(),A(this,"options"),A(this,"websockets",[]),A(this,"logger"),A(this,"reconnectState",{reconnectRetries:0}),A(this,"isSuspended",!1),A(this,"_connectionAttemptCount",0),A(this,"connectStartTime",0),A(this,"_connectTime"),A(this,"shouldContinueConnecting",!1),A(this,"_isConnectInProgress",!1),A(this,"readyState",(()=>{if(0===this.websockets.length)return WebSocket.CLOSED;const t=this.websockets.map((t=>t.readyState));for(const e of t)if(e!==WebSocket.OPEN)return e;return WebSocket.OPEN})),A(this,"url",(()=>{var t;return null==(t=this.websockets[0])?void 0:t.url})),A(this,"send",(t=>{var e;this.websockets.length&&(null==(e=this.websockets[0])||e.send(t))})),A(this,"close",(t=>{var e;let i=!1;return null==(e=this.websockets)||e.forEach((e=>{e.onmessage=$,e.removeEventListener("error",this.onError),e.removeEventListener("close",this.onClose),e.removeEventListener("open",this.onOpen),e.close(1e3,t),i=!0})),this.websockets=[],this.shouldContinueConnecting=!1,this._isConnectInProgress=!1,this.logger.info("Closed websocket",{reason:t}),i})),A(this,"suspend",(()=>{this.isSuspended=!0})),A(this,"unsuspend",(()=>{this.isSuspended=!1,this.readyState()!==WebSocket.OPEN&&!this.isConnectInProgress&&this.connect()})),A(this,"onMessage",((t,e)=>{0!==this.websockets.length&&this.options.onMessage(t,e.data)})),A(this,"onError",(()=>{this.logger.info("On error",m({},this.options)),this.close("one websocket had an error"),this.connect(!0)})),A(this,"onClose",(t=>{switch(this.logger.info("Closed",p(m({},this.options),{reason:t.reason,code:t.code,isSuspended:this.isSuspended})),this.close("one websocket was closed"),this.emit("close",this),t.code){case 4e3:case 4001:this.emit("error",bt(vt()));break;case 4002:this.emit("error",(e=vt(),new mt("Authentication Expired",{isFatal:!0,code:"authentication_expired",source:e})));break;case 4003:this.emit("error",wt("internal",vt())),this.connect(!0);break;case 4010:this.emit("error",((t,e)=>new mt("Connection closed due to inactivity",{isFatal:!1,code:"connection_inactivity",source:e,type:"internal"}))(0,vt())),this.connect(!0);break;default:this.connect(!0)}var e})),A(this,"onOpen",(()=>{this.logger.info("Opened",m({},this.options)),this.readyState()===WebSocket.OPEN&&(this._connectTime=Date.now()-this.connectStartTime,this.reconnectState.reconnectRetries=0,this._isConnectInProgress=!1,this.emit("open",this))})),A(this,"connect",((t=!1)=>y(this,null,(function*(){if(this.isConnectInProgress)return this.logger.info("Connect already in progress"),!1;if(this.isSuspended)return!1;if(this.readyState()!==WebSocket.CLOSED&&this.close("new connection in progress"),this.shouldContinueConnecting=!0,this._isConnectInProgress=!0,t&&this.options.reconnectDelay>0){this.logger.info("Waiting for reconnect delay",m({},this.options)),yield rt(this.options.reconnectDelay);const t=yield this.options.reconnectHandler(this.reconnectState);if(this.reconnectState.reconnectRetries++,!t)return this._isConnectInProgress=!1,this.emit("error",new mt("Connection failed - no more reconnect attempts",{isFatal:!0,code:"connection_failed_will_not_attempt_again"})),!1}this._connectionAttemptCount++;try{if(!this.shouldContinueConnecting)return this._isConnectInProgress=!1,this.logger.info("Connection aborted"),!1;const t=yield this.options.connectHandler();if(this.connectStartTime=Date.now(),!this.shouldContinueConnecting)return this._isConnectInProgress=!1,this.logger.info("Connection aborted"),!1;this.logger.info("Connecting websockets",p(m({},this.options),{url:t}));for(let e=0;e<this.options.connectionsCount;e++){const i=new WebSocket(t);i.binaryType="arraybuffer",i.onmessage=t=>this.onMessage(e,t),i.addEventListener("error",this.onError),i.addEventListener("close",this.onClose),i.addEventListener("open",this.onOpen),this.websockets.push(i)}return!0}catch(t){return this._isConnectInProgress=!1,!(t instanceof mt&&(this.logger.error("Failed to connect",t.toStringifiable()),t.isFatal()))&&!!this.shouldContinueConnecting&&(this.logger.info("Connection aborted",{error:t}),this.connect(!0))}})))),this.options=t,this.logger=e}get isConnectInProgress(){return this._isConnectInProgress}get connectionCount(){return this.options.connectionsCount}set connectionCount(t){this.options.connectionsCount=t}get connectionAttemptCount(){return this._connectionAttemptCount}get connectTime(){return this._connectTime}}const ye=t=>471859200/t,Ee=class t{constructor(e,i,n){A(this,"timers",nt.create()),A(this,"emitter"),A(this,"transport"),A(this,"logger"),A(this,"options"),A(this,"rtts",new k(10)),A(this,"lastPingSentTime",Date.now()),A(this,"isPingInFlight",!1),A(this,"connectCount",0),A(this,"_firstConnectionTime"),A(this,"_lastConnectionTime"),A(this,"missedPings",0),A(this,"_connectionsCount",2),A(this,"contextSwitchesInProgress",new Set),A(this,"contextSwitchesCompleted",new Set),A(this,"buffer",[]),A(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.disconnect("Unloading"),this.timers.unload(),this.emitter.off("send signal",this.sendSignal),this.emitter.off("disconnect",this.disconnect),this.emitter.off("reconnect",this.reconnect),this.logger.debug("Unloaded module")})),A(this,"suspend",(()=>{var t;this.resetPingState(),null==(t=this.transport)||t.suspend()})),A(this,"unsuspend",(()=>{var t;null==(t=this.transport)||t.unsuspend()})),A(this,"getState",(()=>{var t;switch(null==(t=this.transport)?void 0:t.readyState()){case WebSocket.OPEN:return"connected";case WebSocket.CONNECTING:return"connecting";default:return"disconnected"}})),A(this,"sendSignal",(t=>{var e,i;this.logger.debug("sending signal",{signal:t}),(null==(e=this.transport)?void 0:e.readyState())===WebSocket.OPEN?null==(i=this.transport)||i.send(t):this.logger.debug("transport is closed")})),A(this,"getStatistics",(()=>{var t,e,i;const n=O(this.rtts.items());return{rtt:n,estimatedBandwidth:ye(n.average),edgeUrl:null==(t=this.transport)?void 0:t.url(),connectCount:this.connectCount,connectionAttemptCount:null!=(i=null==(e=this.transport)?void 0:e.connectionAttemptCount)?i:0}})),A(this,"onMessage",((t,e)=>{var i;if(this.pingCooldownExpired()&&this.sendPing(),this.contextSwitchesCompleted.size===(null==(i=this.transport)?void 0:i.connectionCount)){this.logger.info("Completing context switch"),this.contextSwitchesInProgress.clear(),this.contextSwitchesCompleted.clear();const t=this.buffer.filter((([t,e])=>!(e instanceof ArrayBuffer))),e=this.buffer.filter((([t,e])=>e instanceof ArrayBuffer));t.map((t=>this.handleMessage(t[0],t[1]))),e.map((t=>this.handleMessage(t[0],t[1]))),this.buffer=[]}if(this.contextSwitchesInProgress.has(t)){if(!(e instanceof ArrayBuffer)){const i=JSON.parse(e);if(ut(i)&&"context switch complete"===i.type)return this.logger.info("context switch completed",{socketId:t}),this.emitter.emit("context switch complete"),void this.contextSwitchesCompleted.add(t)}this.buffer.push([t,e])}else this.handleMessage(t,e)})),A(this,"handleMessage",((t,e)=>{if(e instanceof ArrayBuffer)this.emitter.emit("received data",e);else{const i=JSON.parse(e);if(!ut(i))return;switch(i.type){case"pong":this.lastPingSentTime&&(this.rtts.push(Date.now()-this.lastPingSentTime),this.isPingInFlight=!1,this.emitter.emit("rtt",this.rtt));break;case"context switch":this.logger.info("Starting context switch",{socketId:t}),this.emitter.emit("context switch started"),this.contextSwitchesInProgress.add(t);break;default:this.emitter.emit("received signal",i)}}})),A(this,"connect",(t=>{this.disconnect("user connected"),this._connectionsCount=t,this.transport=new Se({reconnectDelay:1e3,connectionsCount:this._connectionsCount,onMessage:this.onMessage,reconnectHandler:this.options.reconnectHandler,connectHandler:this.options.connectHandler},this.logger.createContext("Transport")),this.transport.on("open",this.onTransportChange),this.transport.on("close",this.onTransportChange),this.transport.on("error",(t=>this.emitter.emit("error",t))),this.transport.connect()})),A(this,"onTransportChange",(()=>{var e;"connected"===this.getState()?(null!=(e=this.transport)&&e.connectTime&&(this.rtts.push(this.transport.connectTime/t.TLS_ROUNDTRIPS/this.transport.connectionCount),this.emitter.emit("rtt",this.rtt)),this._lastConnectionTime=Date.now(),this._firstConnectionTime||(this._firstConnectionTime=this._lastConnectionTime),this.connectCount++,this.resetPingState()):(this.contextSwitchesCompleted.clear(),this.contextSwitchesInProgress.clear(),this.buffer=[],this.resetPingState()),this.emitter.emit("connection state",this.getState())})),A(this,"disconnect",((t="Disconnect Requested")=>{var e;this.contextSwitchesCompleted.clear(),this.contextSwitchesInProgress.clear(),this.buffer=[],this.resetPingState(),null==(e=this.transport)||e.close(t)})),A(this,"reconnect",(t=>{var e;null!=(e=this.transport)&&e.isConnectInProgress?this.logger.debug("Stopping reconnect, already mid-connection"):(this.disconnect(t),this.connect(this._connectionsCount))})),A(this,"resetPingState",(()=>{this.missedPings=0,this.isPingInFlight=!1})),A(this,"pingCooldownExpired",(()=>Date.now()-this.lastPingSentTime>t.PING_INTERVAL)),A(this,"sendPing",(()=>{if(this.isPingInFlight)return this.missedPings++,void(this.missedPings>t.MAX_MISSED_PINGS&&this.reconnect("missed pings"));this.isPingInFlight=!0,this.lastPingSentTime=Date.now(),this.missedPings=0,this.sendSignal(JSON.stringify({type:"ping"}))})),this.logger=i,this.emitter=e,this.options=n,this.emitter.on("send signal",this.sendSignal),this.emitter.on("disconnect",this.disconnect),this.emitter.on("reconnect",this.reconnect)}get rtt(){return this.rtts.items().length>0?F(this.rtts.items()):0}get estimatedBandwidth(){return this.rtt>0?ye(this.rtt):void 0}get connectTime(){var t;return null==(t=this.transport)?void 0:t.connectTime}get firstConnectionTime(){return this._firstConnectionTime}get lastConnectionTime(){return this._lastConnectionTime}setConnectionCount(t){this._connectionsCount=t,this.transport&&(this.transport.connectionCount=t)}getConnectionCount(){return this._connectionsCount}};A(Ee,"PING_INTERVAL",5e3),A(Ee,"MAX_MISSED_PINGS",4),A(Ee,"TLS_ROUNDTRIPS",3),A(Ee,"create",((t,e,i)=>new Ee(t,e,i)));let ke=Ee;const Ce=()=>({video:p(m({},dt()),{bitRate:ct()}),audio:{bitRate:ct()}}),Te=class t{constructor(e,i,n,s){A(this,"emitter"),A(this,"timers",new nt),A(this,"pictureInPictureSource"),A(this,"element"),A(this,"currentCap"),A(this,"userSpecifiedCap"),A(this,"renditionLevelSource"),A(this,"resizeObserver"),A(this,"elementSize"),A(this,"_sizeBasedResolutionCapEnabled"),A(this,"unload",(()=>{var t;this.emitter.off("enter picture in picture",this.enterPictureInPicture),this.emitter.off("exit picture in picture",this.exitPictureInPicture),null==(t=this.resizeObserver)||t.disconnect(),this.suspend()})),A(this,"load",(()=>{window.ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.onResize),this.resizeObserver.observe(this.element)),this.evaluateConstraintCap()})),A(this,"unsuspend",(()=>{this.timers.setInterval(this.evaluateConstraintCap,t.CHECK_SIZE_INTERVAL),this.evaluateConstraintCap()})),A(this,"suspend",(()=>{this.timers.unload()})),A(this,"setUserSpecifiedCap",(t=>{var e;const i=null!=(e=this.getUserSpecifiedCap())?e:Ce();this.userSpecifiedCap=p(m({},i),{video:m(m({},i.video),t.video),audio:m(m({},i.audio),t.audio)}),this.evaluateConstraintCap()})),A(this,"getUserSpecifiedCap",(()=>this.userSpecifiedCap)),A(this,"getCurrentConstraintCap",(()=>this.currentCap)),A(this,"getStatistics",(()=>({constraintCap:this.getUserSpecifiedCap(),windowInnerWidth:window.innerWidth,windowInnerHeight:window.innerHeight,elementWidth:this.elementSize.width,elementHeight:this.elementSize.height,pixelRatio:window.devicePixelRatio}))),A(this,"constrainSubscription",(t=>{const e=this.getCurrentConstraintCap();return e&&(t.video.codec&&(t.video.bitRate=Math.min(e.video.bitRate,t.video.bitRate),t.video.width=Math.min(e.video.width,t.video.width),t.video.height=Math.min(e.video.height,t.video.height)),t.audio.codec&&(t.audio.bitRate=Math.min(e.audio.bitRate,t.audio.bitRate))),t})),A(this,"onResize",(t=>{t.forEach((t=>{this.elementSize={width:t.contentRect.width,height:t.contentRect.height}}))})),A(this,"evaluateConstraintCap",(()=>{var t,e,i,n,s;const r=this.sizeBasedResolutionCapEnabled?p(m({},Ce()),{video:{width:window.innerWidth,height:window.innerHeight,bitRate:ct()}}):Ce();if(!this.resizeObserver){const t=this.element.getBoundingClientRect();this.elementSize={width:t.width,height:t.height}}if(this.sizeBasedResolutionCapEnabled){const e=window.devicePixelRatio,i=null==(t=this.pictureInPictureSource)?void 0:t.getPictureInPictureSize();this.elementSize.width>0&&this.elementSize.height>0&&(r.video.width=this.elementSize.width,r.video.height=this.elementSize.height),i&&(r.video.width=i.width,r.video.height=i.height),r.video.width*=e,r.video.height*=e}const o=this.renditionLevelSource.getRenditionLevels().find((t=>{if(t.video)return t.video.width/t.video.height>r.video.width/r.video.height?t.video.width>r.video.width:t.video.height>r.video.height}));o&&o.video&&(r.video.width=o.video.width,r.video.height=o.video.height);const a=null==(e=this.userSpecifiedCap)?void 0:e.video,l=null==(i=this.userSpecifiedCap)?void 0:i.audio;a&&r.video.width>a.width&&r.video.height>a.height&&(r.video.width=a.width,r.video.height=a.height),r.video.bitRate=null!=(n=null==a?void 0:a.bitRate)?n:r.video.bitRate,r.audio.bitRate=null!=(s=null==l?void 0:l.bitRate)?s:r.audio.bitRate,G(r,this.currentCap)?this.currentCap=m({},r):(this.currentCap=m({},r),this.emitter.emit("constraint cap changed",r))})),A(this,"enterPictureInPicture",(t=>{this.pictureInPictureSource=t,this.evaluateConstraintCap()})),A(this,"exitPictureInPicture",(()=>{this.pictureInPictureSource=void 0,this.evaluateConstraintCap()})),this.element=i;const r=this.element.getBoundingClientRect();this.elementSize={width:r.width,height:r.height},this.emitter=e,this.renditionLevelSource=n,this._sizeBasedResolutionCapEnabled=s,this.emitter.on("enter picture in picture",this.enterPictureInPicture),this.emitter.on("exit picture in picture",this.exitPictureInPicture)}get sizeBasedResolutionCapEnabled(){return this._sizeBasedResolutionCapEnabled}set sizeBasedResolutionCapEnabled(t){this._sizeBasedResolutionCapEnabled=t,this.evaluateConstraintCap()}};A(Te,"CHECK_SIZE_INTERVAL",1e3),A(Te,"create",((t,e,i,n)=>new Te(t,e,i,n)));let xe=Te;class Ie{constructor(t,e,i,n){A(this,"timers",nt.create()),A(this,"logger"),A(this,"emitter"),A(this,"trackContexts"),A(this,"playbackSource"),A(this,"isSuspended",!1),A(this,"load",(()=>{this.timers.setInterval(this.emitDecodedFrames,100),this.timers.setInterval(this.emitDecodeRate,1e3),this.emitter.on("init segment",this.onInitSegment),this.emitter.on("coded sample",this.decode)})),A(this,"unload",(()=>{this.trackContexts.forEach((({decoderContext:t})=>t.unload())),this.timers.unload(),this.emitter.off("init segment",this.onInitSegment),this.emitter.off("coded sample",this.decode)})),A(this,"suspend",(()=>{this.isSuspended=!0})),A(this,"unsuspend",(()=>{this.isSuspended=!1})),A(this,"getBuffer",(t=>{var e;return null==(e=this.trackContexts.get(t))?void 0:e.buffer})),A(this,"videoDecodeRate",(()=>{var t,e,i;const n=this.trackContexts.get("video"),s=null!=(t=null==n?void 0:n.sampleDuration)?t:40,r=O(null!=(e=null==n?void 0:n.decodeTime.items())?e:[]),o=O(null!=(i=null==n?void 0:n.transportTime.items())?i:[]);return s/(r.average+o.average)})),A(this,"getStatistics",(()=>{var t,e,i,n;const s=this.trackContexts.get("video"),r=O(null!=(t=null==s?void 0:s.decodeTime.items())?t:[]),o=O(null!=(e=null==s?void 0:s.transportTime.items())?e:[]),a=O(null!=(n=null==(i=this.trackContexts.get("audio"))?void 0:i.decodeTime.items())?n:[]);return{videoDecodeRate:this.videoDecodeRate(),videoDecodeTime:r,audioDecodeTime:a,videoTransportTime:o}})),A(this,"onInitSegment",(({initSegment:t})=>{var e;const i=null==(e=this.trackContexts.get(t.type))?void 0:e.decoderContext;if(!i)throw new mt("No known decoder context",{code:"no_known_decoder_context",isFatal:!1});i.initSegment(t)})),A(this,"decode",(t=>{const e=this.trackContexts.get(t.type);if(!e)throw new mt("No known decoder context",{code:"no_known_decoder_context",isFatal:!1});if(this.isSuspended)return;e.sampleDuration=t.duration/t.timescale*1e3;const{decoderContext:i,buffer:n}=e,s=t.timestamp/t.timescale*1e3,r=t.duration/t.timescale*1e3,o=n[n.length-1];!o||s-5>o.end?n.push({start:s,end:s+r}):s+5*r<o.end?e.buffer=[{start:s,end:s+r}]:o.end=s+r,i.enqueue(t),this.emitDecodedFrames()})),A(this,"emitDecodedFrames",(()=>{let t;this.updateBufferState(),this.trackContexts.forEach((e=>{var i,n;let s;for(;void 0!==(s=null==(n=(i=e.decoderContext).error)?void 0:n.call(i));)this.emitter.emit("error",pt(!1,s));for(;void 0!==(t=e.decoderContext.take());){const{statistics:i}=t;i&&(e.decodeTime.push(i.decodeTime),e.transportTime.push((i.transportTimeToWorker+i.transportTimeFromWorker)/i.samplesInBatch)),this.emitter.emit("decoded frame",t)}}))})),A(this,"emitDecodeRate",(()=>{this.emitter.emit("video decode rate",this.videoDecodeRate())})),A(this,"updateBufferState",(()=>{var t,e;let i;if(this.trackContexts.forEach((t=>{var e,n,s,r;if(i){const o=null!=(n=null==(e=t.buffer[t.buffer.length-1])?void 0:e.end)?n:0;(null!=(r=null==(s=i[i.length-1])?void 0:s.end)?r:0)>o&&(i=t.buffer)}else i=t.buffer})),!i)return;const n=this.playbackSource.currentTime<(null!=(e=null==(t=i[i.length-1])?void 0:t.end)?e:0)?"playing":"buffering";this.emitter.emit("buffer state",{buffered:i,currentTime:this.playbackSource.currentTime,isPaused:this.playbackSource.isPaused,playbackState:n})})),this.logger=e,this.emitter=t,this.trackContexts=i,this.playbackSource=n}static create(t,e,n,s,r){return y(this,null,(function*(){const o=new Map;for(const t of n)switch(t.type){case"audio":{const{OpusDecoderContext:e}=yield i.e(418).then(i.bind(i,5418));o.set(t.type,{buffer:[],decoderContext:yield e.create(48e3,2),decodeTime:new k(100),transportTime:new k(100),sampleDuration:40});break}case"video":{const{H264DecoderWorkerContext:e}=yield i.e(684).then(i.bind(i,1684));o.set(t.type,{buffer:[],decoderContext:yield e.create(r),decodeTime:new k(100),transportTime:new k(100),sampleDuration:40});break}}return new Ie(t,e,o,s)}))}}const Re=class{constructor(t){A(this,"emitter"),A(this,"isVisibleCount",0),A(this,"isHiddenCount",0),A(this,"isOnlineCount",0),A(this,"isOfflineCount",0),A(this,"isActive","visible"===document.visibilityState),A(this,"unload",(()=>{document.removeEventListener("visibilitychange",this.onVisibilityChanged),window.removeEventListener("pagehide",this.onPageHide),window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)})),A(this,"load",(()=>{document.addEventListener("visibilitychange",this.onVisibilityChanged),window.addEventListener("pagehide",this.onPageHide),window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)})),A(this,"unsuspend",(()=>{})),A(this,"getStatistics",(()=>{var t,e,i,n,s;return{isVisible:this.isVisible,isOnline:this.isOnline,isVisibleCount:this.isVisibleCount,isHiddenCount:this.isHiddenCount,isOnlineCount:this.isOnlineCount,isOfflineCount:this.isOfflineCount,navigatorRtt:null==(t=navigator.connection)?void 0:t.rtt,navigatorEffectiveType:null==(e=navigator.connection)?void 0:e.effectiveType,navigatorConnectionType:null==(i=navigator.connection)?void 0:i.type,navigatorSaveData:null==(n=navigator.connection)?void 0:n.saveData,navigatorDownlink:null==(s=navigator.connection)?void 0:s.downlink}})),A(this,"onOnline",(()=>this.isOnlineCount++)),A(this,"onOffline",(()=>this.isOfflineCount++)),A(this,"onPageHide",(t=>this.emitter.emit("pagehide",t))),A(this,"onVisibilityChanged",(()=>{this.setIsActive("visible"===document.visibilityState)})),A(this,"setIsActive",(t=>{t!==this.isActive&&(this.emitter.emit("page active",t),t?this.isVisibleCount++:this.isHiddenCount++),this.isActive=t})),this.emitter=t}get isOnline(){return navigator.onLine}get isVisible(){return"visible"===document.visibilityState}};A(Re,"create",(t=>new Re(t)));let Le=Re;const Pe=class t{constructor(e,i,n){var s;A(this,"logger"),A(this,"emitter"),A(this,"waitingEvents",[]),A(this,"isTriggered",(s=t.EVENT_TIMEOUT,(t,e,i)=>t.timestamp<=e||t.timestampAdded<=i-s)),A(this,"timeSource"),A(this,"timers",new nt),A(this,"load",(()=>{this.timers.setInterval(this.onBufferedStateChanged,t.EVENT_CHECK_INTERVAL)})),A(this,"unload",(()=>{this.timers.unload()})),A(this,"addEvent",(t=>{this.logger.debug("Adding event",{event:t}),this.waitingEvents.push(p(m({},t),{timestampAdded:Date.now()}))})),A(this,"extractEvent",((t,e)=>{"video"===e.type&&t.channelId!==e.channelId&&this.addEvent({type:"channel switch",channelId:e.channelId,timestamp:e.timestamp/e.timescale*1e3}),"audio"===e.type&&"audio"===t.type&&void 0!==e.language&&e.language!==t.language&&this.addEvent({type:"language switch",language:e.language,timestamp:e.timestamp/e.timescale*1e3})})),A(this,"onBufferedStateChanged",(()=>{var t;const e=Date.now(),i=null!=(t=this.timeSource.drift)?t:0,n=this.timeSource.serverCurrentTime-i;if(0===this.waitingEvents.length)return;const s=this.waitingEvents.filter((t=>this.isTriggered(t,n,e)));this.waitingEvents=this.waitingEvents.filter((t=>!this.isTriggered(t,n,e))),s.forEach((t=>{this.logger.debug("Emitting event",{event:t}),this.emitter.emit("event",t)}))})),this.logger=i,this.emitter=e,this.timeSource=n}};A(Pe,"EVENT_TIMEOUT",5e3),A(Pe,"EVENT_CHECK_INTERVAL",20),A(Pe,"create",((t,e,i)=>new Pe(t,e,i)));let Me=Pe;const Be=class t{constructor(e){A(this,"emitter"),A(this,"timers",nt.create()),A(this,"bytesReceived",new Map),A(this,"timeoutInterval"),A(this,"lastBytesUpdated",Date.now()),A(this,"load",(()=>{this.emitter.on("connection state",this.onConnectionState),this.timers.setInterval((()=>this.bytesReceived.forEach((t=>t.tick()))),100)})),A(this,"unload",(()=>{this.emitter.off("connection state",this.onConnectionState),this.timers.unload()})),A(this,"averageBitRate",(t=>{var e,i;return 8*(null!=(i=null==(e=this.bytesReceived.get(t))?void 0:e.average)?i:0)})),A(this,"totalBytesReceived",(()=>{let t=0;return this.bytesReceived.forEach((e=>{t+=e.total})),t})),A(this,"add",((e,i)=>{let n=this.bytesReceived.get(e);n||(n=new W(20),this.bytesReceived.set(e,n)),i>0&&(this.lastBytesUpdated=Date.now(),this.timeoutInterval||(this.timeoutInterval=this.timers.setInterval(this.checkTimeout,t.UPDATE_RECEIVED_BYTES_INTERVAL))),n.add(i)})),A(this,"getStatistics",(()=>({bytesReceived:this.totalBytesReceived(),videoBitRate:this.averageBitRate("video"),audioBitRate:this.averageBitRate("audio")}))),A(this,"onConnectionState",(e=>{this.clearTimeoutInterval(),"connected"===e&&(this.lastBytesUpdated=Date.now(),this.timeoutInterval=this.timers.setInterval(this.checkTimeout,t.UPDATE_RECEIVED_BYTES_INTERVAL))})),A(this,"checkTimeout",(()=>{const e=Date.now()-this.lastBytesUpdated;if(0===this.totalBytesReceived()&&e>t.NO_DATA_ERROR_TIMEOUT)return this.emitter.emit("error",new mt("No Incoming Data",{isFatal:!1,code:"no_incoming_data_error",source:undefined})),this.emitter.emit("reconnect","no incoming data"),void this.clearTimeoutInterval();e>t.NO_DATA_TIMEOUT&&this.totalBytesReceived()>0&&(this.emitter.emit("no data timeout",this.totalBytesReceived()),this.clearTimeoutInterval())})),A(this,"clearTimeoutInterval",(()=>{this.timeoutInterval&&(this.timers.clearInterval(this.timeoutInterval),this.timeoutInterval=void 0)})),this.emitter=e}};A(Be,"NO_DATA_ERROR_TIMEOUT",2e4),A(Be,"NO_DATA_TIMEOUT",5e3),A(Be,"UPDATE_RECEIVED_BYTES_INTERVAL",1e3),A(Be,"create",(t=>new Be(t)));let _e=Be;const Ue=class t extends n.E{constructor(){super(),A(this,"context",new(window.AudioContext||window.webkitAudioContext)),A(this,"timers",nt.create()),A(this,"previousCurrentTime",0),A(this,"_isStuck",!1),A(this,"mediaStreamDestination"),A(this,"unload",(()=>(this.timers.unload(),this.context.removeEventListener("statechange",this.onStateChange),"closed"!==this.context.state?this.context.close():Promise.resolve()))),A(this,"createGain",(()=>this.context.createGain())),A(this,"createBuffer",((t,e,i)=>this.context.createBuffer(t,e,i))),A(this,"createBufferSource",(()=>this.context.createBufferSource())),A(this,"getMediaStreamDestination",(()=>(this.mediaStreamDestination||(this.mediaStreamDestination=this.context.createMediaStreamDestination()),this.mediaStreamDestination))),A(this,"getDefaultDestination",(()=>this.context.destination)),A(this,"resume",(()=>y(this,null,(function*(){try{return yield Promise.race([this.context.resume(),ot(1e3,new mt("Web Audio Context resume timeout",{isFatal:!1,code:"web_audio_context_resume_timeout"}))])}catch(t){throw this.suspend().catch($),t}})))),A(this,"suspend",(()=>y(this,null,(function*(){var t;yield null!=(t=this.context.suspend())?t:Promise.resolve()})))),A(this,"onStateChange",(()=>this.emit("state",this.state))),this.context.addEventListener("statechange",this.onStateChange),this.timers.setInterval((()=>{this._isStuck=this.isRunning&&this.context.currentTime===this.previousCurrentTime,this._isStuck&&this.emit("stuck"),this.previousCurrentTime=this.context.currentTime}),t.CHECK_INTERVAL)}get isStuck(){return this._isStuck}get isRunning(){return"running"===this.state}get currentTime(){return this.context.currentTime}get sampleRate(){return this.context.sampleRate}get state(){return this.context.state}};A(Ue,"CHECK_INTERVAL",1e3);let Ne=Ue;const De=class extends n.E{constructor(t,e,{muted:i,reInitWhenStuck:n}){super(),A(this,"logger"),A(this,"audio"),A(this,"gainNode"),A(this,"_volume",1),A(this,"_userProvidedMuted",!1),A(this,"_muted",!1),A(this,"startTime",0),A(this,"samples",new Float32Array(new ArrayBuffer(38400))),A(this,"preInitSampleQueue",new k(500)),A(this,"unplayedBufferSources",new k(100)),A(this,"sampleRate",48e3),A(this,"channels",2),A(this,"index",0),A(this,"clockSource"),A(this,"clockDelta"),A(this,"startTimeIsInvalidated",!0),A(this,"lastSampleTimestamp",0),A(this,"reInitWhenStuck"),A(this,"ignoreSuspendCalls",!1),A(this,"isActivated",!1),A(this,"unload",(()=>y(this,null,(function*(){var t,e;null==(t=this.gainNode)||t.disconnect(),yield null==(e=this.audio)?void 0:e.unload(),this.reset(),this.audio=void 0,this.gainNode=void 0})))),A(this,"suspend",(()=>{this.setGain(0)})),A(this,"unsuspend",(()=>{var t;this.setGain(this._volume),this.ignoreSuspendCalls=!!this.audio,null==(t=this.audio)||t.suspend().then((()=>y(this,null,(function*(){yield this.resume(),this.ignoreSuspendCalls=!1})))).catch((()=>{this.ignoreSuspendCalls=!1,this.emit("state change","suspended")}))})),A(this,"flush",(()=>{if(!this.audio||!this.gainNode)throw new mt("AudioContext must be initialized to flush",{isFatal:!1,code:"audiocontext_must_be_initialized"});const t=this.samples.length/this.channels,e=this.audio.createBufferSource(),i=this.audio.createBuffer(this.channels,t,this.sampleRate);let n=0;for(let e=0;e<this.channels;e++){n=e;const s=i.getChannelData(e);for(let e=0;e<t;e++)s[e]=this.samples[n],n+=this.channels}const s=Math.max(this.startTime,0);e.buffer=i,e.connect(this.gainNode),e.start(s),this.unplayedBufferSources.push([s,e]),this.startTime+=i.duration})),A(this,"onDecodedFrame",(t=>{if(this.gainNode&&this.audio&&this.audio.isRunning){for(;!this.preInitSampleQueue.isEmpty();){const t=this.preInitSampleQueue.items();this.preInitSampleQueue.clear(),t.forEach(this.onDecodedFrame)}if(this.unplayedBufferSources.filterPop((([t,e])=>{var i,n;return(null!=(n=null==(i=this.audio)?void 0:i.currentTime)?n:0)<t})),"audio"===t.type){const e=t.timestamp/t.timescale*1e3;if(e<this.lastSampleTimestamp&&(this.logger.info("Unordered timestamp - invalidating start time"),this.startTimeIsInvalidated=!0),this.lastSampleTimestamp=e,this.startTimeIsInvalidated){const t=1e3*this.audio.currentTime,i=this.clockSource.currentTime,n=(t+e-i)/1e3;this.clockDelta=i-t,this.startTime=n,this.startTimeIsInvalidated=!1,this.unplayedBufferSources.items().forEach((([t,e])=>{n<=t&&e.stop()}))}this.samples.set(t.data,this.index),this.index+=t.data.length,this.channels=t.channels,this.sampleRate=t.sampleRate,this.samples.length<=this.index&&(this.index=0,this.flush())}}else if("audio"===t.type){this.preInitSampleQueue.push(p(m({},t),{data:t.data.slice(0,t.data.length)}));const e=this.clockSource.currentTime;this.preInitSampleQueue.filterPop((({timestamp:t,timescale:i})=>t/i*1e3>e))}})),A(this,"play",(()=>y(this,null,(function*(){this.audio=this.getAudioContext(),yield this.resume()})))),A(this,"pause",(()=>{})),A(this,"flushBuffer",(()=>{this.unplayedBufferSources.items().forEach((([t,e])=>e.stop())),this.index=0})),A(this,"resume",(()=>y(this,null,(function*(){var t;if(!this._userProvidedMuted)try{yield null==(t=this.audio)?void 0:t.resume(),this._muted=this._userProvidedMuted,this.startTimeIsInvalidated=!0}catch(t){throw this._muted=!0,t}})))),A(this,"getAudioContext",(()=>this.audio?this.audio:this.setupContext())),A(this,"setupContext",(()=>{var t,e;return null==(t=this.audio)||t.unload(),this.audio=new Ne,this.audio.on("state",(t=>{this.logger.info("AudioContext state change",{state:t}),"running"===t&&(this._muted=this._userProvidedMuted,this.setGain(this._volume)),!this.ignoreSuspendCalls&&this.emit("state change",t)})),this.audio.on("stuck",(()=>{this.reInitWhenStuck&&(this.logger.info("Re-init audio context"),this.setupContext(),this.resume().catch($),this.emit("stuck"))})),null==(e=this.gainNode)||e.disconnect(),this.gainNode=this.audio.createGain(),this.setGain(this._volume),this.startTime=this.audio.currentTime,this.audio})),A(this,"setGain",(t=>{this.gainNode&&(this.gainNode.gain.value=this._muted?0:t)})),this._muted=i,this._userProvidedMuted=i,this.logger=t,this.clockSource=e,this.reInitWhenStuck=n}get isContextRunning(){var t;return"running"===(null==(t=this.audio)?void 0:t.state)}get volume(){return this._volume}set volume(t){this._volume=t,this.muted||this.setGain(t)}get seekTime(){return 0}get isSeeking(){return!1}get muted(){var t;return this._muted||!(null!=(t=this.audio)&&t.isRunning)}set muted(t){this._userProvidedMuted=t,this._muted=t,this.setGain(this._volume)}get isPaused(){return!1}get currentTime(){var t;return this.audio&&this.audio.isRunning&&!this.audio.isStuck?1e3*this.audio.currentTime+(null!=(t=this.clockDelta)?t:0):this.clockSource.currentTime}set currentTime(t){this.logger.debug("setting current time to",{currentTime:t}),this.startTimeIsInvalidated=!0}useMediaStreamDestination(){var t;const e=this.getAudioContext().getMediaStreamDestination();return null==(t=this.gainNode)||t.connect(e),e}useDefaultDestination(){var t;const e=this.getAudioContext().getDefaultDestination();return null==(t=this.gainNode)||t.connect(e),e}};A(De,"create",((t,e,i)=>new De(t,e,i)));let Fe=De;var Oe;class We{constructor(){v(this,Oe,[]),b(this,Oe,[])}addTextTrack(t,e,i){const n=[],s={kind:t,label:e,language:i,mode:"disabled",cues:n,addCue:t=>{n.push(t)},removeCue:t=>{const e=n.findIndex((e=>e===t));-1!==e&&n.splice(e,1)}};return f(this,Oe).push(s),s}set language(t){f(this,Oe).forEach((e=>{e.language===t?e.mode="showing":e.mode="hidden"}))}get language(){var t;return null==(t=f(this,Oe).find((t=>"showing"===t.mode)))?void 0:t.language}getActiveCues(t){const e=f(this,Oe).find((t=>"showing"===t.mode));return e?e.cues.filter((({startTime:e,endTime:i})=>t>=e&&t<=i)):[]}}Oe=new WeakMap;const Ge=(t,e)=>{let i;for(i=e;t>1;t--)i+=e;return i};class ze{constructor(){A(this,"audio"),A(this,"unmute",(()=>this.audio.play().catch($)));const t=document.createElement("div");t.innerHTML="<audio x-webkit-airplay='deny'></audio>";const e=t.children.item(0);if(!(e instanceof HTMLAudioElement))throw new Error("Failed to create audio tag");this.audio=e,this.audio.controls=!1,this.audio.disableRemotePlayback=!0,this.audio.preload="auto",this.audio.src="data:audio/mpeg;base64,//uQx"+Ge(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+Ge(16,"gICA")+Ge(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+Ge(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+Ge(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+Ge(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+Ge(97,"V")+"Q==",this.audio.loop=!1,this.audio.load()}}var He,Ve,Xe,Qe,je,qe,Ze,$e;class Je{constructor(){v(this,je),v(this,He,[]),v(this,Ve,document.createElement("canvas")),v(this,Xe),v(this,Qe,window.devicePixelRatio||1),A(this,"config",{backgroundColor:"rgba(0,0,0,0.6)",textPadding:8,fontSize:"28px",lineGap:16});const t=f(this,Ve).getContext("2d",{alpha:!0});if(!t)throw new Error("Failed to create 2d context");b(this,Xe,t),w(this,je,Ze).call(this)}get canvas(){return f(this,Ve)}setActiveCues(t){b(this,He,t)}render(t,e=!1){const i=f(this,He).flatMap((e=>e.text.split("\n").flatMap((e=>w(this,je,$e).call(this,e,t.width))).map((t=>{w(this,je,Ze).call(this);const e=f(this,Xe).measureText(t);return{text:t,measurement:e,size:{height:e.fontBoundingBoxAscent+e.fontBoundingBoxDescent+2*this.config.textPadding,width:e.width+2*this.config.textPadding}}})))),n=Math.max(...i.map((t=>t.size.width))),s=i.reduce(((t,{size:e})=>t+e.height),0)+(i.length-1)*this.config.lineGap;let r=0;w(this,je,qe).call(this,n,s),f(this,Xe).clearRect(0,0,f(this,Ve).width,f(this,Ve).height);for(const{size:t,text:e}of i)w(this,je,Ze).call(this),f(this,Xe).fillStyle=this.config.backgroundColor,f(this,Xe).fillRect(0,r,t.width,t.height),w(this,je,Ze).call(this),f(this,Xe).fillText(e,this.config.textPadding,r+this.config.textPadding),r+=t.height+this.config.lineGap;e&&(f(this,Xe).strokeStyle="red",f(this,Xe).strokeRect(0,0,t.width,f(this,Ve).height))}}He=new WeakMap,Ve=new WeakMap,Xe=new WeakMap,Qe=new WeakMap,je=new WeakSet,qe=function(t,e){f(this,Ve).width=t*f(this,Qe),f(this,Ve).height=e*f(this,Qe),f(this,Xe).scale(f(this,Qe),f(this,Qe)),this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`},Ze=function(){f(this,Xe).fillStyle="white",f(this,Xe).textAlign="left",f(this,Xe).textBaseline="top",f(this,Xe).font=`${this.config.fontSize} sans-serif`},$e=function(t,e){const i=[],n=t.split(" ");let s="";for(;n.length>0;){w(this,je,Ze).call(this);let t=0;for(;f(this,Xe).measureText(s+(s.length>0?" ":"")+n[0]).width+2*this.config.textPadding<=e&&n.length>0;)t++,s+=(s.length>0?" ":"")+n.shift();0!=t?(i.push(s),s=""):(i.push(n.shift()||""),s="")}return i};const Ye=(t,e)=>{let i=t.getContext("webgl",e);if(i||(i=t.getContext("experimental-webgl",e)),!i)throw new mt("Failed to create webgl context",{isFatal:!0,code:"failed_to_create_web_gl_context"});return i},Ke=(t,e,i)=>{const n=t.createShader(e);if(!n)throw new mt("Failed to create shader",{isFatal:!0,code:"failed_to_create_shader"});if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(n);throw new mt(`Failed to compile shader: ${null!=e?e:""}`,{isFatal:!0,code:"failed_to_compile_shader"})}return n},ti=t=>{const e=t.createTexture();if(!e)throw new mt("Failed to create texture",{isFatal:!0,code:"failed_to_create_texture"});return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},ei=(t,e)=>{const i=t.createBuffer();if(!i)throw new mt("Failed to create buffer",{isFatal:!0,code:"failed_to_create_buffer"});return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e.buffer,t.STATIC_DRAW),i},ii=(t,e,i)=>{const n=t.createProgram();if(!n)throw new mt("Failed to create program",{isFatal:!0,code:"failed_to_create_program"});if(t.attachShader(n,i),t.attachShader(n,e),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){const e=t.getShaderInfoLog(n);throw new mt(`Failed to link program: ${null!=e?e:""}`,{isFatal:!0,code:"failed_to_link_program"})}return n};var ni,si,ri,oi,ai,li,hi,ci,di,ui;class mi{constructor(t){v(this,hi),v(this,ni,96),v(this,si),v(this,ri),v(this,oi),v(this,ai),v(this,li),A(this,"subtitleRenderer",new Je),v(this,ui,((t,e,i,n)=>[t,0,0,0,0,-e,0,0,0,0,1,0,i,n,0,1])),b(this,si,t),b(this,ri,ti(t)),b(this,oi,Ke(t,t.FRAGMENT_SHADER,"\nprecision mediump float;\nuniform sampler2D texture;\n\nvarying vec2 texture_coordinate;\n\nvoid main() {\n  float y = texture2D(texture, texture_coordinate).r;\n  float a = texture2D(texture, texture_coordinate).a;\n\n  gl_FragColor = vec4(y, y, y, a);\n}\n")),b(this,ai,Ke(t,t.VERTEX_SHADER,"\n  attribute vec2 position;\n  varying vec2 texture_coordinate;\n  uniform mat4 model;\n\n  void main() {\n    texture_coordinate = position;\n    gl_Position = model * vec4(position, 0.0, 1.0);\n  }\n")),b(this,li,ii(t,f(this,ai),f(this,oi))),this.subtitleRenderer.config.fontSize="64px"}setActiveCues(t,e){this.subtitleRenderer.setActiveCues(t),this.subtitleRenderer.render(e)}render(t){const e=this.subtitleRenderer.canvas,i=(t.padding+f(this,ni))*window.devicePixelRatio;0!==e.width&&(f(this,si).useProgram(f(this,li)),w(this,hi,ci).call(this),w(this,hi,di).call(this,this.subtitleRenderer.canvas.width/t.width,this.subtitleRenderer.canvas.height/t.height,-this.subtitleRenderer.canvas.width/t.width/2,-(1-(this.subtitleRenderer.canvas.height+i)/t.height)),f(this,si).uniform1i(f(this,si).getUniformLocation(f(this,li),"texture"),4),f(this,si).activeTexture(f(this,si).TEXTURE4),f(this,si).bindTexture(f(this,si).TEXTURE_2D,f(this,ri)),f(this,si).enable(f(this,si).BLEND),f(this,si).blendFunc(f(this,si).SRC_ALPHA,f(this,si).ONE_MINUS_SRC_ALPHA),f(this,si).texImage2D(f(this,si).TEXTURE_2D,0,f(this,si).RGBA,f(this,si).RGBA,f(this,si).UNSIGNED_BYTE,e),f(this,si).texParameteri(f(this,si).TEXTURE_2D,f(this,si).TEXTURE_MAG_FILTER,f(this,si).LINEAR),f(this,si).drawArrays(f(this,si).TRIANGLE_STRIP,0,4))}}ni=new WeakMap,si=new WeakMap,ri=new WeakMap,oi=new WeakMap,ai=new WeakMap,li=new WeakMap,hi=new WeakSet,ci=function(){const t=f(this,si).getAttribLocation(f(this,li),"position");f(this,si).enableVertexAttribArray(t),f(this,si).vertexAttribPointer(t,2,f(this,si).FLOAT,!1,0,0)},di=function(t,e,i,n){const s=f(this,si).getUniformLocation(f(this,li),"model");f(this,si).uniformMatrix4fv(s,!1,f(this,ui).call(this,t,e,i,n))},ui=new WeakMap;const pi="\nprecision mediump float;\nuniform sampler2D y_texture;\nuniform sampler2D u_texture;\nuniform sampler2D v_texture;\nuniform mat4 conversion;\n\nvarying vec2 texture_coordinate;\n\nvoid main() {\n  float y = texture2D(y_texture, texture_coordinate).r;\n  float u = texture2D(u_texture, texture_coordinate).r;\n  float v = texture2D(v_texture, texture_coordinate).r;\n\n  gl_FragColor = vec4(y, u, v, 1) * conversion;\n}\n",Ai="\n  attribute vec2 position;\n  varying vec2 texture_coordinate;\n  uniform mat4 model;\n\n  void main() {\n    texture_coordinate = position;\n    gl_Position = model * vec4(position, 0.0, 1.0);\n  }\n",gi={width:256,codedWidth:256,height:144,codedHeight:144},fi={preserveDrawingBuffer:!1,alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1},vi=class t extends n.E{constructor(){super(),A(this,"canvas",document.createElement("canvas")),A(this,"context",Ye(this.canvas,fi)),A(this,"pixelShader",Ke(this.context,this.context.FRAGMENT_SHADER,pi)),A(this,"vertexShader",Ke(this.context,this.context.VERTEX_SHADER,Ai)),A(this,"buffer",ei(this.context,t.SQUARE_VERTICES)),A(this,"program",ii(this.context,this.vertexShader,this.pixelShader)),A(this,"textures",{y:ti(this.context),u:ti(this.context),v:ti(this.context)}),A(this,"textRenderer"),A(this,"size",gi),A(this,"onContextLost",(t=>{this.textRenderer=void 0;const e=new Error(t instanceof WebGLContextEvent?t.statusMessage:"webgl context lost");this.emit("context lost",new mt("WebGL Context Lost",{isFatal:!1,code:"webgl_context_lost_error",source:e,type:"internal"})),t.preventDefault()})),A(this,"onContextRestored",(()=>{this.emit("context restored"),this.context=Ye(this.canvas,fi),this.pixelShader=Ke(this.context,this.context.FRAGMENT_SHADER,pi),this.vertexShader=Ke(this.context,this.context.VERTEX_SHADER,Ai),this.buffer=ei(this.context,t.SQUARE_VERTICES),this.program=ii(this.context,this.vertexShader,this.pixelShader),this.textures={y:ti(this.context),u:ti(this.context),v:ti(this.context)},this.load()})),A(this,"load",(()=>{this.context.useProgram(this.program),this.setupPositionVertexAttributes(),this.setSize(gi),this.context.uniform1i(this.context.getUniformLocation(this.program,"y_texture"),0),this.context.uniform1i(this.context.getUniformLocation(this.program,"u_texture"),1),this.context.uniform1i(this.context.getUniformLocation(this.program,"v_texture"),2),this.setConversionMatrix(this.rec709())})),A(this,"unload",(()=>{var t;this.setSize({width:1,height:1,codedHeight:1,codedWidth:1}),[this.textures.y,this.textures.u,this.textures.v].forEach((t=>this.context.deleteTexture(t))),this.context.deleteShader(this.pixelShader),this.context.deleteShader(this.vertexShader),this.context.deleteProgram(this.program),this.context.deleteBuffer(this.buffer),this.canvas.removeEventListener("webglcontextlost",this.onContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onContextRestored),null==(t=this.context.getExtension("WEBGL_lose_context"))||t.loseContext()})),A(this,"resetSize",(()=>{this.setSize({width:this.size.width/2,height:this.size.height/2,codedHeight:this.size.codedHeight/2,codedWidth:this.size.codedWidth/2})})),A(this,"render",((t,e)=>{var i;this.context.useProgram(this.program),this.setSize({width:t.width,height:t.height,codedWidth:t.codedWidth,codedHeight:t.codedHeight}),this.setConversionMatrix(this.rec709()),this.setModelMatrix(this.size.width/this.size.codedWidth,this.size.height/this.size.codedHeight),this.context.activeTexture(this.context.TEXTURE0),this.updateTexture(this.textures.y,this.size.codedWidth,this.size.codedHeight,t.data[0]),this.context.activeTexture(this.context.TEXTURE1),this.updateTexture(this.textures.u,this.size.codedWidth/2,this.size.codedHeight/2,t.data[1]),this.context.activeTexture(this.context.TEXTURE2),this.updateTexture(this.textures.v,this.size.codedWidth/2,this.size.codedHeight/2,t.data[2]),this.context.drawArrays(this.context.TRIANGLE_STRIP,0,4),this.textRenderer&&this.textRenderer.render({width:Math.max(e.clientWidth,960)*window.devicePixelRatio,height:Math.max(e.clientHeight,540)*window.devicePixelRatio,padding:-parseInt(null!=(i=e.style.getPropertyValue("--vindral-control-bar-offset"))?i:"0",10)})})),A(this,"updateTexture",((t,e,i,n)=>{const s=this.context.LUMINANCE,r=this.context.UNSIGNED_BYTE;this.context.bindTexture(this.context.TEXTURE_2D,t),this.context.texImage2D(this.context.TEXTURE_2D,0,s,e,i,0,s,r,n)})),A(this,"setupPositionVertexAttributes",(()=>{const t=this.context.getAttribLocation(this.program,"position");this.context.enableVertexAttribArray(t),this.context.vertexAttribPointer(t,2,this.context.FLOAT,!1,0,0)})),A(this,"setSize",(t=>{G(t,this.size)||(this.size=t,this.canvas.setAttribute("width",t.width.toString()),this.canvas.setAttribute("height",t.height.toString()),this.context.viewport(0,0,t.width,t.height),this.setModelMatrix(t.width/t.codedWidth,t.height/t.codedHeight))})),A(this,"setModelMatrix",((t,e)=>{const i=this.context.getUniformLocation(this.program,"model");this.context.uniformMatrix4fv(i,!1,this.transformMatrix(t,e))})),A(this,"setConversionMatrix",(t=>{const e=this.context.getUniformLocation(this.program,"conversion");this.context.uniformMatrix4fv(e,!1,t)})),A(this,"transformMatrix",((t,e)=>[2/t,0,0,0,0,-2/e,0,0,0,0,2,0,-1,1,0,1])),A(this,"rec709",(()=>[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1])),A(this,"rec601",(()=>[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1])),this.canvas.addEventListener("webglcontextlost",this.onContextLost),this.canvas.addEventListener("webglcontextrestored",this.onContextRestored,!1),this.canvas.style.width="100%",this.canvas.style.position="relative"}getTextRenderer(){return this.textRenderer||(this.textRenderer=new mi(this.context)),this.textRenderer}};A(vi,"SQUARE_VERTICES",new Float32Array([0,0,0,1,1,0,1,1]));let bi=vi;const wi=class{constructor(t,e,i,n){A(this,"oldTimestampLimit",400),A(this,"pool"),A(this,"logger"),A(this,"videoRenderer",new bi),A(this,"renderQueue",[]),A(this,"clockSource"),A(this,"isFirstFrame",!0),A(this,"animationFrameRequest"),A(this,"renderedFrameCount",0),A(this,"rendererDroppedFrameCount",0),A(this,"renderTargetSize"),A(this,"load",(()=>{this.videoRenderer.load()})),A(this,"unload",(()=>(this.stopRender(),this.videoRenderer.unload(),Promise.resolve()))),A(this,"suspend",(()=>{this.renderQueue=[],this.stopRender()})),A(this,"unsuspend",(()=>{this.animationFrameRequest=requestAnimationFrame(this.render)})),A(this,"element",(()=>this.videoRenderer.canvas)),A(this,"getStatistics",(()=>({renderedFrameCount:this.renderedFrameCount,rendererDroppedFrameCount:this.rendererDroppedFrameCount,contextLostCount:0,contextRestoredCount:0}))),A(this,"resetSize",(()=>{this.videoRenderer.resetSize()})),A(this,"setActiveCues",((t,e)=>{this.videoRenderer.getTextRenderer().setActiveCues(t,e)})),A(this,"onDecodedFrame",(t=>{if("video"===t.type)if(this.isFirstFrame)this.isFirstFrame=!1,requestAnimationFrame((()=>{this.renderSample(t)}));else{const e=(this.clockSource.currentTime-this.oldTimestampLimit)/1e3;this.renderQueue=this.renderQueue.filter((i=>{const n=i.timestamp/i.timescale,s=t.timestamp/t.timescale,r=n>e&&n<=s;return r||this.pool.reclaim(i.buffer),r})),this.renderQueue.push(t)}})),A(this,"render",(()=>{const t=this.clockSource.currentTime;let e,i=this.renderQueue[0],n=0;for(;i&&i.timestamp/i.timescale*1e3<=t;)i=this.renderQueue.shift(),i&&(n++,e&&this.pool.reclaim(e.buffer),e=i),i=this.renderQueue[0];e&&this.renderSample(e),this.rendererDroppedFrameCount+=Math.max(n-1,0),this.animationFrameRequest=requestAnimationFrame(this.render)})),A(this,"renderSample",(t=>{this.renderedFrameCount++,this.videoRenderer.render(t,this.renderTargetSize),this.pool.reclaim(t.buffer)})),A(this,"stopRender",(()=>{this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest)})),this.logger=t,this.clockSource=e,this.pool=i,this.renderTargetSize=n||this.videoRenderer.canvas}};A(wi,"create",((t,e,i,n)=>new wi(t,e,i,n)));let Si=wi;const yi=class{constructor(t,e,i,n,s){A(this,"logger"),A(this,"emitter"),A(this,"audioPlayer"),A(this,"videoPlayer"),A(this,"pool"),A(this,"unmuter",new ze),A(this,"_isPaused",!1),A(this,"isDisconnected",!1),A(this,"timers",new nt),A(this,"textTracks",new We),A(this,"playbackRate"),A(this,"reset",(()=>{})),A(this,"load",(()=>{this.audioPlayer.useDefaultDestination(),this.emitter.on("decoded frame",this.onDecodedFrame),this.emitter.on("flush buffers",this.flushBuffers),this.videoPlayer.load(),this.timers.setInterval((()=>{if(!this.textTracks.language)return;const t=this.textTracks.getActiveCues(this.currentTime/1e3);this.videoPlayer.setActiveCues(t,{width:this.videoPlayer.element().clientWidth,height:this.videoPlayer.element().clientHeight})}),100)})),A(this,"unload",(()=>{this.emitter.off("decoded frame",this.onDecodedFrame),this.emitter.off("flush buffers",this.flushBuffers),this.audioPlayer.unload(),this.videoPlayer.unload(),this.timers.unload()})),A(this,"suspend",(()=>{this.videoPlayer.suspend(),this.audioPlayer.suspend()})),A(this,"unsuspend",(()=>{this.videoPlayer.unsuspend(),this.audioPlayer.unsuspend()})),A(this,"element",(()=>this.videoPlayer.element())),A(this,"getStatistics",(()=>this.videoPlayer.getStatistics())),A(this,"flushBuffers",(()=>{this.audioPlayer.flushBuffer()})),A(this,"activateAudioPlayer",(()=>(this.isDisconnected&&(this.isDisconnected=!1,this.audioPlayer.useDefaultDestination()),this._isPaused=!1,this.unmuter.unmute(),this.audioPlayer.play()))),A(this,"onDecodedFrame",(t=>{try{this.audioPlayer.onDecodedFrame(t)}catch(t){t instanceof Error&&this.emitter.emit("error",At(!1,t))}this.videoPlayer.onDecodedFrame(t)})),this.logger=e,this.emitter=t,this.pool=i,this.audioPlayer=Fe.create(this.logger.createContext("AudioPlayerModule"),n,{muted:s,reInitWhenStuck:!0}),this.audioPlayer.on("stuck",(()=>{this.isDisconnected=!0})),this.audioPlayer.on("state change",(()=>{this.emitter.emit("volume state",{volume:this.volume,isMuted:this.muted})})),this.videoPlayer=Si.create(this.logger.createContext("VideoPlayerModule"),this.audioPlayer,this.pool)}get volume(){return this.audioPlayer.volume}set volume(t){this.audioPlayer.volume=t}get muted(){return this.audioPlayer.muted}set muted(t){const e=this.muted;this.audioPlayer.muted=t,!t&&e&&this.activateAudioPlayer().catch($)}get currentTime(){return this.audioPlayer.currentTime}set currentTime(t){this.audioPlayer.currentTime=t}get isActivated(){return this.audioPlayer.isActivated}set isActivated(t){this.audioPlayer.isActivated=t}get seekTime(){return this.audioPlayer.seekTime}get isPaused(){return this._isPaused}get isSeeking(){return this.audioPlayer.isSeeking}play(){this.activateAudioPlayer().then((()=>{this.emitter.emit("media element state","playing")})).catch((()=>{this.emitter.emit("needs user input",{forAudio:!0,forVideo:!1})}))}pause(){this._isPaused=!0,this.audioPlayer.pause(),this.emitter.emit("media element state","paused")}};A(yi,"create",((t,e,i,n,s)=>new yi(t,e,i,n,s)));let Ei=yi;const ki=class{constructor(t,e,i,n,{muted:s,type:r,poster:o}){A(this,"logger"),A(this,"emitter"),A(this,"mediaElement"),A(this,"audioPlayer"),A(this,"videoPlayer"),A(this,"pool"),A(this,"isDisconnected",!0),A(this,"_userProvidedMuted",!1),A(this,"timers",new nt),A(this,"volumeState"),A(this,"textTracks",new We),A(this,"reset",(()=>{})),A(this,"load",(()=>{this.mediaElement.load(),this.emitter.on("decoded frame",this.onDecodedFrame),this.emitter.on("flush buffers",this.flushBuffers),this.emitter.on("ios-hack: reset size",this.resetCanvasSize),this.emitter.on("enter picture in picture",this.onEnterIOSHack),this.emitter.on("exit picture in picture",this.onExitIOSHack),this.element().element.addEventListener("webkitendfullscreen",this.onExitIOSHack),this.element().element.addEventListener("webkitbeginfullscreen",this.onEnterIOSHack),this.videoPlayer.load(),this.timers.setInterval((()=>{if(!this.textTracks.language)return;const t=this.textTracks.getActiveCues(this.currentTime/1e3);this.videoPlayer.setActiveCues(t,{width:this.mediaElement.element.clientWidth,height:this.mediaElement.element.clientHeight})}),100)})),A(this,"unload",(()=>{this.emitter.off("decoded frame",this.onDecodedFrame),this.emitter.off("flush buffers",this.flushBuffers),this.emitter.off("ios-hack: reset size",this.resetCanvasSize),this.emitter.off("enter picture in picture",this.onEnterIOSHack),this.emitter.off("exit picture in picture",this.onExitIOSHack),this.element().element.removeEventListener("webkitendfullscreen",this.onExitIOSHack),this.element().element.removeEventListener("webkitbeginfullscreen",this.onEnterIOSHack),this.mediaElement.unload(),this.timers.unload(),this.audioPlayer.unload(),this.videoPlayer.unload()})),A(this,"suspend",(()=>{this.videoPlayer.suspend(),this.audioPlayer.suspend()})),A(this,"unsuspend",(()=>{this.videoPlayer.unsuspend(),this.audioPlayer.unsuspend()})),A(this,"element",(()=>this.mediaElement)),A(this,"getStatistics",(()=>this.videoPlayer.getStatistics())),A(this,"activateAudioPlayer",(()=>(this.isDisconnected&&this.connectStreams(),this.audioPlayer.play()))),A(this,"flushBuffers",(()=>{this.audioPlayer.flushBuffer()})),A(this,"resetCanvasSize",(()=>{this.videoPlayer.resetSize()})),A(this,"onEnterIOSHack",(()=>{this.mediaElement._iosHackEnterPiPMode()})),A(this,"onExitIOSHack",(()=>{this.mediaElement._iosHackExitPiPMode()})),A(this,"onDecodedFrame",(t=>{try{this.audioPlayer.onDecodedFrame(t)}catch(t){t instanceof Error&&this.emitter.emit("error",At(!1,t))}this.videoPlayer.onDecodedFrame(t)})),A(this,"connectStreams",(()=>{const t=this.videoPlayer.element().captureStream(),e=this.audioPlayer.useMediaStreamDestination().stream,i=[];i.push(...t.getTracks(),...e.getTracks()),this.mediaElement.element.srcObject=new MediaStream(i),this.isDisconnected=!1})),A(this,"updateVolumeState",(()=>{const t={isMuted:this.muted,volume:this.volume};G(t,this.volumeState)||(this.volumeState=t,this.emitter.emit("volume state",this.volumeState))})),this.logger=e,this.emitter=t,this.pool=i,this._userProvidedMuted=s,this.mediaElement=new ce({poster:o,type:r,muted:s,autoplay:!1,logger:this.logger.createContext("MediaElement")}),this.mediaElement.on("volume state",(t=>{this.updateVolumeState(),!t.isMuted&&!this.audioPlayer.isContextRunning&&this.activateAudioPlayer().catch($),t.isMuted||(this._userProvidedMuted=!1)})),this.mediaElement.on("media element state",(t=>{"paused"===t&&this.audioPlayer.flushBuffer(),this.emitter.emit("media element state",t)})),this.audioPlayer=Fe.create(this.logger.createContext("AudioPlayerModule"),n,{muted:!1,reInitWhenStuck:!1}),this.audioPlayer.on("stuck",(()=>{this.isDisconnected=!0})),this.audioPlayer.on("state change",(t=>{"suspended"===t||"interrupted"===t?this.mediaElement.muted=!0:"running"===t&&(this.mediaElement.muted=this._userProvidedMuted||"hidden"===document.visibilityState),this.updateVolumeState()})),this.videoPlayer=Si.create(this.logger.createContext("VideoPlayerModule"),this.audioPlayer,this.pool,this.mediaElement.element),this.volumeState={volume:this.volume,isMuted:this.muted}}get volume(){return this.mediaElement.volume}set volume(t){this.mediaElement.volume=t}get muted(){return this.mediaElement.muted||this.audioPlayer.muted}set muted(t){const e=this.muted;this._userProvidedMuted=t,this.mediaElement.muted=t,!t&&e&&this.activateAudioPlayer().catch($)}get currentTime(){return this.audioPlayer.currentTime}set currentTime(t){this.audioPlayer.currentTime=t}get isActivated(){return this.mediaElement.isActivated}set isActivated(t){this.mediaElement.isActivated=t}get seekTime(){return this.mediaElement.seekTime}get isPaused(){return this.mediaElement.isPaused}get isSeeking(){return this.mediaElement.isSeeking}play(){const t=this._userProvidedMuted;return this.activateAudioPlayer().catch((()=>{t||this.emitter.emit("needs user input",{forAudio:!0,forVideo:!1})})),this.mediaElement.play()}pause(){this.mediaElement.pause()}};A(ki,"create",((t,e,i,n,s)=>new ki(t,e,i,n,s)));let Ci=ki;const Ti=()=>t=>xi(t.buffered.start(0),t.buffered.end(t.buffered.length-1)),xi=(t,e)=>i=>i.remove(Math.max(0,t),Math.min(Number.POSITIVE_INFINITY,e)),Ii=t=>e=>e.appendBuffer(t);class Ri{constructor(t){A(this,"commandQueue",[]),A(this,"sourceBuffer"),A(this,"currentInit"),A(this,"handleQueue",(()=>{var t;this.sourceBuffer.updating||null==(t=this.commandQueue.shift())||t.execute(this.sourceBuffer)})),A(this,"appendBuffer",((t,e)=>new Promise(((i,n)=>{if(e&&this.currentInit!==e){const t=new D(Ii(e),i,n);this.commandQueue.push(t),this.currentInit=e}const s=new D(Ii(t),i,n);this.commandQueue.push(s),this.handleQueue()})))),A(this,"execute",(t=>new Promise(((e,i)=>{const n=new D((s=t,t=>s(t)),e,i);var s;this.commandQueue.push(n),this.handleQueue()})))),A(this,"buffered",(()=>this.sourceBuffer.buffered)),A(this,"removeFromMediaSource",(t=>{t.removeSourceBuffer(this.sourceBuffer)})),A(this,"changeType",(t=>new Promise(((e,i)=>{const n=new D((s=t,t=>t.changeType(s)),e,i);var s;this.commandQueue.push(n),this.handleQueue()})))),A(this,"removeBuffer",((t,e)=>new Promise(((i,n)=>{const s=new D(xi(t,e),i,n);this.commandQueue.push(s),this.handleQueue()})))),A(this,"flush",(()=>new Promise(((t,e)=>{const i=new D(Ti,t,e);this.commandQueue.push(i),this.handleQueue()})))),this.sourceBuffer=t,this.sourceBuffer.addEventListener("updateend",this.handleQueue)}}class Li extends n.E{constructor(){super(),A(this,"MediaSource",T()),A(this,"mediaSource",new this.MediaSource),A(this,"isOpen",(()=>"open"===this.mediaSource.readyState)),A(this,"isClosed",(()=>"closed"===this.mediaSource.readyState)),A(this,"isEnded",(()=>"ended"===this.mediaSource.readyState)),A(this,"createObjectURL",(()=>URL.createObjectURL(this.mediaSource))),A(this,"attach",(t=>{const e=t;if("srcObject"in e)try{e.srcObject=this.mediaSource}catch(t){if(t instanceof Error&&"TypeError"!==t.name)throw t;e.src=this.createObjectURL()}else t.src=this.createObjectURL()})),A(this,"detach",(t=>{if(this.mediaSource&&"open"===this.mediaSource.readyState)try{this.mediaSource.endOfStream()}catch(t){}t.srcObject&&(t.srcObject=null),""!==t.src&&(URL.revokeObjectURL(t.src),t.removeAttribute("src")),t.load()})),A(this,"addSourceBuffer",(t=>{const e=this.mediaSource.addSourceBuffer(t);return new Ri(e)})),A(this,"removeSourceBuffer",(t=>{t.removeFromMediaSource(this.mediaSource)})),A(this,"endOfStream",(t=>{this.mediaSource.endOfStream(t)})),A(this,"onSourceOpen",(()=>{this.setDurationIfNeeded(),this.emit("source open")})),A(this,"onSourceEnded",(()=>this.emit("source ended"))),A(this,"onSourceClosed",(()=>this.emit("source close"))),A(this,"setDurationIfNeeded",(()=>{if(Number.isNaN(this.mediaSource.duration)&&"open"===this.mediaSource.readyState){for(let t=0;t<this.mediaSource.sourceBuffers.length;t++){const e=this.mediaSource.sourceBuffers[t];if(null!=e&&e.updating)return}this.mediaSource.duration=Number.POSITIVE_INFINITY}})),this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.mediaSource.addEventListener("sourceclose",this.onSourceClosed),this.mediaSource.addEventListener("sourceended",this.onSourceEnded)}}A(Li,"isTypeSupported",(t=>{var e,i;return null!=(i=null==(e=T())?void 0:e.isTypeSupported(t))&&i}));class Pi{constructor(){A(this,"initSegments",new Map),A(this,"set",((t,e,i)=>{var n;const s=null!=(n=this.initSegments.get(t))?n:new Map;s.set(e,i),this.initSegments.set(t,s)})),A(this,"get",((t,e)=>{var i;return null==(i=this.initSegments.get(t))?void 0:i.get(e)}))}}function Mi(t,{mediaSource:e,mimeType:i}){return p(m({},t),{state:"initialized",mimeType:i,sourceBuffer:e.addSourceBuffer(i),isWorkingOnPendingSamples:!1,sequenceNumber:0,lastBufferCleanupTime:Date.now()})}function Bi({initSegments:t,pendingSamples:e}){return{state:"uninitialized",initSegments:null!=t?t:new Pi,sequenceNumber:0,isWorkingOnPendingSamples:!1,hasFirstSync:!!e,pendingSamples:null!=e?e:[],consecutiveQuotaExceededErrorCount:0,successfulAppendCalls:0}}const _i=class{constructor(t,e,i){A(this,"maxChunkSize",20),A(this,"minConsecutiveErrorsBeforeEmit",5),A(this,"maxSecondsInBuffer",60),A(this,"logger"),A(this,"timers",nt.create()),A(this,"emitter"),A(this,"mediaElement"),A(this,"mediaSource",new Li),A(this,"trackContexts",new Map),A(this,"autoRecoverFromMediaErrors",!0),A(this,"quotaErrorCount",0),A(this,"recoveredFromErrorCount",0),A(this,"sourceOpenStartTime",Date.now()),A(this,"sourceOpenEndTime",Date.now()),A(this,"pendingTracksToAddSourceBuffers"),A(this,"hasAddedInitialPosterFrame",!0),A(this,"load",(()=>{this.emitter.on("init segment",this.init),this.emitter.on("coded sample",this.onCodedSample),this.emitter.on("flush buffers",this.flushBuffers)})),A(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.emitter.off("init segment",this.init),this.emitter.off("coded sample",this.onCodedSample),this.emitter.off("flush buffers",this.flushBuffers),this.mediaSource.off("source ended",this.onSourceEnded),this.mediaSource.off("source open",this.onSourceOpen),this.mediaSource.detach(this.mediaElement),this.trackContexts.forEach((t=>t.pendingSamples=[])),this.timers.unload(),this.logger.debug("Unloaded module")})),A(this,"getStatistics",(()=>{var t,e,i,n;const s={quotaErrorCount:this.quotaErrorCount,mediaSourceOpenTime:this.sourceOpenEndTime-this.sourceOpenStartTime,successfulAudioAppendsCalls:null==(t=this.trackContexts.get("audio"))?void 0:t.successfulAppendCalls,successfulVideoAppendCalls:null==(e=this.trackContexts.get("video"))?void 0:e.successfulAppendCalls};if(this.mediaElement instanceof HTMLVideoElement){const t=null==(n=(i=this.mediaElement).getVideoPlaybackQuality)?void 0:n.call(i);s.totalVideoFrames=null==t?void 0:t.totalVideoFrames,s.droppedVideoFrames=null==t?void 0:t.droppedVideoFrames}return s})),A(this,"flushBuffers",(()=>{this.trackContexts.forEach((t=>{t.pendingSamples=[],t.hasFirstSync=!1,"uninitialized"!==t.state&&this.mediaSource.isOpen()&&t.sourceBuffer.removeBuffer(0,Number.POSITIVE_INFINITY).catch((t=>{this.logger.error("Failed to remove buffer",t)}))}))})),A(this,"setTrackContexts",((t=new Map)=>{this.logger.debug("setTrackContexts"),["audio","video"].forEach((e=>{var i,n,s,r;const o=null!=(n=null==(i=t.get(e))?void 0:i.pendingSamples)?n:[],a=null==(s=t.get(e))?void 0:s.initSegments;for(;o.length>0&&(null==(r=o[0])||!r.isSync);)o.shift();this.trackContexts.set(e,Bi({pendingSamples:o,initSegments:a}))}))})),A(this,"setSourceBuffers",(t=>y(this,null,(function*(){if(this.mediaSource.isClosed())return void(this.pendingTracksToAddSourceBuffers=t);let e=!0;for(const i of t){const t=this.trackContexts.get(i.type);if(!t||"uninitialized"===t.state||t.mimeType!==i.mimeType){e=!1;break}}if(e)this.logger.debug("Already setup with the correct mime types");else for(const e of t){let t=this.trackContexts.get(e.type);t||(t=Bi({pendingSamples:[],initSegments:new Pi}),this.trackContexts.set(e.type,t)),"initialized"===t.state?e.mimeType!==t.mimeType&&(yield t.sourceBuffer.changeType(e.mimeType)):this.trackContexts.set(e.type,Mi(t,{mimeType:e.mimeType,mediaSource:this.mediaSource}))}})))),A(this,"getBuffer",(t=>{const e=[];if(this.mediaSource.isClosed())return[];const i=this.trackContexts.get(t);if(!i||"uninitialized"===i.state)return[];try{const t=i.sourceBuffer.buffered();if(!t)return[];for(let i=0;i<t.length;i++)e.push({start:1e3*t.start(i),end:1e3*t.end(i)});return e}catch(t){return[]}})),A(this,"init",(({initSegment:t,mimeType:e})=>{this.logger.debug("Added init segment",{channel:t.channelId,renditionId:t.renditionId});const i=this.trackContexts.get(t.type);if(!i)throw ft(t.type,t.renditionId);"initialized"===i.state&&(i.mimeType=e);const n=((t,e,i)=>{switch(t){case"h264":return((t,e)=>((t,e)=>{const{sequenceParameterSets:i,pictureParameterSets:n}=Et(t),s=qt(t);return Qt([{type:"video",sequenceParameterSets:i.map((t=>new Uint8Array(t))),pictureParameterSets:n.map((t=>new Uint8Array(t))),width:s.width,height:s.height,timescale:e,duration:0,trackId:1}])})(t,e))(e,i);case"av1":return((t,e)=>((t,e)=>{const i=Zt(t);if(!i)throw new Error("Failed to parse sequence header");return Qt([{type:"video",parsedSequenceHeader:i,sequenceHeader:new Uint8Array(t),width:i.maxFrameWidth,height:i.maxFrameHeight,timescale:e,duration:0,trackId:1}])})(t,e))(e,i);case"opus":return((t,e)=>((t,e,i)=>Qt([{type:"audio",trackId:1,channelCount:2,timescale:i,codec:"opus",decoderConfig:t,duration:0,sampleRate:48e3}]))(new Uint8Array(t),0,e))(e,i);case"aac":return((t,e)=>((t,e,i,n)=>Qt([{type:"audio",codec:"aac",decoderConfig:t,channelCount:2,sampleRate:i,timescale:n,duration:0,trackId:1}]))(new Uint8Array(t),0,e,e))(e,i);default:throw new Error(`Failed to initialize ${t} segment`)}})(t.codec,t.data,t.timescale);n&&i.initSegments.set(t.channelId,t.renditionId,n)})),A(this,"append",((t,e)=>y(this,null,(function*(){var i;const n=t[0];if(!n)return;const s=this.trackContexts.get(n.type),r=null==s?void 0:s.initSegments.get(n.channelId,n.renditionId);if(this.mediaSource.isClosed())return;if(!r)throw((t,e)=>new mt(`No init segment for rendition id ${t} for channel ${e}`,{isFatal:!1,code:"missing_init_segment",type:"internal"}))(n.renditionId,n.channelId);if(!s)throw ft(n.type,n.renditionId);if("uninitialized"===s.state)throw((t,e)=>new mt(`Track context is in an invalid state for ${t}${e?`, rendition id ${e}`:""}`,{isFatal:!1,code:"invalid_track_context_state",type:"internal"}))(n.type,n.renditionId);if(e){const t=(n.timestamp+(null!=(i=n.compositionTimeOffset)?i:0))/n.timescale;yield s.sourceBuffer.removeBuffer(t,Number.POSITIVE_INFINITY);const e=s.previousSample;if(e&&e.codec!==n.codec&&s.sourceBuffer.changeType)try{yield s.sourceBuffer.changeType(s.mimeType)}catch(t){}yield s.sourceBuffer.appendBuffer(r)}const o=Math.max(0,n.timestamp/n.timescale-this.maxSecondsInBuffer);o>0&&Date.now()-s.lastBufferCleanupTime>1e4&&(s.lastBufferCleanupTime=Date.now(),yield s.sourceBuffer.removeBuffer(0,o+10));try{let e=s.sequenceNumber;const i=Di(t.map((t=>((t,e)=>{switch(t.codec){case"h264":case"av1":return(({isSync:t,timestamp:e,data:i,duration:n,compositionTimeOffset:s},r)=>jt({trackId:1,timestamp:e,sequenceNumber:r,defaultSize:i.byteLength,defaultFlags:t?33554432:16842752,defaultDuration:n,samples:[{isSync:t,data:new Uint8Array(i),duration:n,compositionTimeOffset:s}]}))(t,e);case"opus":case"aac":return(({isSync:t,timestamp:e,data:i,duration:n},s)=>jt({trackId:1,timestamp:e,sequenceNumber:s,defaultSize:i.byteLength,defaultFlags:33554432,defaultDuration:n,samples:[{isSync:t,data:new Uint8Array(i),duration:n}]}))(t,e);default:throw new Error(`Unsupported codec ${t.codec}`)}})(t,e++))));yield s.sourceBuffer.appendBuffer(i),s.sequenceNumber=e,s.consecutiveQuotaExceededErrorCount=0,s.successfulAppendCalls++}catch(e){throw e instanceof DOMException&&(e.code===DOMException.QUOTA_EXCEEDED_ERR?(this.quotaErrorCount++,s.consecutiveQuotaExceededErrorCount++,this.logger.error("quota exceeded error",{error:e}),s.pendingSamples.unshift(...t)):this.mediaElement.error&&s.pendingSamples.unshift(...t)),e}})))),A(this,"onCodedSample",(t=>{if(0===t.duration)return;const e=this.trackContexts.get(t.type);if(!e)throw ft(t.type,t.renditionId);if(e.hasFirstSync||t.isSync){if(this.hasAddedInitialPosterFrame&&t.isSync&&"video"===t.type){this.hasAddedInitialPosterFrame=!1;const i=m({},t);i.timestamp=0,e.pendingSamples.push(i)}e.hasFirstSync=!0,e.pendingSamples.push(t),"uninitialized"!==e.state&&(e.isWorkingOnPendingSamples||Fi(e,this.append,this.maxChunkSize).catch((i=>{if(e.isWorkingOnPendingSamples=!1,i instanceof Error){if(this.logger.error("append failed",{message:i.message,name:i.name}),i instanceof DOMException&&i.code===DOMException.QUOTA_EXCEEDED_ERR){if(e.consecutiveQuotaExceededErrorCount>=this.minConsecutiveErrorsBeforeEmit){const n=gt(!1,i,e.consecutiveQuotaExceededErrorCount,t.type);this.emitter.emit("error",n)}}else{const n=gt(!1,i,e.consecutiveQuotaExceededErrorCount,t.type);this.emitter.emit("error",n)}this.mediaElement.error&&this.onSourceEnded()}})))}})),A(this,"onSourceOpen",(()=>{this.logger.debug("source opened"),this.sourceOpenEndTime=Date.now(),this.pendingTracksToAddSourceBuffers&&(this.setSourceBuffers(this.pendingTracksToAddSourceBuffers),this.pendingTracksToAddSourceBuffers=void 0)})),A(this,"onSourceEnded",(()=>{const{error:t}=this.mediaElement;if(t){const e=((t,e)=>new mt("MediaElement Error",{isFatal:t,code:"media_element_error",source:e},{mediaErrorCode:e.code}))(/AUDIO_RENDERER/.test(t.message)||!this.autoRecoverFromMediaErrors,t);if(this.logger.error("MediaElement error",{error:e}),this.emitter.emit("error",e),!e.isFatal()){this.logger.info("Re-opening MediaSource"),this.emitter.emit("recovered from media error",{error:e,count:this.recoveredFromErrorCount}),this.recoveredFromErrorCount++;const t=!this.mediaElement.paused,i=[];this.trackContexts.forEach(((t,e)=>{"initialized"===t.state&&i.push({type:e,mimeType:t.mimeType})})),this.sourceOpenStartTime=Date.now(),this.pendingTracksToAddSourceBuffers=i,this.mediaElement.src="",this.setTrackContexts(this.trackContexts),this.mediaSource.attach(this.mediaElement),t&&this.mediaElement.play().catch($)}}this.logger.debug("source ended")})),this.logger=t,this.mediaElement=i,this.emitter=e}};A(_i,"create",((t,e,i)=>{const n=new _i(t,e,i);return n.setTrackContexts(),n.mediaSource.on("source ended",n.onSourceEnded),n.mediaSource.on("source open",n.onSourceOpen),n.mediaSource.attach(i),n}));let Ui=_i;const Ni=(t,e)=>{var i;const n=t.renditionId!==e.renditionId,s=t.channelId!==e.channelId,r=(null!=(i=t.timestamp)?i:0)>e.timestamp;let o=!1;return"video"===t.type&&"video"===e.type&&(o=e.width!==t.width||e.height!==t.height),s||n||r||o},Di=function(t){const e=t.reduce(((t,e)=>t+e.byteLength),0),i=new Uint8Array(e);let n=0;return t.forEach((t=>{i.set(new Uint8Array(t),n),n+=t.byteLength})),i.buffer},Fi=(t,e,i)=>y(void 0,null,(function*(){for(t.isWorkingOnPendingSamples=!0;t.pendingSamples.length>0;){const n=[];let s=0;for(let e=0;e<t.pendingSamples.length;e++){s=e;const r=t.pendingSamples[e],o=t.pendingSamples[e+1];if(r&&(n.push(r),o&&Ni(r,o))||e===i-1)break}const r=n[0];if(!r)break;const o=!t.previousSample||Ni(t.previousSample,r);yield e(n,o),t.pendingSamples=t.pendingSamples.slice(s+1),t.previousSample=n[n.length-1]}t.isWorkingOnPendingSamples=!1})),Oi=class{constructor(t,e){A(this,"logger"),A(this,"emitter"),A(this,"element"),A(this,"pictureInPictureWindow"),A(this,"unload",(()=>{this.emitter.off("add picture in picture listener",this.onEnablePictureInPicture)})),A(this,"onEnablePictureInPicture",(t=>{this.element=t.element,t.element.addEventListener("leavepictureinpicture",(()=>{this.pictureInPictureWindow=void 0,this.logger.debug("Leave picture in picture"),this.emitter.emit("exit picture in picture")})),t.element.addEventListener("enterpictureinpicture",(t=>{this.pictureInPictureWindow=t.pictureInPictureWindow,this.logger.debug("Enter picture in picture"),this.emitter.emit("enter picture in picture",this)})),t.element.autopictureinpicture=!0})),A(this,"getPictureInPictureSize",(()=>this.pictureInPictureWindow)),A(this,"isPictureInPictureActive",(()=>this.isWebkitPresentationModeActive()||this.isStandardPictureInPictureActive())),A(this,"isPictureInPictureSupported",(()=>this.isWebkitPresentationModeSupported()||this.isStandardPictureInPictureSupported())),A(this,"requestPictureInPicture",(()=>(this.emitter.emit("ios-hack: reset size"),this.isStandardPictureInPictureSupported()?this.requestStandardPictureInPicture():this.isWebkitPresentationModeSupported()?this.requestWebkitPresentationMode("picture-in-picture"):Promise.reject(new Error("Picture in picture is not supported"))))),A(this,"exitPictureInPicture",(()=>this.isStandardPictureInPictureSupported()?this.exitStandardPictureInPicture():this.isWebkitPresentationModeSupported()?this.requestWebkitPresentationMode("inline"):Promise.reject(new Error("Picture in picture is not supported")))),A(this,"getStatistics",(()=>({isPictureInPictureActive:this.isPictureInPictureActive()}))),A(this,"requestStandardPictureInPicture",(()=>y(this,null,(function*(){return yield this.element.requestPictureInPicture()})))),A(this,"exitStandardPictureInPicture",(()=>y(this,null,(function*(){return yield document.exitPictureInPicture()})))),A(this,"isStandardPictureInPictureSupported",(()=>!!this.element&&!!this.element.requestPictureInPicture&&!!document.pictureInPictureEnabled)),A(this,"isStandardPictureInPictureActive",(()=>!!this.element&&!!document.pictureInPictureElement)),A(this,"isWebkitPresentationModeActive",(()=>!!this.element&&"picture-in-picture"===this.element.webkitPresentationMode)),A(this,"requestWebkitPresentationMode",(t=>y(this,null,(function*(){return this.element.webkitSetPresentationMode(t),Promise.resolve()})))),A(this,"isWebkitPresentationModeSupported",(()=>!!this.element&&!!this.element.webkitSetPresentationMode)),this.emitter=t,this.logger=e,this.emitter.on("add picture in picture listener",this.onEnablePictureInPicture)}};A(Oi,"create",((t,e)=>new Oi(t,e)));let Wi=Oi;const Gi=class{constructor(t,e,i,n){A(this,"emitter"),A(this,"logger"),A(this,"clockSource"),A(this,"state","buffering"),A(this,"bufferFullness",0),A(this,"targetBufferTime"),A(this,"lastBufferStateEvent","drained"),A(this,"firstFrameTime"),A(this,"currentTimeIsInRange",!1),A(this,"needsInputForAudioCount",0),A(this,"needsInputForVideoCount",0),A(this,"unload",(()=>{this.emitter.off("buffer state",this.onBufferedStateChanged),this.emitter.off("needs user input",this.onNeedsUserInput)})),A(this,"setTargetBufferTime",(t=>{this.targetBufferTime=t})),A(this,"getTargetBufferTime",(()=>this.targetBufferTime)),A(this,"getBufferFullness",(()=>this.bufferFullness)),A(this,"getLastBufferStateEvent",(()=>this.lastBufferStateEvent)),A(this,"getState",(()=>this.state)),A(this,"getFirstFrameTime",(()=>this.firstFrameTime)),A(this,"getStatistics",(()=>({bufferTime:this.targetBufferTime,needsInputForAudioCount:this.needsInputForAudioCount,needsInputForVideoCount:this.needsInputForVideoCount}))),A(this,"onBufferedStateChanged",(({buffered:t,isPaused:e})=>{const i=this.clockSource.currentTime,n=t.some((t=>t.start<i&&i<t.end)),s=t[t.length-1],r=!!s&&s.end-s.start>=this.targetBufferTime,o=s?Math.max(0,s.end-i)/this.targetBufferTime:0,a=e?"paused":n?"playing":"buffering",l=this.state;this.currentTimeIsInRange===n||n?n&&r&&"drained"===this.lastBufferStateEvent&&(this.lastBufferStateEvent="filled",this.emitter.emit("buffer state event",this.lastBufferStateEvent)):(this.lastBufferStateEvent="drained",this.emitter.emit("buffer state event",this.lastBufferStateEvent)),"playing"===a&&!this.firstFrameTime&&(this.firstFrameTime=Date.now()),this.currentTimeIsInRange=n,this.state=a,this.bufferFullness=n?o:0,l!==a&&this.emitter.emit("playback state",a),this.emitter.emit("buffer fullness",this.bufferFullness)})),A(this,"onNeedsUserInput",(({forAudio:t,forVideo:e})=>{t&&this.needsInputForAudioCount++,e&&this.needsInputForVideoCount++})),this.emitter=t,this.logger=e,this.clockSource=i,this.targetBufferTime=n,this.emitter.on("buffer state",this.onBufferedStateChanged),this.emitter.on("needs user input",this.onNeedsUserInput)}};A(Gi,"create",((t,e,i,n)=>new Gi(t,e,i,n)));let zi=Gi;const Hi=()=>({upgradesFromLevel:[],downgradesFromLevel:[],bufferingRanges:[],activeRanges:[],decodeRate:Number.MAX_SAFE_INTEGER}),Vi=class{constructor(t,e){A(this,"minBufferFullnessLengthForRegression",6),A(this,"logger"),A(this,"emitter"),A(this,"timers",nt.create()),A(this,"metrics",{levels:{},levelDowngrades:[],levelUpgrades:[],bufferFullness:0,general:Hi()}),A(this,"bufferFullness",new k(30)),A(this,"bufferFullnessRegression"),A(this,"currentLevel"),A(this,"isSuspended",!1),A(this,"_fatalQosCount",0),A(this,"hasAsserted",!1),A(this,"load",(()=>{this.emitter.on("playback state",this.onPlaybackState),this.emitter.on("buffer fullness",this.onBufferFullness),this.emitter.on("rendition level changed",this.onRenditionLevelChanged),this.emitter.on("video decode rate",this.onVideoDecodeRate)})),A(this,"unload",(()=>{this.emitter.off("playback state",this.onPlaybackState),this.emitter.off("buffer fullness",this.onBufferFullness),this.emitter.off("rendition level changed",this.onRenditionLevelChanged),this.emitter.off("video decode rate",this.onVideoDecodeRate),this.suspend()})),A(this,"suspend",(()=>{this.isSuspended=!0,this.timers.unload(),this.stopBuffering(),this.unsetActive()})),A(this,"unsuspend",(()=>{this.isSuspended=!1,this.currentLevel&&this.setActive()})),A(this,"fatalQosGraceTime",(()=>1e4*(this.fatalQosCount+1))),A(this,"incrementFatalQosCount",(()=>{this._fatalQosCount++})),A(this,"getMetrics",(()=>this.metrics)),A(this,"getLevelStats",(t=>{var e,i,n,s;const r=(null!=(i=null==(e=t.video)?void 0:e.bitRate)?i:0)+(null!=(s=null==(n=t.audio)?void 0:n.bitRate)?s:0);return this.metrics.levels[r]})),A(this,"getBufferFullnessRegression",(()=>this.bufferFullnessRegression)),A(this,"activeRatios",(()=>{const t=new Map,e=tt(this.metrics.general.activeRanges);if(Object.entries(this.metrics.levels).forEach((([i,n])=>{t.set(i,e?tt(n.activeRanges)/e:0)})),!this.hasAsserted){const e=!t.size||Math.abs(Array.from(t.values()).reduce(((t,e)=>t+e),0)-1)<=.02;e||(this.hasAsserted=!0,console.assert(e,`Active ratios should be close to 1 - actual: ${Array.from(t.values()).reduce(((t,e)=>t+e),0)}`))}return t})),A(this,"bufferingRatios",(()=>{const t=new Map,e=tt(this.metrics.general.bufferingRanges);if(Object.entries(this.metrics.levels).forEach((([i,n])=>{t.set(i,e?tt(n.bufferingRanges)/e:0)})),!this.hasAsserted){const e=Array.from(t.values()).reduce(((t,e)=>t+e),0)<=1;e||(this.hasAsserted=!0,console.assert(e,`Buffering ratios should be less than 1 - actual: ${Array.from(t.values()).reduce(((t,e)=>t+e),0)}`))}return t})),A(this,"bufferingEventsLast",(t=>this.metrics.general.bufferingRanges.filter((e=>e.start>=Date.now()-t)).length)),A(this,"timeSpentBufferingLast",(t=>et(this.metrics.general.bufferingRanges,t))),A(this,"timeSpentActiveLast",(t=>et(this.metrics.general.activeRanges,t))),A(this,"timeSpentPlayingInAtLeastLevelRatio",(t=>{var e,i,n,s;const r=this.timeSpentBuffering(),o=this.timeActive(),a=this.bufferingRatios(),l=this.activeRatios(),h=(null!=(i=null==(e=t.video)?void 0:e.bitRate)?i:0)+(null!=(s=null==(n=t.audio)?void 0:n.bitRate)?s:0),c=r/o;return Object.keys(this.metrics.levels).map((t=>parseInt(t,10))).filter((t=>t>=h)).reduce(((t,e)=>{var i,n;return(null!=(i=l.get(e.toString()))?i:0)-(null!=(n=a.get(e.toString()))?n:0)*c+t}),0)})),A(this,"timeSpentBuffering",(()=>tt(this.metrics.general.bufferingRanges))),A(this,"timeActive",(()=>tt(this.metrics.general.activeRanges))),A(this,"getStatistics",(()=>({timeSpentBuffering:this.timeSpentBuffering(),bufferingEventsCount:this.metrics.general.bufferingRanges.length,timeSpentRatio:[...this.activeRatios()].reduce(((t,[e,i])=>(t[e]=i,t)),{}),fatalQosCount:this.fatalQosCount}))),A(this,"onRenditionLevelChanged",(t=>{var e,i,n,s,r,o,a,l,h,c,d,u,m,p;const A=(null!=(n=null==(i=null==(e=t.from)?void 0:e.video)?void 0:i.bitRate)?n:0)+(null!=(o=null==(r=null==(s=t.from)?void 0:s.audio)?void 0:r.bitRate)?o:0),g=(null!=(h=null==(l=null==(a=t.to)?void 0:a.video)?void 0:l.bitRate)?h:0)+(null!=(u=null==(d=null==(c=t.to)?void 0:c.audio)?void 0:d.bitRate)?u:0);this.logger.info("rendition level changed",{fromLevel:A,toLevel:g}),0===this.metrics.general.activeRanges.length&&this.setActive(),t.from&&t.to&&(A<g?this.metrics.general.upgradesFromLevel.push(Date.now()):this.metrics.general.downgradesFromLevel.push(Date.now()));let f=!1;if(t.from){const t=null!=(m=this.metrics.levels[A])?m:Hi();A<g?t.upgradesFromLevel.push(Date.now()):t.downgradesFromLevel.push(Date.now()),Y(t.activeRanges);const e=t.bufferingRanges[t.bufferingRanges.length-1];f=!!e&&!e.end,Y(t.bufferingRanges),this.metrics.levels[A]=t}if(t.to){const t=null!=(p=this.metrics.levels[g])?p:Hi();K(t.activeRanges),f&&K(t.bufferingRanges),this.metrics.levels[g]=t,this.currentLevel=g}})),A(this,"onBufferFullness",(t=>{this.bufferFullness.push(t),this.metrics.bufferFullness=t,this.bufferFullness.items().length>=this.minBufferFullnessLengthForRegression&&(this.bufferFullnessRegression=this.calculateLinearRegression())})),A(this,"onPlaybackState",(t=>{switch(this.logger.info("Playback state",{state:t,currentLevel:this.currentLevel}),t){case"playing":this.stopBuffering();break;case"buffering":this.isSuspended||this.startBuffering()}})),A(this,"onVideoDecodeRate",(t=>{var e;if(this.metrics.general.decodeRate=t,!this.currentLevel)return;const i=this.metrics.levels[null!=(e=this.currentLevel)?e:0];i&&(i.decodeRate=t)})),A(this,"calculateLinearRegression",(()=>(t=>{let e=0,i=0,n=0,s=0,r=0;for(let o=0;o<t.length;o++){const{x:a,y:l}=t[o];e+=a,i+=l,n+=a*l,s+=a*a,r+=l*l}const o=(t.length*n-e*i)/(t.length*s-e*e),a=(i-o*e)/t.length,l=Math.pow((t.length*n-e*i)/Math.sqrt((t.length*s-e*e)*(t.length*r-i*i)),2);return{slope:o,intercept:a,r2:l,predict:e=>o*(t.length+e)+a}})(this.bufferFullness.items().map(((t,e)=>({x:e,y:t})))))),A(this,"stopBuffering",(()=>{if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&Y(t.bufferingRanges)}Y(this.metrics.general.bufferingRanges)})),A(this,"startBuffering",(()=>{if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&K(t.bufferingRanges)}K(this.metrics.general.bufferingRanges)})),A(this,"unsetActive",(()=>{if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&Y(t.activeRanges)}Y(this.metrics.general.activeRanges)})),this.logger=e,this.emitter=t}get fatalQosCount(){return this._fatalQosCount}setActive(){if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&K(t.activeRanges)}K(this.metrics.general.activeRanges)}};A(Vi,"create",((t,e)=>new Vi(t,e)));let Xi=Vi;const Qi=class{constructor(t,e){A(this,"renditions",new Map),A(this,"renditionLevels",[]),A(this,"languages",[]),A(this,"emitter"),A(this,"subscriptionSource"),A(this,"renditionLevelChangeCount",0),A(this,"unload",(()=>{this.emitter.off("renditions",this.onRenditions),this.emitter.off("subscription changed",this.onSubscriptionChanged)})),A(this,"getRenditionLevels",(t=>t?this.createRenditionLevels(t):this.renditionLevels)),A(this,"getRenditionLevel",(t=>{var e;const i=null!=t?t:this.getCurrentSubscription(),n=t?this.createRenditionLevels(t):this.renditionLevels;if(!i.video)return n.length?n[0]:void 0;const s=i.video.bitRate||Number.MAX_SAFE_INTEGER,r=i.video.width||Number.MAX_SAFE_INTEGER,o=i.video.height||Number.MAX_SAFE_INTEGER;return null!=(e=n.filter((t=>!t.video||!i.video||t.video.bitRate<=s&&t.video.width<=r&&t.video.height<=o)).pop())?e:n[0]})),A(this,"setRenditions",((t,e)=>{this.renditions.set(t,e)})),A(this,"getLanguages",(()=>this.languages)),A(this,"getVideoRendition",((t,e=this.getCurrentSubscription().channelId)=>{const i=this.getRendition(t,e);if(i&&at(i))return i})),A(this,"getAudioRenditions",(t=>{const e=this.renditions.get(t);return null==e?void 0:e.filter((t=>lt(t)))})),A(this,"getVideoRenditions",(t=>{const e=this.renditions.get(t);return null==e?void 0:e.filter((t=>at(t)))})),A(this,"getAudioRendition",((t,e=this.getCurrentSubscription().channelId)=>{const i=this.getRendition(t,e);if(i&&lt(i))return i})),A(this,"getRendition",((t,e=this.getCurrentSubscription().channelId)=>{var i;return null==(i=this.renditions.get(e))?void 0:i.find((e=>e.id===t))})),A(this,"getStatistics",(()=>{var t,e,i,n,s,r,o,a,l,h;const c=this.getRenditionLevel();return{videoCodec:null==(t=null==c?void 0:c.video)?void 0:t.codec,audioCodec:null==(e=null==c?void 0:c.audio)?void 0:e.codec,videoRenditionId:null==(i=null==c?void 0:c.video)?void 0:i.id,audioRenditionId:null==(n=null==c?void 0:c.audio)?void 0:n.id,videoWidth:null==(s=null==c?void 0:c.video)?void 0:s.width,videoHeight:null==(r=null==c?void 0:c.video)?void 0:r.height,expectedVideoBitRate:null==(o=null==c?void 0:c.video)?void 0:o.bitRate,expectedAudioBitRate:null==(a=null==c?void 0:c.audio)?void 0:a.bitRate,frameRate:null==(l=null==c?void 0:c.video)?void 0:l.frameRate,language:null==(h=null==c?void 0:c.audio)?void 0:h.language,renditionLevelChangeCount:this.renditionLevelChangeCount}})),A(this,"onRenditions",(t=>{const e=this.subscriptionSource.getCurrentSubscription();this.renditions.set(t.channelId,t.renditions),this.updateRenditionLevels({to:e,from:e})})),A(this,"onSubscriptionChanged",(t=>{this.updateRenditionLevels(t)})),A(this,"updateRenditionLevels",(({to:t,from:e})=>{var i;const{channelId:n,initiator:s}=t,r=this.getRenditionLevel(e),o=new Set;(null!=(i=this.renditions.get(n))?i:[]).filter((t=>"webvtt"!==t.codec)).forEach((t=>t.language?o.add(t.language):void 0)),this.languages=Array.from(o),this.renditionLevels=this.createRenditionLevels(t);const a=this.getRenditionLevel(t);G(r,a)||(this.renditionLevelChangeCount++,this.emitter.emit("rendition level changed",{to:a,from:r,reason:s?"manual":"abr"}))})),A(this,"createRenditionLevels",(t=>{var e;const{video:i,audio:n,channelId:s}=t,r=null!=(e=this.renditions.get(s))?e:[],o=r.filter(at).filter((t=>i&&t.codec===i.codec)),a=r.filter(lt).filter((t=>n&&t.codec===n.codec&&t.language===n.language)),l=Math.max(o.length,a.length),h=[];for(let t=0;t<l;t++){const e=o[Math.min(o.length-1,t)],i=a[Math.min(a.length-1,t)];h.push({audio:i,video:e})}return h})),A(this,"getCurrentSubscription",(()=>this.subscriptionSource.getCurrentSubscription())),this.subscriptionSource=e,this.emitter=t,this.emitter.on("renditions",this.onRenditions),this.emitter.on("subscription changed",this.onSubscriptionChanged)}};A(Qi,"create",((t,e)=>new Qi(t,e)));let ji=Qi;const qi=t=>JSON.parse(JSON.stringify(t)),Zi=class{constructor(t,e,i){A(this,"logger"),A(this,"timers",new nt),A(this,"emitter"),A(this,"targetSubscription"),A(this,"currentSubscription"),A(this,"_isSwitchingSubscription",!1),A(this,"pendingSubscriptionTimeoutId"),A(this,"burstMs",0),A(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.timers.unload(),this.emitter.off("subscription changed",this.onSubscriptionChanged),this.logger.debug("Unloaded module")})),A(this,"isSwitchingSubscription",(()=>this._isSwitchingSubscription)),A(this,"getTargetSubscription",(()=>this.targetSubscription)),A(this,"getCurrentSubscription",(()=>this.currentSubscription)),A(this,"enableBurst",(t=>{this.burstMs=t})),A(this,"setSize",(t=>{this.targetSubscription.video.width=t.width,this.targetSubscription.video.height=t.height,this.scheduleSubscriptionChange()})),A(this,"setVideoConstraint",(t=>{this.targetSubscription.video=t,this.scheduleSubscriptionChange()})),A(this,"setAudioConstraint",(t=>{this.targetSubscription.audio=t,this.scheduleSubscriptionChange()})),A(this,"setVideoBitRate",(t=>{this.targetSubscription.video.bitRate=t,this.scheduleSubscriptionChange()})),A(this,"setAudioBitRate",(t=>{this.targetSubscription.audio.bitRate=t,this.scheduleSubscriptionChange()})),A(this,"setChannelId",(t=>{this.targetSubscription.channelId=t,this.scheduleSubscriptionChange()})),A(this,"setLanguage",(t=>{this.targetSubscription.audio.language=t,this.scheduleSubscriptionChange()})),A(this,"setVideoCodec",(t=>{this.targetSubscription.video.codec=t,this.scheduleSubscriptionChange()})),A(this,"setAudioCodec",(t=>{this.targetSubscription.audio.codec=t,this.scheduleSubscriptionChange()})),A(this,"setBurst",(t=>{t?this.targetSubscription.burstMs=t:delete this.targetSubscription.burstMs})),A(this,"isNewSubscription",(()=>{const t=["burstMs","meta","initiator","channelGroupId"];return!G(J(this.currentSubscription,t),J(this.targetSubscription,t))})),A(this,"onSubscriptionChanged",(({to:t})=>{this.logger.debug("onSubscriptionChanged",{to:t}),this.currentSubscription=m({},t),this._isSwitchingSubscription=this.isNewSubscription()})),A(this,"scheduleSubscriptionChange",(()=>{this.targetSubscription=qi(this.targetSubscription),this._isSwitchingSubscription=this.isNewSubscription();const t=this.currentSubscription.channelId!==this.targetSubscription.channelId;this._isSwitchingSubscription&&(t&&this.burstMs?this.setBurst(this.burstMs):this.setBurst(0),this.pendingSubscriptionTimeoutId&&(this.timers.clearTimeout(this.pendingSubscriptionTimeoutId),this.pendingSubscriptionTimeoutId=void 0),this.pendingSubscriptionTimeoutId=this.timers.setTimeout((()=>this.emitter.emit("send signal",JSON.stringify({type:"subscribe",subscription:this.getTargetSubscription()}))),0))})),this.logger=t,this.targetSubscription=e,this.currentSubscription=qi(e),this.emitter=i,this.emitter.on("subscription changed",this.onSubscriptionChanged)}};A(Zi,"create",((t,e,i)=>new Zi(t,i,e)));let $i=Zi;const Ji=()=>M()||B()||-1!==I.indexOf("CrKey")?100:0,Yi=t=>e=>e>t,Ki=class{constructor(t,e,i,n,s){A(this,"emitter"),A(this,"logger"),A(this,"playbackSource"),A(this,"bufferSource"),A(this,"keyframeTimestamps",new k(10)),A(this,"lastSeekTime",Date.now()),A(this,"seekCooldownTime",1e3),A(this,"seekTimeoutTime",5e3),A(this,"seekKeyframeOvershoot",50),A(this,"syncMaxBehind"),A(this,"syncMaxBehindMultiplierStep",1),A(this,"syncMaxBehindIncreaseEvery",2),A(this,"syncMaxBehindMaximumAllowed",2e3),A(this,"syncMaxBehindMultiplier",1),A(this,"timeshiftOnAudio",!1),A(this,"syncMaxAhead",150),A(this,"timeshiftSync",{enabled:!1,maxBehind:50,multiplier:1,maxBehindAllowed:600,overshoot:Ji(),minOvershootAllowed:Ji(),maxOvershootAllowed:500}),A(this,"maxTimeSyncDifferenceTolerance",150),A(this,"timers",nt.create()),A(this,"rtt",0),A(this,"channelSyncInfo",new Map),A(this,"driftAdjustmentsCount",0),A(this,"timeshiftDriftAdjustmentCount",0),A(this,"driftAdjustments",[]),A(this,"timeShiftAdjustments",[]),A(this,"timestampOffset"),A(this,"currentChannelId"),A(this,"highestSeenTimestamps",new Map),A(this,"isSuspended",!1),A(this,"isSyncAdjustmentActivated",!1),A(this,"load",(()=>{this.timers.setInterval(this.onSync,100)})),A(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.emitter.off("rtt",this.updateRtt),this.timers.unload(),this.logger.debug("Unloaded module")})),A(this,"suspend",(()=>{this.isSuspended=!0})),A(this,"unsuspend",(()=>{this.resetSyncState(),this.isSuspended=!1})),A(this,"deactivateSyncAdjustments",(()=>{this.isSyncAdjustmentActivated=!1})),A(this,"activateSyncAdjustments",(()=>{this.tryApplySyncInfo(0),this.lastSeekTime=Date.now(),this.isSyncAdjustmentActivated=!0})),A(this,"reset",(()=>{this.logger.info("Reset sync state"),this.currentChannelId=void 0,this.timestampOffset=void 0,this.resetSyncState(),this.highestSeenTimestamps.clear()})),A(this,"getTimeshiftOffset",(()=>{var t;return null!=(t=this.timestampOffset)?t:0})),A(this,"getCurrentChannelId",(()=>this.currentChannelId)),A(this,"resetSyncState",(()=>{this.timeshiftSync.multiplier=1,this.syncMaxBehindMultiplier=1,this.driftAdjustments=[],this.timeShiftAdjustments=[]})),A(this,"getLiveEdgeTime",(t=>{const e=this.channelSyncInfo.get(t);if(!e)return;const i=Date.now()-e.localTimestamp;return e.timestamp+i})),A(this,"getLiveEdgeTimeLatencyAdjusted",(t=>{const e=this.getLiveEdgeTime(t);if(e)return e+this.rtt/2})),A(this,"getWallclockTime",(t=>{const e=this.channelSyncInfo.get(t);if(!e)return;const i=Date.now()-e.localTimestamp;return e.wallclockTime+i})),A(this,"getWallclockTimeLatencyAdjusted",(t=>{const e=this.getWallclockTime(t);if(e)return e+this.rtt/2})),A(this,"processSample",(t=>{var e;if(!t.channelId)throw new Error("Sample must be assigned to a channel");this.currentChannelId||(this.currentChannelId=t.channelId),this.timestampOffset||(this.timestampOffset=t.timestamp/t.timescale*1e3-5e3);const i="video"===t.type&&t.isSync;if(this.currentChannelId!==t.channelId){let e=Number.MAX_SAFE_INTEGER;console.assert(0!==this.highestSeenTimestamps.size,"no known timestamps"),this.highestSeenTimestamps.forEach((t=>{e=Math.min(e,t)}));const i=t.timestamp/t.timescale*1e3;this.currentChannelId=t.channelId,this.timestampOffset=i-e}else(i||this.timeshiftOnAudio)&&this.tryTimeshiftSync();const n=this.timestampOffset*t.timescale/1e3;return t.timestamp-=n,i&&this.keyframeTimestamps.push(t.timestamp/t.timescale*1e3),this.highestSeenTimestamps.set(t.type,Math.max(null!=(e=this.highestSeenTimestamps.get(t.type))?e:0,t.timestamp/t.timescale*1e3)),t})),A(this,"getStatistics",(()=>({drift:this.drift,driftAdjustmentCount:this.driftAdjustmentsCount,timeshiftDriftAdjustmentCount:this.timeshiftDriftAdjustmentCount,seekTime:this.playbackSource.seekTime}))),A(this,"updateRtt",(t=>{this.rtt=t})),A(this,"isPlaybackSourceReadyToSeek",(()=>!this.isSeeking()&&this.isSeekCooldownExpired()&&this.isSyncAdjustmentActivated)),A(this,"isSeeking",(()=>!!this.playbackSource.isSeeking&&!this.isSeekTimeoutExpired())),A(this,"isAllowedToSync",(()=>this.isPlaybackSourceReadyToSeek()&&!!this.currentChannelId&&!this.isSuspended&&!this.playbackSource.isPaused)),A(this,"isSeekCooldownExpired",(()=>Date.now()-this.lastSeekTime>this.seekCooldownTime)),A(this,"isSeekTimeoutExpired",(()=>Date.now()-this.lastSeekTime>this.seekTimeoutTime)),A(this,"currentTimeshiftMaxBehind",(()=>Math.min(this.timeshiftSync.maxBehind*this.timeshiftSync.multiplier,this.timeshiftSync.maxBehindAllowed))),A(this,"currentSyncMaxBehind",(()=>Math.min(this.syncMaxBehindMultiplier*this.syncMaxBehind,this.syncMaxBehindMaximumAllowed))),A(this,"currentSyncMaxAhead",(()=>this.playbackSource.seekTime>500?Math.max(this.syncMaxAhead*this.syncMaxBehindMultiplier,300):this.syncMaxAhead)),A(this,"tryTimeshiftSync",(()=>{var t;if(!this.timeshiftSync.enabled||!this.isAllowedToSync())return;const e=null!=(t=this.drift)?t:0;if(e>=this.syncMaxBehind)return;if(e<this.currentTimeshiftMaxBehind())return void(this.timeshiftSync.overshoot=0);if(!this.timestampOffset)return;const i=Date.now()-this.seekTimeoutTime*this.timeshiftSync.multiplier,n=this.timeShiftAdjustments.filter(Yi(i)).length;if(n&&this.timeshiftSync.multiplier>2)return this.logger.debug("Too many diff timeShifts within sliding window",{timeShiftsCooldownMs:i,timeShiftsWithinCooldownTime:n}),!1;const s=e+this.timeshiftSync.overshoot;this.logger.info("Adjusting for drift using timeshift",{drift:e,syncAmount:s,currentTime:this.playbackSource.currentTime,rtt:this.rtt,overshoot:this.timeshiftSync.overshoot}),this.timestampOffset+=s,this.lastSeekTime=Date.now(),!this.playbackSource.isPaused&&(this.timeShiftAdjustments.push(this.lastSeekTime),this.timeshiftDriftAdjustmentCount++,this.timeshiftSync.multiplier++,this.timeshiftSync.overshoot=Math.max(this.timeshiftSync.minOvershootAllowed,Math.min(this.timeshiftSync.multiplier*e/2,this.timeshiftSync.maxOvershootAllowed)))})),A(this,"onSync",(()=>{var t;if(!this.isAllowedToSync())return;const e=null!=(t=this.drift)?t:0;if(e<0&&-e<this.currentSyncMaxAhead()||e>0&&e<this.currentSyncMaxBehind()||Math.abs(e)<1||!this.isSeekCooldownExpired())return;const i=Date.now()-this.seekTimeoutTime*this.syncMaxBehindMultiplier,n=this.driftAdjustments.filter(Yi(i)).length;if(n&&this.syncMaxBehindMultiplier>2)return this.logger.debug("Too many diff adjustments within sliding window",{adjustmentsCooldownMs:i,adjustmentsWithinCooldownTime:n}),!1;const s=this.playbackSource.seekTime,r=this.playbackSource.currentTime+e,o=this.findKeyframeCloseToTimestamp(r);if(o||this.keyframeTimestamps.isEmpty()){const t=o?o+this.seekKeyframeOvershoot:r;if(this.logger.info("Adjusting for drift using seek",{drift:e,currentTime:this.playbackSource.currentTime,targetCurrentTime:t,seekTime:s,rtt:this.rtt}),this.lastSeekTime=Date.now(),this.driftAdjustments.push(this.lastSeekTime),this.driftAdjustmentsCount++,this.playbackSource.currentTime=t+s,this.timeshiftSync.overshoot=Math.max(this.timeshiftSync.minOvershootAllowed,this.timeshiftSync.overshoot/2),this.driftAdjustmentsCount%this.syncMaxBehindIncreaseEvery==0&&!this.playbackSource.isPaused){const t=this.currentSyncMaxBehind;this.syncMaxBehindMultiplier+=this.syncMaxBehindMultiplierStep,t!==this.currentSyncMaxBehind&&this.logger.info("Increasing max drift behind allowed",{from:t,to:this.currentSyncMaxBehind})}}})),A(this,"findKeyframeCloseToTimestamp",(t=>{const e=this.keyframeTimestamps.items();for(const i of e)if(i>=t&&i<=t+200)return i})),this.logger=e,this.emitter=t,this.playbackSource=i,this.bufferSource=n,this.timeshiftSync.enabled=s,this.syncMaxBehind=this.timeshiftSync.enabled?1e3:200,this.emitter.on("rtt",this.updateRtt)}updateChannelSyncInfo(t,e){const i=Date.now(),n=this.channelSyncInfo.get(t),s=this.getLiveEdgeTime(t);if(this.isSuspended)return;if(!n||!s)return this.logger.info("Initial timing info",{syncInfo:e}),void this.channelSyncInfo.set(t,p(m({},e),{localTimestamp:i,timeDifferences:new k(12)}));const r=e.wallclockTime-n.wallclockTime,o=e.timestamp-n.timestamp,a=i-n.localTimestamp,l=o-a;if(n.timeDifferences.push(l),this.logger.debug("Timing info",{rtt:this.rtt,channelId:t,syncInfo:e,localTimestamp:i,diffFromEstimated:l,timestampDelta:o,wallclockDelta:r,localWallclockDelta:a}),Math.abs(l)>=2*this.bufferSource.getTargetBufferTime())return this.logger.info("Resetting sync info",{diffFromEstimated:l}),this.channelSyncInfo.set(t,p(m({},e),{localTimestamp:i,timeDifferences:new k(n.timeDifferences.maxSize+1)})),void(this.currentChannelId&&this.currentChannelId===t&&(this.reset(),this.emitter.emit("channel reset")));n.timeDifferences.isFull()&&this.tryApplySyncInfo(this.maxTimeSyncDifferenceTolerance)}tryApplySyncInfo(t){const e=this.getCurrentChannelId();if(!e)return;const i=this.channelSyncInfo.get(e);if(!i)return;const n=F(i.timeDifferences.items());Math.abs(n)>t&&(this.logger.info("Adjusting sync info",{averageDifference:n}),i.timestamp+=n,i.timeDifferences.clear())}get serverCurrentTime(){return this.channelCurrentTime-this.getTimeshiftOffset()}get channelCurrentTime(){const t=this.getCurrentChannelId();if(!t)return 0;const e=this.getLiveEdgeTime(t);return e?e-this.bufferSource.getTargetBufferTime():0}get drift(){return this.serverCurrentTime-this.playbackSource.currentTime}};A(Ki,"create",((t,e,i,n,s)=>new Ki(t,e,i,n,s)));let tn=Ki;const en={enabled:!0,interval:3e4,includeErrors:!0,includeEvents:!0,includeStats:!0,maxRetries:10,maxErrorReports:50,maxEvents:50},nn=(t,e)=>p(m({},e),{type:t,timestamp:(new Date).toISOString(),discriminator:"web"}),sn=class{constructor(t,e,i,n){A(this,"logger"),A(this,"timers",new nt),A(this,"emitter"),A(this,"options"),A(this,"parentContext"),A(this,"unsentLines",new k(100)),A(this,"retries",0),A(this,"errorCount",0),A(this,"eventCount",0),A(this,"statsCount",0),A(this,"unload",(()=>{this.logger.debug("Unloading module..."),window.removeEventListener("error",this.onError),window.removeEventListener("unhandledrejection",this.onRejection),this.timers.unload(),this.emitter.off("error",this.addError),this.emitter.off("visibilitystate",this.onVisibilityChange),this.emitter.off("pagehide",this.onPageHide),this.addStats({isFinal:!0,initiator:"unload"}),this.send("beacon"),this.logger.debug("Unloaded module")})),A(this,"load",(()=>{window.addEventListener("error",this.onError),window.addEventListener("unhandledrejection",this.onRejection),this.emitter.on("error",this.addError),this.emitter.on("visibilitystate",this.onVisibilityChange),this.emitter.on("pagehide",this.onPageHide),this.timers.setInterval((()=>{this.addStats(),this.send("fetch")}),this.options.interval)})),A(this,"addStats",(({isFinal:t,initiator:e}={isFinal:!1,initiator:"interval"},i={})=>{if(!this.options.includeStats)return;const n=this.parentContext.getStatistics(),s=nn("stats",p(m(m({},i),n),{isFinal:t,initiator:e,count:this.statsCount++}));this.unsentLines.push(s)})),A(this,"addEvent",(t=>{if(!this.options.includeEvents||this.eventCount>this.options.maxEvents)return;const e=this.parentContext.getStatistics(),i=nn("event",m(m({},e),t));this.eventCount++,this.unsentLines.push(i)})),A(this,"getStatistics",(()=>({errorCount:this.errorCount}))),A(this,"send",(t=>y(this,null,(function*(){if(this.options.enabled&&!(this.retries>=this.options.maxRetries)&&!this.unsentLines.isEmpty()){this.logger.debug("Sending telemetry",{lines:this.unsentLines.items()});try{const e=this.unsentLines.items().map((t=>JSON.stringify(t))).reverse().join("\n");"beacon"===t?navigator.sendBeacon(this.options.url,e):"connected"===this.parentContext.connectionState?this.emitter.emit("send signal",JSON.stringify({type:"telemetry",body:e})):yield(0,s.p)(new URL(this.options.url),{body:e,headers:{"Content-Type":"text/plain"}}),this.retries=0,this.unsentLines.clear()}catch(t){this.retries++}}})))),A(this,"onVisibilityChange",(t=>{"hidden"===t&&(this.addStats({isFinal:!0,initiator:"visibilitychange"}),this.send("beacon"))})),A(this,"onPageHide",(t=>{this.addStats({isFinal:!0,initiator:"pagehide"},{persisted:t.persisted}),this.send("beacon")})),A(this,"onRejection",(t=>this.addError(t.reason))),A(this,"onError",(t=>this.addError(t.error))),A(this,"addError",(t=>{const{includeErrors:e,maxErrorReports:i}=this.options;if(e&&t instanceof mt){if(this.errorCount++,this.errorCount>i)return;const e=this.parentContext.getStatistics();this.unsentLines.push(nn("error",m(m({},e),t.toStringifiable())))}})),this.logger=t,this.emitter=e,this.options=m(m({},en),i),this.parentContext=n}};A(sn,"create",((t,e,i,n)=>new sn(t,e,i,n)));let rn=sn;const on=class{constructor(t,e,i){A(this,"logger"),A(this,"element"),A(this,"documentState"),A(this,"timers",new nt),A(this,"unload",(()=>{this.timers.unload()})),A(this,"unpause",(()=>{this.element.userHasProvidedInput&&this.element.isPaused&&this.documentState.isVisible&&this.documentState.isOnline&&(this.logger.debug("Unpause video"),this.element.tryPlay())})),this.logger=t,this.element=e,this.documentState=i,this.timers.setInterval(this.unpause,100)}};A(on,"create",((t,e,i)=>new on(t,e,i)));let an=on;class ln{constructor(){var t;A(this,"highEntropyValues"),null==(t=self.navigator.userAgentData)||t.getHighEntropyValues(["architecture","model","platformVersion","fullVersionList"]).then((t=>{this.highEntropyValues=t}))}getUserAgentInformation(){var t,e,i,n,s,r;const o=window.location.origin,a=o&&"null"!=o?`${window.location.pathname}${window.location.search}`.substring(0,1e3):"",l={locationOrigin:window.location.origin,locationPath:a,ancestorOrigins:(null==(t=window.location.ancestorOrigins)?void 0:t.length)>0?Array.from(window.location.ancestorOrigins):void 0,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory};if(self.navigator.userAgentData&&this.highEntropyValues){const t="1",o=[...null!=(e=this.highEntropyValues.brands)?e:[]];o.sort(((t,e)=>t.brand.localeCompare(e.brand)));const a=[...null!=(i=this.highEntropyValues.fullVersionList)?i:[]];a.sort(((t,e)=>t.brand.localeCompare(e.brand)));const h=a.map((t=>t.version)),c=o.map((t=>t.brand)),d=o.map((t=>t.version)),u=parseInt(null!=(s=null==(n=this.highEntropyValues.platformVersion)?void 0:n.split(".")[0])?s:t);return m({userAgentLegacy:window.navigator.userAgent,ua:{browser:{brands:c,fullVersionBrands:h,majorVersions:d},device:this.highEntropyValues.model||"Other",os:{family:this.highEntropyValues.platform||"Other",version:null!=(r=this.highEntropyValues.platformVersion)?r:t,major_version:Number.isFinite(u)?u:0}}},l)}return m({userAgent:window.navigator.userAgent},l)}}const hn=(t,e)=>t&&"object"==typeof t&&e in t;var cn,dn,un;const mn=class t extends n.E{constructor(e){super(),A(this,"pictureInPicture"),A(this,"browser",(()=>{var t;const e=!!T();let i=!1;return e&&(i=(()=>{var t,e;return!B()&&null!=(e=null==(t=T())?void 0:t.isTypeSupported('audio/mp4; codecs="opus"'))&&e})()),{isMobile:R,supportsMp4Opus:i,supportsMediaSource:e,supportsHls:L(),supportsWebAssembly:P(),platform:{iosVersion:null!=(t=U())?t:Number.MAX_SAFE_INTEGER,isIpadOS:B(),isMacOS:M(),isIOS:I.indexOf("iphone")>=0&&I.indexOf("like iphone")<0||I.indexOf("ipad")>=0&&I.indexOf("like ipad")<0||I.indexOf("ipod")>=0&&I.indexOf("like ipod")<0||B()}}})()),A(this,"options"),A(this,"element"),A(this,"playbackSource"),A(this,"emitter",new n.E),A(this,"logger"),A(this,"modules"),A(this,"clientIp"),A(this,"sessionId"),A(this,"clientId",st()),A(this,"_channels",[]),A(this,"createdAt",Date.now()),A(this,"hasCalledConnect",!1),A(this,"apiClient"),A(this,"latestEmittedLanguages",[]),A(this,"wakeLock"),A(this,"cachedEdges",[]),A(this,"shiftedEdges",[]),A(this,"pool",new E(t.MAX_POOL_SIZE)),A(this,"userAgentInformation",new ln),v(this,cn,0),v(this,dn,[]),A(this,"sampleProcessingSesssions",new Map),A(this,"sizes",new Map),A(this,"isSuspended",!0),A(this,"disconnectTimeout"),v(this,un),A(this,"attach",(t=>{var e;null==(e=this.wakeLock)||e.attach(t),t.appendChild(this.element)})),A(this,"getOptions",(()=>this.options.getOptions())),A(this,"getThumbnailUrl",(()=>{let t=this.options.get("edgeUrl")||this.options.get("url");t=t.replace("wss://","https://"),t=t.replace("ws://","http://"),t=t.endsWith("/")?t.slice(0,-1):t;const e=this.options.get("authenticationToken"),i=e?`&auth.token=${e}`:"";return`${t}/api/thumbnail?channelId=${this.options.get("channelId")}${i}`})),A(this,"updateAuthenticationToken",(t=>{this.logger.debug("Got new auth token",{token:t}),this.options.set("authenticationToken",t),this.emitter.emit("send signal",JSON.stringify({type:"refresh auth",token:t}))})),A(this,"connect",(()=>{this.hasCalledConnect||(this.play(),this._connect())})),A(this,"_connect",(()=>{var t,e;this.hasCalledConnect||(this.hasCalledConnect=!0,Object.values(this.modules).forEach((t=>{t&&"load"in t&&t.load()})),this.unsuspend(),this.playbackSource instanceof ce&&(null==(e=(t=this.playbackSource).load)||e.call(t)),this.modules.connection.connect("audio+video"===this.options.get("media")?2:1))})),A(this,"getCastOptions",(()=>({url:this.options.get("url"),channelId:this.options.get("channelId"),channelGroupId:this.options.get("channelGroupId"),authenticationToken:this.options.get("authenticationToken"),language:this.options.get("language"),logLevel:this.options.get("logLevel"),minBufferTime:this.options.get("minBufferTime"),tags:this.options.get("tags"),ownerSessionId:this.sessionId,edgeUrl:this.options.get("edgeUrl"),media:this.options.get("media")}))),A(this,"connectionInfo",(()=>y(this,null,(function*(){try{return yield this.apiClient.connect(this.options.getOptions())}catch(e){if((0,s.i)(e))switch(e.status){case 401:throw this.emitter.emit("error",bt(e)),bt(e);case 403:throw this.emitter.emit("error",St(e.message)),St(e.message)}throw this.emitter.emit("error",(t=e instanceof Error?e:void 0,new mt("Connection attempt failed",{isFatal:!1,code:"connection_failed",source:t}))),e}var t})))),A(this,"estimateRTT",(()=>y(this,null,(function*(){const e=Date.now(),i=()=>Date.now()-e;return Promise.race([rt(t.PING_TIMEOUT),fetch(new URL("/api/v2/connect/ping",this.options.get("url")).toString(),{method:"HEAD"})]).then(i,i)})))),A(this,"connectHandler",(()=>y(this,null,(function*(){var t,e;this.sessionId=st();const i=this.modules.subscription.getTargetSubscription(),[n,s]=yield Promise.all([this.connectionInfo(),this.estimateRTT()]),r=ye(s/2),o=n.channels.find((t=>t.channelId===i.channelId));if(this.emitter.emit("connect info",n),this._channels=n.channels,this.updateTextTracks(null!=(t=null==o?void 0:o.renditions)?t:[]),!this.textTrack&&this.options.get("textTrack")&&(this.textTrack=this.options.get("textTrack")),yield Promise.all(n.channels.map((t=>y(this,null,(function*(){t.overrides&&this.options.addOverrides(t.channelId,t.overrides),t.renditions=yield this.filterRenditions(t.renditions),this.modules.renditions.setRenditions(t.channelId,t.renditions)}))))),!o)throw wt("external");const a=this.options.getOverride("sizeBasedResolutionCapEnabled",this.channelId);void 0!==a&&(this.modules.constraintCap.sizeBasedResolutionCapEnabled=a);const l=this.options.getOverride("separateVideoSocketEnabled",this.channelId);void 0!==l&&"audio+video"===this.options.get("media")&&this.modules.connection.setConnectionCount(l?2:1);const h=this.options.getOverride("minBufferTime",this.channelId),c=this.options.getOverride("maxBufferTime",this.channelId);if((h||c)&&(this.modules.bufferTime.updateConfig({minBufferTime:this.options.get("minBufferTime",this.channelId),maxBufferTime:this.options.get("maxBufferTime",this.channelId)}),this.targetBufferTime=this.options.get("minBufferTime",this.channelId)),this.options.get("burstEnabled",this.channelId)&&this.modules.subscription.enableBurst(this.targetBufferTime),this.emit("is live",o.isLive),!o.isLive)throw new Error("Waiting for channel to go live");this.patchSubscription(o,r),yield this.initializeDecodingModule(),this.resetModules(),this.emit("rendition levels",this.modules.renditions.getRenditionLevels()),this.emit("channels",this.channels),this.emitLanguagesIfChanged(),this.sampleProcessingSesssions.clear(),this.cachedEdges=0===this.cachedEdges.length?n.edges:this.cachedEdges;const d=(this.options.get("edgeUrl")?[this.options.get("edgeUrl")]:[this.cachedEdges.shift()])[0],u=this.options.get("burstEnabled",this.channelId),m=((t,e)=>{if(!t)return;const i=new URL("/subscribe",t);return i.searchParams.append("channelId",e.channelId),i.searchParams.append("sessionId",e.sessionId),i.searchParams.append("clientId",e.clientId),e.audio&&e.audio.codec&&(i.searchParams.append("audio.bitRate",Math.round(e.audio.bitRate).toString()),i.searchParams.append("audio.codec",e.audio.codec),e.audio.language&&i.searchParams.append("audio.language",e.audio.language)),e.video&&e.video.codec&&(i.searchParams.append("video.width",e.video.width.toString()),i.searchParams.append("video.height",e.video.height.toString()),i.searchParams.append("video.bitRate",Math.round(e.video.bitRate).toString()),i.searchParams.append("video.codec",e.video.codec)),e.expectAdditionalConnection&&i.searchParams.append("expectAdditionalConnection",e.expectAdditionalConnection.toString()),e.burstMs&&i.searchParams.append("burstMs",e.burstMs.toString()),e.channelGroupId&&i.searchParams.append("channelGroupId",e.channelGroupId),e.authToken&&(i.searchParams.append("auth.token",e.authToken),i.searchParams.append("auth.type","jwt")),i.toString()})(d,{video:this.targetSubscription.video,audio:this.targetSubscription.audio,burstMs:u?this.targetBufferTime:void 0,sessionId:this.sessionId,clientId:this.clientId,channelId:this.channelId,channelGroupId:this.options.get("channelGroupId"),expectAdditionalConnection:this.modules.connection.getConnectionCount()>1,authToken:this.options.get("authenticationToken")});if(!m||!d)throw new mt("Failed to resolve edge url",{isFatal:!0,code:"failed_to_resolve_edge_url"});const p=this.shiftedEdges[this.shiftedEdges.length-1];return p&&(null==(e=this.modules.telemetry)||e.addEvent({code:"shifted_edge",edgeUrl:p})),this.shiftedEdges.push(d),this.logger.debug("resolved edge url",{edgeUrl:m}),Promise.resolve(m)})))),A(this,"emitLanguagesIfChanged",(()=>{const t=this.modules.renditions.getLanguages(),e=this.latestEmittedLanguages;t.length==e.length&&t.every((t=>e.includes(t)))||(this.logger.debug("Emitting new languages",{currentLanguages:t}),this.latestEmittedLanguages=t,this.emit("languages",this.latestEmittedLanguages))})),A(this,"updateTextTracks",(t=>{const e=t.filter((t=>"webvtt"===t.codec));e.forEach((t=>{if(!f(this,dn).find((e=>e.language===t.language)))if(this.modules.canvasModule){const e=this.modules.canvasModule.textTracks.addTextTrack(t.kind,t.label||t.language||"",t.language||"");f(this,dn).push(e)}else if(this.mediaElement instanceof HTMLVideoElement){const e=this.mediaElement.addTextTrack(t.kind,t.label||t.language,t.language);f(this,dn).push(e)}}));for(const t of f(this,dn))e.find((e=>e.language===t.language))?"disabled"===t.mode&&(t.mode="hidden"):t.mode="disabled";this.emit("text tracks",this.textTracks)})),A(this,"cleanupTextTracks",((t=this.currentTime-2e4)=>{f(this,dn).forEach((e=>{if(e.cues)for(const i of e.cues)1e3*i.endTime<t-2e3&&e.removeCue(i)}))})),A(this,"filterRenditions",(t=>y(this,null,(function*(){const e=yield Promise.all(t.map((t=>y(this,null,(function*(){var e,i,n;if(lt(t))return!0;if(!at(t)||!this.isSupportedVideoCodecProfile(t.codec,t.codecString))return!1;if(!this.willUseMediaSource()){const s=this.options.get("advanced"),r=null!=(e=s.wasmDecodingConstraint.bitRate)?e:Number.MAX_SAFE_INTEGER,o=null!=(i=s.wasmDecodingConstraint.width)?i:Number.MAX_SAFE_INTEGER,a=null!=(n=s.wasmDecodingConstraint.height)?n:Number.MAX_SAFE_INTEGER;return t.bitRate<=r&&t.width<=o&&t.height<=a}const s=yield(t=>{if(!navigator.mediaCapabilities)return Promise.resolve({smooth:!0,supported:!0,powerEfficient:!0,failedToQuery:!0});if("webvtt"===t.codec)throw new Error("WebVTT is not supported");let e;return e=lt(t)?{type:"media-source",audio:{contentType:ht(t),bitrate:t.bitRate,channels:t.channels.toString(),samplerate:t.sampleRate}}:{type:"media-source",video:{contentType:ht(t),bitrate:t.bitRate,width:t.width,height:t.height,framerate:t.frameRate[0]/t.frameRate[1]}},navigator.mediaCapabilities.decodingInfo(e)})(t);if(!s.supported||"av1"==t.codec&&!s.smooth&&!s.powerEfficient)return!1;const r=this.options.getOverride("maxVideoBitRate",this.channelId);return!r||r>=t.bitRate})))));let i=t.filter(((t,i)=>e[i]));const n=i.filter((t=>"h264"===t.codec)).reverse()[0],s=i.filter((t=>"av1"===t.codec)).reverse()[0];return n&&s&&n.width>s.width&&n.height>s.height&&(i=i.filter((t=>"av1"!==t.codec))),i})))),A(this,"patchSubscription",((e,i)=>{const n=Math.min(this.options.get("maxVideoBitRate"),t.INITIAL_MAX_BIT_RATE,i,this.targetSubscription.video.bitRate),s=Math.min(this.options.get("maxAudioBitRate"),t.INITIAL_MAX_BIT_RATE,i,this.targetSubscription.audio.bitRate),r="audio"===this.options.get("media")?[]:this.options.get("videoCodecs",this.channelId),o=this.supportedAudioCodecs(),a=e.renditions.filter(lt),l=e.renditions.filter(at),h=o.find((t=>void 0!==a.find((e=>e.codec===t)))),c=r.find((t=>void 0!==l.find((e=>e.codec===t)))),d=a.map((t=>t.language));if(this.logger.debug("supported and selected codecs",{audioCodecs:o,videoCodecs:r,audioCodec:h,videoCodec:c}),c){const t=this.options.get("maxSize");this.modules.subscription.setVideoConstraint(m({codec:c,bitRate:this.abrEnabled?n:this.options.get("maxVideoBitRate")},t))}h&&(this.modules.subscription.setAudioConstraint({codec:h,bitRate:this.abrEnabled?s:this.options.get("maxAudioBitRate"),language:this.options.get("language")}),(!d.includes(this.options.get("language"))||void 0===this.language)&&this.modules.subscription.setLanguage(d[0])),this.alignSizeAndBitRate(this.targetSubscription);const u=this.modules.subscription.getTargetSubscription();this.emitter.emit("subscription changed",{to:u,from:this.modules.subscription.getCurrentSubscription()})})),A(this,"isSupportedVideoCodecProfile",((t,e)=>{if(this.willUseMediaSource()){const i=T();return!i||i.isTypeSupported(ht({codec:t,codecString:e}))}if("h264"===t){const t=!(null==e||!e.startsWith("avc1.42")),i=!(null==e||!e.startsWith("avc1.66."));return t||i}return"av1"!==t})),A(this,"supportedAudioCodecs",(()=>{if("video"===this.options.get("media"))return[];const t=[];return(this.browser.supportsMp4Opus&&this.options.get("mseOpusEnabled")||!this.willUseMediaSource())&&t.push("opus"),this.willUseMediaSource()&&t.push("aac"),t})),A(this,"initializeDecodingModule",(()=>y(this,null,(function*(){var t,e;const i=this.currentRenditionLevel,n=[];if(!i)throw new mt("No currentRenditionLevel",{code:"no_current_rendition_level",isFatal:!1});if(null!=i&&i.video&&n.push({type:"video",mimeType:ht(i.video)}),null!=i&&i.audio&&n.push({type:"audio",mimeType:ht(i.audio)}),0===n.length)throw new mt("Can't initialize decoding module without tracks",{code:"no_tracks",isFatal:!1});if(this.willUseMediaSource()&&this.element instanceof HTMLMediaElement)this.emitter.emit("flush buffers"),yield null==(t=this.modules.mseModule)?void 0:t.setSourceBuffers(n);else{const t=yield Ie.create(this.emitter,this.logger.createContext("DecoderModule"),n,this.playbackSource,this.pool);null==(e=this.modules.decoder)||e.unload(),this.modules.decoder=t,this.modules.decoder.load()}})))),A(this,"unload",(()=>y(this,null,(function*(){var e,i,n;this.logger.debug("Unloading modules..."),yield Promise.all(Object.values(this.modules).map((t=>null==t?void 0:t.unload()))),null==(e=this.wakeLock)||e.unload(),this.pool=new E(t.MAX_POOL_SIZE),null==(n=(i=this.playbackSource).unload)||n.call(i),this.element.remove(),this.emitter.reset(),this.reset(),this.logger.debug("Unloaded modules")})))),A(this,"userInput",(()=>{this.play()})),A(this,"pause",(()=>{this.options.get("pauseSupportEnabled")&&"paused"!==this.playbackState&&(this.playbackSource.pause(),this.hasCalledConnect&&this.suspend())})),A(this,"registerDebugInstance",(()=>{(t=>{const e=window;e.vindralInstances=e.vindralInstances||{},e.vindralInstances[t.getStatistics().clientId.substring(0,8)]=t})(this)})),A(this,"play",(()=>{var e;this.hasCalledConnect?this.unsuspend():"playing"!==this.playbackState&&(this._connect(),self.addEventListener("__vindral_register_debug__",this.registerDebugInstance),this.modules.timer.setInterval((()=>this.cleanupTextTracks()),t.REMOVE_CUE_THRESHOLD)),null==(e=this.wakeLock)||e.enable(),"paused"===this.playbackState&&(this.resetModules(),this.emitter.emit("flush buffers"),this.cleanupTextTracks(Number.MAX_SAFE_INTEGER)),this.playbackSource.play()})),A(this,"getStatistics",(()=>Object.values(this.modules).reduce(((t,e)=>e&&"getStatistics"in e?m(m({},t),e.getStatistics()):t),this.getRuntimeInfo()))),A(this,"resetModules",(()=>{Object.values(this.modules).forEach((t=>{t&&"reset"in t&&t.reset()})),this.sampleProcessingSesssions.clear(),this.playbackSource.currentTime=0,this.playbackSource.isActivated=!1})),A(this,"getRuntimeInfo",(()=>{const t=this.modules.canvasModule?this.options.get("iosMediaElementEnabled"):void 0;return m({uptime:Date.now()-this.createdAt,version:"4.0.0",clientId:this.clientId,sessionId:this.sessionId,channelId:this.channelId,channelGroupId:this.options.get("channelGroupId"),ip:this.clientIp,url:this.options.get("url"),timeToFirstFrame:this.timeToFirstFrame(),iosMediaElementEnabled:t},this.userAgentInformation.getUserAgentInformation())})),A(this,"onMediaElementState",(t=>{this.logger.info("media element state",{state:t}),this.options.get("pauseSupportEnabled")&&("paused"===t?this.modules.documentState.isVisible&&(this.suspend(),this.modules.connection.disconnect()):(this.unsuspend(),"disconnected"===this.modules.connection.getState()&&this.modules.connection.unsuspend()))})),A(this,"onBufferEvent",(t=>{var e,i,n,s;this.emit("buffer state event",t);const r=!this.playbackSource.isActivated||this.playbackSource.isPaused;if("filled"===t&&r){const t=Math.max(this.currentTime,null!=(i=null==(e=this.videoBufferedRanges[0])?void 0:e.start)?i:0,null!=(s=null==(n=this.audioBufferedRanges[0])?void 0:n.start)?s:0);this.logger.info("Buffer filled - starting playback",{currentTime:t}),this.playbackSource.currentTime=t,this.modules.sync.activateSyncAdjustments(),this.playbackSource.isActivated=!0}else"drained"===t&&this.playbackSource.isPaused&&(this.playbackSource.isActivated=!1,this.modules.sync.deactivateSyncAdjustments())})),A(this,"timeToFirstFrame",(()=>{const t=this.modules.playback.getFirstFrameTime(),e=this.modules.connection.firstConnectionTime;if(e&&t)return t-e})),this.options=new ue(m(m({},me),(t=>{if(!(t=>!("object"!=typeof t||!hn(t,"channelId")||"string"!=typeof t.channelId||!hn(t,"url")||"string"!=typeof t.url||0===t.channelId.length||0===t.url.length))(t))throw new mt("Invalid options",{isFatal:!0,code:"invalid_options"});const e=m({},t);return Object.keys(e).forEach((t=>{const i=e;void 0===i[t]&&delete i[t]})),e})(e))),void 0===e.telemetryEnabled&&["localhost","127.0.0.1"].includes(location.hostname)&&this.options.set("telemetryEnabled",!1);const i={channelId:this.options.get("channelId"),audio:{language:this.options.get("language"),bitRate:this.options.get("maxAudioBitRate")},video:{bitRate:this.options.get("maxVideoBitRate"),width:this.options.get("maxSize").width,height:this.options.get("maxSize").height}},r=Z.get();r.setLevel(this.options.get("logLevel")),r.setDebug(!1),this.logger=r;const o=Wi.create(this.emitter,this.logger.createContext("PictureInPictureModule")),a=nt.create();this.apiClient=new s.A({publicEndpoint:this.options.get("url").toString(),tokenFactory:()=>this.options.get("authenticationToken")});const l=ke.create(this.emitter,this.logger.createContext("ConnectionModule"),{connectHandler:this.connectHandler,reconnectHandler:this.options.get("reconnectHandler")}),h=$i.create(this.logger.createContext("SubscriptionModule"),this.emitter,i),c=ji.create(this.emitter,h),d=Xi.create(this.emitter,this.logger.createContext("QualityOfServiceModule")),u=zi.create(this.emitter,this.logger.createContext("PlaybackModule"),this,this.options.get("minBufferTime")),g=Le.create(this.emitter),w=this.options.get("poster"),S=!0===w?this.getThumbnailUrl():w||void 0;let k,C,x;if(this.willUseMediaSource()){const t=new ce({type:"audio"==this.options.get("media")?"audio":"video",autoplay:!1,muted:this.options.get("muted")||"video"===this.options.get("media"),logger:this.logger.createContext("MediaElement"),poster:S});t.on("buffer state",(t=>this.emitter.emit("buffer state",t))),t.on("needs user input",(t=>this.emitter.emit("needs user input",t))),t.on("volume state",(t=>this.emit("volume state",t))),t.on("media element state",(t=>this.onMediaElementState(t))),this.element=t.element,this.playbackSource=t,k=Ui.create(this.logger.createContext("MseModule"),this.emitter,this.element),this.options.get("pauseSupportEnabled")||(C=an.create(this.logger.createContext("UnpauseModule"),t,g)),this.options.get("pictureInPictureEnabled")&&this.emitter.emit("add picture in picture listener",{element:t.element})}else if(this.browser.platform.iosVersion>=15&&this.options.get("iosMediaElementEnabled")){const t=Ci.create(this.emitter,this.logger.createContext("ModernCanvasModule"),this.pool,this,{type:"audio"==this.options.get("media")?"audio":"video",muted:this.options.get("muted")||"video"===this.options.get("media"),poster:S}),e=t.element();this.element=e.element,this.playbackSource=t,x=t,this.options.get("pictureInPictureEnabled")&&this.browser.platform.iosVersion>15&&this.emitter.emit("add picture in picture listener",{element:this.element}),this.options.get("pauseSupportEnabled")||(C=an.create(this.logger.createContext("UnpauseModule"),e,g))}else{const t=Ei.create(this.emitter,this.logger.createContext("LegacyCanvasModule"),this.pool,this,this.options.get("muted")||"video"===this.options.get("media"));this.element=t.element(),this.playbackSource=t,x=t,this.options.get("iosWakeLockEnabled")&&(this.wakeLock=new ee)}this.emitter.on("channel reset",this.resetModules),this.emitter.on("no data timeout",this.resetModules),this.emitter.on("media element state",(t=>this.onMediaElementState(t))),this.emitter.on("volume state",(t=>this.emit("volume state",t))),this.options.get("pauseSupportEnabled")||this.emitter.on("exit picture in picture",(()=>a.setTimeout((()=>this.play()),0))),this.emitter.on("constraint cap changed",(t=>{this.logger.info("new cap set",{cap:t}),this.alignSizeAndBitRate(this.targetSubscription)})),this.pictureInPicture={enter:()=>o.requestPictureInPicture(),exit:()=>o.exitPictureInPicture(),isActive:()=>o.isPictureInPictureActive(),isSupported:()=>o.isPictureInPictureSupported()},this.emitter.on("error",(t=>{if("external"===t.type()&&this.emit("error",t),t.isFatal())return()=>{this.unload()}}));const _=this.browser.platform.isIOS&&!this.browser.platform.isIpadOS,N=tn.create(this.emitter,this.logger.createContext("SyncModule"),this.playbackSource,u,this.willUseMediaSource()&&!_),D=(this.options.get("edgeUrl")||this.options.get("url")).replace("wss://","https://").replace("ws://","http://").replace("//lb.","//errors."),F=new URL("/telemetry",D).toString(),O=rn.create(this.logger.createContext("TelemetryModule"),this.emitter,{url:F,enabled:this.options.get("telemetryEnabled"),includeStats:!1,interval:5e3},this);let W;this.modules={telemetry:O,bufferTime:we.create(this.emitter,this.logger.createContext("BufferTimeModule"),d,this,{maxBufferTime:this.options.get("maxBufferTime"),minBufferTime:this.options.get("minBufferTime")}),incomingData:_e.create(this.emitter),adaptivity:fe.create(this.emitter,this.logger.createContext("AdaptivityModule"),d,{cooldownTime:Math.max(this.options.get("minBufferTime"),2e3)}),constraintCap:xe.create(this.emitter,this.element,c,!!this.options.get("abrEnabled")&&this.options.get("sizeBasedResolutionCapEnabled")),event:Me.create(this.emitter,this.logger.createContext("EventModule"),N),sync:N,documentState:g,connection:l,playback:u,pictureInPicture:o,timer:a,subscription:h,renditions:c,qualityOfService:d,mseModule:k,unpause:C,canvasModule:x},this.modules.adaptivity.isEnabled=this.options.get("abrEnabled"),this.emitter.on("page active",(e=>{var i;e&&"number"==typeof this.disconnectTimeout&&(this.modules.timer.clearInterval(this.disconnectTimeout),this.disconnectTimeout=void 0),e?this.playbackSource.isPaused||(this.logger.debug("Unsuspending"),this.unsuspend()):(this.logger.debug("Suspending"),this.suspend(),this.modules.decoder?this.options.get("iosBackgroundPlayEnabled")?(this.modules.decoder.unsuspend(),null==(i=this.modules.canvasModule)||i.unsuspend()):this.modules.connection.disconnect():(this.disconnectTimeout&&this.modules.timer.clearInterval(this.disconnectTimeout),this.disconnectTimeout=this.modules.timer.setInterval((()=>{const t="paused"===this.playbackState||this.muted;"connected"===this.connectionState&&t&&(this.emitter.emit("flush buffers"),this.modules.connection.disconnect("Page inactive timeout"))}),t.DISCONNECT_TIMEOUT)))})),this.emitter.on("context switch complete",(()=>{W||(W=window.setTimeout((()=>{window.clearTimeout(W),W=void 0,this.emit("context switch","completed"),this.emitLanguagesIfChanged()}),this.targetBufferTime))})),this.emitter.on("context switch started",(()=>this.emit("context switch","started"))),this.emitter.on("needs user input",(t=>this.emit("needs user input",t))),this.emitter.on("event",(t=>{switch(t.type){case"metadata":this.emit("metadata",t);break;case"channel switch":this.emit("channel switch",{channelId:t.channelId});break;case"language switch":this.emit("language switch",{language:t.language})}})),this.emitter.on("buffer state event",this.onBufferEvent),this.emitter.on("playback state",(t=>this.emit("playback state",t))),this.emitter.on("rendition level changed",(({to:t})=>{t&&this.emit("rendition level",t)})),this.emitter.on("connection state",(t=>{"connected"===t&&(this.cachedEdges=[],this.shiftedEdges=[]),this.emit("connection state",t)})),this.emitter.on("recovered from media error",(()=>{this.modules.adaptivity.reset(2*this.targetBufferTime)})),this.emitter.once("connect info",(t=>{var e,i,n;const s=(null!=(i=null==(e=t.telemetry)?void 0:e.probability)?i:1)>=Math.random();t.telemetry&&(null==(n=this.modules.telemetry)||n.unload(),this.modules.telemetry=rn.create(this.logger.createContext("TelemetryModule"),this.emitter,p(m({},t.telemetry),{enabled:this.options.get("telemetryEnabled")&&s}),this),this.modules.telemetry.load())})),this.emitter.on("adapt level",(t=>{var e,i,n,s,r;this.logger.debug("adapt level",{direction:t});const o=this.modules.renditions.getRenditionLevels(),a=this.modules.renditions.getRenditionLevel(),l=o.findIndex((t=>t===a)),h=o.length-1;let c=l;switch(t){case"upgrade":{const t=Math.min(l+1,h),a=o[t],d=null!=(e=this.modules.connection.estimatedBandwidth)?e:ct(),u=(null!=(n=null==(i=null==a?void 0:a.audio)?void 0:i.bitRate)?n:0)+(null!=(r=null==(s=null==a?void 0:a.video)?void 0:s.bitRate)?r:0);a&&2*d>u&&this.modules.adaptivity.isQoSOk(a)&&(c=t)}break;case"downgrade":c=Math.max(l-1,0);break;case"double downgrade":c=Math.max(l-2,0);break;case"reconnect":if(0===l||this.modules.qualityOfService.timeSpentBufferingLast(6e3)>5e3){if(!this.modules.connection.lastConnectionTime||Date.now()-this.modules.connection.lastConnectionTime<this.modules.qualityOfService.fatalQosGraceTime()||"connected"!==this.modules.connection.getState())return;return this.modules.qualityOfService.incrementFatalQosCount(),this.logger.info("Reconnecting due to poor qos"),this.modules.connection.reconnect("Fatal QOS"),void this.emitter.emit("adapted level")}c=0}if(c===l)return;const d=o[c];this.alignSizeAndBitRate(p(m({},this.targetSubscription),{video:m(m({},this.targetSubscription.video),null==d?void 0:d.video),audio:m(m({},this.targetSubscription.audio),null==d?void 0:d.audio)})),this.emitter.emit("adapted level")})),this.emitter.on("received signal",(t=>{var e;const i=t;switch(this.logger.debug("received",m({},i)),i.type){case"client ip":this.clientIp=i.ip;break;case"renditions":this.updateTextTracks(i.renditions),b(this,un,this.filterRenditions(i.renditions).then((t=>{this.emitter.emit("renditions",{renditions:t,channelId:this.currentSubscription.channelId}),this.emit("rendition levels",this.modules.renditions.getRenditionLevels()),this.emitLanguagesIfChanged()})).finally((()=>{b(this,un,void 0)})));break;case"subscription changed":try{(t=>{if("object"!=typeof t||null===t)throw new Error("not an object");if(!("video"in t))throw new Error("missing video in subscription");if(!("audio"in t))throw new Error("missing audio in subscription");if(!("channelId"in t))throw new Error("missing channelId")})(i.subscription)}catch(t){this.emitter.emit("error",new mt("Subscription failed validation",{source:t instanceof Error?t:void 0,isFatal:!1,code:"subscription_failed_validation"}))}this.emitter.emit("subscription changed",{to:i.subscription,from:this.modules.subscription.getCurrentSubscription()}),this.modules.sync.timeshiftOnAudio=!(null!=(e=i.subscription.video)&&e.codec),this.modules.adaptivity.reset();break;case"timing info":this.modules.sync.updateChannelSyncInfo(i.timingInfo.channelId,i.timingInfo),this.emit("server wallclock time",i.timingInfo.wallclockTime)}})),this.emitter.on("received data",(t=>{const e=this.modules.subscription.getCurrentSubscription(),i=(t=>{const e=new DataView(t,0),i=e.getUint8(0),n=e.getUint16(1),s=e.getUint8(3),r=e.getUint8(4),o=((t,e,i)=>{let n=0;for(let e=5;e<=12;e++)if(5===e){const i=t[e];n+=127&i,128&i&&(n-=128)}else n=256*n+t[e];return n})(new Uint8Array(t)),a=e.getUint32(13),l=(t=>!!(16&t))(s)?e.getInt16(17):void 0;return{version:i,renditionId:r,flags:s,timestamp:o,timescale:a,payload:t.slice(n),compositionTimeOffset:l}})(t);e?H(p(m({},i),{channelId:e.channelId})):this.logger.warn("Received unwanted message",m({},i))}));const z=this.options.get("container");z&&this.attach(z),this.logger.info("Created Vindral instance",{options:this.options});const H=t=>y(this,null,(function*(){const e=t.channelId;f(this,un)&&(yield f(this,un));const i=this.modules.renditions.getRendition(t.renditionId,e);if(!(4&t.flags))if(8&t.flags){const e=(new TextDecoder).decode(t.payload),i=this.modules.sync.getTimeshiftOffset();if(0!==t.renditionId){const t=(0,s.t)(e);if(t&&void 0!==t.language){const e=(new he).parse(t.content||""),n=i/1e3,s=f(this,dn).find((e=>e.language===t.language)),r=n-f(this,cn);if(b(this,cn,n),s){if(s.cues)for(const t of s.cues)t.startTime-=r,t.endTime-=r;for(const t of e){const e=new VTTCue(t.startTime-n,t.endTime-n,t.text);s.addCue(e)}}}}else this.modules.event.addEvent({timestamp:t.timestamp/t.timescale*1e3-this.modules.sync.getTimeshiftOffset(),content:e,type:"metadata"})}else if(null!=i&&i.codec){const n=(t=>{switch(t){case"h264":case"av1":return"video";case"aac":case"opus":case"mp3":return"audio";case"webvtt":return"text";default:throw new Error("Unknown codec")}})(i.codec);if("text"===n)throw new Error("Subtitles are not supported");if(this.modules.incomingData.add(n,t.payload.byteLength),(t=>!!(2&t))(t.flags)){const s=p(m({type:n,data:t.payload,codec:i.codec},t),{channelId:e}),r=((t,e)=>{switch(t){case"h264":return qt(e);case"av1":return(t=>{const e=Zt(t);if(e)return{width:e.maxFrameWidth,height:e.maxFrameHeight}})(e)}})(s.codec,s.payload);r&&this.sizes.set(s.renditionId,r);const o=ht({codec:i.codec,codecString:i.codecString});this.emitter.emit("init segment",{initSegment:s,mimeType:o}),this.emit("initialized media")}else{const e=((t,e,i)=>{if(at(e))return m(p(m({},t),{type:"video",codec:e.codec,isSync:Kt(t.flags),data:t.payload,duration:0,width:e.width,height:e.height}),i);if("webvtt"===e.codec)throw new Error("WebVTT is not supported");return p(m({},t),{type:"audio",channels:e.channels,sampleRate:e.sampleRate,codec:e.codec,language:e.language,isSync:Kt(t.flags),data:t.payload,duration:0})})(t,i,this.sizes.get(t.renditionId));let s=this.sampleProcessingSesssions.get(n);if(s){const t=s(this.modules.sync.processSample(e),this.isSwitchingRenditionLevel&&"video"===e.type);let i=e;t.forEach((t=>{this.modules.event.extractEvent(t,i),this.emitter.emit("coded sample",t),i=t}))}else s=(t=>{let e=[t],i=0,n=0,s=!1;return(t,r=!1)=>{if(t.flags&&Kt(t.flags)&&r&&(s=!s),!(r&&e.length<6&&s)&&e.length>0){s=!1;let r=t;for(let t=e.length-1;t>0;t--){const i=e[t];if(!i||!r)break;i.timestamp>=r.timestamp?e.splice(t,1):r=i}const o=e.map(((s,r)=>((t,e)=>{var s,r,o;t.flags&&Kt(t.flags)&&(i=null!=(s=t.compositionTimeOffset)?s:0),t.timestamp+=i,t.compositionTimeOffset=(null!=(r=t.compositionTimeOffset)?r:0)-i;const a=t.timestamp/t.timescale,l=e.flags&&Kt(e.flags)?null!=(o=e.compositionTimeOffset)?o:0:i,h=(e.timestamp+l)/e.timescale,c=Math.max(0,Math.round((h-a)*t.timescale));return c>0&&(n=c),p(m({},t),{duration:c>0?c:n})})(s,e[r+1]||t)));return e=[t],o}return e.push(t),[]}})(this.modules.sync.processSample(e)),this.sampleProcessingSesssions.set(n,s)}}}));this.options.get("maxVideoBitRate")!==Number.MAX_SAFE_INTEGER&&(this.maxVideoBitRate=this.options.get("maxVideoBitRate")),this.options.get("maxAudioBitRate")!==Number.MAX_SAFE_INTEGER&&(this.maxAudioBitRate=this.options.get("maxAudioBitRate")),G(this.options.get("maxSize"),dt())||(this.maxSize=this.options.get("maxSize")),this.options.get("burstEnabled")&&h.enableBurst(this.targetBufferTime)}set volume(t){this.playbackSource.volume=t}get volume(){return this.playbackSource.volume}set muted(t){if(t===this.muted)return;const e=this.playbackSource.muted;this.playbackSource.muted=t,!t&&e&&!this.playbackSource.isPaused&&this.playbackSource.play()}get muted(){return this.playbackSource.muted}get media(){return this.options.get("media")}get videoBitRate(){return this.modules.incomingData.averageBitRate("video")}get audioBitRate(){return this.modules.incomingData.averageBitRate("audio")}get connectionState(){return this.modules.connection.getState()}get playbackState(){return this.modules.playback.getState()}get bufferFullness(){return this.modules.playback.getBufferFullness()}get sizeBasedResolutionCapEnabled(){return this.modules.constraintCap.sizeBasedResolutionCapEnabled}set sizeBasedResolutionCapEnabled(t){this.modules.constraintCap.sizeBasedResolutionCapEnabled=t}get abrEnabled(){return this.modules.adaptivity.isEnabled}set abrEnabled(t){this.modules.constraintCap.sizeBasedResolutionCapEnabled=!!t&&this.options.get("sizeBasedResolutionCapEnabled"),this.modules.adaptivity.isEnabled=t,this.alignSizeAndBitRate(this.targetSubscription)}get serverEdgeTime(){return this.modules.sync.getLiveEdgeTimeLatencyAdjusted(this.currentSubscription.channelId)}get serverWallclockTime(){return this.modules.sync.getWallclockTimeLatencyAdjusted(this.currentSubscription.channelId)}get currentTime(){return this.modules.sync.serverCurrentTime}get channelCurrentTime(){return this.modules.sync.channelCurrentTime}get targetBufferTime(){return this.modules.playback.getTargetBufferTime()}set targetBufferTime(t){this.modules.playback.getTargetBufferTime()!==t&&(this.modules.playback.setTargetBufferTime(t),this.playbackSource.currentTime=this.modules.sync.serverCurrentTime,this.options.get("burstEnabled",this.channelId)?this.modules.subscription.enableBurst(this.targetBufferTime):this.modules.subscription.enableBurst(0))}get playbackLatency(){var t;if(0!==this.playbackSource.currentTime)return this.targetBufferTime+(null!=(t=this.modules.sync.drift)?t:0)+this.modules.connection.rtt/2}get playbackWallclockTime(){if(this.serverWallclockTime&&this.playbackLatency)return this.serverWallclockTime-this.playbackLatency}get channels(){return this._channels}get languages(){return this.modules.renditions.getLanguages()}get language(){return this.modules.subscription.getTargetSubscription().audio.language}set language(t){this.modules.subscription.setLanguage(t)}set textTrack(t){f(this,dn).forEach((e=>{e.label===t?e.mode="showing":e.mode="hidden"}))}get textTracks(){return f(this,dn).filter((t=>"disabled"!==t.mode)).map((t=>t.label))}get textTrack(){var t;return null==(t=f(this,dn).find((t=>"showing"===t.mode)))?void 0:t.label}get channelId(){return this.modules.subscription.getTargetSubscription().channelId}set channelId(t){if(t===this.channelId)return;this.modules.subscription.setChannelId(t);const e="audio"===this.options.get("media")?[]:this.options.get("videoCodecs"),i=this.modules.renditions.getAudioRenditions(t),n=this.modules.renditions.getVideoRenditions(t),s=this.targetSubscription.audio.language,r=null==i?void 0:i.some((t=>t.language===s)),o=e.find((t=>void 0!==(null==n?void 0:n.find((e=>e.codec===t)))));o&&this.modules.subscription.setVideoCodec(o),this.logger.debug("Channel switch - started",{audioRenditions:i,targetSubscriptionLanguage:s,targetHasCurrentLanguage:r}),this.alignSizeAndBitRate(this.targetSubscription)}get maxSize(){var t,e;const{width:i,height:n}=null!=(e=null==(t=this.modules.constraintCap.getCurrentConstraintCap())?void 0:t.video)?e:dt();return{width:i,height:n}}set maxSize(t){this.modules.constraintCap.setUserSpecifiedCap({video:{width:t.width,height:t.height}}),this.alignSizeAndBitRate(this.targetSubscription)}get maxVideoBitRate(){var t,e;return null!=(e=null==(t=this.modules.constraintCap.getCurrentConstraintCap())?void 0:t.video.bitRate)?e:ct()}set maxVideoBitRate(t){this.modules.constraintCap.setUserSpecifiedCap({video:{bitRate:t}}),this.alignSizeAndBitRate(this.targetSubscription)}get maxAudioBitRate(){var t,e;return null!=(e=null==(t=this.modules.constraintCap.getCurrentConstraintCap())?void 0:t.audio.bitRate)?e:ct()}set maxAudioBitRate(t){this.modules.constraintCap.setUserSpecifiedCap({audio:{bitRate:t}}),this.alignSizeAndBitRate(this.targetSubscription)}get renditionLevels(){return this.modules.renditions.getRenditionLevels()}get currentRenditionLevel(){return this.modules.renditions.getRenditionLevel()}get targetRenditionLevel(){return this.modules.renditions.getRenditionLevel(this.modules.subscription.getTargetSubscription())}get isSwitchingRenditionLevel(){return this.modules.subscription.isSwitchingSubscription()}get videoBufferedRanges(){var t,e,i,n;return null!=(n=null!=(i=null==(t=this.modules.mseModule)?void 0:t.getBuffer("video"))?i:null==(e=this.modules.decoder)?void 0:e.getBuffer("video"))?n:[]}get audioBufferedRanges(){var t,e,i,n;return null!=(n=null!=(i=null==(t=this.modules.mseModule)?void 0:t.getBuffer("audio"))?i:null==(e=this.modules.decoder)?void 0:e.getBuffer("audio"))?n:[]}getApiClient(){return this.apiClient}get lastBufferEvent(){return this.modules.playback.getLastBufferStateEvent()}get activeRatios(){return this.modules.qualityOfService.activeRatios()}get bufferingRatios(){return this.modules.qualityOfService.bufferingRatios()}get timeSpentBuffering(){return this.modules.qualityOfService.timeSpentBuffering()}get timeActive(){return this.modules.qualityOfService.timeActive()}get mediaElement(){return this.element}get uptime(){return Date.now()-this.createdAt}suspend(){this.isSuspended||(Object.values(this.modules).forEach((t=>{t&&"suspend"in t&&t.suspend()})),this.isSuspended=!0)}unsuspend(){this.isSuspended&&(Object.values(this.modules).forEach((t=>{t&&"unsuspend"in t&&t.unsuspend()})),this.isSuspended=!1)}alignSizeAndBitRate(t){const e=this.modules.constraintCap.constrainSubscription(p(m({},t),{video:m({},t.video),audio:m({},t.audio)})),i=this.modules.constraintCap.getUserSpecifiedCap();!this.abrEnabled&&i&&(e.audio.bitRate=i.audio.bitRate,e.video.bitRate=i.video.bitRate,e.video.width=i.video.width,e.video.height=i.video.height);const n=this.modules.renditions.getRenditionLevel(e);if(n)if(n.video&&(this.modules.subscription.setVideoBitRate(n.video.bitRate),this.modules.subscription.setSize(n.video)),n.audio)this.modules.subscription.setAudioBitRate(n.audio.bitRate),this.modules.subscription.setLanguage(n.audio.language);else if(e.audio.language){let t=this.modules.renditions.getAudioRenditions(e.channelId);!this.abrEnabled&&i&&(t=null==t?void 0:t.filter((t=>t.bitRate<i.audio.bitRate)));const n=e.audio.language,s=null==t?void 0:t.some((t=>t.language===n)),r=null==t?void 0:t.find((t=>t.language)),o=(null==t?void 0:t.length)&&t[0]||void 0;s||(r?(this.logger.debug("Randomizing language since target did not have current language"),this.modules.subscription.setAudioBitRate(r.bitRate),this.modules.subscription.setLanguage(r.language)):(this.logger.debug("Randomizing audio rendition since target did not have current language"),null!=o&&o.bitRate&&this.modules.subscription.setAudioBitRate(o.bitRate),this.modules.subscription.setLanguage(null==o?void 0:o.language)))}}get currentSubscription(){return this.modules.subscription.getCurrentSubscription()}get targetSubscription(){return this.modules.subscription.getTargetSubscription()}willUseMediaSource(){return this.browser.supportsMediaSource&&this.options.get("mseEnabled")}};cn=new WeakMap,dn=new WeakMap,un=new WeakMap,A(mn,"MAX_POOL_SIZE",10),A(mn,"INITIAL_MAX_BIT_RATE",25e5),A(mn,"PING_TIMEOUT",1e3),A(mn,"DISCONNECT_TIMEOUT",15e3),A(mn,"REMOVE_CUE_THRESHOLD",1e4);let pn=mn}},n={};function s(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={exports:{}};return i[t](r,r.exports,s),r.exports}s.m=i,s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.f={},s.e=t=>Promise.all(Object.keys(s.f).reduce(((e,i)=>(s.f[i](t,e),e)),[])),s.u=t=>t+"."+{418:"8adec1ee0f3a27e0fe4d",684:"78b0efe9ae917632040d"}[t]+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="vindral-examples:",s.l=(i,n,r,o)=>{if(t[i])t[i].push(n);else{var a,l;if(void 0!==r)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var d=h[c];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==e+r){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",e+r),a.src=i),t[i]=[n];var u=(e,n)=>{a.onerror=a.onload=null,clearTimeout(m);var s=t[i];if(delete t[i],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((t=>t(n))),e)return e(n)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),(()=>{var t={508:0};s.f.j=(e,i)=>{var n=s.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise(((i,s)=>n=t[e]=[i,s]));i.push(n[2]=r);var o=s.p+s.u(e),a=new Error;s.l(o,(i=>{if(s.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+o+")",a.name="ChunkLoadError",a.type=r,a.request=o,n[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var n,r,[o,a,l]=i,h=0;if(o.some((e=>0!==t[e]))){for(n in a)s.o(a,n)&&(s.m[n]=a[n]);l&&l(s)}for(e&&e(i);h<o.length;h++)r=o[h],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0},i=self.webpackChunkvindral_examples=self.webpackChunkvindral_examples||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var r=s(4088),o=s(7848),a=Object.defineProperty,l=(t,e,i)=>((t,e,i)=>e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),h=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{a(i.next(t))}catch(t){s(t)}},o=t=>{try{a(i.throw(t))}catch(t){s(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,o);a((i=i.apply(t,e)).next())}));class c extends o.E{constructor(t){super(),l(this,"state","not casting"),l(this,"config"),l(this,"unloaded",!1),l(this,"updateAuthenticationToken",(t=>{this.config&&(this.config.options.authenticationToken=t,this.send({type:"updateAuthToken",token:t}))})),l(this,"unload",(()=>{var t;this.unloaded=!0,null==(t=this.getSession())||t.removeMessageListener("urn:x-cast:com.vindral.castdata",this.onMessage)})),l(this,"init",(()=>h(this,null,(function*(){return new Promise(((t,e)=>{let i=!1;const n=setTimeout((()=>{i=!0,e()}),1e4);window.__onGCastApiAvailable=s=>{if(!i)return clearTimeout(n),s?void setTimeout((()=>{try{this.onGCastApiAvailable(),t()}catch(t){e()}}),1e3):e();i=!1},this.castLibrariesAdded()&&window.cast?window.__onGCastApiAvailable(!0):this.verifyCastLibraries()}))})))),l(this,"start",(()=>h(this,null,(function*(){var t;yield null==(t=this.getInstance())?void 0:t.requestSession()})))),l(this,"stop",(()=>{var t;null==(t=this.getSession())||t.endSession(!0)})),l(this,"getReceiverName",(()=>{var t,e;return(null==(e=null==(t=this.getSession())?void 0:t.getCastDevice())?void 0:e.friendlyName)||void 0})),l(this,"onGCastApiAvailable",(()=>{var t;const e=this.getInstance();if(!e)throw"cast context should exist";const i=e.getSessionState(),n=(null==(t=this.config)?void 0:t.receiverApplicationId)||"A5452297";e.setOptions({receiverApplicationId:n,autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,resumeSavedSession:!0}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged),i===cast.framework.SessionState.SESSION_STARTED&&setTimeout((()=>{this.state="casting",this.emit("resumed")}))})),l(this,"send",(t=>{var e;null==(e=this.getSession())||e.sendMessage("urn:x-cast:com.vindral.castdata",t)})),l(this,"onMessage",((t,e)=>{if("urn:x-cast:com.vindral.castdata"===t)try{const t=JSON.parse(e);switch(t.type){case"metadata":this.emit("metadata",t.metadata);break;case"serverWallclockTime":this.emit("server wallclock time",t.serverWallclockTime)}}catch(t){}})),l(this,"onSessionStarted",(()=>{var t;null==(t=this.getSession())||t.addMessageListener("urn:x-cast:com.vindral.castdata",this.onMessage),this.send({type:"start",config:this.config})})),l(this,"onSessionStateChanged",(t=>{if(!this.unloaded)switch(t.sessionState){case cast.framework.SessionState.SESSION_START_FAILED:this.state="not casting",this.emit("failed");break;case cast.framework.SessionState.SESSION_ENDED:this.state="not casting",this.emit("disconnected");break;case cast.framework.SessionState.SESSION_ENDING:break;case cast.framework.SessionState.SESSION_RESUMED:this.onSessionStarted(),this.state="casting",this.emit("resumed");break;case cast.framework.SessionState.SESSION_STARTED:this.onSessionStarted(),this.state="casting",this.emit("connected");case cast.framework.SessionState.SESSION_STARTING:}})),l(this,"getInstance",(()=>{var t;return null==(t=window.cast)?void 0:t.framework.CastContext.getInstance()})),l(this,"getSession",(()=>{var t;return null==(t=this.getInstance())?void 0:t.getCurrentSession()})),l(this,"castLibrariesAdded",(()=>!(!document.querySelector("#vindralCastFrameworkLib")||!document.querySelector("#vindralCastSenderLib")))),l(this,"verifyCastLibraries",(()=>{if(this.castLibrariesAdded())return;const t=document.createElement("script");t.type="text/javascript",t.id="vindralCastFrameworkLib",t.src="//www.gstatic.com/cast/sdk/libs/sender/1.0/cast_framework.js",document.head.appendChild(t);const e=document.createElement("script");e.type="text/javascript",e.id="vindralCastSenderLib",e.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js",document.head.appendChild(e)})),this.config=t}get casting(){return"casting"===this.state}get volume(){var t,e;return null!=(e=null==(t=this.getSession())?void 0:t.getVolume())?e:0}set volume(t){var e;null==(e=this.getSession())||e.setVolume(t)}get language(){var t,e;return null==(e=null==(t=this.config)?void 0:t.options)?void 0:e.language}set language(t){this.config&&(this.config.options.language=t,this.send({type:"setLanguage",language:t}))}get channelId(){var t;return(null==(t=this.config)?void 0:t.options.channelId)||""}set channelId(t){this.config&&(this.config.options.channelId=t,this.send({type:"setChannelId",channelId:t}))}}var d=s(4896),u=Object.defineProperty,m=Object.getPrototypeOf,p=Reflect.get,A=t=>{throw TypeError(t)},g=(t,e,i)=>((t,e,i)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),f=(t,e,i)=>e.has(t)||A("Cannot "+i),v=(t,e,i)=>(f(t,e,"read from private field"),i?i.call(t):e.get(t)),b=(t,e,i)=>e.has(t)?A("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),w=(t,e,i,n)=>(f(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),S=(t,e,i)=>(f(t,e,"access private method"),i),y=(t,e,i)=>p(m(t),i,e),E=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{a(i.next(t))}catch(t){s(t)}},o=t=>{try{a(i.throw(t))}catch(t){s(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,o);a((i=i.apply(t,e)).next())}));const k=1e6,C=1e3*k,T=(t,e,i)=>t%e==0?t/e:(t/e).toFixed(i),x={PAUSED:"paused",MUTED:"muted",USER_INTERACTING:"user-interacting",IS_CASTING:"is-casting",CAST_AVAILABLE:"cast-available",CAST_RECEIVER_NAME:"cast-receiver-name",BUFFERING:"buffering",UI_LOCKED:"ui-locked",FULLSCREEN:"is-fullscreen",FULLSCREEN_FALLBACK:"is-fullscreen-fallback",RENDITION_LEVELS:"rendition-levels",RENDITION_LEVEL:"rendition-level",MAX_VIDEO_BITRATE:"max-video-bit-rate",CHANNELS:"channels",CHANNEL_ID:"channel-id",CHANNEL_GROUP_ID:"channel-group-id",PICTURE_IN_PICTURE:"picture-in-picture",AIRPLAY_AVAILABLE:"airplay-available",IS_AIRPLAYING:"is-airplaying",MEDIA:"media",LANGUAGES:"languages",LANGUAGE:"language",TEXT_TRACKS:"text-tracks",TEXT_TRACK:"text-track",NEEDS_USER_INPUT:"needs-user-input",AUTHENTICATION_TOKEN:"authentication-token",VOLUME:"volume",CAST_ENABLED:"cast",AIRPLAY_ENABLED:"airplay",PIP_ENABLED:"pip",FULLSCREEN_ENABLED:"fullscreen"},I=Object.values(x),R={PLAY:"play",PAUSE:"pause",MUTE:"mute",UNMUTE:"unmute",LOCK_UI:"lock-ui",UNLOCK_UI:"unlock-ui",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_FULLSCREEN:"exit-fullscreen",SET_RENDITION:"set-rendition",CHANNEL_GRID_OPENED:"channel-grid-opened",ENTER_PIP:"enter-pip",EXIT_PIP:"exit-pip",REQUEST_AIRPLAY:"request-airplay",SET_LANGUAGE:"set-language",SET_TEXT_TRACK:"set-text-track",REQUEST_USER_INPUT:"request-user-input",SET_VOLUME:"set-volume"};function L(t){return"audio"===t||"video"===t||"audio+video"===t?t:"audio+video"}function P(t){return"trace"===t||"debug"===t||"info"===t||"warn"===t||"error"===t||"off"===t?t:"off"}function M(t){if(null!==t)return""===t||t}function B(t){if(null===t)return;const e=parseInt(t,10);return isNaN(e)?void 0:e}function _(t){return"string"==typeof t}function U(t,e){if(null===t)return null!=e?e:void 0;const i=t.toLowerCase();return"false"!==i&&("true"===i||""===i||null==e||e)}const N=document.createElement("template");var D,F,O,W;N.innerHTML="\n  <style>\n    :host {\n      cursor: pointer;\n      color: var(--fg-strong);\n      padding: var(--button-padding);\n      background: transparent;\n      transition: background 0.2s linear;\n      -webkit-tap-highlight-color: transparent;\n    }\n\n    :host(:focus-visible) {\n      box-shadow: inset 0 0 0 2px var(--fg-strong);\n      outline: 0;\n    }\n\n    :host(:where(:focus)) {\n      box-shadow: none;\n      outline: 0;\n    }\n\n    @media (hover: hover) and (pointer: fine) {\n      :host(:hover) {\n        background: rgba(255, 255, 255, 0.15);\n      }\n    }\n\n    :host(:active) {\n      background: rgba(255, 255, 255, 0.25);\n    }\n\n    :host(:active) svg {\n      scale: 0.9;\n    }\n\n    :host([disabled]) {\n      opacity: 0.5;\n      background: transparent;\n    }\n  </style>\n";class G extends HTMLElement{constructor(){super(),b(this,D,null),b(this,F,(t=>{this.handleClick(t)})),b(this,O,(t=>{const{key:e}=t;this.keysUsed.includes(e)?this.handleClick(t):this.removeEventListener("keyup",v(this,O))})),b(this,W,(t=>{const{metaKey:e,altKey:i,key:n}=t;e||i||!this.keysUsed.includes(n)?this.removeEventListener("keyup",v(this,O)):this.addEventListener("keyup",v(this,O),{once:!0})})),this.attachShadow({mode:"open"}).appendChild(N.content.cloneNode(!0))}get keysUsed(){return["Enter"," "]}connectedCallback(){var t;const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,D,e.querySelector("vindral-controller")),null==(t=v(this,D))||t.connectListener(this)),this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button")}enable(){this.addEventListener("click",v(this,F)),this.addEventListener("keydown",v(this,W)),this.tabIndex=0}disable(){this.removeEventListener("click",v(this,F)),this.removeEventListener("keydown",v(this,W)),this.removeEventListener("keyup",v(this,O)),this.tabIndex=-1}disconnectedCallback(){var t;null==(t=v(this,D))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){"disabled"===t&&(_(i)?this.disable():this.enable())}}D=new WeakMap,F=new WeakMap,O=new WeakMap,W=new WeakMap,g(G,"observedAttributes",["disabled"]);const z=document.createElement("template"),H='\n    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round" ><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 18a3 3 0 0 0 3 -3v-8a3 3 0 0 0 -3 -3h-12a3 3 0 0 0 -3 3v8a3 3 0 0 0 3 3" /><path d="M9 20h6l-3 -5z" /></svg>\n';var V,X;z.innerHTML=`\n  <style>\n    :host {\n      display: var(--airplay-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host(:not([${x.AIRPLAY_AVAILABLE}])) {\n      display: none !important;\n    }\n\n    :host([${x.IS_AIRPLAYING}]) slot[name="exit"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.IS_AIRPLAYING}])) slot[name="enter"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="enter">${H}</slot>\n    <slot name="exit">${H}</slot>\n  </slot>\n`;const Q=class extends G{constructor(){var t;super(),b(this,V),null==(t=this.shadowRoot)||t.appendChild(z.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),S(this,V,X).call(this)}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.IS_AIRPLAYING&&S(this,V,X).call(this)}set isAirPlaying(t){t?this.setAttribute(x.IS_AIRPLAYING,""):this.removeAttribute(x.IS_AIRPLAYING)}get isAirPlaying(){return this.hasAttribute(x.IS_AIRPLAYING)}handleClick(t){this.dispatchEvent(new CustomEvent(R.REQUEST_AIRPLAY,{bubbles:!0,composed:!0}))}};V=new WeakSet,X=function(){this.setAttribute("aria-label",this.isAirPlaying?"Exit airplay":"Enter airplay")},g(Q,"observedAttributes",[...y(Q,Q,"observedAttributes"),x.AIRPLAY_AVAILABLE,x.IS_AIRPLAYING]);let j=Q;const q=document.createElement("template");var Z;q.innerHTML=`\n  <style>\n    :host {\n      display: var(--buffering-overlay-display);\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background-color: rgba(0, 0, 0, 0.3);\n      transition: opacity 250ms;\n      transition-delay: 1s;\n      opacity: 1;\n      pointer-events: none;\n      z-index: 1;\n    }\n\n    #buffering-indicator {\n      width: 40px;\n      height: 40px;\n      border-radius: 40px;\n      background-color: var(--fg-strong);\n      animation: scaleout 1s infinite ease-in-out;\n    }\n\n    @-webkit-keyframes scaleout {\n      0% {\n        -webkit-transform: scale(0);\n      }\n      100% {\n        -webkit-transform: scale(1);\n        opacity: 0;\n      }\n    }\n\n    @keyframes scaleout {\n      0% {\n        -webkit-transform: scale(0);\n        transform: scale(0);\n      }\n      100% {\n        -webkit-transform: scale(1);\n        transform: scale(1);\n        opacity: 0;\n      }\n    }\n\n    :host(:not([${x.BUFFERING}])) {\n      transition-delay: 0s;\n      opacity: 0 !important;\n    }\n  </style>\n\n  <div id="buffering-indicator"></div>\n`;class $ extends HTMLElement{constructor(){super(),b(this,Z,null),this.attachShadow({mode:"open"}).appendChild(q.content.cloneNode(!0))}connectedCallback(){var t;const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,Z,e.querySelector("vindral-controller")),null==(t=v(this,Z))||t.connectListener(this))}disconnectedCallback(){var t;null==(t=v(this,Z))||t.disconnectListener(this)}}Z=new WeakMap,g($,"observedAttributes",[x.BUFFERING]);const J=document.createElement("template");var Y,K,tt;J.innerHTML=`\n  <style>\n    :host {\n      display: var(--cast-button-display);\n    }\n\n    google-cast-launcher {\n      display: block;\n      width: 24px;\n      height: 24px;\n      cursor: pointer;\n      --connected-color: var(--fg-strong);\n      --disconnected-color: var(--fg-strong);\n    }\n\n    :host(:active) google-cast-launcher {\n      transform: scale(0.9);\n    }\n\n    :host(:not([${x.CAST_AVAILABLE}])) {\n      display: none !important;\n    }\n  </style>\n`;const et=class extends G{constructor(){var t;super(),b(this,Y),null==(t=this.shadowRoot)||t.appendChild(J.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),S(this,Y,K).call(this)}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.CAST_AVAILABLE&&S(this,Y,tt).call(this),t===x.IS_CASTING&&S(this,Y,K).call(this)}set isCasting(t){t?this.setAttribute(x.IS_CASTING,""):this.removeAttribute(x.IS_CASTING)}get isCasting(){return this.hasAttribute(x.IS_CASTING)}handleClick(t){}};Y=new WeakSet,K=function(){this.setAttribute("aria-label",this.isCasting?"Exit cast":"Enter cast")},tt=function(){var t,e;if(null==(t=this.shadowRoot)||!t.querySelector("google-cast-launcher")){const t=document.createElement("google-cast-launcher");null==(e=this.shadowRoot)||e.appendChild(t)}},g(et,"observedAttributes",[...y(et,et,"observedAttributes"),x.CAST_AVAILABLE,x.IS_CASTING]);let it=et;const nt=document.createElement("template");var st,rt;nt.innerHTML=`\n  <style>\n    :host {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      font-size: 20px;\n      text-align: center;\n      padding: 5% 0;\n      box-shadow: 0px 0px 20px black;\n      background: rgba(0, 0, 0, 0.5);\n      color: white;\n      pointer-events: none;\n      z-index: 1;\n      transition: opacity 0.3s ease-in-out;\n    }\n\n    @media only screen and (max-width: 600px) {\n      :host {\n        font-size: 14px;\n      }\n    }\n\n    :host(:not([${x.IS_CASTING}])) {\n      display: none;\n    }\n\n    #text {\n      margin: 0;\n      padding: 0;\n    }\n  </style>\n  <span id="text"></span>\n`;class ot extends HTMLElement{constructor(){super(),b(this,st,null),b(this,rt,null),this.attachShadow({mode:"open"}).appendChild(nt.content.cloneNode(!0))}connectedCallback(){var t,e;const i=this.getRootNode();(i instanceof Document||i instanceof ShadowRoot)&&(w(this,st,i.querySelector("vindral-controller")),null==(t=v(this,st))||t.connectListener(this)),w(this,rt,null==(e=this.shadowRoot)?void 0:e.querySelector("#text"))}disconnectedCallback(){var t;null==(t=v(this,st))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){e===i||!v(this,rt)||"cast-receiver-name"===t&&"string"==typeof i&&(v(this,rt).innerText=`Casting to ${i||"device"}`)}}st=new WeakMap,rt=new WeakMap,g(ot,"observedAttributes",[x.IS_CASTING,x.CAST_RECEIVER_NAME]);const at=document.createElement("template");var lt;at.innerHTML='\n  <style>\n    :host {\n      position: relative;\n      aspect-ratio: 16 / 9;\n      object-fit: cover;\n      cursor: pointer;\n      border-radius: 6px;\n      box-sizing: border-box;\n      margin: 2px;\n\n      background-size: cover;\n      background-position: center;\n\n      transition-property: background-image;\n      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n      transition-duration: 200ms;\n\n      background-color: rgba(0, 0, 0, 0.5);\n      background-blend-mode: multiply;\n    }\n\n    :host([aria-selected="true"]) {\n      outline: 2px solid var(--fg-strong);\n      background-color: rgba(0, 0, 0, 0);\n    }\n\n    :host([offline]) {\n      display: var(--grid-item-offline-display);\n      background-image: repeating-linear-gradient(-45deg, #3d3d3d 0, #3d3d3d 4px, #1c2024 4px, #1c2024 8px) !important;\n      pointer-events: none;\n    }\n\n    :host::before {\n      content: "";\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(255, 255, 255, 0);\n      transition: background 0.2s ease;\n    }\n\n    :host(:hover)::before {\n      background: rgba(255, 255, 255, 0.1);\n    }\n\n    .channel-title {\n      position: absolute;\n      bottom: var(--padding-2);\n      left: var(--padding-2);\n      padding: var(--padding-1) var(--padding-2);\n      color: white;\n      font-size: 15px;\n      font-weight: 500;\n      text-overflow: ellipsis;\n      border-radius: 4px;\n\n      @container (max-width: 480px) {\n        font-size: 13px;\n      }\n    }\n  </style>\n  <slot></slot>\n';class ht extends HTMLElement{constructor(){super(),b(this,lt),g(this,"lastThumbnailUpdate");const t=this.attachShadow({mode:"open"});w(this,lt,document.createElement("span")),v(this,lt).className="channel-title",t.appendChild(v(this,lt)),t.appendChild(at.content.cloneNode(!0))}attributeChangedCallback(t,e,i){if(e!==i)switch(t){case"url":this.updateThumbnail();break;case"title":v(this,lt).textContent=i}}updateThumbnail(){const t=this.getAttribute("url"),e=this.hasAttribute("offline"),i=this.hasAttribute("visible");if(e||!t||!i||this.lastThumbnailUpdate&&Date.now()-this.lastThumbnailUpdate<1e4)return;const n=new URL(t),s=new Image,r=this.getAttribute("authentication-token");r&&n.searchParams.set("auth.token",r),n.searchParams.set("t",Date.now().toString()),s.src=n.toString(),s.onload=()=>this.style.backgroundImage=`url(${n.toString()})`}}lt=new WeakMap,g(ht,"observedAttributes",["url","title","offline","authentication-token","visible"]);const ct=document.createElement("template");var dt,ut,mt,pt,At,gt,ft,vt,bt,wt,St,yt;ct.innerHTML='\n  <style>\n    :host {\n      cursor: default;\n      display: flex;\n      flex-direction: column;\n      box-sizing: border-box;\n      border-radius: 4px;\n      background-color: var(--bg-subtle);\n      padding: var(--padding-2);\n\n      position: absolute;\n      bottom: 0;\n      right: 0;\n\n      z-index: 5;\n      width: 100%;\n      max-height: 75%;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    .wrapper {\n      overflow: auto;\n      -ms-overflow-style: none;\n      scrollbar-width: none;\n      height: 100%;\n    }\n\n    .wrapper::-webkit-scrollbar {\n      display: none;\n    }\n\n    slot#grid {\n      display: grid;\n      gap: var(--padding-2);\n\n      @container (width < 768px) {\n        grid-template-columns: repeat(2, minmax(0, 1fr));\n      }\n      @container (width < 1024px) and (width >= 768px) {\n        grid-template-columns: repeat(3, minmax(0, 1fr));\n      }\n      @container (width >= 1024px) {\n        grid-template-columns: repeat(4, minmax(0, 1fr));\n      }\n    }\n\n    :host([mode="list"]) slot#grid {\n      grid-template-columns: repeat(1, minmax(0, 1fr));\n    }\n  </style>\n\n  <div class="wrapper">\n    <slot name="grid" id="grid"></slot>\n  </div>\n';class Et extends HTMLElement{constructor(){super(),b(this,vt),b(this,dt,null),b(this,ut,null),b(this,mt,[]),b(this,pt,[]),b(this,At),b(this,gt),b(this,ft),this.attachShadow({mode:"open"}).appendChild(ct.content.cloneNode(!0))}connectedCallback(){var t;const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,ut,e.querySelector("vindral-controller")),null==(t=v(this,ut))||t.connectListener(this)),S(this,vt,bt).call(this),S(this,vt,wt).call(this),w(this,ft,window.setInterval((()=>{S(this,vt,St).call(this)}),1e4))}disconnectedCallback(){var t;clearInterval(v(this,ft)),null==(t=v(this,dt))||t.disconnect()}attributeChangedCallback(t,e,i){var n;switch(t){case x.CHANNEL_ID:{const t=v(this,pt).find((t=>t.id===i));null==t||t.element.setAttribute("aria-selected","true"),null==(n=v(this,At))||n.setAttribute("aria-selected","false"),w(this,At,null==t?void 0:t.element);break}case x.CHANNELS:w(this,mt,JSON.parse(i)),S(this,vt,wt).call(this);break;case"hidden":this.hasAttribute("hidden")&&this.dispatchEvent(new CustomEvent(R.CHANNEL_GRID_OPENED,{bubbles:!0,composed:!0}));break;case"authentication-token":w(this,gt,i)}}}dt=new WeakMap,ut=new WeakMap,mt=new WeakMap,pt=new WeakMap,At=new WeakMap,gt=new WeakMap,ft=new WeakMap,vt=new WeakSet,bt=function(){w(this,dt,new IntersectionObserver((t=>{t.forEach((t=>{const{intersectionRatio:e,target:i}=t;i instanceof ht&&(e>0?(i.setAttribute("visible",""),(!i.lastThumbnailUpdate||Date.now()-i.lastThumbnailUpdate>=1e4)&&(i.updateThumbnail(),i.lastThumbnailUpdate=Date.now())):i.removeAttribute("visible"))}))})))},wt=function(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector("slot[name=grid]");e.innerHTML="",v(this,pt).forEach((t=>{var e;return null==(e=v(this,dt))?void 0:e.unobserve(t.element)})),w(this,pt,[]),v(this,mt).sort(((t,e)=>t.isLive&&!e.isLive?-1:1)).forEach((t=>{var i;const n=document.createElement("vindral-channel-grid-item"),s=t.thumbnailUrls[0]||"";v(this,gt)&&n.setAttribute("authentication-token",v(this,gt)),n.setAttribute("url",s),n.setAttribute("title",t.name),n.onclick=()=>S(this,vt,yt).call(this,t),t.isLive||n.setAttribute("offline",""),t.channelId===this.getAttribute("channel-id")&&(n.setAttribute("aria-selected","true"),w(this,At,n)),e.appendChild(n),v(this,pt).push({element:n,thumbnail:s,id:t.channelId}),null==(i=v(this,dt))||i.observe(n)}))},St=function(){this.hasAttribute("hidden")||v(this,pt).forEach((t=>t.element.updateThumbnail()))},yt=function(t){var e;null==(e=v(this,ut))||e.setAttribute("channel-id",t.channelId)},g(Et,"observedAttributes",[x.CHANNELS,x.CHANNEL_ID,x.AUTHENTICATION_TOKEN,"mode","hidden"]);const kt=document.createElement("template");var Ct,Tt,xt,It,Rt,Lt,Pt,Mt,Bt;kt.innerHTML='\n  <style>\n    :host {\n      display: var(--grid-button-display);\n      cursor: pointer;\n      flex-shrink: 0.5;\n      color: var(--fg-strong);\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    slot > svg {\n      display: block;\n    }\n  </style>\n  <slot name="button">\n<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layout-grid" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n  <path d="M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n  <path d="M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n  <path d="M14 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n</svg>\n</slot>\n';const _t=class extends G{constructor(){var t,e;super(),b(this,Rt),b(this,Ct),b(this,Tt),b(this,xt),b(this,It,(t=>{t.composedPath().includes(this)||S(this,Rt,Mt).call(this)})),null==(t=this.shadowRoot)||t.appendChild(kt.content.cloneNode(!0)),w(this,Ct,null==(e=this.shadowRoot)?void 0:e.querySelector("slot[name=button]"))}connectedCallback(){var t;super.connectedCallback(),this.setAttribute("aria-haspopup","listbox"),this.enable(),S(this,Rt,Bt).call(this);const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,Tt,e.querySelector("vindral-channel-grid")),"vindral-scroll-overlay"===(null==(t=v(this,Tt).parentElement)?void 0:t.localName)&&(v(this,Tt).hidden=!1,v(this,Tt).style.position="relative",w(this,xt,v(this,Tt).parentElement)))}disconnectedCallback(){}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),(t===x.CHANNEL_GROUP_ID||t===x.CHANNELS)&&S(this,Rt,Bt).call(this)}enable(){super.enable(),document.addEventListener("click",v(this,It))}handleClick(t){S(this,Rt,Lt).call(this)}};Ct=new WeakMap,Tt=new WeakMap,xt=new WeakMap,It=new WeakMap,Rt=new WeakSet,Lt=function(){var t;v(this,xt)?v(this,xt).hasAttribute("open")?S(this,Rt,Mt).call(this):S(this,Rt,Pt).call(this):null!=(t=v(this,Tt))&&t.hidden?S(this,Rt,Pt).call(this):S(this,Rt,Mt).call(this)},Pt=function(){var t;if(v(this,xt))v(this,xt).setAttribute("open","");else{if(null==(t=v(this,Tt))||!t.hidden)return;v(this,Tt).hidden=!1,v(this,Tt).focus()}v(this,Ct).setAttribute("aria-expanded","true")},Mt=function(){if(v(this,xt))v(this,xt).removeAttribute("open");else{if(!v(this,Tt)||v(this,Tt).hidden)return;v(this,Tt).hidden=!0}v(this,Ct).setAttribute("aria-expanded","false")},Bt=function(){this.getAttribute(x.CHANNEL_GROUP_ID)?this.removeAttribute("hidden"):this.setAttribute("hidden",""),this.hasAttribute(x.CHANNELS)?this.removeAttribute("disabled"):this.setAttribute("disabled","")},g(_t,"observedAttributes",[...y(_t,_t,"observedAttributes"),x.CHANNEL_GROUP_ID,x.CHANNELS,"hidden"]);let Ut=_t;const Nt=document.createElement("template");Nt.innerHTML='\n  <style>\n    :host {\n      display: flex;\n      width: 100%;\n      align-items: center;\n    }\n\n    slot {\n      display: flex;\n      flex-grow: 1;\n      align-items: center;\n    }\n\n    :host([content-center]) slot {\n      justify-content: center;\n    }\n\n    slot[name="right"] {\n      justify-content: flex-end;\n    }\n  </style>\n\n  <slot name="bar">\n    <slot></slot>\n    <slot name="right"></slot>\n  </slot>\n';class Dt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).appendChild(Nt.content.cloneNode(!0))}connectedCallback(){}disconnectedCallback(){}}g(Dt,"observedAttributes",[]);class Ft extends o.E{constructor(t){super(),g(this,"config"),g(this,"hlsUrl"),g(this,"element"),g(this,"connectingTimeout"),g(this,"updateAuthenticationToken",(t=>{})),g(this,"unload",(()=>{this.element&&(this.element.removeEventListener("webkitplaybacktargetavailabilitychanged",this.onAirPlayAvailable),this.element.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.onAirPlayPlaybackChanged),this.element.remove())})),g(this,"onAirPlayAvailable",(t=>{"available"===t.availability&&this.element.src!==this.hlsUrl&&this.checkHlsUrl(this.hlsUrl).then((t=>{t&&(this.element.src=this.hlsUrl,this.emit("available"))}))})),g(this,"onAirPlayPlaybackChanged",(()=>{window.clearTimeout(this.connectingTimeout),this.element.webkitCurrentPlaybackTargetIsWireless?(this.emit("connected"),this.element.style.display="block",this.element.paused&&this.element.play()):(this.emit("disconnected"),this.element.pause(),this.element.src="",this.element.src=this.hlsUrl,this.element.style.display="none")})),this.hlsUrl=new URL(`/api/hls?channelId=${t.channelId}`,t.url).toString(),this.config=t,this.element=document.createElement("video"),this.element.style.position="absolute",this.element.style.top="0",this.element.style.bottom="0",this.element.style.left="0",this.element.style.right="0",this.element.style.width="100%",this.element.style.height="100%",this.element.style.zIndex="1001",this.element.style.display="none",this.element.id="vindral-airplay-element",this.element.playsInline=!0,this.element.controls=!0,this.element.preload="metadata",this.element.addEventListener("webkitplaybacktargetavailabilitychanged",this.onAirPlayAvailable),this.element.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.onAirPlayPlaybackChanged),this.config.container.appendChild(this.element)}get casting(){return this.element.webkitCurrentPlaybackTargetIsWireless}set channelId(t){}showPlaybackTargetPicker(){this.element.paused&&(this.element.play(),this.connectingTimeout=window.setTimeout((()=>{this.element.webkitCurrentPlaybackTargetIsWireless||(this.element.pause(),this.element.src="",this.element.src=this.hlsUrl)}),3e4)),this.element.webkitShowPlaybackTargetPicker()}static isAirPlaySupported(){return!!window.WebKitPlaybackTargetAvailabilityEvent}checkHlsUrl(t){return E(this,null,(function*(){try{return(yield fetch(t,{method:"HEAD"})).ok}catch(t){return!1}}))}}const Ot=class t extends o.E{constructor(e){super(),g(this,"container"),g(this,"unload",(()=>{document.removeEventListener("webkitfullscreenchange",this.onChange),document.removeEventListener("mozfullscreenchange",this.onChange),document.removeEventListener("fullscreenchange",this.onChange),this.container.removeEventListener("webkitendfullscreen",this.onChange)})),g(this,"request",(()=>E(this,null,(function*(){try{yield this.requestFn()}catch(t){throw this.onChange(),t}})))),g(this,"exit",(()=>E(this,null,(function*(){try{yield this.exitFn()}catch(t){throw this.onChange(),t}})))),g(this,"onChange",(()=>this.emit("on fullscreen change",this.isFullscreen()))),g(this,"isFullscreen",(()=>!!(document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen))),g(this,"isSupported",(()=>t.isFullscreenApiSupported(this.container)||!this.isInIframe())),g(this,"isFullscreenApiSupported",(()=>t.isFullscreenApiSupported(this.container))),g(this,"isInIframe",(()=>window.location!==window.parent.location)),this.container=e,document.addEventListener("webkitfullscreenchange",this.onChange),document.addEventListener("mozfullscreenchange",this.onChange),document.addEventListener("fullscreenchange",this.onChange),this.container.addEventListener("webkitendfullscreen",this.onChange)}get requestFn(){return t.isFullscreenApiSupported(this.container)?(this.container.requestFullscreen||this.container.webkitRequestFullscreen||this.container.webkitEnterFullscreen||this.container.mozRequestFullScreen).bind(this.container):()=>new Promise((t=>{t()}))}get exitFn(){if(t.isFullscreenApiSupported(this.container)&&this.isFullscreen()){const t=document.exitFullscreen,e=document.webkitFullscreenElement&&document.webkitExitFullscreen,i=document.mozFullscreenElement&&document.mozCancelFullScreen,n=t||e||i;return n?n.bind(document):this.container.webkitExitFullscreen.bind(this.container)}return()=>new Promise((t=>{t()}))}};g(Ot,"isFullscreenApiSupported",(t=>void 0!==(t.requestFullscreen||t.webkitRequestFullscreen||t.webkitEnterFullscreen||t.mozRequestFullScreen)));let Wt=Ot;var Gt,zt,Ht,Vt,Xt,Qt,jt,qt,Zt;class $t extends o.E{constructor(t){super(),g(this,"unload",(()=>{this.element.removeEventListener("enterpictureinpicture",this.onChange),this.element.removeEventListener("leavepictureinpicture",this.onChange)})),g(this,"request",(()=>E(this,null,(function*(){try{return yield v(this,Gt).call(this)}catch(t){throw this.onChange(),t}})))),g(this,"exit",(()=>E(this,null,(function*(){try{return yield v(this,zt).call(this)}catch(t){throw this.onChange(),t}})))),g(this,"onChange",(()=>{this.emit("on picture in picture change",this.isPictureInPictureActive())})),g(this,"isPictureInPictureActive",(()=>v(this,jt).call(this)||v(this,Qt).call(this))),g(this,"isSupported",(()=>v(this,Zt).call(this)||v(this,Xt).call(this))),b(this,Gt,(()=>v(this,Xt).call(this)?v(this,Ht).call(this):v(this,Zt).call(this)?v(this,qt).call(this,"picture-in-picture"):Promise.resolve())),b(this,zt,(()=>this.isPictureInPictureActive()?v(this,Xt).call(this)?v(this,Vt).call(this):v(this,Zt).call(this)?v(this,qt).call(this,"inline"):Promise.resolve():Promise.resolve())),b(this,Ht,(()=>E(this,null,(function*(){yield this.element.requestPictureInPicture()})))),b(this,Vt,(()=>E(this,null,(function*(){yield document.exitPictureInPicture()})))),b(this,Xt,(()=>!!this.element.requestPictureInPicture&&!!document.pictureInPictureEnabled)),b(this,Qt,(()=>!!document.pictureInPictureElement)),b(this,jt,(()=>"picture-in-picture"===this.element.webkitPresentationMode)),b(this,qt,(t=>(this.element.webkitSetPresentationMode&&this.element.webkitSetPresentationMode(t),Promise.resolve()))),b(this,Zt,(()=>!!this.element.webkitSetPresentationMode)),this.element=t,this.element.addEventListener("enterpictureinpicture",this.onChange),this.element.addEventListener("leavepictureinpicture",this.onChange),this.element.setAttribute("autopictureinpicture","")}}Gt=new WeakMap,zt=new WeakMap,Ht=new WeakMap,Vt=new WeakMap,Xt=new WeakMap,Qt=new WeakMap,jt=new WeakMap,qt=new WeakMap,Zt=new WeakMap;const Jt=t=>{var e;let i="observedAttributes"in t.constructor?t.constructor.observedAttributes:void 0;return!i&&null!=(e=t.nodeName)&&e.includes("-")&&(globalThis.customElements.upgrade(t),i="observedAttributes"in t.constructor?t.constructor.observedAttributes:void 0),Array.isArray(i)?i.filter((t=>I.includes(t))):[]},Yt=document.createElement("template");var Kt,te,ee,ie,ne,se,re,oe,ae,le;Yt.innerHTML="\n  <style>\n    :host {\n      position: relative;\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n  </style>\n";class he extends G{constructor(){var t;super(),b(this,re),b(this,Kt),b(this,te),b(this,ee),b(this,ie,null),b(this,ne,(t=>{t.composedPath().includes(this)||S(this,re,le).call(this)})),b(this,se,(()=>{S(this,re,le).call(this)})),null==(t=this.shadowRoot)||t.appendChild(Yt.content.cloneNode(!0))}connectedCallback(){var t,e,i,n;super.connectedCallback(),this.setAttribute("role","button"),this.setAttribute("aria-haspopup","listbox");const s=null!=(t=this.getAttribute("list-position"))?t:"top";null==(e=v(this,te))||e.setAttribute("list-position",s);const r=this.getRootNode(),o=[...null!=(n=null==(i=this.shadowRoot)?void 0:i.querySelectorAll(":not(:defined)"))?n:[]].map((t=>customElements.whenDefined(t.localName)));Promise.all(o).then((()=>{var t;(r instanceof Document||r instanceof ShadowRoot)&&(w(this,ie,r.querySelector("vindral-controller")),null==(t=v(this,ie))||t.connectListener(this))}))}set button(t){w(this,Kt,t)}set listbox(t){w(this,te,t)}set listboxSlot(t){w(this,ee,t)}enable(){super.enable(),this.addEventListener("change",v(this,se)),document.addEventListener("click",v(this,ne))}handleClick(t){v(this,ee)&&!t.composedPath().includes(v(this,ee))&&S(this,re,oe).call(this)}}Kt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ne=new WeakMap,se=new WeakMap,re=new WeakSet,oe=function(){var t;null!=(t=v(this,ee))&&t.hidden?S(this,re,ae).call(this):S(this,re,le).call(this)},ae=function(){var t,e,i;null!=(t=v(this,ee))&&t.hidden&&(v(this,ee).hidden=!1,null==(e=v(this,Kt))||e.setAttribute("aria-expanded","true"),null==(i=v(this,te))||i.focus(),this.dispatchEvent(new CustomEvent(R.LOCK_UI,{bubbles:!0,composed:!0})))},le=function(){var t,e;!v(this,ee)||null!=(t=v(this,ee))&&t.hidden||(v(this,ee).hidden=!0,null==(e=v(this,Kt))||e.setAttribute("aria-expanded","false"),this.dispatchEvent(new CustomEvent(R.UNLOCK_UI,{bubbles:!0,composed:!0})))};const ce=document.createElement("template");var de,ue,me,pe,Ae,ge,fe,ve,be,we,Se,ye,Ee,ke,Ce,Te,xe,Ie,Re,Le,Pe,Me,Be,_e,Ue,Ne,De,Fe,Oe,We,Ge,ze,He,Ve,Xe,Qe,je,qe,Ze,$e,Je,Ye,Ke,ti;ce.innerHTML=`\n  <style>\n    :host {\n      --fg-strong: var(--vindral-fg-strong, #eeeeee);\n      --fg-subtle: var(--vindral-fg-subtle, #b4b4b4);\n      --fg-extra-subtle: var(--vindral-fg-extra-subtle, #7b7b7b);\n\n      --bg-strong: var(--vindral-bg-strong, #111111);\n      --bg-subtle: var(--vindral-bg-subtle, #191919);\n      --bg-extra-subtle: var(--vindral-bg-extra-subtle, #222222);\n\n      --bg-component: var(--vindral-bg-component, #222222);\n      --bg-component-hover: var(--vindral-bg-component-hover, #2a2a2a);\n      --bg-component-active: var(--vindral-bg-component-active, #313131);\n\n      --padding-1: var(--vindral-padding-1, 4px);\n      --padding-2: var(--vindral-padding-2, 8px);\n      --padding-3: var(--vindral-padding-3, 16px);\n      --padding-4: var(--vindral-padding-4, 24px);\n      --padding-5: var(--vindral-padding-5, 32px);\n\n      --control-padding: var(--vindral-control-padding, var(--padding-1));\n\n      --button-padding: var(--vindral-button-padding, var(--padding-2));\n\n      --ui-font: var(\n        --vindral-ui-font,\n        -apple-system,\n        BlinkMacSystemFont,\n        "Segoe UI",\n        Roboto,\n        "Helvetica Neue",\n        Arial,\n        sans-serif\n      );\n      --ui-display: var(--vindral-ui-display, flex);\n\n      --play-button-display: var(--vindral-play-button-display, flex);\n      --mute-button-display: var(--vindral-mute-button-display, flex);\n      --airplay-button-display: var(--vindral-airplay-button-display, flex);\n      --pip-button-display: var(--vindral-pip-button-display, flex);\n      --fullscreen-button-display: var(--vindral-fullscreen-button-display, flex);\n      --cast-button-display: var(--vindral-cast-button-display, flex);\n      --grid-button-display: var(--vindral-grid-button-display, flex);\n      --grid-item-offline-display: var(--vindral-grid-item-offline-display, flex);\n      --volume-range-display: var(--vindral-volume-range-display, flex);\n      --rendition-menu-display: var(--vindral-rendition-menu-display, flex);\n      --language-menu-display: var(--vindral-language-menu-display, flex);\n      --play-overlay-display: var(--vindral-play-overlay-display, flex);\n      --buffering-overlay-display: var(--vindral-buffering-overlay-display, flex);\n\n      position: relative;\n      display: flex;\n      background-color: var(--bg-strong);\n      width: 100%;\n      container-type: inline-size;\n      overflow: hidden;\n      font-family: var(--ui-font);\n    }\n\n    #ui {\n      position: absolute;\n      display: flex;\n      justify-content: space-between;\n      flex-direction: column;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      transition: opacity 0.5s;\n      user-select: none;\n      pointer-events: auto;\n\n      // Ensure the #ui element is above the video element on Safari\n      z-index: 1;\n    }\n\n    #ui > * {\n      pointer-events: auto;\n      display: var(--ui-display);\n    }\n\n    #video {\n      cursor: none;\n      display: flex;\n      width: 100%;\n      z-index: 0;\n    }\n\n    #video > canvas {\n      object-fit: contain;\n    }\n\n    slot#middle {\n      align-items: center;\n      justify-content: center;\n      flex-grow: 1;\n    }\n\n    slot#top-bar {\n      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0));\n      padding: var(--control-padding);\n    }\n\n    slot#bottom-bar {\n      padding: var(--control-padding);\n      background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.8));\n    }\n\n    :host(\n        :not([${x.USER_INTERACTING}]\n        ):not([${x.PAUSED}]\n        ):not([${x.IS_CASTING}]\n        ):not([${x.MEDIA}="audio"])\n      )\n      #ui {\n      opacity: 0;\n      cursor: none;\n      pointer-events: none;\n    }\n\n    :host(\n      :not([${x.USER_INTERACTING}]\n      ):not([${x.PAUSED}]\n      ):not([${x.IS_CASTING}]\n      ):not([${x.MEDIA}="audio"])\n    )\n    #ui > * {\n      pointer-events: none;\n    }\n\n    :host([${x.FULLSCREEN}][${x.FULLSCREEN_FALLBACK}]) {\n      position: fixed !important;\n      inset: 0 !important;\n      margin: 0 !important;\n      box-sizing: border-box !important;\n      min-width: 0 !important;\n      max-width: none !important;\n      min-height: 0 !important;\n      max-height: none !important;\n      width: 100% !important;\n      height: 100% !important;\n      transform: none !important;\n      z-index: 1000 !important;\n      background: black;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n\n      /* intentionally not !important */\n      object-fit: contain;\n    }\n\n    :host([${x.MEDIA}="audio"]) {\n      min-height: 100px;\n      overflow: visible;\n    }\n  </style>\n\n  <div id="video"></div>\n\n  <slot id="overlay" name="overlay"></slot>\n\n  <div id="ui">\n    <slot id="top-bar" name="top-bar"></slot>\n    <slot id="middle" name="middle"></slot>\n    <slot id="bottom-bar"></slot>\n    <slot id="overlay-interactive" name="overlay-interactive"></slot>\n  </div>\n`;const ei=class t extends HTMLElement{constructor(){super(),b(this,Ie),b(this,ue,new Map),b(this,me,2e3),b(this,pe,null),b(this,Ae,null),b(this,ge),b(this,fe,v(t,de)),b(this,ve),b(this,be),b(this,we),b(this,Se),b(this,ye),b(this,Ee),b(this,ke),b(this,Ce),b(this,Te),b(this,xe),b(this,Ne,0),g(this,"handleEvent",(t=>{switch(t.type){case"pointerdown":w(this,Ne,t.timeStamp);break;case"pointermove":S(this,Ie,De).call(this,t);break;case"pointerup":S(this,Ie,Fe).call(this,t);break;case"mouseleave":S(this,Ie,Xe).call(this);break;case"dblclick":S(this,Ie,Oe).call(this,t);break;case"mousemove":S(this,Ie,We).call(this,t)}})),b(this,Ge,(t=>{var e;if(v(this,ge)&&(v(this,xe).debug("Vindral event",{type:t.type}),t instanceof CustomEvent))switch(t.type){case R.PLAY:this.removeAttribute(x.PAUSED);break;case R.PAUSE:this.setAttribute(x.PAUSED,"");break;case R.MUTE:this.setAttribute(x.MUTED,"");break;case R.UNMUTE:this.removeAttribute(x.MUTED);break;case R.LOCK_UI:this.setAttribute(x.UI_LOCKED,"");break;case R.UNLOCK_UI:this.removeAttribute(x.UI_LOCKED);break;case R.ENTER_FULLSCREEN:this.setAttribute(x.FULLSCREEN,"");break;case R.EXIT_FULLSCREEN:this.removeAttribute(x.FULLSCREEN);break;case R.SET_RENDITION:{const e=t.detail;e.audio&&(v(this,ge).maxAudioBitRate=e.audio.bitRate),e.video&&(v(this,ge).maxVideoBitRate=e.video.bitRate,v(this,ge).maxSize=e.video,this.setAttribute(x.MAX_VIDEO_BITRATE,String(e.video.bitRate)))}break;case R.CHANNEL_GRID_OPENED:S(this,Ie,ze).call(this);break;case R.ENTER_PIP:this.setAttribute(x.PICTURE_IN_PICTURE,"");break;case R.EXIT_PIP:this.removeAttribute(x.PICTURE_IN_PICTURE);break;case R.REQUEST_AIRPLAY:null==(e=v(this,Ee))||e.showPlaybackTargetPicker();break;case R.SET_LANGUAGE:_(t.detail)?this.setAttribute(x.LANGUAGE,t.detail):this.removeAttribute(x.LANGUAGE);break;case R.SET_TEXT_TRACK:_(t.detail)?this.setAttribute(x.TEXT_TRACK,t.detail):this.removeAttribute(x.TEXT_TRACK);break;case R.REQUEST_USER_INPUT:S(this,Ie,ti).call(this,x.NEEDS_USER_INPUT),v(this,ge).play();break;case R.SET_VOLUME:{const e=t.detail;v(this,ge).muted&&e>0?v(this,ge).muted=!1:0===e&&(v(this,ge).muted=!0),this.setAttribute(x.VOLUME,e.toString())}}})),b(this,$e,(()=>{var t,e,i;if(!("orientation"in screen)||!screen.orientation.lock)return;const n=null==(t=v(this,ge))?void 0:t.currentRenditionLevel;null!=n&&n.video&&screen.orientation.lock((null==(e=null==n?void 0:n.video)?void 0:e.width)>(null==(i=null==n?void 0:n.video)?void 0:i.height)?"landscape-primary":"portrait-primary").catch((()=>{}))})),b(this,Je,(()=>{!("orientation"in screen)||!screen.orientation.unlock||screen.orientation.unlock()})),this.attachShadow({mode:"open"}).appendChild(ce.content.cloneNode(!0));const e=P(this.getAttribute("log-level"));w(this,xe,r.L.get().createContext("VindralController")),v(this,xe).setLevel(e)}connectedCallback(){return E(this,null,(function*(){U(this.getAttribute("auto-instance-enabled"),!0)&&(yield S(this,Ie,Re).call(this));for(const t of Object.values(R))this.addEventListener(t,v(this,Ge));window.PointerEvent?(this.addEventListener("pointerdown",this),this.addEventListener("pointermove",this),this.addEventListener("pointerup",this)):this.addEventListener("mousemove",this),this.addEventListener("mouseleave",this),this.addEventListener("keyup",this),this.addEventListener("resize",this),this.addEventListener("dblclick",this),this.connectListener(this)}))}disconnectedCallback(){var t,e,i;null==(t=v(this,ge))||t.unload(),null==(e=v(this,Se))||e.unload(),null==(i=v(this,ye))||i.unload();for(const t of Object.values(R))this.removeEventListener(t,v(this,Ge));this.disconnectListener(this)}attributeChangedCallback(t,e,i){var n,s,r,o,a,l,h,c;if(e!=i)switch(v(this,xe).debug("Attribute changed",{name:t,oldValue:e,newValue:i}),t){case"channel-id":w(this,ve,i),v(this,ge)&&i&&(v(this,ge).channelId=i,v(this,ge).play(),S(this,Ie,Ke).call(this,x.BUFFERING,""),S(this,Ie,Ke).call(this,x.CHANNEL_ID,i));break;case"channel-group-id":w(this,be,i);break;case"url":i&&w(this,fe,i);break;case"paused":_(i)?null==(n=v(this,ge))||n.pause():null==(s=v(this,ge))||s.play();break;case"target-buffer-time":if(v(this,ge)&&i){const t=parseInt(i,10);Number.isNaN(t)||(v(this,ge).targetBufferTime=t)}break;case"user-interacting":_(i)?S(this,Ie,Ke).call(this,x.USER_INTERACTING,""):S(this,Ie,ti).call(this,x.USER_INTERACTING);break;case"muted":v(this,ge)&&(_(i)?(v(this,ge).muted=!0,S(this,Ie,Ke).call(this,x.MUTED,"")):(v(this,ge).muted=!1,S(this,Ie,ti).call(this,x.MUTED),0===v(this,ge).volume&&(v(this,ge).volume=.3)));break;case"ui-locked":_(i)?S(this,Ie,Ve).call(this):S(this,Ie,Xe).call(this);break;case"is-fullscreen":_(i)?S(this,Ie,qe).call(this):S(this,Ie,Ze).call(this);break;case"max-video-bit-rate":w(this,we,i),_(i)?S(this,Ie,Ke).call(this,x.MAX_VIDEO_BITRATE,i):S(this,Ie,ti).call(this,x.MAX_VIDEO_BITRATE);break;case"picture-in-picture":_(i)?S(this,Ie,Qe).call(this):S(this,Ie,je).call(this);break;case"is-airplaying":_(i)?(null!=(r=v(this,ge))&&r.mediaElement&&(v(this,ge).mediaElement.style.display="hidden"),null==(o=v(this,ge))||o.pause()):null!=(a=v(this,ge))&&a.mediaElement&&(v(this,ge).mediaElement.style.display="block");break;case"is-casting":_(i)?(null!=(l=v(this,ye))&&l.isFullscreen()&&S(this,Ie,Ze).call(this),null==(h=v(this,ge))||h.pause()):document.hidden||null==(c=v(this,ge))||c.play();break;case"cast-receiver-id":w(this,Ce,i);break;case"cast-background":w(this,Te,i);break;case"language":v(this,ge)&&(v(this,ge).language=i,_(i)?S(this,Ie,Ke).call(this,x.LANGUAGE,i):S(this,Ie,ti).call(this,x.LANGUAGE));break;case"text-track":v(this,ge)&&(v(this,ge).textTrack=i,_(i)?S(this,Ie,Ke).call(this,x.TEXT_TRACK,i):S(this,Ie,ti).call(this,x.TEXT_TRACK));break;case"log-level":_(i)&&v(this,xe).setLevel(P(i));break;case"authentication-token":_(i)?S(this,Ie,Ke).call(this,x.AUTHENTICATION_TOKEN,i):S(this,Ie,ti).call(this,x.AUTHENTICATION_TOKEN);break;case"volume":if(v(this,ge)&&_(i)){const t=parseFloat(i);v(this,ge).volume=t}}}connectListener(t){Jt(t).forEach((e=>{var i,n;const s=v(this,ue).get(e);switch(s?s.push(t):v(this,ue).set(e,[t]),e){case x.PAUSED:("paused"===(null==(i=v(this,ge))?void 0:i.playbackState)||this.hasAttribute(x.PAUSED))&&t.setAttribute(x.PAUSED,"");break;case x.MUTED:(null!=(n=v(this,ge))&&n.muted||this.hasAttribute(x.MUTED))&&t.setAttribute(x.MUTED,"");break;case x.MAX_VIDEO_BITRATE:v(this,we)&&t.setAttribute(x.MAX_VIDEO_BITRATE,v(this,we));break;case x.CHANNEL_ID:v(this,ve)&&t.setAttribute(x.CHANNEL_ID,v(this,ve));break;case x.CHANNEL_GROUP_ID:v(this,be)&&t.setAttribute(x.CHANNEL_GROUP_ID,v(this,be));break;case x.AUTHENTICATION_TOKEN:{const e=this.getAttribute("authentication-token");e&&t.setAttribute(x.AUTHENTICATION_TOKEN,e);break}}}))}disconnectListener(t){Jt(t).forEach((e=>{const i=v(this,ue).get(e);i&&v(this,ue).set(e,i.filter((e=>e!=t)))}))}get instance(){return v(this,ge)}connect(){S(this,Ie,Re).call(this)}};de=new WeakMap,ue=new WeakMap,me=new WeakMap,pe=new WeakMap,Ae=new WeakMap,ge=new WeakMap,fe=new WeakMap,ve=new WeakMap,be=new WeakMap,we=new WeakMap,Se=new WeakMap,ye=new WeakMap,Ee=new WeakMap,ke=new WeakMap,Ce=new WeakMap,Te=new WeakMap,xe=new WeakMap,Ie=new WeakSet,Re=function(){return E(this,null,(function*(){var t,e;if(!v(this,ve))return;yield null==(t=v(this,ge))?void 0:t.unload();const i=this.hasAttribute(x.PAUSED),n=this.hasAttribute(x.MUTED),s=L(this.getAttribute(x.MEDIA)),o=this.getAttribute(x.TEXT_TRACK)||void 0,a=this.getAttribute("edge-url")||void 0,l=this.getAttribute("authentication-token")||void 0,h=B(this.getAttribute("max-video-bit-rate")),c=function(t){if(null!==t)try{const e=JSON.parse(t);if("object"==typeof e&&null!==e){const t=e;if("number"==typeof t.width&&"number"==typeof t.height)return t}}catch(t){return}}(this.getAttribute("max-size")),d=B(this.getAttribute("min-buffer-time")),u=B(this.getAttribute("max-buffer-time")),m=U(this.getAttribute("burst-enabled")),p=U(this.getAttribute("mse-enabled")),A=U(this.getAttribute("mse-opus-enabled")),g=U(this.getAttribute("ios-background-play-enabled")),f=U(this.getAttribute("ios-wake-lock-enabled")),b=U(this.getAttribute("ios-media-element-enabled")),y=U(this.getAttribute("abr-enabled")),E=U(this.getAttribute("size-based-resolution-cap-enabled")),k=U(this.getAttribute("telemetry-enabled")),C=function(t){if(null!==t)return t.split(",").map((t=>t.trim()))}(this.getAttribute("video-codecs")),T=M(this.getAttribute("poster"));w(this,ge,new r.V({url:v(this,fe),channelId:v(this,ve),channelGroupId:v(this,be),edgeUrl:a,authenticationToken:l,muted:n,media:s,maxSize:c,maxVideoBitRate:h,minBufferTime:d,maxBufferTime:u,burstEnabled:m,mseEnabled:p,mseOpusEnabled:A,iosBackgroundPlayEnabled:g,iosWakeLockEnabled:f,iosMediaElementEnabled:b,abrEnabled:y,sizeBasedResolutionCapEnabled:E,telemetryEnabled:k,videoCodecs:C,poster:T,textTrack:o})),v(this,ge).on("rendition levels",(t=>{const e=t.filter((t=>{var e;return null==(e=t.video)?void 0:e.width}));S(this,Ie,Ke).call(this,x.RENDITION_LEVELS,JSON.stringify(e))})),v(this,ge).on("rendition level",(t=>{S(this,Ie,Ke).call(this,x.RENDITION_LEVEL,JSON.stringify(t))})),v(this,ge).on("playback state",(t=>{switch(t){case"playing":S(this,Ie,ti).call(this,x.PAUSED),S(this,Ie,ti).call(this,x.BUFFERING);break;case"paused":S(this,Ie,Ke).call(this,x.PAUSED,""),S(this,Ie,ti).call(this,x.BUFFERING);break;case"buffering":S(this,Ie,ti).call(this,x.PAUSED),S(this,Ie,Ke).call(this,x.BUFFERING,"")}})),v(this,ge).on("volume state",(t=>{S(this,Ie,Ke).call(this,x.VOLUME,t.volume.toString()),t.isMuted?S(this,Ie,Ke).call(this,x.MUTED,""):S(this,Ie,ti).call(this,x.MUTED)})),v(this,ge).on("channel switch",(()=>{var t;"buffering"!==(null==(t=v(this,ge))?void 0:t.playbackState)&&S(this,Ie,ti).call(this,x.BUFFERING)})),v(this,ge).on("channels",(t=>{S(this,Ie,Ke).call(this,x.CHANNELS,JSON.stringify(t))})),v(this,ge).on("languages",(t=>{var e;S(this,Ie,Ke).call(this,x.LANGUAGES,JSON.stringify(t)),null!=(e=v(this,ge))&&e.language&&S(this,Ie,Ke).call(this,x.LANGUAGE,v(this,ge).language)})),v(this,ge).on("text tracks",(t=>{var e,i,n;S(this,Ie,Ke).call(this,x.TEXT_TRACKS,JSON.stringify(t)),null!=(e=v(this,ge))&&e.textTrack&&S(this,Ie,Ke).call(this,x.TEXT_TRACK,null!=(n=null==(i=v(this,ge))?void 0:i.textTrack)?n:"")})),v(this,ge).on("needs user input",(()=>{S(this,Ie,Ke).call(this,x.NEEDS_USER_INPUT,"")})),w(this,Ae,null==(e=this.shadowRoot)?void 0:e.querySelector("#video")),v(this,Ae)&&v(this,ge).attach(v(this,Ae)),this.setAttribute(x.MEDIA,v(this,ge).media),v(this,ge).muted&&S(this,Ie,Ke).call(this,x.MUTED,""),S(this,Ie,Ke).call(this,x.VOLUME,v(this,ge).volume.toString());const I=U(this.getAttribute(x.AIRPLAY_ENABLED),!1),R=U(this.getAttribute(x.CAST_ENABLED),!0),P=U(this.getAttribute(x.FULLSCREEN_ENABLED),!0),_=U(this.getAttribute(x.PIP_ENABLED),!0);I&&S(this,Ie,Ue).call(this,v(this,ge)),R&&S(this,Ie,Me).call(this,v(this,ge)),P&&S(this,Ie,Pe).call(this,v(this,ge)),_&&S(this,Ie,Le).call(this,v(this,ge)),i||v(this,ge).play(),this.dispatchEvent(new CustomEvent("vindral-instance-ready",{bubbles:!0,composed:!0,detail:v(this,ge)}))}))},Le=function(t){t.mediaElement instanceof HTMLVideoElement&&(w(this,Se,new $t(t.mediaElement)),v(this,Se).on("on picture in picture change",(t=>{t?S(this,Ie,Ke).call(this,x.PICTURE_IN_PICTURE,""):S(this,Ie,ti).call(this,x.PICTURE_IN_PICTURE)})))},Pe=function(t){const e=!Wt.isFullscreenApiSupported(this)&&Wt.isFullscreenApiSupported(t.mediaElement)?t.mediaElement:this;w(this,ye,new Wt(e)),v(this,ye).on("on fullscreen change",(t=>{t?S(this,Ie,Ke).call(this,x.FULLSCREEN,""):S(this,Ie,ti).call(this,x.FULLSCREEN)}))},Me=function(t){w(this,ke,new c({background:v(this,Te),receiverApplicationId:v(this,Ce),options:t.getCastOptions()})),v(this,ke).init().then((()=>{var t,e,i;S(this,Ie,Ke).call(this,x.CAST_AVAILABLE,""),null==(t=v(this,ke))||t.on("connected",S(this,Ie,Be).bind(this)),null==(e=v(this,ke))||e.on("resumed",S(this,Ie,Be).bind(this)),null==(i=v(this,ke))||i.on("disconnected",S(this,Ie,_e).bind(this))})).catch((t=>{v(this,xe).warn("Failed to initialize CastSender",t)}))},Be=function(){var t,e;S(this,Ie,Ke).call(this,x.IS_CASTING,"");const i=null!=(e=null==(t=v(this,ke))?void 0:t.getReceiverName())?e:"device";S(this,Ie,Ke).call(this,x.CAST_RECEIVER_NAME,i)},_e=function(){S(this,Ie,ti).call(this,x.IS_CASTING),S(this,Ie,ti).call(this,x.CAST_RECEIVER_NAME)},Ue=function(t){const e=t.getCastOptions();w(this,Ee,new Ft({url:e.url,channelId:e.channelId,authenticationToken:e.authenticationToken,container:this})),v(this,Ee).once("available",(()=>{S(this,Ie,Ke).call(this,x.AIRPLAY_AVAILABLE,"")})),v(this,Ee).on("connected",(()=>{S(this,Ie,Ke).call(this,x.IS_AIRPLAYING,"")})),v(this,Ee).on("disconnected",(()=>{S(this,Ie,ti).call(this,x.IS_AIRPLAYING)}))},Ne=new WeakMap,De=function(t){"mouse"!==t.pointerType&&t.timeStamp-v(this,Ne)<250||(S(this,Ie,Ve).call(this),v(this,pe)&&clearTimeout(v(this,pe)),t.target instanceof HTMLElement&&([this,v(this,Ae)].includes(t.target)||"vindral-scroll-overlay"===t.target.localName)&&S(this,Ie,Xe).call(this))},Fe=function(t){const e=this.hasAttribute(x.USER_INTERACTING);"touch"===t.pointerType&&t.target instanceof HTMLElement?[this,v(this,Ae)].includes(t.target)&&e?S(this,Ie,He).call(this):S(this,Ie,Xe).call(this):t.composedPath().some((t=>t instanceof HTMLElement&&["vindral-play-button"].includes(null==t?void 0:t.localName)))&&S(this,Ie,Xe).call(this)},Oe=function(t){!v(this,ye)||t.target instanceof G||t.target instanceof he||(this.hasAttribute(x.FULLSCREEN)?this.removeAttribute(x.FULLSCREEN):this.setAttribute(x.FULLSCREEN,""))},We=function(t){this.hasAttribute(x.USER_INTERACTING)||S(this,Ie,Xe).call(this)},Ge=new WeakMap,ze=function(){return E(this,null,(function*(){if(!v(this,ge)||!v(this,be))return;const t=yield v(this,ge).getApiClient().getChannels(v(this,be));S(this,Ie,Ke).call(this,x.CHANNELS,JSON.stringify(t))}))},He=function(){!this.hasAttribute(x.USER_INTERACTING)||this.hasAttribute(x.UI_LOCKED)||(this.dispatchEvent(new CustomEvent("user-interacting",{bubbles:!0,composed:!0,detail:{active:!1}})),this.removeAttribute(x.USER_INTERACTING))},Ve=function(){this.hasAttribute(x.USER_INTERACTING)||requestAnimationFrame((()=>{this.setAttribute(x.USER_INTERACTING,""),this.dispatchEvent(new CustomEvent("user-interacting",{bubbles:!0,composed:!0,detail:{active:!0}}))}))},Xe=function(){S(this,Ie,Ve).call(this),v(this,pe)&&clearTimeout(v(this,pe)),v(this,me)&&w(this,pe,self.setTimeout((()=>{S(this,Ie,He).call(this)}),v(this,me)))},Qe=function(){var t;S(this,Ie,Ye).call(this),null==(t=v(this,Se))||t.request().catch((t=>{v(this,xe).warn("Failed to enter picture in picture:",t)}))},je=function(){var t;null==(t=v(this,Se))||t.exit().catch((t=>{v(this,xe).warn("Failed to exit picture in picture:",t)}))},qe=function(){var t,e;null!=(t=v(this,ye))&&t.isFullscreenApiSupported()?(S(this,Ie,Ye).call(this),null==(e=v(this,ye))||e.request().then((()=>{v(this,$e).call(this)})).catch((t=>{v(this,xe).warn("Failed to enter fullscreen:",t)}))):(this.setAttribute(x.FULLSCREEN_FALLBACK,""),S(this,Ie,Ke).call(this,x.FULLSCREEN,""))},Ze=function(){var t,e;null!=(t=v(this,ye))&&t.isFullscreenApiSupported()?null==(e=v(this,ye))||e.exit().then((()=>{v(this,Je).call(this)})).catch((t=>{v(this,xe).warn("Failed to exit fullscreen:",t)})):(this.removeAttribute(x.FULLSCREEN_FALLBACK),S(this,Ie,ti).call(this,x.FULLSCREEN))},$e=new WeakMap,Je=new WeakMap,Ye=function(){v(this,ge)&&v(this,ge).emitter.emit("ios-hack: reset size")},Ke=function(t,e){var i;null==(i=v(this,ue).get(t))||i.forEach((i=>i.setAttribute(t,e)))},ti=function(t){var e;null==(e=v(this,ue).get(t))||e.forEach((e=>e.removeAttribute(t)))},g(ei,"observedAttributes",[...I,"url","edge-url","target-buffer-time","cast-receiver-id","cast-background","log-level","max-size","min-buffer-time","max-buffer-time","max-audio-bit-rate","burst-enabled","mse-enabled","mse-opus-enabled","ios-background-play-enabled","ios-wake-lock-enabled","ios-media-element-enabled","abr-enabled","size-based-resolution-cap-enabled","telemetry-enabled","video-codecs","poster","auto-instance-enabled"]),b(ei,de,"https://lb.cdn.vindral.com");let ii=ei;const ni=document.createElement("template");ni.innerHTML=`\n  <style>\n    :host {\n      display: var(--fullscreen-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([${x.FULLSCREEN}]) slot[name="enter"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.FULLSCREEN}])) slot[name="exit"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="enter">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-maximize"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 8v-2a2 2 0 0 1 2 -2h2" /><path d="M4 16v2a2 2 0 0 0 2 2h2" /><path d="M16 4h2a2 2 0 0 1 2 2v2" /><path d="M16 20h2a2 2 0 0 0 2 -2v-2" /></svg>\n</slot>\n    <slot name="exit">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-minimize"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 19v-2a2 2 0 0 1 2 -2h2" /><path d="M15 5v2a2 2 0 0 0 2 2h2" /><path d="M5 15h2a2 2 0 0 1 2 2v2" /><path d="M5 9h2a2 2 0 0 0 2 -2v-2" /></svg>\n</slot>\n  </slot>\n`;const si=class extends G{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(ni.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.isFullscreen?"Exit fullscreen":"Enter fullscreen")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.FULLSCREEN&&this.setAttribute("aria-label",this.isFullscreen?"Exit fullscreen":"Enter fullscreen")}set isFullscreen(t){t?this.setAttribute(x.FULLSCREEN,""):this.removeAttribute(x.FULLSCREEN)}get isFullscreen(){return this.hasAttribute(x.FULLSCREEN)}handleClick(t){const e=this.isFullscreen?R.EXIT_FULLSCREEN:R.ENTER_FULLSCREEN;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};g(si,"observedAttributes",[...y(si,si,"observedAttributes"),x.FULLSCREEN]);let ri=si;const oi=document.createElement("template");var ai,li;oi.innerHTML='\n  <style>\n    :host(:not([hidden])) {\n      display: var(--language-menu-display);\n    }\n  </style>\n\n  <slot name="button">\n    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7" /><path d="M9 3v2c0 4.418 -2.239 8 -5 8" /><path d="M5 9c0 2.144 2.952 3.908 6.7 4" /><path d="M12 20l4 -9l4 9" /><path d="M19.1 18h-6.2" /></svg>\n</slot>\n  <slot name="listbox" hidden>\n    <vindral-language-menu-list id="listbox" part="listbox"></vindral-language-menu-list>\n  </slot>\n';const hi=class extends he{constructor(){var t,e,i,n;super(),b(this,ai),null==(t=this.shadowRoot)||t.appendChild(oi.content.cloneNode(!0)),this.button=null==(e=this.shadowRoot)?void 0:e.querySelector("slot[name=button]"),this.listbox=null==(i=this.shadowRoot)?void 0:i.querySelector("[part=listbox]"),this.listboxSlot=null==(n=this.shadowRoot)?void 0:n.querySelector("slot[name=listbox]")}connectedCallback(){super.connectedCallback(),S(this,ai,li).call(this)}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),(t===x.LANGUAGES||t===x.TEXT_TRACKS)&&S(this,ai,li).call(this)}};ai=new WeakSet,li=function(){const t=this.getAttribute(x.LANGUAGES),e=this.getAttribute(x.TEXT_TRACKS);t&&"[]"!==t||e&&"[]"!==e?this.removeAttribute("hidden"):this.setAttribute("hidden","")},g(hi,"observedAttributes",[...y(hi,hi,"observedAttributes"),x.LANGUAGES,x.TEXT_TRACKS]);let ci=hi;const di=document.createElement("template");var ui,mi,pi,Ai,gi,fi,vi,bi,wi,Si,yi,Ei,ki,Ci,Ti,xi,Ii,Ri;di.innerHTML=`\n  <style>\n    :host {\n      font: inherit;\n      cursor: default;\n      padding: var(--padding-2);\n      padding-top: var(--padding-3);\n      border-radius: 0.25em;\n      position: absolute;\n      min-width: 140px;\n      background: var(--bg-subtle);\n      z-index: 1;\n      overflow: auto;\n      display: flex;\n      flex-direction: row;\n      gap: var(--padding-3);\n    }\n\n    :host([list-position="top"]) {\n      bottom: calc(100% + 0.5em);\n      transform: translate(-50%);\n    }\n\n    :host([list-position="bottom"]) {\n      top: calc(100% + 0.5em);\n    }\n\n    :host::-webkit-scrollbar {\n      width: 5px;\n      padding-right: 5px;\n    }\n\n    :host::-webkit-scrollbar-thumb {\n      background-color: var(--fg-extra-subtle);\n      border-radius: 10px;\n      border: 0;\n    }\n\n    :host::-webkit-scrollbar-track {\n      border-radius: 10px;\n      background-color: transparent;\n    }\n\n    .menu {\n      display: grid;\n      gap: var(--padding-1);\n    }\n\n    .menu-container {\n      display: flex;\n      flex-direction: column;\n      flex: 1;\n    }\n\n    [role="menuitem"] {\n      position: relative;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      height: 44px;\n      padding: 0 var(--padding-3);\n      border-radius: 4px;\n      font-size: 14px;\n      text-transform: capitalize;\n    }\n\n    [role="menuitem"]:hover {\n      background: var(--bg-component-hover);\n    }\n\n    [role="menuitem"][aria-selected="true"] {\n      background: var(--bg-component-active);\n    }\n\n    [role="menuitem"][aria-selected="true"]::before {\n      content: url("data:image/svg+xml,${encodeURIComponent('\n  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="#fff" viewBox="0 0 78.369 78.369" xml:space="preserve"><path d="M78.049 19.015 29.458 67.606a1.094 1.094 0 0 1-1.548 0L.32 40.015a1.094 1.094 0 0 1 0-1.547l6.704-6.704a1.095 1.095 0 0 1 1.548 0l20.113 20.112 41.113-41.113a1.095 1.095 0 0 1 1.548 0l6.703 6.704a1.094 1.094 0 0 1 0 1.548z"/></svg>\n')}");\n      position: absolute;\n      left: var(--padding-3);\n      top: calc(50% - 8px);\n    }\n\n    .heading {\n      text-transform: uppercase;\n      margin-bottom: var(--padding-2);\n      padding: 0 var(--padding-3);\n      font-size: 11px;\n      font-weight: bold;\n    }\n\n    :host([${x.LANGUAGES}="[]"]) #languages,\n    :host(:not([${x.LANGUAGES}])) #languages {\n      display: none;\n    }\n\n    :host([${x.TEXT_TRACKS}="[]"]) #text-tracks,\n    :host(:not([${x.TEXT_TRACKS}])) #text-tracks {\n      display: none;\n    }\n  </style>\n\n  <div id="languages" class="menu-container">\n    <div class="heading">Language</div>\n    <div class="menu"></div>\n  </div>\n  <div id="text-tracks" class="menu-container">\n    <div class="heading">Subtitles</div>\n    <div class="menu"></div>\n  </div>\n`;class Li extends HTMLElement{constructor(){super(),b(this,Si),b(this,ui,[]),b(this,mi,[]),b(this,pi),b(this,Ai),b(this,gi,[]),b(this,fi,[]),b(this,vi,null),b(this,bi,null),b(this,wi,null),this.attachShadow({mode:"open"}).appendChild(di.content.cloneNode(!0))}connectedCallback(){var t,e,i;const n=this.getRootNode();n instanceof ShadowRoot&&(w(this,wi,n.host.closest("vindral-controller")),null==(t=v(this,wi))||t.connectListener(this),w(this,vi,null==(e=this.shadowRoot)?void 0:e.querySelector("#languages .menu")),w(this,bi,null==(i=this.shadowRoot)?void 0:i.querySelector("#text-tracks .menu")),S(this,Si,yi).call(this),S(this,Si,Ei).call(this))}attributeChangedCallback(t,e,i){e!==i&&(t===x.LANGUAGES&&i&&(this.languages=JSON.parse(i)),t===x.TEXT_TRACKS&&i&&(this.textTracks=JSON.parse(i)),t===x.LANGUAGE&&(this.language=i),t===x.TEXT_TRACK&&(this.textTrack=i))}set languages(t){w(this,ui,t),S(this,Si,Ci).call(this),S(this,Si,xi).call(this)}set textTracks(t){w(this,mi,t),S(this,Si,ki).call(this),S(this,Si,Ii).call(this)}set language(t){w(this,pi,t),S(this,Si,xi).call(this)}set textTrack(t){w(this,Ai,t),S(this,Si,Ii).call(this)}}ui=new WeakMap,mi=new WeakMap,pi=new WeakMap,Ai=new WeakMap,gi=new WeakMap,fi=new WeakMap,vi=new WeakMap,bi=new WeakMap,wi=new WeakMap,Si=new WeakSet,yi=function(){new IntersectionObserver((t=>{t.forEach((t=>{if(1!==t.intersectionRatio)if(t.intersectionRatio>0){const e=this.offsetHeight*t.intersectionRatio-24;this.style.height=`${e}px`}else this.style.height="auto"}))}),{root:v(this,wi),threshold:0}).observe(this)},Ei=function(){v(this,vi)&&(S(this,Si,Ci).call(this),S(this,Si,xi).call(this)),v(this,bi)&&(S(this,Si,ki).call(this),S(this,Si,Ii).call(this))},ki=function(){v(this,bi).innerHTML="",w(this,fi,[]);const t=S(this,Si,Ti).call(this,"off","textTrack",void 0);v(this,bi).appendChild(t),v(this,fi).push({element:t,value:void 0}),v(this,mi).forEach((t=>{const e=S(this,Si,Ti).call(this,t,"textTrack",t);v(this,bi).appendChild(e),v(this,fi).push({element:e,value:t})})),S(this,Si,Ii).call(this)},Ci=function(){v(this,vi).innerHTML="",w(this,gi,[]),v(this,ui).forEach((t=>{const e=S(this,Si,Ti).call(this,t,"language",t);v(this,vi).appendChild(e),v(this,gi).push({element:e,value:t})})),S(this,Si,xi).call(this)},Ti=function(t,e,i){const n=document.createElement("div");return n.setAttribute("role","menuitem"),n.textContent=t,n.addEventListener("click",(()=>S(this,Si,Ri).call(this,i,e))),n},xi=function(){const t=v(this,gi).find((t=>"true"===t.element.getAttribute("aria-selected")));t&&t.element.removeAttribute("aria-selected");const e=v(this,gi).find((t=>t.value===v(this,pi)));null==e||e.element.setAttribute("aria-selected","true")},Ii=function(){const t=v(this,fi).find((t=>"true"===t.element.getAttribute("aria-selected")));t&&t.element.removeAttribute("aria-selected");const e=v(this,fi).find((t=>t.value===v(this,Ai)));if(e)e.element.setAttribute("aria-selected","true");else{const t=v(this,fi).find((t=>void 0===t.value));null==t||t.element.setAttribute("aria-selected","true")}},Ri=function(t,e){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}));const i="language"===e?R.SET_LANGUAGE:R.SET_TEXT_TRACK;this.dispatchEvent(new CustomEvent(i,{bubbles:!0,composed:!0,detail:t}))},g(Li,"observedAttributes",[x.LANGUAGES,x.TEXT_TRACKS,x.LANGUAGE,x.TEXT_TRACK]);const Pi=document.createElement("template");Pi.innerHTML=`\n  <style>\n    :host {\n      display: var(--mute-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([${x.MUTED}]) slot[name="unmute"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.MUTED}])) slot[name="mute"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="mute">\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  <g fill="none" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" />\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />\n</g></svg>\n</slot>\n    <slot name="unmute">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  <g fill="none" stroke="currentColor">\n  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>\n</slot>\n  </slot>\n`;const Mi=class extends G{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(Pi.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.muted?"UnMute":"Mute")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.MUTED&&this.setAttribute("aria-label",this.muted?"UnMute":"Mute")}set muted(t){t?this.setAttribute(x.MUTED,""):this.removeAttribute(x.MUTED)}get muted(){return this.hasAttribute(x.MUTED)}handleClick(t){const e=this.muted?R.UNMUTE:R.MUTE;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};g(Mi,"observedAttributes",[...y(Mi,Mi,"observedAttributes"),x.MUTED]);let Bi=Mi;const _i=document.createElement("template");_i.innerHTML='\n  <style>\n    :host {\n      display: var(--pip-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n  </style>\n  <slot name="icon">\n    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 4a3 3 0 0 1 3 3v4a1 1 0 0 1 -2 0v-4a1 1 0 0 0 -1 -1h-14a1 1 0 0 0 -1 1v10a1 1 0 0 0 1 1h6a1 1 0 0 1 0 2h-6a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3z" /><path d="M20 13a2 2 0 0 1 2 2v3a2 2 0 0 1 -2 2h-5a2 2 0 0 1 -2 -2v-3a2 2 0 0 1 2 -2z" /></svg>\n</slot>\n';const Ui=class extends G{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(_i.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.isPictureInPictureActive?"Exit picture in picture":"Enter picture in picture")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.PICTURE_IN_PICTURE&&this.setAttribute("aria-label",this.isPictureInPictureActive?"Exit picture in picture":"Enter picture in picture")}set isPictureInPictureActive(t){t?this.setAttribute(x.PICTURE_IN_PICTURE,""):this.removeAttribute(x.PICTURE_IN_PICTURE)}get isPictureInPictureActive(){return this.hasAttribute(x.PICTURE_IN_PICTURE)}handleClick(t){const e=this.isPictureInPictureActive?R.EXIT_PIP:R.ENTER_PIP;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};g(Ui,"observedAttributes",[...y(Ui,Ui,"observedAttributes"),x.PICTURE_IN_PICTURE]);let Ni=Ui;const Di=document.createElement("template");Di.innerHTML=`\n  <style>\n    :host {\n      display: var(--play-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([${x.PAUSED}]) slot[name="pause"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.PAUSED}])) slot[name="play"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="play">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z" /></svg>\n</slot>\n    <slot name="pause">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 4h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h2a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2z" /><path d="M17 4h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h2a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2z" /></svg>\n</slot>\n  </slot>\n`;const Fi=class extends G{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(Di.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.paused?"Play":"Pause")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.PAUSED&&this.setAttribute("aria-label",this.paused?"Play":"Pause")}set paused(t){t?this.setAttribute(x.PAUSED,""):this.removeAttribute(x.PAUSED)}get paused(){return this.hasAttribute(x.PAUSED)}handleClick(t){const e=this.paused?R.PLAY:R.PAUSE;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};g(Fi,"observedAttributes",[...y(Fi,Fi,"observedAttributes"),x.PAUSED]);let Oi=Fi;const Wi={TITLE:"title",OFFLINE:"offline"},Gi=Object.values(Wi);var zi,Hi,Vi,Xi,Qi,ji,qi,Zi,$i,Ji,Yi,Ki;class tn extends o.E{constructor(t){super(),b(this,Zi),b(this,zi),b(this,Hi),b(this,Vi,!1),b(this,Xi,!1),b(this,Qi,!0),b(this,ji,null),b(this,qi,null),w(this,Hi,t),w(this,zi,new d.A({publicEndpoint:t.url,tokenFactory:()=>t.authenticationToken}))}start(t=5e3){v(this,qi)&&clearInterval(v(this,qi)),w(this,Vi,!1),w(this,Xi,!1),S(this,Zi,Ki).call(this),S(this,Zi,$i).call(this),w(this,qi,window.setInterval((()=>{!v(this,Xi)&&!v(this,Hi).infiniteReconnect&&!v(this,ji)&&v(this,Qi)&&w(this,ji,window.setTimeout((()=>S(this,Zi,Ji).call(this)),3e5)),!v(this,Xi)&&v(this,Qi)&&S(this,Zi,$i).call(this)}),t))}stop(){S(this,Zi,Yi).call(this),v(this,qi)&&(window.clearInterval(v(this,qi)),w(this,qi,null))}}zi=new WeakMap,Hi=new WeakMap,Vi=new WeakMap,Xi=new WeakMap,Qi=new WeakMap,ji=new WeakMap,qi=new WeakMap,Zi=new WeakSet,$i=function(){return E(this,null,(function*(){var t;if(v(this,Vi))return;w(this,Vi,!0);let e="Stream is offline",i="Please stand by";try{const t=yield v(this,zi).getChannel(v(this,Hi).channelId);if(t.isLive)return w(this,Xi,!0),S(this,Zi,Ki).call(this),this.emit("live",t),void w(this,Vi,!1)}catch(n){403===n.status&&(e="Forbidden",i=null!=(t=n.message)?t:"You do not have permission to view this stream")}v(this,Qi)&&this.emit("error",{title:e,message:i}),w(this,Vi,!1)}))},Ji=function(){this.stop(),w(this,Qi,!1),this.emit("timeout")},Yi=function(){v(this,ji)&&(window.clearTimeout(v(this,ji)),w(this,ji,null))},Ki=function(){S(this,Zi,Yi).call(this),w(this,Qi,!0)};const en=new RegExp("/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/","i"),nn=navigator.userAgent.toLowerCase(),sn=`\n  <style>\n    :host {\n      container-type: inline-size;\n      position: relative;\n      overflow: hidden;\n      width: 100%;\n      display: flex;\n      justify-content: center;\n\n      --vindral-volume-range-display: ${en.test(nn)?"none":"flex"};\n      --vindral-airplay-button-display: none;\n      --vindral-play-overlay-display: none;\n      --vindral-grid-item-offline-display: none;\n    }\n\n    vindral-control-bar[slot="top-bar"] {\n      display: none;\n    }\n\n    @container (max-width: 320px) {\n      vindral-controller {\n        --vindral-volume-range-display: none;\n        --vindral-control-padding: 0px;\n        --vindral-button-padding: 4px;\n      }\n\n      vindral-control-bar[slot="top-bar"] {\n        display: block;\n      }\n\n      vindral-control-bar:not([slot="top-bar"]) vindral-rendition-levels-menu,\n      vindral-control-bar:not([slot="top-bar"]) vindral-cast-button,\n      vindral-control-bar:not([slot="top-bar"]) vindral-airplay-button {\n        display: none;\n      }\n    }\n\n    :host([${Wi.OFFLINE}]) {\n      aspect-ratio: 16 / 9;\n      vindral-controller {\n        --vindral-ui-display: none;\n      }\n    }\n\n    :host([${x.AIRPLAY_ENABLED}="false"]) {\n      --vindral-airplay-button-display: none;\n    }\n\n    :host([${x.CAST_ENABLED}="false"]) {\n      --vindral-cast-button-display: none;\n    }\n\n    :host([${x.FULLSCREEN_ENABLED}="false"]) {\n      --vindral-fullscreen-button-display: none;\n    }\n\n    :host([${x.PIP_ENABLED}="false"]) {\n      --vindral-pip-button-display: none;\n    }\n\n    :host(:not([${x.CHANNEL_GROUP_ID}])) vindral-scroll-overlay {\n      display: none;\n    }\n\n    :host([${x.MEDIA}="video"]) vindral-mute-button,\n    :host([${x.MEDIA}="video"]) vindral-volume-range {\n      display: none;\n    }\n  </style>\n`,rn=`\n  ${sn}\n\n  <vindral-controller auto-instance-enabled="false">\n    <vindral-control-bar slot="top-bar">\n      <vindral-rendition-levels-menu list-position="bottom"></vindral-rendition-levels-menu>\n      <vindral-cast-button></vindral-cast-button>\n      <vindral-airplay-button></vindral-airplay-button>\n    </vindral-control-bar>\n    <vindral-control-bar>\n      <vindral-play-button></vindral-play-button>\n      <vindral-mute-button></vindral-mute-button>\n      <vindral-volume-range></vindral-volume-range>\n      <vindral-channel-grid-button slot="right"></vindral-channel-grid-button>\n      <vindral-language-menu slot="right"></vindral-language-menu>\n      <vindral-rendition-levels-menu slot="right"></vindral-rendition-levels-menu>\n      <vindral-pip-button slot="right"></vindral-pip-button>\n      <vindral-cast-button slot="right"></vindral-cast-button>\n      <vindral-airplay-button slot="right"></vindral-airplay-button>\n      <vindral-fullscreen-button slot="right"></vindral-fullscreen-button>\n    </vindral-control-bar>\n    <vindral-scroll-overlay slot="overlay-interactive">\n      <vindral-channel-grid id="listbox" part="listbox"></vindral-channel-grid>\n    </vindral-scroll-overlay>\n    <vindral-cast-overlay slot="overlay"></vindral-cast-overlay>\n    <vindral-buffering-overlay slot="overlay"></vindral-buffering-overlay>\n    <vindral-user-input-play-overlay slot="overlay"></vindral-user-input-play-overlay>\n\n    <vindral-play-overlay id="play-overlay" slot="overlay" hidden></vindral-play-overlay>\n    <vindral-message id="vindral-message" slot="overlay" hidden></vindral-message>\n\n    <slot slot="overlay"></slot>\n  </vindral-controller>\n`,on=`\n  ${sn}\n\n  <style>\n    #control-bar {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: var(--padding-3);\n    }\n  </style>\n\n  <vindral-controller auto-instance-enabled="false">\n    <div id="control-bar" slot="middle">\n      <vindral-play-button></vindral-play-button>\n      <vindral-mute-button></vindral-mute-button>\n      <vindral-volume-range></vindral-volume-range>\n      <vindral-buffering-icon></vindral-buffering-icon>\n    </div>\n\n    <vindral-play-overlay id="play-overlay" slot="overlay" hidden></vindral-play-overlay>\n    <vindral-message id="vindral-message" slot="overlay" hidden></vindral-message>\n  </vindral-controller>\n`,an=document.createElement("template");var ln,hn,cn,dn,un,mn,pn,An,gn,fn,vn,bn;class wn extends HTMLElement{constructor(){super(),b(this,An),b(this,ln),b(this,hn),b(this,cn),b(this,dn),b(this,un),b(this,mn,(()=>{Array.from(this.attributes).forEach((t=>{var e;e=t.name,ii.observedAttributes.includes(e)&&v(this,hn).setAttribute(t.name,t.value)}))})),b(this,pn,(()=>"audio"===L(this.getAttribute(x.MEDIA))?on:rn)),w(this,ln,this.attachShadow({mode:"open"})),S(this,An,gn).call(this),w(this,hn,v(this,ln).querySelector("vindral-controller")),w(this,cn,v(this,ln).querySelector("#vindral-message")),w(this,dn,v(this,ln).querySelector("#play-overlay"))}connectedCallback(){this.setAttribute(Wi.OFFLINE,""),v(this,hn).addEventListener("vindral-instance-ready",(()=>S(this,An,vn).call(this))),S(this,An,fn).call(this)}disconnectedCallback(){var t;null==(t=v(this,un))||t.stop()}attributeChangedCallback(t,e,i){e!==i&&(t===x.MEDIA?S(this,An,gn).call(this):v(this,mn).call(this))}get instance(){return v(this,hn).instance}}ln=new WeakMap,hn=new WeakMap,cn=new WeakMap,dn=new WeakMap,un=new WeakMap,mn=new WeakMap,pn=new WeakMap,An=new WeakSet,gn=function(){an.innerHTML=v(this,pn).call(this);const t=an.content.cloneNode(!0);w(this,hn,t.querySelector("vindral-controller")),w(this,cn,t.querySelector("#vindral-message")),w(this,dn,t.querySelector("#play-overlay")),v(this,mn).call(this),v(this,ln).innerHTML="",v(this,ln).appendChild(t)},fn=function(){var t;const e=this.getAttribute("url"),i=this.getAttribute("channel-id"),n=null!=(t=this.getAttribute("authentication-token"))?t:void 0,s=this.hasAttribute("infinite-reconnect"),r=U(this.getAttribute("title"),!0),o=M(this.getAttribute("poster"));if(!e||!i)return this.setAttribute(Wi.OFFLINE,""),void S(this,An,bn).call(this,"Invalid options","Please enter at least a channel id and url to start the stream");w(this,un,new tn({url:e,channelId:i,authenticationToken:n,infiniteReconnect:s})),v(this,un).on("live",(t=>{v(this,hn).connect(),this.removeAttribute("offline"),v(this,cn).setAttribute("hidden",""),r&&(({title:t,subTitle:e="Live stream",poster:i})=>{document.title=t,"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:t,artist:e,artwork:i?[{src:i}]:[]}))})({title:t.name,poster:"string"==typeof o?o:void 0})})),v(this,un).on("timeout",(()=>{v(this,cn).setAttribute("hidden",""),v(this,dn).removeAttribute("hidden")})),v(this,un).on("error",(t=>{this.setAttribute(Wi.OFFLINE,""),S(this,An,bn).call(this,t.title,t.message)})),v(this,dn).addEventListener("click",(()=>{var t;null==(t=v(this,un))||t.start(),v(this,dn).setAttribute("hidden","")})),v(this,un).start()},vn=function(){var t;null==(t=v(this,hn).instance)||t.on("error",(t=>{if(t.isFatal()){let e="Stream is offline",i="Please stand by";"access_forbidden"===t.code()&&(e="Forbidden",i="You do not have permission to view this stream"),S(this,An,bn).call(this,e,i)}}))},bn=function(t,e){v(this,cn).setAttribute("title",t),v(this,cn).setAttribute("description",e);const i=this.getAttribute("poster");i&&v(this,cn).setAttribute("background-image",i),v(this,cn).removeAttribute("hidden")},g(wn,"observedAttributes",[...ii.observedAttributes,...Gi]);const Sn=document.createElement("template");var yn,En;Sn.innerHTML='\n  <style>\n    :host {\n      display: var(--rendition-menu-display);\n    }\n  </style>\n\n  <slot name="button">\n<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-settings-filled" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M14.647 4.081a.724 .724 0 0 0 1.08 .448c2.439 -1.485 5.23 1.305 3.745 3.744a.724 .724 0 0 0 .447 1.08c2.775 .673 2.775 4.62 0 5.294a.724 .724 0 0 0 -.448 1.08c1.485 2.439 -1.305 5.23 -3.744 3.745a.724 .724 0 0 0 -1.08 .447c-.673 2.775 -4.62 2.775 -5.294 0a.724 .724 0 0 0 -1.08 -.448c-2.439 1.485 -5.23 -1.305 -3.745 -3.744a.724 .724 0 0 0 -.447 -1.08c-2.775 -.673 -2.775 -4.62 0 -5.294a.724 .724 0 0 0 .448 -1.08c-1.485 -2.439 1.305 -5.23 3.744 -3.745a.722 .722 0 0 0 1.08 -.447c.673 -2.775 4.62 -2.775 5.294 0zm-2.647 4.919a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" stroke-width="0" fill="currentColor" />\n</svg>\n</slot>\n  <slot name="listbox" hidden>\n    <vindral-rendition-levels-menu-list id="listbox" part="listbox"></vindral-rendition-levels-menu-list>\n  </slot>\n';const kn=class extends he{constructor(){var t,e,i,n;super(),b(this,yn),null==(t=this.shadowRoot)||t.appendChild(Sn.content.cloneNode(!0)),this.button=null==(e=this.shadowRoot)?void 0:e.querySelector("slot[name=button]"),this.listbox=null==(i=this.shadowRoot)?void 0:i.querySelector("[part=listbox]"),this.listboxSlot=null==(n=this.shadowRoot)?void 0:n.querySelector("slot[name=listbox]")}connectedCallback(){super.connectedCallback(),S(this,yn,En).call(this)}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.RENDITION_LEVELS&&S(this,yn,En).call(this)}};yn=new WeakSet,En=function(){const t=this.getAttribute(x.RENDITION_LEVELS);t&&"[]"!==t?this.removeAttribute("disabled"):this.setAttribute("disabled","")},g(kn,"observedAttributes",[...y(kn,kn,"observedAttributes"),x.RENDITION_LEVELS]);let Cn=kn;const Tn=document.createElement("template");var xn,In,Rn,Ln,Pn,Mn,Bn,_n,Un,Nn,Dn;Tn.innerHTML=`\n  <style>\n    :host {\n      font: inherit;\n      cursor: default;\n      padding: var(--padding-2);\n      padding-top: var(--padding-3);\n      border-radius: 0.25em;\n      position: absolute;\n      min-width: 140px;\n      background: var(--bg-subtle);\n      z-index: 1;\n      overflow: auto;\n    }\n\n    :host([list-position="top"]) {\n      bottom: calc(100% + 0.5em);\n      transform: translate(-50%);\n    }\n\n    :host([list-position="bottom"]) {\n      top: calc(100% + 0.5em);\n    }\n\n    :host::-webkit-scrollbar {\n      width: 5px;\n      padding-right: 5px;\n    }\n\n    :host::-webkit-scrollbar-thumb {\n      background-color: var(--fg-extra-subtle);\n      border-radius: 10px;\n      border: 0;\n    }\n\n    :host::-webkit-scrollbar-track {\n      border-radius: 10px;\n      background-color: transparent;\n    }\n\n    .menu {\n      display: grid;\n      gap: var(--padding-1);\n    }\n\n    [role="menuitem"] {\n      flex: 1;\n      position: relative;\n      cursor: pointer;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      height: 44px;\n      padding: 0 var(--padding-5);\n      border-radius: 4px;\n      font-size: 14px;\n      font-style: normal;\n      font-weight: 500;\n      line-height: normal;\n      white-space: nowrap;\n      text-align: left;\n    }\n\n    [role="menuitem"]:hover {\n      background: var(--bg-component-hover);\n    }\n\n    [role="menuitem"][aria-selected="true"] {\n      background: var(--bg-component-active);\n    }\n\n    [role="menuitem"][aria-selected="true"]::before {\n      content: url("data:image/svg+xml,${encodeURIComponent('\n  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="#fff" viewBox="0 0 78.369 78.369" xml:space="preserve"><path d="M78.049 19.015 29.458 67.606a1.094 1.094 0 0 1-1.548 0L.32 40.015a1.094 1.094 0 0 1 0-1.547l6.704-6.704a1.095 1.095 0 0 1 1.548 0l20.113 20.112 41.113-41.113a1.095 1.095 0 0 1 1.548 0l6.703 6.704a1.094 1.094 0 0 1 0 1.548z"/></svg>\n')}");\n      position: absolute;\n      left: calc(var(--padding-3) - var(--padding-1));\n      top: calc(50% - 8px);\n    }\n\n    .menu-item-subtitle {\n      font-size: 11px;\n      opacity: 0.6;\n    }\n\n    .heading {\n      text-transform: uppercase;\n      margin-bottom: var(--padding-2);\n      padding: 0 var(--padding-3);\n      font-size: 11px;\n      font-weight: bold;\n    }\n  </style>\n\n  <slot>\n    <div class="heading">Max quality</div>\n    <div class="menu"></div>\n  </slot>\n`;class Fn extends HTMLElement{constructor(){super(),b(this,Mn),b(this,xn,[]),b(this,In,Number.MAX_SAFE_INTEGER),b(this,Rn,null),b(this,Ln,[]),b(this,Pn,null),this.attachShadow({mode:"open"}).appendChild(Tn.content.cloneNode(!0))}connectedCallback(){var t;const e=this.getRootNode();e instanceof ShadowRoot&&(w(this,Pn,e.host.closest("vindral-controller")),null==(t=v(this,Pn))||t.connectListener(this),S(this,Mn,Bn).call(this),S(this,Mn,_n).call(this))}attributeChangedCallback(t,e,i){e!==i&&(t===x.RENDITION_LEVELS&&i&&(this.list=JSON.parse(i)),t===x.MAX_VIDEO_BITRATE&&i&&(this.maxVideoBitrate=i?parseInt(i):Number.MAX_SAFE_INTEGER))}set list(t){w(this,xn,t),S(this,Mn,_n).call(this)}set maxVideoBitrate(t){w(this,In,t),S(this,Mn,Nn).call(this)}}xn=new WeakMap,In=new WeakMap,Rn=new WeakMap,Ln=new WeakMap,Pn=new WeakMap,Mn=new WeakSet,Bn=function(){new IntersectionObserver((t=>{t.forEach((t=>{if(1!==t.intersectionRatio)if(t.intersectionRatio>0){const e=this.offsetHeight*t.intersectionRatio-24;this.style.height=`${e}px`}else this.style.height="auto"}))}),{root:v(this,Pn),threshold:0}).observe(this)},_n=function(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector(".menu");e&&(w(this,Ln,[]),e.innerHTML="",v(this,xn).sort(((t,e)=>{var i,n;return null!=(i=t.video)&&i.bitRate&&null!=(n=e.video)&&n.bitRate?e.video.bitRate-t.video.bitRate:0})).forEach((t=>{var i,n,s,r,o,a,l;const h=document.createElement("div");h.setAttribute("role","menuitem"),h.setAttribute("value",String(null==(i=t.video)?void 0:i.height)),h.classList.add("menu-item");const c=S(this,Mn,Un).call(this,null==(n=t.video)?void 0:n.frameRate);h.textContent=t.video?(({width:t,height:e})=>`${t}x${e}`)(t.video):"";const d=document.createElement("span");d.classList.add("menu-item-subtitle"),d.textContent=`${((t,e=1)=>t>=C?`${T(t,C,e)} Gbit/s`:t>=k?`${T(t,k,e)} Mbit/s`:t>=1e3?`${T(t,1e3,e)} Kbit/s`:`${t} bit/s`)((null!=(r=null==(s=t.video)?void 0:s.bitRate)?r:0)+(null!=(a=null==(o=t.audio)?void 0:o.bitRate)?a:0))}, ${c}p`,h.appendChild(d),h.addEventListener("click",(()=>S(this,Mn,Dn).call(this,t))),v(this,Ln).push({el:h,id:(null==(l=t.video)?void 0:l.id)||-1}),e.appendChild(h)})),S(this,Mn,Nn).call(this))},Un=function(t){return t?t[0]%t[1]==0?(t[0]/t[1]).toString():(t[0]/t[1]).toFixed(2):""},Nn=function(){v(this,Rn)&&v(this,Rn).removeAttribute("aria-selected");const t=v(this,xn).sort(((t,e)=>{var i,n;return null!=(i=t.video)&&i.bitRate&&null!=(n=e.video)&&n.bitRate?e.video.bitRate-t.video.bitRate:0})),e=v(this,xn).filter((t=>{var e;return(null==(e=t.video)?void 0:e.bitRate)&&t.video.bitRate<=v(this,In)}))[0]||t[t.length-1];if(e){const t=v(this,Ln).find((t=>{var i;return t.id===(null==(i=e.video)?void 0:i.id)}));t&&(t.el.setAttribute("aria-selected","true"),w(this,Rn,t.el))}},Dn=function(t){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),this.dispatchEvent(new CustomEvent(R.SET_RENDITION,{bubbles:!0,composed:!0,detail:t}))},g(Fn,"observedAttributes",[x.RENDITION_LEVELS,x.MAX_VIDEO_BITRATE]);const On=document.createElement("template");var Wn,Gn,zn,Hn,Vn,Xn,Qn,jn,qn,Zn,$n,Jn,Yn,Kn;On.innerHTML=`\n  <style>\n    :host {\n      --scroll-overlay-offset: var(--vindral-scroll-overlay-offset, 0px);\n\n      position: absolute;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      overflow-y: scroll !important;\n      pointer-events: none !important;\n      display: block;\n      transition: background-color 0.5s ease-in-out;\n      -ms-overflow-style: none;\n      scrollbar-width: none;\n    }\n\n    :host([snap]) {\n      scroll-snap-type: y mandatory;\n      scroll-behavior: smooth;\n    }\n\n    :host([snap-touch]) {\n      scroll-snap-type: y mandatory;\n      scroll-behavior: smooth;\n      pointer-events: auto !important;\n    }\n\n    :host([open]) #scroll-area {\n      width: 100%;\n      cursor: pointer;\n    }\n\n    :host([open]) {\n      background-color: rgba(0, 0, 0, 0.5);\n    }\n\n    :host::-webkit-scrollbar {\n      display: none;\n    }\n\n    #scroll-area {\n      margin: 0 auto;\n      width: 1px;\n      height: calc(100% - var(--scroll-overlay-offset));\n      pointer-events: auto;\n      scroll-snap-align: start;\n    }\n\n    slot#content {\n      display: flex;\n      margin: 0 auto;\n      width: 100%;\n      pointer-events: auto;\n      scroll-snap-align: start;\n      flex-direction: column;\n    }\n\n    :host(:not([${x.USER_INTERACTING}])) {\n      overflow: hidden !important;\n    }\n  </style>\n\n  <div id="scroll-area"></div>\n  <slot id="content"></slot>\n`;class ts extends HTMLElement{constructor(){super(),b(this,Hn),b(this,Wn,null),b(this,Gn,null),b(this,zn,null),g(this,"handleEvent",(t=>{switch(t.type){case"touchstart":S(this,Hn,Vn).call(this,t);break;case"touchmove":S(this,Hn,Xn).call(this,t);break;case"touchend":S(this,Hn,Qn).call(this,t)}})),b(this,jn,(()=>{0===this.scrollTop?(this.open=!1,this.removeAttribute("snap-touch"),S(this,Hn,Kn).call(this)):!this.visible&&this.scrollTop>0?S(this,Hn,Yn).call(this):!this.hasAttribute("snap-touch")&&S(this,Hn,Jn).call(this)&&(this.open=!0,this.setAttribute("snap-touch",""))})),b(this,qn,(()=>{S(this,Hn,Zn).call(this)?0===this.scrollTop?(this.open=!1,S(this,Hn,Kn).call(this)):!this.visible&&this.scrollTop>0?S(this,Hn,Yn).call(this):S(this,Hn,Jn).call(this)&&(this.open=!0):this.scrollTop=0})),this.attachShadow({mode:"open"}).appendChild(On.content.cloneNode(!0))}connectedCallback(){var t,e,i,n,s,o;const a=this.getRootNode();if(a instanceof Document||a instanceof ShadowRoot){w(this,Wn,a.querySelector("vindral-controller")),null==(t=v(this,Wn))||t.connectListener(this),w(this,Gn,null==(e=this.shadowRoot)?void 0:e.querySelector("#scroll-area")),null==(i=v(this,Gn))||i.addEventListener("click",(()=>{this.open&&(this.open=!1)}));const l=this.hasAttribute("touch-enabled");if(!(0,r.i)()||!l)return this.setAttribute("snap",""),void this.addEventListener("scroll",v(this,qn));this.addEventListener("scroll",v(this,jn)),null==(n=v(this,Wn))||n.addEventListener("touchstart",this,{passive:!0}),null==(s=v(this,Wn))||s.addEventListener("touchmove",this,{passive:!1}),null==(o=v(this,Wn))||o.addEventListener("touchend",this,{passive:!0})}}disconnectedCallback(){var t;null==(t=v(this,Wn))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){var n;e!==i&&(t===x.USER_INTERACTING&&null===i&&S(this,Hn,$n).call(this)&&setTimeout((()=>{this.open=!1}),300),"open"===t&&this.scrollTo({top:null===i?0:null==(n=v(this,Gn))?void 0:n.clientHeight,behavior:"smooth"}))}set open(t){t?this.setAttribute("open",""):this.removeAttribute("open")}get open(){return this.hasAttribute("open")}set visible(t){t?this.setAttribute("visible",""):this.removeAttribute("visible")}get visible(){return this.hasAttribute("visible")}}Wn=new WeakMap,Gn=new WeakMap,zn=new WeakMap,Hn=new WeakSet,Vn=function(t){S(this,Hn,Zn).call(this)&&t.touches[0]&&w(this,zn,t.touches[0].clientY)},Xn=function(t){if(S(this,Hn,Zn).call(this)&&v(this,zn)&&!this.hasAttribute("snap-touch")&&(t.preventDefault(),t.touches[0])){const e=t.touches[0].clientY,i=v(this,zn)-e;this.scrollTop=i}},Qn=function(t){S(this,Hn,$n).call(this)&&!this.hasAttribute("snap-touch")&&(this.open=!0)},jn=new WeakMap,qn=new WeakMap,Zn=function(){return this.hasAttribute(x.USER_INTERACTING)},$n=function(){return this.scrollTop>0},Jn=function(){var t;return Math.round(this.scrollTop)===this.scrollHeight-this.clientHeight||Math.round(this.scrollTop)===(null==(t=v(this,Gn))?void 0:t.clientHeight)},Yn=function(){this.visible=!0,this.dispatchEvent(new CustomEvent(R.LOCK_UI,{bubbles:!0,composed:!0}))},Kn=function(){this.visible=!1,this.dispatchEvent(new CustomEvent(R.UNLOCK_UI,{bubbles:!0,composed:!0}))},g(ts,"observedAttributes",[x.USER_INTERACTING,"open","touch-enabled"]);const es=document.createElement("template");var is,ns;es.innerHTML='\n  <style>\n    :host {\n      --value: 0;\n\n      width: 100%;\n      height: 5px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      margin: 0;\n      position: relative;\n      cursor: pointer;\n      pointer-events: auto;\n      touch-action: none;\n    }\n\n    #range {\n      -webkit-appearance: none;\n      appearance: none;\n\n      height: 4px;\n      width: 100%;\n      margin: 0;\n      padding: 0;\n\n      background-color: #00000000;\n      outline: none;\n      z-index: 1;\n    }\n\n    #range-track {\n      position: absolute;\n      top: calc(50% - 2px);\n      left: 1px;\n      width: calc(100% - 1px);\n      height: 4px;\n      background-color: rgb(255 255 255 / 0.2);\n      overflow: hidden;\n      cursor: pointer;\n    }\n\n    #range-track::before {\n      position: absolute;\n      content: "";\n      left: calc(-100%);\n      top: 0;\n      width: calc(100%);\n      height: 100%;\n      background-color: var(--fg-strong);\n      transition: background-color 300ms ease-out;\n      transform-origin: 100% 0%;\n      transform: translateX(calc(var(--value) * 100%)) scaleX(1.2);\n    }\n\n    #range::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background-color: var(--fg-strong);\n      cursor: pointer;\n      z-index: 1;\n    }\n\n    #range::-moz-range-thumb {\n      -moz-appearance: none;\n      appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background-color: var(--fg-strong);\n      cursor: pointer;\n      z-index: 1;\n    }\n  </style>\n\n  <input type="range" id="range" min="0" max="1" step="any" value="0" />\n  <div id="range-track"></div>\n';class ss extends HTMLElement{constructor(){super(),b(this,is,null),b(this,ns),g(this,"range"),w(this,ns,this.attachShadow({mode:"open"})),v(this,ns).appendChild(es.content.cloneNode(!0)),this.range=v(this,ns).getElementById("range")}connectedCallback(){var t;const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,is,e.querySelector("vindral-controller")),null==(t=v(this,is))||t.connectListener(this)),this.hasAttribute("disabled")||this.enable()}disconnectedCallback(){var t;null==(t=v(this,is))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){e!==i&&("disabled"===t&&i?this.disable():this.enable(),this.updateBar())}enable(){this.range.addEventListener("input",this)}disable(){this.range.removeEventListener("input",this)}handleEvent(t){"input"===t.type&&this.updateBar()}updateBar(){this.style.setProperty("--value",this.range.value)}}is=new WeakMap,ns=new WeakMap,g(ss,"observedAttributes",["disabled"]);const rs=document.createElement("template");var os;rs.innerHTML="\n  <style>\n    :host {\n      display: var(--volume-range-display);\n      width: 80px;\n    }\n  </style>\n";const as=class extends ss{constructor(){var t;super(),b(this,os,(()=>{const t=this.range.valueAsNumber;this.dispatchEvent(new CustomEvent(R.SET_VOLUME,{bubbles:!0,composed:!0,detail:t}))})),null==(t=this.shadowRoot)||t.appendChild(rs.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.range.addEventListener("input",v(this,os)),this.range.setAttribute("aria-label","volume")}disconnectedCallback(){super.disconnectedCallback(),this.range.removeEventListener("input",v(this,os))}attributeChangedCallback(t,e,i){var n;super.attributeChangedCallback(t,e,i),(t===x.MUTED||t===x.VOLUME)&&(this.range.valueAsNumber=this.muted?0:parseFloat(this.volume),this.range.setAttribute("aria-valuetext",(n=this.range.valueAsNumber,`${Math.round(100*n)}%`)),this.updateBar())}get volume(){var t;return null!=(t=this.getAttribute(x.VOLUME))?t:"1"}get muted(){return this.hasAttribute(x.MUTED)}};os=new WeakMap,g(as,"observedAttributes",[...y(as,as,"observedAttributes"),x.MUTED,x.VOLUME]);let ls=as;const hs=document.createElement("template");var cs;hs.innerHTML=`\n  <style>\n    :host {\n      color: var(--fg-strong);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host(:not([${x.BUFFERING}])) {\n      visibility: hidden !important;\n    }\n  </style>\n\n  <slot name="icon">\n<svg width="24" height="24" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <style>\n    .spinner-container {\n      transform-origin: center;\n      animation: rotate 2s linear infinite;\n    }\n    .spinner-circle {\n      stroke-linecap: round;\n      animation: dash 1.5s ease-in-out infinite;\n    }\n    @keyframes rotate {\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n    @keyframes dash {\n      0% {\n        stroke-dasharray: 0 150;\n        stroke-dashoffset: 0;\n      }\n      47.5% {\n        stroke-dasharray: 42 150;\n        stroke-dashoffset: -16;\n      }\n      95%, 100% {\n        stroke-dasharray: 42 150;\n        stroke-dashoffset: -59;\n      }\n    }\n  </style>\n  <g class="spinner-container">\n    <circle class="spinner-circle" cx="12" cy="12" r="9.5" fill="none" stroke-width="3"></circle>\n  </g>\n</svg>\n</slot>\n`;class ds extends HTMLElement{constructor(){super(),b(this,cs,null),this.attachShadow({mode:"open"}).appendChild(hs.content.cloneNode(!0))}connectedCallback(){var t;const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,cs,e.querySelector("vindral-controller")),null==(t=v(this,cs))||t.connectListener(this))}disconnectedCallback(){var t;null==(t=v(this,cs))||t.disconnectListener(this)}}cs=new WeakMap,g(ds,"observedAttributes",[x.BUFFERING]);const us=document.createElement("template");var ms;us.innerHTML='\n  <style>\n    :host {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      z-index: 1;\n      pointer-events: none;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    slot#play {\n      pointer-events: auto;\n      cursor: pointer;\n      color: var(--fg-strong);\n    }\n\n    slot#play > svg {\n      width: 48px;\n      height: 48px;\n    }\n  </style>\n\n  <slot id="play" name="icon">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z" /></svg>\n</slot>\n';class ps extends HTMLElement{constructor(){super(),b(this,ms,null),this.attachShadow({mode:"open"}).appendChild(us.content.cloneNode(!0))}connectedCallback(){var t;const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,ms,e.querySelector("vindral-controller")),null==(t=v(this,ms))||t.connectListener(this)),this.setAttribute("arial-label","Play")}disconnectedCallback(){var t;null==(t=v(this,ms))||t.disconnectListener(this)}}ms=new WeakMap,g(ps,"observedAttributes",["hidden"]);const As=document.createElement("template");var gs;As.innerHTML=`\n  <style>\n    :host {\n      display: var(--play-overlay-display);\n    }\n\n    :host(:not([${x.NEEDS_USER_INPUT}]):not([${x.PAUSED}])) #play {\n      display: none;\n    }\n  </style>\n`;const fs=class extends ps{constructor(){var t;super(),b(this,gs,(()=>{this.dispatchEvent(new CustomEvent(R.REQUEST_USER_INPUT,{bubbles:!0,composed:!0}))})),null==(t=this.shadowRoot)||t.appendChild(As.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.addEventListener("click",v(this,gs))}disconnectedCallback(){super.disconnectedCallback()}};gs=new WeakMap,g(fs,"observedAttributes",[...y(fs,fs,"observedAttributes"),x.NEEDS_USER_INPUT,x.PAUSED]);let vs=fs;const bs=document.createElement("template");var ws,Ss,ys;bs.innerHTML='\n  <style>\n    :host,\n    #background {\n      position: absolute;\n      overflow: hidden;\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      width: 100%;\n      top: 0;\n      left: 0;\n      justify-content: center;\n      align-items: center;\n      background-repeat: no-repeat;\n      background-position: 50% 50%;\n      background-size: contain;\n      font-size: 20px;\n      color: var(--fg-strong);\n      pointer-events: none;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    #background {\n      opacity: 0.7;\n    }\n\n    #title,\n    #description {\n      position: relative;\n      text-align: center;\n    }\n\n    @container (max-width: 600px) {\n      :host {\n        font-size: 15px;\n      }\n    }\n\n    @container (max-width: 400px) {\n      :host {\n        font-size: 12px;\n      }\n      #title {\n        margin: 0;\n      }\n    }\n\n    @container (max-width: 150px) {\n      :host {\n        font-size: 10px;\n      }\n      #title,\n      #description {\n        font-size: 1.2em;\n        margin: 0;\n      }\n    }\n  </style>\n\n  <div id="background"></div>\n  <h1 id="title"></h1>\n  <p id="description"></p>\n';class Es extends HTMLElement{constructor(){super(),b(this,ws),b(this,Ss),b(this,ys);const t=this.attachShadow({mode:"open"});t.appendChild(bs.content.cloneNode(!0)),w(this,ws,t.querySelector("#title")),w(this,Ss,t.querySelector("#description")),w(this,ys,t.querySelector("#background"))}connectedCallback(){}disconnectedCallback(){}attributeChangedCallback(t,e,i){e!==i&&("title"===t?v(this,ws).textContent=i:"description"===t?v(this,Ss).textContent=i:"background-image"===t&&(v(this,ys).style.backgroundImage=`url(${i})`))}}ws=new WeakMap,Ss=new WeakMap,ys=new WeakMap,g(Es,"observedAttributes",["title","description","background-image","hidden"]),customElements.define("vindral-controller",ii),customElements.define("vindral-control-bar",Dt),customElements.define("vindral-play-button",Oi),customElements.define("vindral-mute-button",Bi),customElements.define("vindral-buffering-overlay",$),customElements.define("vindral-scroll-overlay",ts),customElements.define("vindral-play-overlay",ps),customElements.define("vindral-user-input-play-overlay",vs),customElements.define("vindral-fullscreen-button",ri),customElements.define("vindral-rendition-levels-menu",Cn),customElements.define("vindral-rendition-levels-menu-list",Fn),customElements.define("vindral-channel-grid-button",Ut),customElements.define("vindral-channel-grid",Et),customElements.define("vindral-channel-grid-item",ht),customElements.define("vindral-pip-button",Ni),customElements.define("vindral-airplay-button",j),customElements.define("vindral-cast-button",it),customElements.define("vindral-cast-overlay",ot),customElements.define("vindral-buffering-icon",ds),customElements.define("vindral-language-menu",ci),customElements.define("vindral-language-menu-list",Li),customElements.define("vindral-message",Es),customElements.define("vindral-volume-range",ls),customElements.define("vindral-player",wn)})();