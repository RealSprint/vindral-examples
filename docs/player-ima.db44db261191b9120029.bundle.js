(()=>{"use strict";var t,e,i={9633:(t,e,i)=>{i.d(e,{E:()=>s});var n=Object.defineProperty;class s{constructor(){((t,e,i)=>{((t,e,i)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i)})(this,"listeners",{})}emit(t,e){const i=this.listeners[t];i&&(this.listeners[t]=i.filter((t=>!t.once)),i.map((t=>t.fn(e))).map((t=>"function"==typeof t&&(null==t?void 0:t()))))}off(t,e){const i=this.listeners[t];i&&(this.listeners[t]=i.filter((t=>t.fn!==e)))}on(t,e){this.add(t,e,!1)}once(t,e){this.add(t,e,!0)}reset(){this.listeners={}}add(t,e,i){const n=this.listeners[t],s={fn:e,once:i};n?n.push(s):this.listeners[t]=[s]}}},119:(t,e,i)=>{i.d(e,{A:()=>C,a:()=>g,b:()=>y,c:()=>v,d:()=>p,i:()=>f,p:()=>k,t:()=>A});var n=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,h=(t,e,i)=>e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,c=(t,e)=>{for(var i in e||(e={}))o.call(e,i)&&h(t,i,e[i]);if(a)for(var i of a(e))l.call(e,i)&&h(t,i,e[i]);return t},d=(t,e)=>s(t,r(e)),u=(t,e,i)=>h(t,"symbol"!=typeof e?e+"":e,i),m=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{o(i.next(t))}catch(t){s(t)}},a=t=>{try{o(i.throw(t))}catch(t){s(t)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,a);o((i=i.apply(t,e)).next())}));const p=t=>{switch(t){case"h264":case"av1":return"video";case"aac":case"opus":case"mp3":return"audio";case"webvtt":return"text";default:throw new Error("Unknown codec")}};function g(t,e){if(!t)throw new Error(e)}const A=t=>{try{return JSON.parse(t)}catch(t){return}};function f(t){return!("string"==typeof t.edges[0]||t.channels[0]&&!("catalog"in t.channels[0]))}function v(t){return t.tracks.filter((t=>!!t.codec)).filter((t=>b(t.codec||""))).map(((t,e)=>{const i=t.codec,n=t.bitrate;g(i,"codec is required"),g(null!=n,"bitrate is required");const s=b(i);if(g(s,"codec is required"),"audio"===p(s)){const r=t.samplerate||0;return{track:t,id:e,codec:s,codecString:i,bitRate:n,channels:"stereo"===t.channelConfig?2:1,sampleRate:r,language:t.language}}return"text"===p(s)?{track:t,id:e,bitRate:0,codec:s,kind:"subtitles",codecString:i,label:t.label,language:t.language}:(g(t.width,"width is required"),g(t.height,"width is required"),g(t.framerate,"framerate is required"),{track:t,id:e,codec:s,bitRate:n,codecString:i,width:t.width,height:t.height,frameRate:t.framerate})})).sort(((t,e)=>t.bitRate-e.bitRate))}function b(t){return t.startsWith("opus")?"opus":t.startsWith("mp4a")?"aac":t.startsWith("avc1")?"h264":t.startsWith("av01")?"av1":t.startsWith("webvtt")?"webvtt":void 0}class w extends Error{constructor({status:t,url:e,body:i}){const n=A(i),s=(t=>"object"==typeof t&&null!==t&&"message"in t)(n)?n.message:`Url ${e.toString()}, Status code: ${t}, Body: ${i}`;super(s),u(this,"status"),u(this,"body"),u(this,"url"),this.status=t,this.body=i,this.url=e,Object.setPrototypeOf(this,new.target.prototype)}}const y=t=>"number"==typeof t.status,E=(t,e)=>m(void 0,null,(function*(){const i=yield fetch(t.toString(),c({mode:"cors"},e));if(!i.ok)throw new w({status:i.status,url:t,body:yield i.text()});return i})),S=(t,e)=>m(void 0,null,(function*(){return yield(yield E(t,c({},e))).json()})),k=(t,e)=>m(void 0,null,(function*(){return E(t,c({method:"POST"},e))}));class C{constructor(t){u(this,"baseUrl"),u(this,"tokenFactory"),this.baseUrl=new URL("/api/v4/",t.publicEndpoint).toString(),this.tokenFactory=t.tokenFactory}connect(t){return m(this,null,(function*(){const{channelId:e,channelGroupId:i}=t,n={channelId:e,channelGroupId:i},s=new URL((t=>t.channelGroupId?`connect?channelId=${t.channelId}&channelGroupId=${t.channelGroupId}`:`connect?channelId=${t.channelId}`)(t),this.baseUrl),r=this.getAuthToken(n),a=yield S(s,{headers:this.getHeaders(r)});if(function(t){var e;return!("string"==typeof t.edges[0]||t.channels[0]&&"catalog"in t.channels[0]&&void 0===(null==(e=t.channels[0])?void 0:e.catalog))}(a)){const t=a.channels.map((t=>{const e=this.toChannel(t,n),i=v(t.catalog);return d(c(c({},t),e),{renditions:i})}));return d(c({},a),{channels:t})}{const t=a.channels.map((t=>{const e=this.toChannel(t,n);return c(c({},t),e)}));return d(c({},a),{channels:t})}}))}getChannel(t){return m(this,null,(function*(){const e={channelId:t},i=new URL(`channel/${t}`,this.baseUrl),n=this.getAuthToken(e),s=yield S(i,{headers:this.getHeaders(n)});return this.toChannel(s,e,n)}))}getChannels(t){return m(this,null,(function*(){const e={channelGroupId:t},i=new URL(`channels/${t}`,this.baseUrl),n=this.getAuthToken(e),s=yield S(i,{headers:this.getHeaders(n)}),r=Array.isArray(s)?s:s.channels;return this.toChannels(r,e,n)}))}getHeaders(t){var e;return null!=(e=(t=>t?{Authorization:`Bearer ${t}`}:void 0)(t))?e:{}}getAuthToken(t){return this.tokenFactory?this.tokenFactory(t):void 0}toChannels(t,e,i){return t.map((t=>this.toChannel(t,e,i)))}toChannel(t,e,i){const{baseUrl:n,sizes:s}=t.thumbnail,r=n||new URL(((t,e)=>e?t.channelGroupId?`thumbnail/?channelGroupId=${t.channelGroupId}&auth.token=${e}&auth.type=jwt`:t.channelId?`thumbnail/?channelId=${t.channelId}&auth.token=${e}&auth.type=jwt`:"thumbnail":"thumbnail")(e,i),this.baseUrl),a=s.map((n=>new URL(`?channelId=${t.channelId}&width=${n.width}&height=${n.height}${T(e,i)}`,r).toString()));return{channelId:t.channelId,name:t.name,isLive:t.isLive,thumbnailUrls:a}}}const T=(t,e)=>e?t.channelGroupId?`&channelGroupId=${t.channelGroupId}&auth.token=${e}&auth.type=jwt`:`&auth.token=${e}&auth.type=jwt`:""},4903:(t,e,i)=>{i.d(e,{A:()=>St,B:()=>z,C:()=>Et,D:()=>k,F:()=>C,L:()=>nt,V:()=>xs,W:()=>di,a:()=>Q,b:()=>F,c:()=>At,d:()=>Ct,e:()=>gt,f:()=>D,g:()=>N,i:()=>st,m:()=>j,n:()=>T,t:()=>pt,w:()=>mt});var n=i(9633),s=i(119),r=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=t=>{throw TypeError(t)},u=(t,e,i)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,m=(t,e)=>{for(var i in e||(e={}))h.call(e,i)&&u(t,i,e[i]);if(l)for(var i of l(e))c.call(e,i)&&u(t,i,e[i]);return t},p=(t,e)=>a(t,o(e)),g=(t,e,i)=>u(t,"symbol"!=typeof e?e+"":e,i),A=(t,e,i)=>e.has(t)||d("Cannot "+i),f=(t,e,i)=>(A(t,e,"read from private field"),i?i.call(t):e.get(t)),v=(t,e,i)=>e.has(t)?d("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),b=(t,e,i,n)=>(A(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),w=(t,e,i)=>(A(t,e,"access private method"),i),y=(t,e,i,n)=>({set _(n){b(t,e,n,i)},get _(){return f(t,e,n)}}),E=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{o(i.next(t))}catch(t){s(t)}},a=t=>{try{o(i.throw(t))}catch(t){s(t)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,a);o((i=i.apply(t,e)).next())}));class S{constructor(t){g(this,"maxSize",0),g(this,"size",0),g(this,"buffers",[]),g(this,"_borrowedBuffers",0),g(this,"get",(t=>{const e=this.buffers.shift();return this._borrowedBuffers++,this.size<t||!e?(this.buffers=[],this.size=t,new ArrayBuffer(t)):e})),g(this,"reclaim",(t=>{this._borrowedBuffers=Math.max(0,this._borrowedBuffers-1),!(t.byteLength<this.size)&&(this.buffers.length>=this.maxSize||this.buffers.push(t))})),this.maxSize=t}get bufferSize(){return this.size}get poolSize(){return this.buffers.length}get borrowedBuffers(){return this._borrowedBuffers}}class k{constructor(){g(this,"promise"),g(this,"resolved"),g(this,"resolve"),g(this,"reject"),g(this,"pending",!0),this.promise=new Promise(((t,e)=>{this.resolve=e=>{this.pending=!1,this.resolved=e,t(e)},this.reject=t=>{this.pending=!1,e(t)}}))}static resolved(t){const e=new k;return e.resolve(t),e}static fromPromise(t){const e=new k;return e.promise=t,t.then((t=>{e.pending=!1,e.resolved=t}),(t=>{e.pending=!1,e.reject(t)})),e}}class C{constructor(t=50){g(this,"maxSize"),g(this,"values",[]),g(this,"push",(t=>{this.isFull()&&this.pop(),this.values.push(t)})),g(this,"clear",(()=>{this.values=[]})),g(this,"pop",(()=>this.values.shift())),g(this,"peekFirst",(()=>this.values[0])),g(this,"peekLast",(()=>this.values[this.values.length-1])),g(this,"isFull",(()=>this.values.length>=this.maxSize)),g(this,"isEmpty",(()=>0===this.values.length)),g(this,"items",(()=>this.values)),g(this,"filterPop",(t=>{for(;this.peekFirst()&&!t(this.peekFirst());)this.pop()})),this.maxSize=t}}const T=()=>{};class x{constructor(t,e=0){g(this,"buffer"),g(this,"bytes"),g(this,"bitOffset"),g(this,"peekBit",(()=>this.getBit(this.bytes,this.bitOffset))),g(this,"readBit",(()=>{const t=this.peekBit();return this.bitOffset++,t})),g(this,"readBits",(t=>{let e=0;for(let i=0;i<t;i++)e=e<<1|(this.getBit(this.bytes,this.bitOffset++)?1:0);return e})),g(this,"readSignedExpGolomb",(()=>{const t=this.readUnsignedExpGolomb();return 1&t?(t+1)/2:-t/2})),g(this,"readUnsignedExpGolomb",(()=>{let t=0;for(;0===this.getBit(this.bytes,this.bitOffset++);)t++;let e=1<<t;for(let i=t-1;i>=0;i--)e|=this.getBit(this.bytes,this.bitOffset++)<<i;return e-1})),g(this,"getBit",((t,e)=>t[e>>3]>>7-(7&e)&1)),this.buffer=t,this.bytes=new Uint8Array(this.buffer),this.bitOffset=e}}function I(){const t=self.MediaSource,e=self.ManagedMediaSource;return null!=t?t:e}const R=new RegExp("(android|bbd+|meego).+mobile|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/","i"),L=navigator.userAgent.toLowerCase(),M=R.test(L),P=()=>{const t=document.createElement("video");return""!==t.canPlayType("application/vnd.apple.mpegURL")||""!==t.canPlayType("audio/mpegurl")},B=()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){return!1}return!1},U=()=>"MacIntel"===navigator.platform&&0===navigator.maxTouchPoints,_=()=>"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,N=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,D=()=>/^(?!.*chrome).*safari/i.test(L);function O(){var t,e;if(/(iPhone|iPod|iPad)/i.test(L))return null==(e=null==(t=null==L?void 0:L.match(/OS [\d_]+/i))?void 0:t[0])?void 0:e.substring(3).split("_").map((t=>parseInt(t)))[0]}const F=(t,e,i)=>{let n=0;for(let s=e;s<=i;s++)if(s===e){const e=t[s];n+=127&e,128&e&&(n-=128)}else n=256*n+t[s];return n};var W,G,H;class z{constructor(t){v(this,W),v(this,G),v(this,H),b(this,G,t),b(this,H,new DataView(t.buffer,t.byteOffset,t.byteLength)),b(this,W,0)}position(){return f(this,W)}byteOffset(){return f(this,G).byteOffset+f(this,W)}buffer(){return f(this,G)}remaining(){return f(this,G).length-f(this,W)}readUint8(){const t=f(this,H).getUint8(f(this,W));return b(this,W,f(this,W)+1),t}readUint24(){const t=f(this,H).getUint32(f(this,W))>>8&16777215;return b(this,W,f(this,W)+3),t}readUint16(){const t=f(this,H).getUint16(f(this,W));return b(this,W,f(this,W)+2),t}readUint32(){const t=f(this,H).getUint32(f(this,W));return b(this,W,f(this,W)+4),t}readUint64(){const t=F(f(this,G),f(this,W),f(this,W)+7);return b(this,W,f(this,W)+8),t}readBytes(t){const e=f(this,G).subarray(f(this,W),f(this,W)+t);return b(this,W,f(this,W)+t),e}readRemaining(){return this.readBytes(this.remaining())}readUtf8String(){const t=[];let e;for(;0!==(e=this.readUint8())&&(t.push(e),0!=this.remaining()););return(new TextDecoder).decode(new Uint8Array(t))}}W=new WeakMap,G=new WeakMap,H=new WeakMap;class V{constructor(t=100,e=100){g(this,"resizeSteps"),g(this,"internalBuffer"),g(this,"view"),g(this,"uint8"),g(this,"_position",0),g(this,"_end",0),this.resizeSteps=e,this.internalBuffer=new ArrayBuffer(t),this.view=new DataView(this.internalBuffer),this.uint8=new Uint8Array(this.internalBuffer)}position(){return this._position}seek(t){this._position=Math.max(0,Math.min(this._end,t))}seekToEnd(){this._position=this._end}writeUint8(t){this.writeAndMove(t,1)}writeUint16(t){this.writeAndMove(t,2)}writeUint24(t){this.writeAndMove(t,3)}writeUint32(t){this.writeAndMove(t,4)}writeUint32At(t,e){this.view.setUint32(t,e)}writeBytes(t){this.resizeIfNeeded(this.position()+t.byteLength),this.uint8.set(t,this.position()),this._position+=t.byteLength,this._end=Math.max(this._end,this._position)}buffer(){return this.internalBuffer.slice(0,this._end)}write(t,e){switch(this.resizeIfNeeded(this.position()+e),e){case 1:this.view.setUint8(this.position(),t);break;case 2:this.view.setUint16(this.position(),t);break;case 3:this.view.setUint8(this.position(),t>>16&255),this.view.setUint8(this.position()+1,t>>8&255),this.view.setUint8(this.position()+2,255&t);break;case 4:this.view.setUint32(this.position(),t)}}writeAndMove(t,e){this.write(t,e),this._position+=e,this._end=Math.max(this._end,this._position)}resizeIfNeeded(t){if(t>this.internalBuffer.byteLength){const e=new ArrayBuffer(t+this.resizeSteps),i=new Uint8Array(e);i.set(this.uint8),this.internalBuffer=e,this.view=new DataView(this.internalBuffer),this.uint8=i}}}class X{constructor(t,e,i){g(this,"onSuccess"),g(this,"onError"),g(this,"doExecute"),this.doExecute=t,this.onSuccess=e,this.onError=i}execute(t){try{this.doExecute(t),this.onSuccess()}catch(t){this.onError(t)}}}const Q=t=>t.reduce(((t,e)=>t+e),0)/t.length,j=t=>({last:t[t.length-1]||0,average:0===t.length?0:Q(t),max:0===t.length?0:Math.max(...t),min:0===t.length?0:Math.min(...t)});class q{constructor(t=10){g(this,"rates"),g(this,"_total",0),g(this,"accumulatedValues",0),g(this,"lastTickTime",Date.now()),g(this,"add",(t=>{this.accumulatedValues+=t,this._total+=t})),g(this,"tick",(()=>{const t=this.accumulatedValues/((Date.now()-this.lastTickTime)/1e3);this.rates.push(t),this.accumulatedValues=0,this.lastTickTime=Date.now()})),this.rates=new C(t)}get total(){return this._total}get average(){return this.rates.isEmpty()?0:Q(this.rates.items())}}const $=(t,e)=>{if(t===e)return!0;if(null==t||"object"!=typeof t||null==e||"object"!=typeof e)return!1;let i=0,n=0;for(const e in t)i+=1;for(const i in e)if(n+=1,!(i in t)||!$(t[i],e[i]))return!1;return i==n},Z=["off","error","warn","info","debug","trace"];var K,J,Y,tt,et;const it=class t{constructor({context:t,logLevel:e,debug:i}){v(this,K,new Map),v(this,J,""),v(this,Y,!1),v(this,tt,"off"),g(this,"trace",((...t)=>{})),g(this,"debug",((...t)=>{})),g(this,"info",((...t)=>{})),g(this,"warn",((...t)=>{})),g(this,"error",((...t)=>{})),g(this,"table",((...t)=>{})),g(this,"count",((...t)=>{})),b(this,J,t),b(this,tt,e),b(this,Y,i||!1),this.setLevel(e),this.setDebug(f(this,Y))}setDebug(t){b(this,Y,t);for(const[e,i]of f(this,K))i.setDebug(t);t?(this.table=console.table.bind(console),this.count=console.count.bind(console)):(this.table=()=>{},this.count=()=>{})}setLevel(t){b(this,tt,t);for(const[e,i]of f(this,K))i.setLevel(t);const e=Z.indexOf(t);for(const[t,i]of Z.entries())"off"!==i&&(this[i]=t<=e?console[i].bind(console,"%c%s %c%s","font-weight:bold;",i.toUpperCase(),"font-weight:normal;",f(this,J)):()=>{})}createContext(e){const i=f(this,K).get(e);if(!i){const i=new t({context:`${e}`,logLevel:f(this,tt),debug:f(this,Y)});return f(this,K).set(e,i),i}return i}static get(){return f(t,et)||b(t,et,new t({context:"Vindral",logLevel:"off"})),f(t,et)}};K=new WeakMap,J=new WeakMap,Y=new WeakMap,tt=new WeakMap,et=new WeakMap,v(it,et);let nt=it;function st(t){const e=nt.get().createContext(t.context);return function(i,n){const s=String(n.name);return function(...n){t.enter&&e[t.enter](`Enter '${s}'`,m({},n));try{const r=i.call(this,...n);return r instanceof Promise?r.then((i=>{t.return&&e[t.return](`Return '${s}'`,i)})).catch((i=>{t.error&&e[t.error](`Error '${s}'`,i)})):t.return&&e[t.return](`Return '${s}'`,r),r}catch(i){throw t.error&&e[t.error](`Error '${s}'`,i),i}}}}const rt=(t,e)=>{const i=m({},t);return"object"!=typeof i||e.forEach((t=>{delete i[t]})),i},at=(t,e=Date.now())=>{const i=t.length;if(i>0){const n=t[i-1];n.end||(n.end=e)}},ot=(t,e=Date.now())=>{at(t),t.push({start:e})},lt=t=>t.reduce(((t,e)=>{var i;return t+((null!=(i=e.end)?i:Date.now())-e.start)}),0),ht=(t,e,i=Date.now())=>t.reduce(((t,n)=>{var s;const r=Math.max(i-e,n.start),a=null!=(s=n.end)?s:i;return Math.max(0,a-r)+t}),0),ct=class{constructor(){g(this,"pendingTimeouts",new Set),g(this,"pendingIntervals",new Set),g(this,"clearTimeout",(t=>{this.pendingTimeouts.delete(t)&&window.clearTimeout(t)})),g(this,"clearInterval",(t=>{this.pendingIntervals.delete(t)&&window.clearInterval(t)})),g(this,"setTimeout",((t,e,...i)=>{const n=window.setTimeout((()=>{t(...i),this.clearTimeout(n)}),e);return this.pendingTimeouts.add(n),n})),g(this,"setInterval",((t,e,...i)=>{const n=window.setInterval((()=>{t(...i)}),e);return this.pendingIntervals.add(n),n})),g(this,"unload",(()=>{this.pendingIntervals.forEach(this.clearInterval),this.pendingTimeouts.forEach(this.clearTimeout)}))}};g(ct,"create",(()=>new ct));let dt=ct;const ut=()=>{const t=[...Array(256).keys()].map((t=>t.toString(16).padStart(2,"0"))),e=crypto.getRandomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,[...e.entries()].map((([e,i])=>[4,6,8,10].includes(e)?`-${t[i]}`:t[i])).join("")},mt=t=>E(void 0,null,(function*(){return new Promise((e=>setTimeout(e,t)))})),pt=(t,...e)=>E(void 0,[t,...e],(function*(t,e=new Error("Timeout")){return new Promise(((i,n)=>setTimeout((()=>n(e)),t)))})),gt=t=>"width"in t&&"number"==typeof t.width,At=t=>"sampleRate"in t&&"number"==typeof t.sampleRate,ft=t=>{switch(t.codec){case"opus":return'audio/mp4; codecs="opus"';case"mp3":return"audio/mpeg";case"webvtt":return"text/vtt";case"aac":return t.codecString?`audio/mp4; codecs="${t.codecString}"`:"audio/mp4";case"h264":case"av1":return t.codecString?`video/mp4; codecs="${t.codecString}"`:"video/mp4"}},vt=()=>Number.MAX_SAFE_INTEGER,bt=()=>({width:Number.MAX_SAFE_INTEGER,height:Number.MAX_SAFE_INTEGER}),wt=t=>!("object"!=typeof t||null===t||!("type"in t)),yt={sizeBasedResolutionCapEnabled:!0,pictureInPictureEnabled:!0,abrEnabled:!0,burstEnabled:!1,mseEnabled:!0,mseOpusEnabled:!1,muted:!1,minBufferTime:1500,maxBufferTime:1500,logLevel:"off",maxSize:bt(),maxVideoBitRate:vt(),maxAudioBitRate:vt(),tags:[],media:"audio+video",poster:!0,reconnectHandler:t=>t.reconnectRetries<30,iosWakeLockEnabled:!1,telemetryEnabled:!0,iosMediaElementEnabled:!1,pauseSupportEnabled:!0,advanced:{wasmDecodingConstraint:{bitRate:Number.MAX_SAFE_INTEGER,width:1280,height:1280}},videoCodecs:["av1","h264"],webtransportEnabled:!0},Et="connection_failed",St="access_forbidden";class kt extends Error{constructor(t,e,i={}){super(t),g(this,"props"),g(this,"extra",{}),g(this,"code",(()=>this.props.code)),g(this,"isFatal",(()=>this.props.isFatal)),g(this,"source",(()=>this.props.source)),g(this,"type",(()=>{var t;return null!=(t=this.props.type)?t:"external"})),g(this,"toStringifiable",(()=>{var t;const e=this.source(),i=e instanceof Error?e.stack:this.stack;return p(m({},this.extra),{code:this.props.code,isFatal:this.props.isFatal,type:this.props.type,message:this.message,sourceMessage:null==(t=this.source())?void 0:t.message,stack:i})})),this.props=e,this.extra=i,Object.setPrototypeOf(this,new.target.prototype)}}const Ct=(t,e)=>new kt("Decoder Error",{isFatal:t,code:"decoder_error",source:e,type:"internal"}),Tt=(t,e)=>new kt("Audio Player Error",{isFatal:t,code:"audio_player_error",source:e,type:"internal"}),xt=(t,e,i,n)=>new kt("MediaSource Error",{isFatal:t,code:"media_source_error",source:e,type:"internal"},{type:n,consecutiveErrorsCount:i}),It=(t,e)=>new kt(`No track context for ${t}${e?`, rendition id ${e}`:""}`,{isFatal:!1,code:"no_track_context",type:"internal"}),Rt=(t,e)=>new kt(`Track context is in an invalid state for ${t}${e?`, rendition id ${e}`:""}`,{isFatal:!1,code:"invalid_track_context_state",type:"internal"}),Lt=t=>new kt("Disconnected From Edge Server",{type:"external",source:t,isFatal:!1,code:"disconnected_by_edge"}),Mt=t=>new kt("Authentication Failed",{isFatal:!0,code:"authentication_error",source:t}),Pt=(t,e)=>new kt("Channel not found",{isFatal:!1,code:"channel_not_found",source:e,type:t}),Bt=()=>new kt("Connection failed - no more reconnect attempts",{isFatal:!0,code:"connection_failed_will_not_attempt_again"}),Ut=t=>new kt(t,{isFatal:!0,code:St}),_t=t=>new kt(`Channel switch to '${t}' failed`,{isFatal:!1,code:"channel_switch_failed"}),Nt=(t,e)=>t&&"object"==typeof t&&e in t,Dt={playready:["150","2000","3000"],widevine:["SW_SECURE_CRYPTO","SW_SECURE_DECODE","HW_SECURE_CRYPTO","HW_SECURE_DECODE","HW_SECURE_ALL"],fairplay:[""],clearkey:[""]},Ot={initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}]},Ft={fairplay:{keySystem:"com.apple.fps",supportedConfig:{initDataTypes:["sinf"],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01f"'}]}},playready:{keySystem:"com.microsoft.playready",supportedConfig:Ot},widevine:{keySystem:"com.widevine.alpha",supportedConfig:Ot},clearkey:{keySystem:"org.w3.clearkey",supportedConfig:Ot}},Wt=(t,e)=>E(void 0,null,(function*(){return navigator.requestMediaKeySystemAccess(t,[e]).catch((()=>{}))})),Gt=(t,e,i,n,s,r)=>E(void 0,null,(function*(){let a;for(const o of n){const n=null==i?void 0:i.map((t=>p(m({},t),{robustness:o,contentType:r?`${"audioCapabilities"===s?"audio/mp4":"video/mp4"}; codecs="${r}"`:t.contentType})));if(!(yield Wt(t,{initDataTypes:e,[s]:n})))break;a=n}return a})),Ht=(t,e,i)=>E(void 0,null,(function*(){const{keySystem:n,supportedConfig:s}=Ft[t],{initDataTypes:r,videoCapabilities:a,audioCapabilities:o}=s,l=Dt[t],[h,c]=yield Promise.all([Gt(n,r,a,l,"videoCapabilities",e),Gt(n,r,o,l,"audioCapabilities",i)]);return h||c?yield Wt(n,{initDataTypes:r,videoCapabilities:h,audioCapabilities:c}):void 0}));var zt,Vt,Xt,Qt,jt,qt,$t,Zt,Kt,Jt,Yt,te,ee,ie,ne,se,re,ae,oe,le,he,ce,de,ue,me;class pe{constructor(t,e,i,n){g(this,"keySystem"),g(this,"licenseServerUrl"),g(this,"certificate"),g(this,"headers",{}),g(this,"queryParams",{}),v(this,zt),v(this,Vt),b(this,zt,e),this.keySystem=t,this.licenseServerUrl=i,this.certificate=n}get statistics(){return{keySystem:f(this,zt).keySystem,licenseServerUrl:this.licenseServerUrl,mediaKeySystemConfiguration:f(this,zt).getConfiguration()}}getMediaKeys(){return E(this,null,(function*(){return f(this,Vt)||b(this,Vt,yield f(this,zt).createMediaKeys()),f(this,Vt)}))}requestLicense(t){return E(this,null,(function*(){const e=new URL(this.licenseServerUrl);for(const[t,i]of Object.entries(this.queryParams))e.searchParams.append(t,i);const i=yield fetch(e,{method:"POST",body:t,headers:m({"Content-Type":"application/octet-stream"},this.headers)});if(!i.ok)throw new Error(`Failed to fetch license: ${i.statusText}`);return yield i.arrayBuffer()}))}}function ge(t){const e=window.atob(t.replace(/-/g,"+").replace(/_/g,"/"));let i="";for(let t=0;t<e.length;t++)i+=("0"+e.charCodeAt(t).toString(16)).substr(-2);return i}function Ae(t){let e="";for(let i=0;i<t.length;i+=2)e+=String.fromCharCode(parseInt(t.substr(i,2),16));return window.btoa(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function fe(t,e){if(t.byteLength!==e.byteLength)return!1;const i=new Uint8Array(t),n=new Uint8Array(e);for(let t=0;t<i.length;t++)if(i[t]!==n[t])return!1;return!0}zt=new WeakMap,Vt=new WeakMap;class ve extends pe{constructor(t,e){super("clearkey",t,""),v(this,Xt),b(this,Xt,e)}handleLicenseRequest(t){const e=new Uint8Array(t),i=String.fromCharCode(...e),n=JSON.parse(i),s=[];for(let t=0;t<n.kids.length;t++){const e=n.kids[t];if(e){const t=ge(e).toLowerCase(),i=f(this,Xt)[t];i&&s.push({kty:"oct",alg:"A128KW",kid:e,k:Ae(i)})}}const r=JSON.stringify({keys:s,type:n.type});return(new TextEncoder).encode(r)}}Xt=new WeakMap;class be extends pe{constructor(t,e,i){super("fairplay",t,e,i)}}class we extends pe{constructor(t,e){super("playready",t,e)}requestLicense(t){return E(this,null,(function*(){(0,s.a)(this.licenseServerUrl,"No license server URL set");const e=new URL(this.licenseServerUrl);for(const[t,i]of Object.entries(this.queryParams))e.searchParams.append(t,i);const i=(t=>{var e,i,n,s;const r=String.fromCharCode(...new Uint16Array(t)),a=(new window.DOMParser).parseFromString(r,"application/xml"),o=a.getElementsByTagName("HttpHeaders")[0];let l={};if(o){const t=o.getElementsByTagName("name"),n=o.getElementsByTagName("value");for(let s=0;s<t.length;s++){const r=null==(e=t[s])?void 0:e.childNodes[0],a=null==(i=n[s])?void 0:i.childNodes[0];null!=r&&r.nodeValue&&a&&a.nodeValue&&(l[r.nodeValue]=a.nodeValue)}}const h=a.getElementsByTagName("Challenge")[0];let c;return h&&null!=(n=h.childNodes[0])&&n.nodeValue&&(c=window.atob(null==(s=h.childNodes[0])?void 0:s.nodeValue)),a.querySelector("parsererror")&&(l={"Content-Type":"text/xml; charset=utf-8",SOAPAction:'"http://schemas.microsoft.com/DRM/2007/03/protocols/AcquireLicense"'},c=t),{headers:l,message:c}})(t),n=yield fetch(e,{method:"POST",headers:m(m({},i.headers),this.headers),body:i.message});if(!n.ok)throw new Error(`Failed to fetch license: ${n.statusText}`);return yield n.arrayBuffer()}))}}class ye extends pe{constructor(t,e){super("widevine",t,e)}}class Ee{constructor(t,e,i,n){v(this,ne),v(this,Qt),v(this,jt),v(this,qt),v(this,$t,new k),v(this,Zt,{}),v(this,Kt,{}),v(this,Jt,null),v(this,Yt,new Map),v(this,te,null),v(this,ee,(t=>{f(this,Qt).debug("Received DRM data",{options:t}),f(this,$t).resolve(t)})),v(this,ie,(t=>{f(this,Qt).info("Encrypted event received",{event:t}),w(this,ne,se).call(this,t)})),v(this,le,(t=>{var e;f(this,Qt).debug("Session message received",{event:t});const i=t.target,n=t.message;f(this,Yt).get(i)?(f(this,Qt).debug("Requesting license for session",{sessionId:i.sessionId}),null==(e=f(this,Jt))||e.requestLicense(n).then((t=>{f(this,Qt).debug("License received for session",{sessionId:i.sessionId}),i.update(t).catch((t=>{w(this,ne,de).call(this,{message:"Failed to update session with license",code:"eme",isFatal:!1,error:t})}))})).catch((t=>{w(this,ne,de).call(this,{message:"Failed to request license",code:"eme",isFatal:!1,error:t})}))):f(this,Qt).error("No active session found for event",{event:t})})),v(this,he,(t=>{const e=t.target;f(this,Qt).debug("Key status changed for session",{sessionId:e.sessionId}),e.keyStatuses.forEach(((t,e)=>{const i=ge(window.btoa(String.fromCharCode(...new Uint8Array(e))));f(this,Qt).debug("Key status",{base64kid:i,status:t})}))})),v(this,ue,(t=>E(this,null,(function*(){const e=w(this,ne,me).call(this,t);f(this,Qt).debug("Prioritized key system list",{keySystemList:e});const i=yield((t,e,i)=>E(void 0,null,(function*(){let n;for(const s of t)if(n=yield Ht(s,e,i),n)return{keySystem:s,mediaKeySystemAccess:n}})))(e,t.videoCodec,t.audioCodec);if(!i)return f(this,Qt).debug("No supported key system found"),null;f(this,Qt).debug("Supported key system found",i.mediaKeySystemAccess.getConfiguration());const{keySystem:n,mediaKeySystemAccess:r}=i;let a=null;return"clearkey"===n?((0,s.a)(t.clearkeys,"No clearkeys found"),a=new ve(r,t.clearkeys)):"playready"===n?((0,s.a)(t.playreadyLicenseUrl,"No playreadyLicenseUrl found"),a=new we(r,t.playreadyLicenseUrl)):"widevine"===n?((0,s.a)(t.widevineLicenseUrl,"No widevineLicenseUrl found"),a=new ye(r,t.widevineLicenseUrl)):"fairplay"===n&&((0,s.a)(t.fairplayLicenseUrl,"No fairplayLicenseUrl found"),(0,s.a)(t.fairplayCertificate,"No fairplayCertificate found"),a=new be(r,t.fairplayLicenseUrl,t.fairplayCertificate)),a&&(a.headers=f(this,Zt),a.queryParams=f(this,Kt)),a})))),b(this,jt,t),b(this,Qt,e),b(this,Zt,i||{}),b(this,Kt,n||{}),f(this,jt).on("received drm data",f(this,ee))}static isSupported(){return!!navigator.requestMediaKeySystemAccess}attach(t){b(this,qt,t),f(this,Qt).info("Media element attached"),f(this,qt).addEventListener("encrypted",f(this,ie))}getStatistics(){var t,e;return f(this,$t).resolved||null!=(t=f(this,Jt))&&t.statistics?m(m({},f(this,$t).resolved),null==(e=f(this,Jt))?void 0:e.statistics):null}unload(){var t;f(this,Qt).info("Unloading EncryptedMediaExtensions"),f(this,jt).off("received drm data",f(this,ee)),null==(t=f(this,qt))||t.removeEventListener("encrypted",f(this,ie)),f(this,Yt).forEach(((t,e)=>{e.close()})),f(this,Yt).clear(),b(this,te,null),b(this,Jt,null)}}Qt=new WeakMap,jt=new WeakMap,qt=new WeakMap,$t=new WeakMap,Zt=new WeakMap,Kt=new WeakMap,Jt=new WeakMap,Yt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ne=new WeakSet,se=function(t){return E(this,null,(function*(){try{yield w(this,ne,re).call(this),f(this,Qt).debug("Media keys initialization completed"),yield w(this,ne,ae).call(this,t.initData,t.initDataType)}catch(t){w(this,ne,de).call(this,{message:"Failed to handle encrypted event",code:"eme",isFatal:!0,error:t})}}))},re=function(){return E(this,null,(function*(){var t;if(f(this,Qt).debug("Initializing media keys"),null==(t=f(this,qt))||!t.mediaKeys)return f(this,te)?(f(this,Qt).debug("Media keys initialization already in progress, waiting for completion"),void(yield f(this,te))):(b(this,te,E(this,null,(function*(){const t=yield f(this,$t).promise,e=yield f(this,ue).call(this,t);f(this,Qt).debug("CDM obtained",{cdm:e}),(0,s.a)(f(this,qt),"No media element found"),(0,s.a)(e,"No CDM found");const i=yield e.getMediaKeys();e.certificate&&(yield w(this,ne,ce).call(this,i,e.certificate)),f(this,Qt).debug("Setting media keys on media element"),yield f(this,qt).setMediaKeys(i),b(this,Jt,e)}))),void(yield f(this,te)));f(this,Qt).debug("Media keys already set on media element")}))},ae=function(t,e){return E(this,null,(function*(){(0,s.a)(f(this,Jt),"No CDM manager found");const i=yield f(this,Jt).getMediaKeys();if(!t||!w(this,ne,oe).call(this,t))return void f(this,Qt).debug("Duplicate initData, no need to create new session",{initData:t});const n=i.createSession();f(this,Qt).debug("Creating new session",{session:n}),n.addEventListener("keystatuseschange",f(this,he)),n.closed.then((t=>{f(this,Qt).info("Session is closed",{reason:t})})),n.addEventListener("message",f(this,le)),f(this,Yt).set(n,t),f(this,Qt).debug("Generating request for session",{session:n,initDataType:e,initData:t}),yield n.generateRequest(e,t)}))},oe=function(t){for(const[e,i]of f(this,Yt))if(fe(t,i))return!1;return!0},le=new WeakMap,he=new WeakMap,ce=function(t,e){return E(this,null,(function*(){try{f(this,Qt).debug("Setting server certificate",{certificate:e}),(yield t.setServerCertificate(e))||f(this,Qt).warn("Server certificates are not supported by the CDM.")}catch(t){f(this,Qt).error("Failed to set server certificate",{error:t})}}))},de=function(t){const{message:e,code:i,isFatal:n,error:s}=t;f(this,Qt).error(e,{error:s}),f(this,jt).emit("error",new kt(e,{code:i,isFatal:n},{error:s}))},ue=new WeakMap,me=function(t){const e=[];return t.clearkeys&&e.push("clearkey"),t.playreadyLicenseUrl&&e.push("playready"),t.widevineLicenseUrl&&e.push("widevine"),t.fairplayLicenseUrl&&t.fairplayCertificate&&e.push("fairplay"),e};const Se=(t,e=0)=>{for(let i=e;i<t.byteLength-4;i++){const e=1===t.getUint32(i),n=1==(t.getUint8(i)<<16|t.getUint16(i+1));if(e||n)return{position:i,nalPrefixSize:e?4:3}}},ke=t=>{const e=[],i=[];if(!(t=>0!==(t=>{const e=t.getUint32(0,!1);let i=0;return 1==(t.getUint8(0)<<16|t.getUint16(1,!1))?i+=3:1===e&&(i+=4),i})(new DataView(t,0)))(t)){const n=new DataView(t,0),s=31&n.getUint8(5);let r=6;for(let i=0;i<s;i++){const i=n.getUint16(r);e.push(t.slice(r+2,r+2+i)),r+=i+2}const a=n.getUint8(r);r+=1;for(let e=0;e<a;e++){const e=n.getUint16(r);i.push(t.slice(r+2,r+2+e)),r+=e+2}return{sequenceParameterSets:e,pictureParameterSets:i}}return((t,e)=>{const i=new DataView(t,0);let n=Se(i);for(;n;){const{position:s,nalPrefixSize:r}=n,a=Se(i,s+4),o=a?a.position-s-r:void 0;if(!e(new DataView(t,s+r,o)))return;n=a}})(t,(t=>{const n=t.byteOffset+t.byteLength;switch((t=>31&t)(t.getUint8(0))){case 8:i.push(t.buffer.slice(t.byteOffset,n));break;case 7:e.push(t.buffer.slice(t.byteOffset,n))}return!0})),{sequenceParameterSets:e,pictureParameterSets:i}},Ce=[{numerator:0,denumerator:0},{numerator:1,denumerator:1},{numerator:12,denumerator:11},{numerator:10,denumerator:11},{numerator:16,denumerator:11},{numerator:40,denumerator:33},{numerator:24,denumerator:11},{numerator:20,denumerator:11},{numerator:32,denumerator:11},{numerator:80,denumerator:33},{numerator:18,denumerator:11},{numerator:15,denumerator:11},{numerator:64,denumerator:33},{numerator:160,denumerator:99},{numerator:4,denumerator:3},{numerator:3,denumerator:2},{numerator:2,denumerator:1}];function Te(t){return{encoding:t.readUint8(),description:t.readUtf8String(),value:t.readUtf8String()}}function xe(t){const e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(let e=0,n=t.length;e<n;e++)i[e]=t.charCodeAt(e);return new Uint8Array(e)}const Ie={ftyp:xe("ftyp"),mvhd:xe("mvhd"),moov:xe("moov"),trak:xe("trak"),tkhd:xe("tkhd"),mdia:xe("mdia"),mdhd:xe("mdhd"),hdlr:xe("hdlr"),minf:xe("minf"),vmhd:xe("vmhd"),smhd:xe("smhd"),dinf:xe("dinf"),dref:xe("dref"),stbl:xe("stbl"),stsd:xe("stsd"),avc1:xe("avc1"),av01:xe("av01"),av1C:xe("av1C"),avcC:xe("avcC"),esds:xe("esds"),colr:xe("colr"),nclx:xe("nclx"),mvex:xe("mvex"),trex:xe("trex"),udta:xe("udta"),meta:xe("meta"),ilst:xe("ilst"),moof:xe("moof"),mfhd:xe("mfhd"),traf:xe("traf"),tfhd:xe("tfhd"),tfdt:xe("tfdt"),trun:xe("trun"),mdat:xe("mdat"),mp4a:xe("mp4a"),Opus:xe("Opus"),prft:xe("prft"),dOps:xe("dOps"),emsg:xe("emsg")},Re=xe("iso6"),Le=new Uint8Array([0,0,2,0]),Me=[Re,new Uint8Array([105,115,111,109]),new Uint8Array([105,115,111,50]),new Uint8Array([97,118,99,49]),new Uint8Array([109,112,52,49])],Pe=[Re,new Uint8Array([105,115,111,109]),new Uint8Array([105,115,111,50]),new Uint8Array([97,118,48,49]),new Uint8Array([109,112,52,49])],Be=[Re,new Uint8Array([105,115,111,109]),new Uint8Array([105,115,111,50]),new Uint8Array([109,112,52,49])];class Ue{constructor(){g(this,"writer",new V)}}const _e=(t,e,i)=>{t.writer.writeUint32(i+8),t.writer.writeBytes(e)},Ne=(t,e,i,n,s)=>{_e(t,e,i+4),t.writer.writeUint8(n),t.writer.writeUint24(s)},De=(t,e)=>{_e(t,Ie.ftyp,Re.byteLength+Le.byteLength+e.reduce(((t,e)=>t+e.byteLength),0)),t.writer.writeBytes(Re),t.writer.writeBytes(Le),e.forEach((e=>t.writer.writeBytes(e)))},Oe=t=>"sequenceParameterSets"in t,Fe=t=>"sequenceHeader"in t,We=t=>"video"==t.type,Ge=t=>"audio"==t.type,He=(t,e,i)=>{let n=3;for(t.writer.writeUint8(e);n>0;n--)t.writer.writeUint8(i>>7*n|128);t.writer.writeUint8(127&i)},ze=(t,e)=>{const i=t.writer.position();_e(t,Ie.minf,0),We(e)?(Ne(t,Ie.vmhd,8,0,1),t.writer.writeUint32(0),t.writer.writeUint32(0)):Ge(e)&&(Ne(t,Ie.smhd,4,0,0),t.writer.writeUint16(0),t.writer.writeUint16(0)),(t=>{const e=t.writer.position();_e(t,Ie.dinf,0),Ne(t,Ie.dref,16,0,0),t.writer.writeUint32(1),Ne(t,xe("url "),0,0,1),t.writer.writeUint32At(e,t.writer.position()-e)})(t),((t,e)=>{const i=t.writer.position();_e(t,Ie.stbl,0);const n=t.writer.position();Ne(t,Ie.stsd,0,0,0),t.writer.writeUint32(1),We(e)?((t,e)=>{const i=t.writer.position(),n=Fe(e)?Ie.av01:Ie.avc1;_e(t,n,0),t.writer.writeUint32(0),t.writer.writeUint16(0),t.writer.writeUint16(1),t.writer.writeUint16(0),t.writer.writeUint16(0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint16(e.width),t.writer.writeUint16(e.height),t.writer.writeUint32(4718592),t.writer.writeUint32(4718592),t.writer.writeUint32(0),t.writer.writeUint16(1),t.writer.writeUint8(0),t.writer.writeBytes(new Uint8Array(31)),t.writer.writeUint16(24),t.writer.writeUint16(-1),Oe(e)?((t,e)=>{const i=t.writer.position();_e(t,Ie.avcC,0),t.writer.writeUint8(1),t.writer.writeUint8(e.sequenceParameterSets[0][1]),t.writer.writeUint8(e.sequenceParameterSets[0][2]),t.writer.writeUint8(e.sequenceParameterSets[0][3]),t.writer.writeUint8(255),t.writer.writeUint8(224|e.sequenceParameterSets.length),e.sequenceParameterSets.forEach((e=>{t.writer.writeUint16(e.byteLength),t.writer.writeBytes(e)})),t.writer.writeUint8(e.pictureParameterSets.length),e.pictureParameterSets.forEach((e=>{t.writer.writeUint16(e.byteLength),t.writer.writeBytes(e)})),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e):Fe(e)&&(((t,e)=>{var i,n;const s=t.writer.position();_e(t,Ie.av1C,0);const{seqProfile:r,operatingPoints:a,colorConfig:o}=e.parsedSequenceHeader,l=a[0];t.writer.writeUint8(129),t.writer.writeUint8(r<<5|(null!=(i=null==l?void 0:l.seqLevelIdx)?i:0)),t.writer.writeUint8((null!=(n=null==l?void 0:l.tier)?n:0)|(o.highBitDepth?1:0)|(12===o.bitDepth?1:0)<<5|(o.monoChrome?1:0)<<4|o.subsamplingX<<3|o.subsamplingY<<2|65535&o.chromaSamplePosition),t.writer.writeUint8(0),t.writer.writeBytes(e.sequenceHeader),t.writer.writeUint32At(s,t.writer.position()-s)})(t,e),e.parsedSequenceHeader.colorConfig&&(_e(t,xe("colr"),11),t.writer.writeBytes(Ie.nclx),t.writer.writeUint16(e.parsedSequenceHeader.colorConfig.colorPrimaries),t.writer.writeUint16(e.parsedSequenceHeader.colorConfig.transferCharacteristics),t.writer.writeUint16(e.parsedSequenceHeader.colorConfig.matrixCoefficients),t.writer.writeUint8(e.parsedSequenceHeader.colorConfig.colorRange?1:0))),e.pixelAspectRatio&&(_e(t,xe("pasp"),8),t.writer.writeUint32(e.pixelAspectRatio.numerator),t.writer.writeUint32(e.pixelAspectRatio.denumerator)),e.bitrate&&(_e(t,xe("btrt"),12),t.writer.writeUint32(0),t.writer.writeUint32(e.bitrate),t.writer.writeUint32(e.bitrate)),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e):Ge(e)&&((t,e)=>{const i=t.writer.position();switch(_e(t,xe((t=>{switch(t){case"aac":case"mp3":return"mp4a";case"opus":return"Opus"}})(e.codec)),0),t.writer.writeUint32(0),t.writer.writeUint16(0),t.writer.writeUint16(1),t.writer.writeUint16(0),t.writer.writeUint16(0),t.writer.writeUint32(0),t.writer.writeUint16(e.channelCount),t.writer.writeUint16(16),t.writer.writeUint32(0),t.writer.writeUint16(e.sampleRate),t.writer.writeUint16(0),e.codec){case"aac":case"mp3":((t,e)=>{const i=e.decoderConfig.byteLength>0?e.decoderConfig.byteLength+5:0,n=t.writer.position();Ne(t,Ie.esds,0,0,0),He(t,3,21+i+5+1),t.writer.writeUint16(e.trackId),t.writer.writeUint8(0),He(t,4,13+i);const s="mp3"===e.codec&&e.sampleRate>24e3?107:64;t.writer.writeUint8(s),t.writer.writeUint8(21),t.writer.writeUint24(0),t.writer.writeUint32(e.bitrate||0),t.writer.writeUint32(e.bitrate||0),e.decoderConfig.byteLength>0&&(He(t,5,e.decoderConfig.byteLength),t.writer.writeBytes(e.decoderConfig)),He(t,6,1),t.writer.writeUint8(2),t.writer.writeUint32At(n,t.writer.position()-n)})(t,e);break;case"opus":((t,e)=>{const i=t.writer.position();_e(t,xe("dOps"),0),t.writer.writeUint8(0);const n=e.decoderConfig,s=new DataView(n.buffer,n.byteOffset,n.byteLength);t.writer.writeUint8(s.getUint8(9)),t.writer.writeUint16(s.getUint16(10,!0)),t.writer.writeUint32(s.getUint32(12,!0)),t.writer.writeUint16(s.getUint16(16,!0)),t.writer.writeBytes(e.decoderConfig.slice(18)),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e)}e.bitrate&&(_e(t,xe("btrt"),12),t.writer.writeUint32(0),t.writer.writeUint32(e.bitrate),t.writer.writeUint32(e.bitrate)),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(n,t.writer.position()-n),Ne(t,xe("stts"),4,0,0),t.writer.writeUint32(0),Ne(t,xe("stsc"),4,0,0),t.writer.writeUint32(0),Ne(t,xe("stsz"),8,0,0),t.writer.writeUint32(0),t.writer.writeUint32(0),Ne(t,xe("stco"),4,0,0),t.writer.writeUint32(0),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(i,t.writer.position()-i)},Ve=(t,e,i)=>{const n=t.writer.position();_e(t,Ie.trak,0),((t,e,i)=>{const n=t.writer.position();Ne(t,Ie.tkhd,0,0,3),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(e.trackId),t.writer.writeUint32(0),t.writer.writeUint32(e.duration*i/e.timescale),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint16(0),t.writer.writeUint16(Ge(e)?1:0),t.writer.writeUint16(Ge(e)?256:0),t.writer.writeUint16(0),t.writer.writeBytes(new Uint8Array([0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0])),We(e)?(t.writer.writeUint32(65536*e.width),t.writer.writeUint32(65536*e.height)):Ge(e)&&(t.writer.writeUint32(0),t.writer.writeUint32(0)),t.writer.writeUint32At(n,t.writer.position()-n)})(t,e,i),((t,e)=>{const i=t.writer.position();_e(t,Ie.mdia,0),((t,e)=>{Ne(t,Ie.mdhd,20,0,0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(e.timescale),t.writer.writeUint32(e.duration);const i=e.lang||"und",n=(31&i.charCodeAt(0))<<10|(31&i.charCodeAt(1))<<5|31&i.charCodeAt(2);t.writer.writeUint16(n),t.writer.writeUint16(0)})(t,e),((t,e)=>{const i=t.writer.position();Ne(t,Ie.hdlr,0,0,0),t.writer.writeUint32(0),t.writer.writeBytes(xe(We(e)?"vide":"soun")),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeBytes(xe(We(e)?"VideoHandler\0":"SoundHandler\0")),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),ze(t,e),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(n,t.writer.position()-n)},Xe=(t,e,i,n)=>{const s=t.writer.position();_e(t,Ie.moov,0),((t,e,i)=>{Ne(t,Ie.mvhd,96,0,0),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(i),t.writer.writeUint32(0),t.writer.writeUint32(65536),t.writer.writeUint16(256),t.writer.writeBytes(new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),t.writer.writeUint32(2)})(t,0,i),e.forEach((e=>Ve(t,e,i))),((t,e)=>{const i=t.writer.position();_e(t,Ie.mvex,0),e.forEach((e=>((t,e)=>{Ne(t,Ie.trex,20,0,0),t.writer.writeUint32(e.trackId),t.writer.writeUint32(1),t.writer.writeUint32(0),t.writer.writeUint32(0),t.writer.writeUint32(0)})(t,e))),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(s,t.writer.position()-s)},Qe=t=>t.isSync?33554432:16842752,je=(t,e)=>{const i=t.writer.position();_e(t,Ie.moof,0),((t,e)=>{Ne(t,Ie.mfhd,4,0,0),t.writer.writeUint32(e)})(t,e.sequenceNumber),((t,e)=>{const i=t.writer.position();_e(t,Ie.traf,0),((t,e)=>{const i=t.writer.position();Ne(t,Ie.tfhd,16,0,56),t.writer.writeUint32(e.trackId),t.writer.writeUint32(e.defaultDuration||0),t.writer.writeUint32(e.defaultSize||0),t.writer.writeUint32(e.defaultFlags||0),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),((t,e)=>{const i=t.writer.position();Ne(t,Ie.tfdt,8,1,0);const n=Math.floor(e.timestamp/4294967296),s=(4294967295&e.timestamp)>>>0;t.writer.writeUint32(n),t.writer.writeUint32(s),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),((t,e)=>{if(!e.samples[0])throw new Error("At least one sample must be provided");const i=e.samples.some((t=>!!t.compositionTimeOffset)),n=Qe(e.samples[0])!==e.defaultFlags,s=e.samples.length>1;let r=1;n&&(r|=4),i&&(r|=2048),s&&(r|=512,r|=256,r|=1024);const a=t.writer.position();Ne(t,Ie.trun,16,1,r),t.writer.writeUint32(e.samples.length);const o=t.writer.position();t.writer.writeUint32(0),n&&t.writer.writeUint32(Qe(e.samples[0]));for(const n of e.samples)s&&(t.writer.writeUint32(n.duration),t.writer.writeUint32(n.data.byteLength),t.writer.writeUint32(Qe(n))),i&&t.writer.writeUint32(n.compositionTimeOffset||0);t.writer.writeUint32At(o,t.writer.position()+8),t.writer.writeUint32At(a,t.writer.position()-a)})(t,e),t.writer.writeUint32At(i,t.writer.position()-i)})(t,e),t.writer.writeUint32At(i,t.writer.position()-i)},qe=(t,e)=>{const i=new Ue,n=t.filter((t=>We(t)&&Oe(t))).length>0;return t.filter((t=>We(t)&&Fe(t))).length>0?De(i,Pe):De(i,n?Me:Be),Xe(i,t,1e3),i.writer.buffer()},$e=t=>{const e=new Ue;return je(e,t),((t,e)=>{const i=e.samples.reduce(((t,e)=>t+e.data.byteLength),0);_e(t,Ie.mdat,i),e.samples.forEach((e=>t.writer.writeBytes(e.data)))})(e,t),e.writer.buffer()},Ze=t=>{const{sequenceParameterSets:e,pictureParameterSets:i}=ke(t),n=e[0],s=i[0];if(!n||!s)throw new Error("No sps or pps provided");return(t=>{var e;const i=new DataView(t),n=i.getUint8(1),s=i.getUint8(2),r=i.getUint8(3),a=new x(t,32);a.readUnsignedExpGolomb();let o=1;switch(n){case 100:case 110:case 122:case 244:case 44:case 83:case 86:case 118:case 128:case 138:case 144:if(o=a.readUnsignedExpGolomb(),3===o&&a.readBits(1),a.readUnsignedExpGolomb(),a.readUnsignedExpGolomb(),a.readBit(),a.readBit())for(let t=0;t<(3!=o?8:12);t++)if(a.readBit()){const e=t<6?16:64;let i=0,n=8,s=8;for(let t=0;t<e;t++)0!=s&&(i=a.readSignedExpGolomb(),s=(n+i+256)%256),n=0==s?n:s}}a.readUnsignedExpGolomb();const l=a.readUnsignedExpGolomb();if(0==l)a.readUnsignedExpGolomb();else if(1==l)throw new Error("Unhandled case");a.readUnsignedExpGolomb(),a.readBit();const h=a.readUnsignedExpGolomb(),c=a.readUnsignedExpGolomb(),d=a.readBit();0===d&&a.readBit(),a.readBit();let u=h+1,m=c+1;if(m*=2-d,m*=16,u*=16,a.readBit()){const t=1<<(1==o||2==o?1:0),e=2-d<<(1==o?1:0);u-=a.readUnsignedExpGolomb()*t+a.readUnsignedExpGolomb()*t,m-=a.readUnsignedExpGolomb()*e+a.readUnsignedExpGolomb()*e}let p={numerator:1,denumerator:1};return a.readBit()&&a.readBit()&&(p=null!=(e=Ce[a.readBits(8)])?e:{numerator:0,denumerator:0}),{width:u,height:m,pixelAspectRatio:p,profileIdc:n,constraintFlags:s,levelIdc:r}})(n)},Ke=t=>{const e=new x(t);return 1===e.peekBit()&&e.readBits(32),Je(e),Ye(e)},Je=t=>{const e=t.readBits(8);if(e>>7&1)return;const i=e>>3&15,n=e>>2&1,s=e>>1&1;return 1==n&&t.readBits(8),1==s&&(t=>{let e=0;for(let i=0;i<8;i++){const n=t.readBits(8);if(e|=(127&n)<<7*i,128&~n)break}})(t),{headerLength:1+n,type:i}},Ye=t=>{const e=t.readBits(3),i=0!==t.readBit(),n=0!==t.readBit();let s,r=!1,a=!1,o=!1,l=0,h=0;const c=[];if(n)t.readBits(5);else{if(a=0!==t.readBit(),a&&(s=(t=>{const e=t.readBits(32),i=t.readBits(32),n=0!==t.readBit();let s=0;return n&&(s=(t=>{let e=0;for(;e<100&&0===t.readBit();)e++;return e>=32?0:t.readBits(e)+(1<<e)-1})(t)+1),{timescale:i,equalPictureInterval:n,numUnitsInDisplayTick:e,numTicksPerPicture:s}})(t),r=0!==t.readBit(),r))throw new Error("Not implemented");o=0!==t.readBit();const e=t.readBits(5)+1;for(let i=0;i<e;i++){const e=t.readBits(12),i=t.readBits(5);let n=0;if(i>7&&(n=t.readBit()),r)throw new Error("decoderModelInfoPresentFlag==1");o&&0!==t.readBit()&&t.readBits(4),c.push({tier:n,operatingPointIdc:e,seqLevelIdx:i})}}const d=t.readBits(4)+1,u=t.readBits(4)+1,m=t.readBits(d)+1,p=t.readBits(u)+1;let g=!1;g=!n&&0!==t.readBit(),g&&(l=t.readBits(4)+2,h=t.readBits(3)+1);const A=0!==t.readBit(),f=0!==t.readBit(),v=0!==t.readBit();let b=!1,w=!1,y=!1,E=!1,S=!1,k=!1,C=!1,T=2,x=2,I=0;return n||(b=0!==t.readBit(),w=0!==t.readBit(),y=0!==t.readBit(),E=0!==t.readBit(),S=0!==t.readBit(),S&&(k=0!==t.readBit(),C=0!==t.readBit()),T=0!==t.readBit()?2:t.readBit(),x=T>0?t.readBit()>0?2:t.readBit():2,I=S?t.readBits(3):0),{seqProfile:e,stillPicture:i,reducedStillPictureHeader:n,timingInfoPresentFlag:a,timingInfo:null!=s?s:{equalPictureInterval:!1,numUnitsInDisplayTick:0,timescale:0,numTicksPerPicture:0},decoderModelInfoPresentFlag:r,initialDisplayDelayPresentFlag:o,operatingPoints:c,frameWidthBits:d,frameHeightBits:u,maxFrameWidth:m,maxFrameHeight:p,frameIdNumbersPresentFlag:g,deltaFrameIdLength:l,additionalFrameIdLength:h,use_128x128Superblock:A,enableFilterIntra:f,enableIntraEdgeFilter:v,enableInterintraCompound:b,enableMaskedCompound:w,enableWarpedMotion:y,enableDualFilter:E,enableOrderHint:S,enableJntComp:k,enableRefFrameMvs:C,seqForceScreenContentTools:T,seqForceIntegerMv:x,orderHintBits:I,enableSuperres:0!==t.readBit(),enableCdef:0!==t.readBit(),enableRestoration:0!==t.readBit(),colorConfig:ti(t,e),filmGrainParamsPresent:0!==t.readBit()}},ti=(t,e)=>{const i=0!==t.readBit();let n=8,s=!1;2===e&&i?n=0!==t.readBit()?12:10:e<=2&&(n=i?10:8),s=1!==e&&0!==t.readBit();const r=s?1:3;let a=2,o=2,l=2,h=!1,c=0,d=0,u=0,m=!1;return 0!==t.readBit()&&(a=t.readBits(8),o=t.readBits(8),l=t.readBits(8)),s?(h=0!==t.readBit(),c=1,d=1,u=0,m=!1,{highBitDepth:i,bitDepth:n,monoChrome:s,chromaSamplePosition:u,colorPrimaries:a,colorRange:h,matrixCoefficients:l,numPlanes:r,separateUvDeltaQ:m,subsamplingX:c,subsamplingY:d,transferCharacteristics:o}):1===a&&13==o&&0==l?(h=!0,c=0,d=0,{highBitDepth:i,bitDepth:n,monoChrome:s,chromaSamplePosition:u,colorPrimaries:a,colorRange:h,matrixCoefficients:l,numPlanes:r,separateUvDeltaQ:m,subsamplingX:c,subsamplingY:d,transferCharacteristics:o}):(h=0!==t.readBit(),0===e?(c=1,d=1):1===e?(c=0,d=0):12===n?(c=t.readBit(),d=0!==c?t.readBit():0):(c=1,d=0),0!==c&&0!==d&&(u=t.readBits(2)),m=0!==t.readBit(),{highBitDepth:i,bitDepth:n,monoChrome:s,chromaSamplePosition:u,colorPrimaries:a,colorRange:h,matrixCoefficients:l,numPlanes:r,separateUvDeltaQ:m,subsamplingX:c,subsamplingY:d,transferCharacteristics:o})},ei=t=>!!(1&t),ii=()=>"wakeLock"in navigator&&-1===window.navigator.userAgent.indexOf("Samsung");class ni{constructor(){g(this,"enabled",!1),g(this,"wakeLockVideo"),g(this,"_wakeLock",null),g(this,"handleVisibilityChange",(()=>{null!==this._wakeLock&&"visible"===document.visibilityState&&this.enable()})),ii()&&(this._wakeLock=null,document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange))}_addSourceToVideo(t,e,i){const n=document.createElement("source");n.src=i,n.type=`video/${e}`,t.appendChild(n)}get isEnabled(){return this.enabled}attach(t){if(!ii()){if(!this.wakeLockVideo){const t=document.createElement("video");this.wakeLockVideo=t,this.wakeLockVideo.setAttribute("title","Live Stream"),this.wakeLockVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.wakeLockVideo,"mp4","data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"),Object.assign(this.wakeLockVideo.style,{position:"absolute",left:"-100%",top:"-100%"}),this.wakeLockVideo.addEventListener("loadedmetadata",(()=>{t.addEventListener("timeupdate",(()=>{t.currentTime>.5&&(t.currentTime=Math.random())}))}))}t&&t.appendChild(this.wakeLockVideo)}}enable(){return E(this,null,(function*(){var t,e;return ii()?navigator.wakeLock.request("screen").then((t=>{this._wakeLock=t,this.enabled=!0,this._wakeLock.addEventListener("release",(()=>{}))})).catch((()=>{this.enabled=!1})):(null!=(e=null==(t=this.wakeLockVideo)?void 0:t.play())?e:Promise.resolve()).then((t=>(this.enabled=!0,t))).catch((()=>{this.enabled=!1}))}))}disable(){var t,e;ii()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):(null==(t=this.wakeLockVideo)||t.pause(),null==(e=this.wakeLockVideo)||e.remove()),this.enabled=!1}unload(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange),this.disable()}}const si=/\r\n|\r|\n/;var ri,ai,oi,li,hi;class ci{constructor(t){v(this,ri),v(this,ai),b(this,ri,t),b(this,ai,0)}skipEmptyLines(){let t=0;for(;""===f(this,ri)[f(this,ai)];)y(this,ai)._++,t++;return t}readLine(){return f(this,ri)[y(this,ai)._++]}takeUntilEmptyLine(){const t=[];for(;""!==f(this,ri)[f(this,ai)];){const e=this.readLine();if(void 0===e)break;t.push(e)}return t}linesLeft(){return f(this,ri).length-f(this,ai)}}ri=new WeakMap,ai=new WeakMap;class di{constructor(){v(this,oi)}parse(t){const e=[],i=t.split(si),n=new ci(i),s=n.readLine();if(!s||!s.startsWith("WEBVTT"))throw new Error("missing 'WEBVTT' signature");for(;""!==n.readLine(););for(;n.linesLeft()>0;){const t=w(this,oi,li).call(this,n);e.push(t),n.skipEmptyLines()}return e}}oi=new WeakSet,li=function(t){t.skipEmptyLines();const e=t.takeUntilEmptyLine(),i=new ci(e);let n,s=i.readLine();if(null!=s&&s.includes("--\x3e")||(n=s,s=i.readLine()),void 0===s)throw new Error("expected cue line");const[r,a]=s.split("--\x3e").map((t=>t.trim()));if(!r||!a)throw new Error(`a cue needs both start and end time start: ${r} end: ${a}`);const[o,l]=a.split(" ",1).map((t=>t.trim()));if(!o)throw new Error(`missing end time: ${o}`);const h=i.readLine();if(!h)throw new Error("missing text");return{id:n,startTime:w(this,oi,hi).call(this,r),endTime:w(this,oi,hi).call(this,o),text:h}},hi=function(t){const e=t.split(":");if(2==e.length){const[t=0,i=0]=e.map((t=>parseFloat(t)));return 60*t+i}const[i=0,n=0,s=0]=e.map((t=>parseFloat(t)));return 60*i*60+60*n+s};class ui extends n.E{constructor({type:t,autoplay:e,muted:i,logger:n,poster:s}){super(),g(this,"element"),g(this,"logger"),g(this,"seekTimes",new C(10)),g(this,"seekStartTime"),g(this,"_userProvidedMuted"),g(this,"timers",new dt),g(this,"_userHasProvidedInput",!1),g(this,"_isPaused",!0),g(this,"isActivated",!1),g(this,"dummy"),g(this,"_iosHackEnterPiPMode",(()=>{const t=this.element.parentElement,e=this.element.clientWidth/this.element.clientHeight;this.element.style.position="fixed",this.element.style.opacity="0",this.element.style.pointerEvents="none",t&&(this.dummy=document.createElement("video"),this.dummy.style.paddingBottom="calc(100% / "+e+")",this.dummy.style.width="100%",this.dummy.style.height="0px",t.appendChild(this.dummy))})),g(this,"_iosHackExitPiPMode",(()=>{this.element.style.position="relative",this.element.style.opacity="1",this.element.style.pointerEvents="auto",this.dummy&&(this.dummy.remove(),this.dummy=void 0)})),g(this,"attach",(t=>{this.element.remove(),t.appendChild(this.element)})),g(this,"load",(()=>{this.timers.setInterval(this.onPlayPause,500),this.timers.setTimeout((()=>{this.timers.setInterval(this.onBufferStateChange,500)}),1e4)})),g(this,"unload",(()=>{this.timers.unload()})),g(this,"getPlaybackRate",(()=>this.element.playbackRate)),g(this,"getPlaybackState",(()=>this.element.readyState>=this.element.HAVE_FUTURE_DATA?"playing":"buffering")),g(this,"setPlaybackRate",(t=>{this.element.playbackRate=t})),g(this,"getBuffer",(()=>{const t=[],e=this.element.buffered;if(!e)return[];for(let i=0;i<e.length;i++)t.push({start:1e3*e.start(i),end:1e3*e.end(i)});return t})),g(this,"pause",(()=>{this._isPaused=!1,this.element.pause()})),g(this,"tryPlay",(()=>{this.element.muted=this._userProvidedMuted,this._play().catch(T)})),g(this,"play",(()=>{this.element.muted=this._userProvidedMuted,this._play().catch((t=>{if(t instanceof Error){const e=new kt("Media Play Error",{source:t,isFatal:!1,code:"media_play_error"});this.emit("error",e)}}))})),g(this,"_play",(()=>E(this,null,(function*(){try{yield this.element.play(),this._userHasProvidedInput=!this.muted||this._userProvidedMuted}catch(t){if(!(t instanceof Error&&"NotAllowedError"===t.name))throw t;if(this._userHasProvidedInput=!1,!this.element.muted)return this.element.muted=!0,this.emit("needs user input",{forAudio:!0,forVideo:!1}),this._play();this.emit("needs user input",{forAudio:!0,forVideo:!0})}})))),g(this,"onEvent",(t=>{this.logger.trace(t.type,{state:this.element.readyState,event:t,playbackState:this.getPlaybackState()})})),g(this,"onVolumeChange",(()=>{this.logger.info("volume state",{isMuted:this.element.muted,volume:this.element.volume}),this.emit("volume state",{isMuted:this.element.muted,volume:this.element.volume})})),g(this,"onPlayPause",(()=>{this._isPaused!==this.element.paused&&(this._isPaused=this.element.paused,this.logger.info("player pause change",{paused:this.element.paused}),this.emit("media element state",this.element.paused?"paused":"playing"))})),g(this,"onBufferStateChange",(()=>{this.emit("buffer state",{isPaused:this.element.paused,buffered:this.getBuffer(),currentTime:this.currentTime,playbackState:this.getPlaybackState()})})),g(this,"onSeekStart",(()=>{this.seekStartTime=Date.now()})),g(this,"onSeekEnd",(()=>{this.seekStartTime&&(this.seekTimes.push(Date.now()-this.seekStartTime),this.seekStartTime=void 0)})),this.logger=n,this._userProvidedMuted=i,this.element=document.createElement(t),this.element instanceof HTMLVideoElement&&(this.element.playsInline=!0),this.element.controls=!1,this.element.autoplay=e,this.element.muted=i,this.element.style.display="block",this.element.style.width="100%",this.element.disableRemotePlayback=!0,this.element.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg=="),this.onPlayPause(),setTimeout((()=>{!this.element||!s||this.element.setAttribute("poster",s)}),0),this.element.addEventListener("stalled",this.onEvent),this.element.addEventListener("canplay",this.onEvent),this.element.addEventListener("loadeddata",this.onEvent),this.element.addEventListener("loadedmetadata",this.onEvent),this.element.addEventListener("canplaythrough",this.onEvent),this.element.addEventListener("waiting",this.onEvent),this.element.addEventListener("playing",this.onPlayPause),this.element.addEventListener("pause",this.onPlayPause),this.element.addEventListener("seeked",this.onSeekEnd),this.element.addEventListener("seeking",this.onSeekStart),this.element.addEventListener("volumechange",this.onVolumeChange),this.element.addEventListener("timeupdate",this.onBufferStateChange),this.element.addEventListener("progress",this.onBufferStateChange)}get seekTime(){return this.seekTimes.isEmpty()?0:Q(this.seekTimes.items())}get isSeeking(){return this.element.seeking}get currentTime(){return isNaN(this.element.currentTime)?0:1e3*this.element.currentTime}set currentTime(t){Number.isFinite(t)&&(this.element.currentTime=t/1e3)}get playbackRate(){return this.element.playbackRate}set playbackRate(t){this.element.playbackRate=t}get volume(){return this.element.volume}set volume(t){this.element.volume=t}get muted(){return this.element.muted}set muted(t){this._userProvidedMuted=t,this.element.muted=t}get userHasProvidedInput(){return this._userHasProvidedInput}get isPaused(){return this._isPaused}}const mi=["minBufferTime","maxBufferTime","burstEnabled","sizeBasedResolutionCapEnabled","separateVideoSocketEnabled","videoCodecs"];class pi{constructor(t){g(this,"options"),g(this,"overrides",new Map),this.options=t}getOptions(){return this.options}addOverrides(t,e){this.overrides.set(t,e)}set(t,e){this.options[t]=e}get(t,e){var i,n;if(e&&(n=t,mi.includes(n))){const n=null==(i=this.overrides.get(e))?void 0:i[t];if(void 0!==n)return n}return this.options[t]}getOverride(t,e){var i;return null==(i=this.overrides.get(e))?void 0:i[t]}}const gi={cooldownTime:3e3,maxBufferingEvents:{last10Seconds:0},maxBufferingRatio:{last10Seconds:0},maxRecentDowngradesCount:3,maxDowngradeLookbackMs:6e4,minTimeSpentPlaying:{factor:.5,ratio:.1},maxCooldownRatio:2},Ai=t=>e=>e>t,fi=class{constructor(t,e,i,n){g(this,"qualityOfServiceSource"),g(this,"config"),g(this,"emitter"),g(this,"logger"),g(this,"isSuspended",!1),g(this,"lastAdaptTime",Date.now()),g(this,"isEnabled",!0),g(this,"load",(()=>{this.emitter.on("buffer state",this.onBufferState),this.emitter.on("adapted level",this.onAdaptedLevel)})),g(this,"unload",(()=>{this.emitter.off("buffer state",this.onBufferState),this.emitter.off("adapted level",this.onAdaptedLevel)})),g(this,"suspend",(()=>{this.isSuspended=!0})),g(this,"unsuspend",(()=>{this.reset(),this.isSuspended=!1})),g(this,"reset",((t=0)=>{this.lastAdaptTime=Date.now()+t})),g(this,"getStatistics",(()=>({isAbrEnabled:this.isEnabled}))),g(this,"isQoSOk",(t=>{const e=this.qualityOfServiceSource.getLevelStats(t),{upgradesFromLevel:i,downgradesFromLevel:n}=null!=e?e:{upgradesFromLevel:[],downgradesFromLevel:[]},s=Date.now()-this.config.maxDowngradeLookbackMs,r=n.filter(Ai(s)).length,a=i.filter(Ai(s)).length;if(r-a>this.config.maxRecentDowngradesCount)return this.logger.debug("Recent downgrades count is over maximum",{downgrades:r-a,maxRecentDowngradesCount:this.config.maxRecentDowngradesCount}),!1;const o=this.qualityOfServiceSource.timeSpentPlayingInAtLeastLevelRatio(t),l=o*(this.qualityOfServiceSource.timeActive()-this.qualityOfServiceSource.timeSpentBuffering())/this.config.maxDowngradeLookbackMs;if(r>1&&l<this.config.minTimeSpentPlaying.factor)return this.logger.debug("Time spent playing is too low",{recentDowngrades:r,timeSpentPlayingInAtLeastLevelRatio:o}),!1;if(r>1&&o<this.config.minTimeSpentPlaying.ratio)return this.logger.debug("Time spent playing in at least this level is too low",{recentDowngrades:r,timeSpentPlayingInAtLeastLevelRatio:o}),!1;const h=Math.max(0,n.length-i.length-l),c=Date.now()-this.config.maxDowngradeLookbackMs*h,d=n.filter(Ai(c)).length;return!(d&&h>this.config.maxCooldownRatio&&(this.logger.debug("Too many downgrades compared to time spent playing",{downgradesWithinCooldownTime:d,cooldownRatio:h}),1))})),g(this,"onBufferState",(t=>{if(!this.isEnabled||this.isSuspended||this.lastAdaptTime+this.config.cooldownTime>Date.now())return;const{bufferFullness:e,general:i}=this.qualityOfServiceSource.getMetrics(),n=this.qualityOfServiceSource.getBufferFullnessRegression();if(!n)return;const{slope:s}=n,r=n.predict(15),a=s<0,o=n.predict(15)<.4&&n.slope<0,l=n.predict(15)>.6,h=this.qualityOfServiceSource.timeSpentBufferingLast(3e4),c=this.qualityOfServiceSource.timeSpentActiveLast(3e4);e<.15&&h/c>.8?this.adaptLevel("reconnect"):i.decodeRate<=1?this.adaptLevel("downgrade"):o||e<.15?a&&e<.4&&r<.2&&this.adaptLevel("buffering"===t.playbackState?"double downgrade":"downgrade"):e>.5&&l&&!this.tooMuchTimeBuffering(1e4)&&!this.tooManyBufferingEvents(1e4)&&this.adaptLevel("upgrade")})),g(this,"onAdaptedLevel",(()=>{this.reset()})),g(this,"adaptLevel",(t=>this.emitter.emit("adapt level",t))),this.qualityOfServiceSource=i,this.config=m(m({},gi),n),this.emitter=t,this.logger=e}tooMuchTimeBuffering(t){return this.qualityOfServiceSource.timeSpentBufferingLast(t)/this.qualityOfServiceSource.timeSpentActiveLast(t)>this.config.maxBufferingRatio.last10Seconds}tooManyBufferingEvents(t){return this.qualityOfServiceSource.timeSpentBufferingLast(t)>this.config.maxBufferingEvents.last10Seconds}};g(fi,"create",((t,e,i,n={})=>new fi(t,e,i,n)));let vi=fi;const bi={minBufferTime:1500,maxBufferTime:1500,cooldownTime:3e4,maxBufferingEvents:{last30Seconds:3},maxBufferingRatio:{last30Seconds:.15}},wi=class t{constructor(e,i,n,s,r){g(this,"qualityOfServiceSource"),g(this,"targetBufferTimeTarget"),g(this,"config"),g(this,"emitter"),g(this,"logger"),g(this,"isSuspended",!1),g(this,"lastIncreaseTime",Date.now()),g(this,"bufferTimeAdjustmentCount",0),g(this,"load",(()=>{this.emitter.on("buffer state",this.onBufferState)})),g(this,"unload",(()=>{this.emitter.off("buffer state",this.onBufferState)})),g(this,"suspend",(()=>{this.isSuspended=!0})),g(this,"unsuspend",(()=>{this.reset(),this.isSuspended=!1})),g(this,"reset",(()=>{this.lastIncreaseTime=Date.now()})),g(this,"getStatistics",(()=>({bufferTimeAdjustmentCount:this.bufferTimeAdjustmentCount}))),g(this,"onBufferState",(e=>{const{minBufferTime:i,maxBufferTime:n,cooldownTime:s}=this.config;if(this.isSuspended||this.lastIncreaseTime+s>Date.now()||this.targetBufferTimeTarget.targetBufferTime>=n)return;const r=this.qualityOfServiceSource.timeSpentBufferingLast(3e4),a=this.qualityOfServiceSource.bufferingEventsLast(3e4),o=r/this.qualityOfServiceSource.timeSpentActiveLast(3e4),l=Math.ceil(Math.max((n-i)/(t.BUFFER_TIME_MAX_STEPS-1),t.BUFFER_TIME_STEP_SIZE));(o>this.config.maxBufferingRatio.last30Seconds||a>this.config.maxBufferingEvents.last30Seconds)&&(this.targetBufferTimeTarget.targetBufferTime=Math.min(n,this.targetBufferTimeTarget.targetBufferTime+l),this.bufferTimeAdjustmentCount++,this.reset())})),this.qualityOfServiceSource=n,this.targetBufferTimeTarget=s,this.config=m(m({},bi),r),this.emitter=e,this.logger=i}updateConfig(t){this.config=m(m({},this.config),t)}};g(wi,"BUFFER_TIME_STEP_SIZE",500),g(wi,"BUFFER_TIME_MAX_STEPS",3),g(wi,"create",((t,e,i,n,s={})=>new wi(t,e,i,n,s)));let yi=wi;class Ei extends n.E{constructor(t,e){super(),g(this,"options"),g(this,"websockets",[]),g(this,"logger"),g(this,"reconnectState",{reconnectRetries:0}),g(this,"isSuspended",!1),g(this,"_connectionAttemptCount",0),g(this,"connectStartTime",0),g(this,"_connectTime"),g(this,"shouldContinueConnecting",!1),g(this,"_isConnectInProgress",!1),g(this,"readyState",(()=>{if(0===this.websockets.length)return WebSocket.CLOSED;const t=this.websockets.map((t=>t.readyState));for(const e of t)if(e!==WebSocket.OPEN)return e;return WebSocket.OPEN})),g(this,"url",(()=>{var t;return null==(t=this.websockets[0])?void 0:t.url})),g(this,"send",(t=>{var e;this.websockets.length&&(null==(e=this.websockets[0])||e.send(t))})),g(this,"close",(t=>{var e;let i=!1;return null==(e=this.websockets)||e.forEach((e=>{e.onmessage=T,e.removeEventListener("error",this.onError),e.removeEventListener("close",this.onClose),e.removeEventListener("open",this.onOpen),e.close(1e3,t),i=!0})),this.websockets=[],this.shouldContinueConnecting=!1,this._isConnectInProgress=!1,this.logger.info("Closed websocket",{reason:t}),i})),g(this,"suspend",(()=>{this.isSuspended=!0})),g(this,"unsuspend",(()=>{this.isSuspended=!1,this.readyState()!==WebSocket.OPEN&&!this.isConnectInProgress&&this.connect()})),g(this,"onMessage",((t,e)=>{0!==this.websockets.length&&this.options.onMessage(t,e.data)})),g(this,"onError",(()=>{this.logger.info("On error",m({},this.options)),this.close("one websocket had an error"),this.emit("error",new kt("WebSocket error",{code:"websocket_error",isFatal:!1}))})),g(this,"onClose",(t=>{switch(this.logger.info("Closed",p(m({},this.options),{reason:t.reason,code:t.code,isSuspended:this.isSuspended})),this.close("one websocket was closed"),t.code){case 4e3:case 4001:this.emit("error",Mt(Lt()));break;case 4002:this.emit("error",(e=Lt(),new kt("Authentication Expired",{isFatal:!0,code:"authentication_expired",source:e})));break;case 4003:this.emit("error",Pt("internal",Lt()));break;case 4010:this.emit("error",((t,e)=>new kt("Connection closed due to inactivity",{isFatal:!1,code:"connection_inactivity",source:e,type:"internal"}))(0,Lt()))}var e;this.emit("close",this)})),g(this,"onOpen",(()=>{this.logger.info("Opened",m({},this.options)),this.readyState()===WebSocket.OPEN&&(this._connectTime=Date.now()-this.connectStartTime,this.reconnectState.reconnectRetries=0,this._isConnectInProgress=!1,this.emit("open",this))})),g(this,"connect",((t=!1)=>E(this,null,(function*(){if(this.isConnectInProgress)return this.logger.info("Connect already in progress"),!1;if(this.isSuspended)return!1;if(this.readyState()!==WebSocket.CLOSED&&this.close("new connection in progress"),this.shouldContinueConnecting=!0,this._isConnectInProgress=!0,t&&this.options.reconnectDelay>0){this.logger.info("Waiting for reconnect delay",m({},this.options)),yield mt(this.options.reconnectDelay);const t=yield this.options.reconnectHandler(this.reconnectState);if(this.reconnectState.reconnectRetries++,!t)return this._isConnectInProgress=!1,this.emit("error",Bt()),!1}this._connectionAttemptCount++;try{if(!this.shouldContinueConnecting)return this._isConnectInProgress=!1,this.logger.info("Connection aborted"),!1;const{url:t,connectionCount:e}=yield this.options.connectHandler();if(this.connectStartTime=Date.now(),!this.shouldContinueConnecting)return this._isConnectInProgress=!1,this.logger.info("Connection aborted"),!1;this.logger.info("Connecting websockets",p(m({},this.options),{url:t}));for(let i=0;i<e;i++){const e=new WebSocket(t);e.binaryType="arraybuffer",e.onmessage=t=>this.onMessage(i,t),e.addEventListener("error",this.onError),e.addEventListener("close",this.onClose),e.addEventListener("open",this.onOpen),this.websockets.push(e)}return!0}catch(t){return this._isConnectInProgress=!1,t instanceof kt&&(this.logger.error("Failed to connect",t.toStringifiable()),t.isFatal())||this.shouldContinueConnecting&&(this.logger.info("Connection aborted",{error:t}),this.emit("error",new kt("Failed to connect",{code:"failed_to_connect",isFatal:!1,source:t,type:"internal"}))),!1}})))),this.options=t,this.logger=e}get isConnectInProgress(){return this._isConnectInProgress}get connectionCount(){return this.websockets.length}get connectionAttemptCount(){return this._connectionAttemptCount}get connectTime(){return this._connectTime}}const Si=t=>471859200/t,ki=class t{constructor(e,i,n){g(this,"emitter"),g(this,"transport"),g(this,"logger"),g(this,"config"),g(this,"rtts",new C(10)),g(this,"lastPingSentTime",Date.now()),g(this,"isPingInFlight",!1),g(this,"connectCount",0),g(this,"_firstConnectionTime"),g(this,"_lastConnectionTime"),g(this,"missedPings",0),g(this,"_estimatedPingBandwidth"),g(this,"contextSwitchesInProgress",new Set),g(this,"contextSwitchesCompleted",new Set),g(this,"buffer",[]),g(this,"disconnected",new k),g(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.close("Unloading"),this.emitter.off("send signal",this.sendSignal),this.emitter.off("disconnect",this.close),this.emitter.off("reconnect",this.reconnect),this.logger.debug("Unloaded module")})),g(this,"suspend",(()=>{this.resetPingState(),this.transport.suspend()})),g(this,"unsuspend",(()=>{this.transport.unsuspend()})),g(this,"getState",(()=>{switch(this.transport.readyState()){case WebSocket.OPEN:return"connected";case WebSocket.CONNECTING:return"connecting";default:return"disconnected"}})),g(this,"sendSignal",(t=>{this.logger.debug("sending signal",{signal:t}),this.transport.readyState()===WebSocket.OPEN?this.transport.send(JSON.stringify(t)):this.logger.debug("transport is closed")})),g(this,"getStatistics",(()=>{var t;const e=j(this.rtts.items());return{rtt:e,estimatedBandwidth:Si(e.average),edgeUrl:null==(t=this.transport)?void 0:t.url(),connectionProtocol:"vindral_ws"}})),g(this,"onMessage",((t,e)=>{var i;if(this.pingCooldownExpired()&&this.sendPing(),this.contextSwitchesCompleted.size===(null==(i=this.transport)?void 0:i.connectionCount)){this.logger.info("Completing context switch"),this.contextSwitchesInProgress.clear(),this.contextSwitchesCompleted.clear();const t=this.buffer.filter((([t,e])=>!(e instanceof ArrayBuffer))),e=this.buffer.filter((([t,e])=>e instanceof ArrayBuffer));t.map((t=>this.handleMessage(t[0],t[1]))),e.map((t=>this.handleMessage(t[0],t[1]))),this.buffer=[]}if(this.contextSwitchesInProgress.has(t)){if(!(e instanceof ArrayBuffer)){const i=JSON.parse(e);if(wt(i)&&"context switch complete"===i.type)return this.logger.info("context switch completed",{socketId:t}),this.emitter.emit("context switch complete"),void this.contextSwitchesCompleted.add(t)}this.buffer.push([t,e])}else this.handleMessage(t,e)})),g(this,"resolveEdgeUrl",(()=>E(this,null,(function*(){const t=this.config.connectInfo,e=yield this.config.onConnectInfo(t),i=this.config.options.getOverride("separateVideoSocketEnabled",e.channelId);let n=1;"audio+video"===this.config.options.get("media")&&(n=!1!==i?2:1);const s=((t,e)=>{const i=new URL("/subscribe",t);return i.searchParams.append("channelId",e.channelId),i.searchParams.append("sessionId",e.sessionId),i.searchParams.append("clientId",e.clientId),e.audio&&e.audio.codec&&(i.searchParams.append("audio.bitRate",Math.round(e.audio.bitRate).toString()),i.searchParams.append("audio.codec",e.audio.codec),e.audio.language&&i.searchParams.append("audio.language",e.audio.language)),e.video&&e.video.codec&&(i.searchParams.append("video.width",e.video.width.toString()),i.searchParams.append("video.height",e.video.height.toString()),i.searchParams.append("video.bitRate",Math.round(e.video.bitRate).toString()),i.searchParams.append("video.codec",e.video.codec)),e.expectAdditionalConnection&&i.searchParams.append("expectAdditionalConnection",e.expectAdditionalConnection.toString()),e.burstMs&&i.searchParams.append("burstMs",e.burstMs.toString()),e.channelGroupId&&i.searchParams.append("channelGroupId",e.channelGroupId),e.authToken&&(i.searchParams.append("auth.token",e.authToken),i.searchParams.append("auth.type","jwt")),i.toString()})(this.config.edgeUrl,{video:e.video,audio:e.audio,burstMs:e.burstMs,sessionId:e.sessionId,clientId:e.clientId,channelId:e.channelId,channelGroupId:e.channelGroupId,expectAdditionalConnection:n>1,authToken:this.config.options.get("authenticationToken")});return this.logger.debug("Resolved edge url",{edgeUrl:s}),{url:s,connectionCount:n}})))),g(this,"handleMessage",((t,e)=>{if(e instanceof ArrayBuffer)this.emitter.emit("received data",e);else{const i=JSON.parse(e);if(!wt(i))return;switch(i.type){case"pong":this.lastPingSentTime&&(this.rtts.push(Date.now()-this.lastPingSentTime),this.isPingInFlight=!1,this.emitter.emit("rtt",this.rtt));break;case"context switch":this.logger.info("Starting context switch",{socketId:t}),this.emitter.emit("context switch started"),this.contextSwitchesInProgress.add(t);break;default:this.emitter.emit("received signal",i)}}})),g(this,"connectWebSocketTransport",(()=>{const t=new Ei({reconnectDelay:1e3,onMessage:this.onMessage,reconnectHandler:this.config.reconnectHandler,connectHandler:this.resolveEdgeUrl},this.logger.createContext("Transport"));return t.on("open",this.onTransportChange),t.on("close",this.onTransportChange),t.on("error",(t=>this.disconnected.reject(t))),t.connect(),t})),g(this,"close",((t="Disconnect Requested")=>{var e;this.contextSwitchesCompleted.clear(),this.contextSwitchesInProgress.clear(),this.buffer=[],this.resetPingState(),this.disconnected.resolve(),null==(e=this.transport)||e.close(t)})),g(this,"onTransportChange",(()=>{var e;"connected"===this.getState()?(null!=(e=this.transport)&&e.connectTime&&(this.rtts.push(this.transport.connectTime/t.TLS_ROUNDTRIPS/this.transport.connectionCount),this.emitter.emit("rtt",this.rtt)),this._lastConnectionTime=Date.now(),this._firstConnectionTime||(this._firstConnectionTime=this._lastConnectionTime),this.connectCount++,this.resetPingState()):(this.contextSwitchesCompleted.clear(),this.contextSwitchesInProgress.clear(),this.buffer=[],this.resetPingState(),this.disconnected.resolve()),this.emitter.emit("connection state",this.getState())})),g(this,"reconnect",(t=>{this.transport.isConnectInProgress?this.logger.debug("Stopping reconnect, already mid-connection"):this.close(t)})),g(this,"resetPingState",(()=>{this.missedPings=0,this.isPingInFlight=!1})),g(this,"pingCooldownExpired",(()=>Date.now()-this.lastPingSentTime>t.PING_INTERVAL)),g(this,"sendPing",(()=>{if(this.isPingInFlight)return this.missedPings++,void(this.missedPings>t.MAX_MISSED_PINGS&&this.reconnect("missed pings"));this.isPingInFlight=!0,this.lastPingSentTime=Date.now(),this.missedPings=0,this.sendSignal({type:"ping"})})),this._estimatedPingBandwidth=Si(n.estimatedRtt),this.logger=i,this.emitter=e,this.config=n,this.emitter.on("send signal",this.sendSignal),this.emitter.on("disconnect",this.close),this.emitter.on("reconnect",this.reconnect),this.disconnected.promise.catch(T),this.transport=this.connectWebSocketTransport()}get rtt(){return this.rtts.items().length>0?Q(this.rtts.items()):0}get estimatedBandwidth(){return this.rtt>0?Si(this.rtt):this._estimatedPingBandwidth}get firstConnectionTime(){return this._firstConnectionTime}get lastConnectionTime(){return this._lastConnectionTime}closed(){return this.disconnected.promise}};g(ki,"PING_INTERVAL",5e3),g(ki,"MAX_MISSED_PINGS",4),g(ki,"TLS_ROUNDTRIPS",3),g(ki,"start",((t,e,i)=>new Promise(((n,s)=>{const r=new ki(t,e,i);r.transport.once("error",(t=>s(t))),r.transport.once("open",(()=>n(r)))}))));let Ci=ki;var Ti,xi,Ii,Ri,Li,Mi,Pi,Bi,Ui,_i,Ni;class Di{constructor(t){v(this,Ti),v(this,xi,[]),v(this,Ii),b(this,Ti,t)}select(t){if(f(this,Ti).edgeUrl)return f(this,Ti).edgeUrl;0===f(this,xi).length&&b(this,xi,f(this,xi).concat(t));const e=f(this,xi).shift();return b(this,Ii,e),e||void 0}shiftedEdge(){return f(this,Ii)}reset(){b(this,Ii,void 0),b(this,xi,[])}}Ti=new WeakMap,xi=new WeakMap,Ii=new WeakMap;const Oi=class t{constructor(e,i,n){v(this,_i),g(this,"emitter"),g(this,"logger"),g(this,"config"),g(this,"apiClient"),g(this,"connectionImpl"),v(this,Ri,!0),v(this,Li),v(this,Mi,0),v(this,Pi,0),g(this,"unload",(()=>{var t;this.logger.debug("Unloading module..."),this.disconnect("Unloading"),null==(t=this.connectionImpl)||t.unload(),this.logger.debug("Unloaded module")})),g(this,"suspend",(()=>{var t;b(this,Ri,!1),null==(t=this.connectionImpl)||t.suspend()})),g(this,"unsuspend",(()=>{var t;b(this,Ri,!0),null==(t=this.connectionImpl)||t.unsuspend(),this.connect()})),g(this,"getState",(()=>this.connectionImpl?this.connectionImpl.getState():"disconnected")),g(this,"getStatistics",(()=>this.connectionImpl?p(m({},this.connectionImpl.getStatistics()),{connectCount:f(this,Pi),connectionAttemptCount:f(this,Mi)}):{rtt:{min:0,max:0,average:0,last:0},estimatedBandwidth:0,connectCount:f(this,Pi),connectionAttemptCount:f(this,Mi),connectionProtocol:void 0})),g(this,"connect",(()=>{b(this,Ri,!0),!f(this,Li)&&b(this,Li,w(this,_i,Ni).call(this))})),g(this,"disconnect",((t="Disconnect Requested")=>{var e;b(this,Ri,!1),null==(e=this.connectionImpl)||e.close(t)})),g(this,"reconnect",(t=>{this.disconnect(t),this.connect()})),v(this,Bi,(()=>E(this,null,(function*(){try{return yield this.apiClient.connect(this.config.options.getOptions())}catch(e){if((0,s.b)(e))switch(e.status){case 401:throw this.emitter.emit("error",Mt(e)),Mt(e);case 403:throw this.emitter.emit("error",Ut(e.message)),Ut(e.message)}throw this.emitter.emit("error",(t=e instanceof Error?e:void 0,new kt("Connection attempt failed",{isFatal:!1,code:Et,source:t}))),e}var t})))),v(this,Ui,(()=>E(this,null,(function*(){const e=Date.now(),i=()=>Date.now()-e;return Promise.race([mt(t.PING_TIMEOUT),fetch(new URL("/api/v4/connect/ping",this.config.options.get("url")).toString(),{method:"HEAD"})]).then(i,i)})))),this.logger=i,this.emitter=e,this.config=n,this.apiClient=new s.A({publicEndpoint:this.config.options.get("url").toString(),tokenFactory:()=>this.config.options.get("authenticationToken")})}get rtt(){var t,e;return null!=(e=null==(t=this.connectionImpl)?void 0:t.rtt)?e:0}get estimatedBandwidth(){var t;return(null==(t=this.connectionImpl)?void 0:t.estimatedBandwidth)||Number.MAX_SAFE_INTEGER}get firstConnectionTime(){var t;return null==(t=this.connectionImpl)?void 0:t.firstConnectionTime}get lastConnectionTime(){var t;return null==(t=this.connectionImpl)?void 0:t.lastConnectionTime}};Ri=new WeakMap,Li=new WeakMap,Mi=new WeakMap,Pi=new WeakMap,Bi=new WeakMap,Ui=new WeakMap,_i=new WeakSet,Ni=function(){return E(this,null,(function*(){var t;const e=new Di({edgeUrl:this.config.options.get("edgeUrl")});for(b(this,Mi,0);;){y(this,Mi)._++;try{const[t,n]=yield Promise.all([f(this,Bi).call(this),f(this,Ui).call(this)]),r=n/2;if(!f(this,Ri))break;const a=e.select(t.edges);if(!a)throw new kt("Failed to resolve edge url",{isFatal:!0,code:"failed_to_resolve_edge_url"});if((0,s.i)(t)){const{MoqConnectionAdapter:e}=yield i.e(487).then(i.bind(i,4487));this.connectionImpl=yield e.start(this.emitter,this.logger,this.apiClient,p(m({},this.config),{connectInfo:t,estimatedRtt:r,edgeUrl:a}))}else(0,s.a)("string"==typeof a,"Edge URL is expected to be a string"),this.connectionImpl=yield Ci.start(this.emitter,this.logger,p(m({},this.config),{connectInfo:t,estimatedRtt:r,edgeUrl:a}));e.reset(),y(this,Pi)._++,b(this,Mi,0),yield this.connectionImpl.closed()}catch(t){this.logger.info("Failed to connect",t);const i=e.shiftedEdge();i&&this.emitter.emit("telemetry event",{code:"shifted_edge",edgeUrl:"string"==typeof i?i:i.moqUrl||i.moqWsUrl}),t instanceof kt&&this.emitter.emit("error",t)}if(null==(t=this.connectionImpl)||t.unload(),this.connectionImpl=void 0,!f(this,Ri))break;if(!(yield this.config.reconnectHandler({reconnectRetries:f(this,Mi)}))){this.emitter.emit("error",Bt());break}if(yield mt(1e3),!f(this,Ri))break}b(this,Li,void 0)}))},g(Oi,"PING_TIMEOUT",1e3),g(Oi,"create",((t,e,i)=>new Oi(t,e,i)));let Fi=Oi;const Wi=()=>({video:p(m({},bt()),{bitRate:vt()}),audio:{bitRate:vt()}}),Gi=class t{constructor(e,i,n,s){g(this,"emitter"),g(this,"timers",new dt),g(this,"pictureInPictureSource"),g(this,"element"),g(this,"currentCap"),g(this,"userSpecifiedCap"),g(this,"renditionLevelSource"),g(this,"resizeObserver"),g(this,"elementSize"),g(this,"_sizeBasedResolutionCapEnabled"),g(this,"unload",(()=>{var t;this.emitter.off("enter picture in picture",this.enterPictureInPicture),this.emitter.off("exit picture in picture",this.exitPictureInPicture),null==(t=this.resizeObserver)||t.disconnect(),this.suspend()})),g(this,"load",(()=>{window.ResizeObserver&&(this.resizeObserver=new ResizeObserver(this.onResize),this.resizeObserver.observe(this.element)),this.evaluateConstraintCap()})),g(this,"unsuspend",(()=>{this.timers.setInterval(this.evaluateConstraintCap,t.CHECK_SIZE_INTERVAL),this.evaluateConstraintCap()})),g(this,"suspend",(()=>{this.timers.unload()})),g(this,"setUserSpecifiedCap",(t=>{var e;const i=null!=(e=this.getUserSpecifiedCap())?e:Wi();this.userSpecifiedCap=p(m({},i),{video:m(m({},i.video),t.video),audio:m(m({},i.audio),t.audio)}),this.evaluateConstraintCap()})),g(this,"getUserSpecifiedCap",(()=>this.userSpecifiedCap)),g(this,"getCurrentConstraintCap",(()=>this.currentCap)),g(this,"getStatistics",(()=>({constraintCap:this.getUserSpecifiedCap(),windowInnerWidth:window.innerWidth,windowInnerHeight:window.innerHeight,elementWidth:this.elementSize.width,elementHeight:this.elementSize.height,pixelRatio:window.devicePixelRatio}))),g(this,"constrainSubscription",(t=>{const e=this.getCurrentConstraintCap();return e&&(t.video.codec&&(t.video.bitRate=Math.min(e.video.bitRate,t.video.bitRate),t.video.width=Math.min(e.video.width,t.video.width),t.video.height=Math.min(e.video.height,t.video.height)),t.audio.codec&&(t.audio.bitRate=Math.min(e.audio.bitRate,t.audio.bitRate))),t})),g(this,"onResize",(t=>{t.forEach((t=>{this.elementSize={width:t.contentRect.width,height:t.contentRect.height}}))})),g(this,"evaluateConstraintCap",(()=>{var t,e,i,n,s;const r=this.sizeBasedResolutionCapEnabled?p(m({},Wi()),{video:{width:window.innerWidth,height:window.innerHeight,bitRate:vt()}}):Wi();if(!this.resizeObserver){const t=this.element.getBoundingClientRect();this.elementSize={width:t.width,height:t.height}}if(this.sizeBasedResolutionCapEnabled){const e=window.devicePixelRatio,i=null==(t=this.pictureInPictureSource)?void 0:t.getPictureInPictureSize();this.elementSize.width>0&&this.elementSize.height>0&&(r.video.width=this.elementSize.width,r.video.height=this.elementSize.height),i&&(r.video.width=i.width,r.video.height=i.height),r.video.width*=e,r.video.height*=e}const a=this.renditionLevelSource.getRenditionLevels().find((t=>{if(t.video)return t.video.width/t.video.height>r.video.width/r.video.height?t.video.width>r.video.width:t.video.height>r.video.height}));a&&a.video&&(r.video.width=a.video.width,r.video.height=a.video.height);const o=null==(e=this.userSpecifiedCap)?void 0:e.video,l=null==(i=this.userSpecifiedCap)?void 0:i.audio;o&&r.video.width>o.width&&r.video.height>o.height&&(r.video.width=o.width,r.video.height=o.height),r.video.bitRate=null!=(n=null==o?void 0:o.bitRate)?n:r.video.bitRate,r.audio.bitRate=null!=(s=null==l?void 0:l.bitRate)?s:r.audio.bitRate,$(r,this.currentCap)?this.currentCap=m({},r):(this.currentCap=m({},r),this.emitter.emit("constraint cap changed",r))})),g(this,"enterPictureInPicture",(t=>{this.pictureInPictureSource=t,this.evaluateConstraintCap()})),g(this,"exitPictureInPicture",(()=>{this.pictureInPictureSource=void 0,this.evaluateConstraintCap()})),this.element=i;const r=this.element.getBoundingClientRect();this.elementSize={width:r.width,height:r.height},this.emitter=e,this.renditionLevelSource=n,this._sizeBasedResolutionCapEnabled=s,this.emitter.on("enter picture in picture",this.enterPictureInPicture),this.emitter.on("exit picture in picture",this.exitPictureInPicture)}get sizeBasedResolutionCapEnabled(){return this._sizeBasedResolutionCapEnabled}set sizeBasedResolutionCapEnabled(t){this._sizeBasedResolutionCapEnabled=t,this.evaluateConstraintCap()}};g(Gi,"CHECK_SIZE_INTERVAL",1e3),g(Gi,"create",((t,e,i,n)=>new Gi(t,e,i,n)));let Hi=Gi;class zi{constructor(t,e,i,n){g(this,"timers",dt.create()),g(this,"logger"),g(this,"emitter"),g(this,"trackContexts"),g(this,"playbackSource"),g(this,"isSuspended",!1),g(this,"load",(()=>{this.timers.setInterval(this.emitDecodedFrames,100),this.timers.setInterval(this.emitDecodeRate,1e3),this.emitter.on("init segment",this.onInitSegment),this.emitter.on("coded sample",this.decode)})),g(this,"unload",(()=>{this.trackContexts.forEach((({decoderContext:t})=>t.unload())),this.timers.unload(),this.emitter.off("init segment",this.onInitSegment),this.emitter.off("coded sample",this.decode)})),g(this,"suspend",(()=>{this.isSuspended=!0})),g(this,"unsuspend",(()=>{this.isSuspended=!1})),g(this,"getBuffer",(t=>{var e;return null==(e=this.trackContexts.get(t))?void 0:e.buffer})),g(this,"videoDecodeRate",(()=>{var t,e,i;const n=this.trackContexts.get("video"),s=null!=(t=null==n?void 0:n.sampleDuration)?t:40,r=j(null!=(e=null==n?void 0:n.decodeTime.items())?e:[]),a=j(null!=(i=null==n?void 0:n.transportTime.items())?i:[]);return s/(r.average+a.average)})),g(this,"getStatistics",(()=>{var t,e,i,n;const s=this.trackContexts.get("video"),r=j(null!=(t=null==s?void 0:s.decodeTime.items())?t:[]),a=j(null!=(e=null==s?void 0:s.transportTime.items())?e:[]),o=j(null!=(n=null==(i=this.trackContexts.get("audio"))?void 0:i.decodeTime.items())?n:[]);return{videoDecodeRate:this.videoDecodeRate(),videoDecodeTime:r,audioDecodeTime:o,videoTransportTime:a}})),g(this,"onInitSegment",(({initSegment:t})=>{var e;const i=null==(e=this.trackContexts.get(t.type))?void 0:e.decoderContext;if(!i)throw new kt("No known decoder context",{code:"no_known_decoder_context",isFatal:!1});i.initSegment(t)})),g(this,"decode",(t=>{const e=this.trackContexts.get(t.type);if(!e)throw new kt("No known decoder context",{code:"no_known_decoder_context",isFatal:!1});if(this.isSuspended)return;e.sampleDuration=t.duration/t.timescale*1e3;const{decoderContext:i,buffer:n}=e,s=t.timestamp/t.timescale*1e3,r=t.duration/t.timescale*1e3,a=n[n.length-1];!a||s-5>a.end?n.push({start:s,end:s+r}):s+5*r<a.end?e.buffer=[{start:s,end:s+r}]:a.end=s+r,i.enqueue(t),this.emitDecodedFrames()})),g(this,"emitDecodedFrames",(()=>{let t;this.updateBufferState(),this.trackContexts.forEach((e=>{var i,n;let s;for(;void 0!==(s=null==(n=(i=e.decoderContext).error)?void 0:n.call(i));)this.emitter.emit("error",Ct(!1,s));for(;void 0!==(t=e.decoderContext.take());){const{statistics:i}=t;i&&(e.decodeTime.push(i.decodeTime),e.transportTime.push((i.transportTimeToWorker+i.transportTimeFromWorker)/i.samplesInBatch)),this.emitter.emit("decoded frame",t)}}))})),g(this,"emitDecodeRate",(()=>{this.emitter.emit("video decode rate",this.videoDecodeRate())})),g(this,"updateBufferState",(()=>{var t,e;let i;if(this.trackContexts.forEach((t=>{var e,n,s,r;if(i){const a=null!=(n=null==(e=t.buffer[t.buffer.length-1])?void 0:e.end)?n:0;(null!=(r=null==(s=i[i.length-1])?void 0:s.end)?r:0)>a&&(i=t.buffer)}else i=t.buffer})),!i)return;const n=this.playbackSource.currentTime<(null!=(e=null==(t=i[i.length-1])?void 0:t.end)?e:0)?"playing":"buffering";this.emitter.emit("buffer state",{buffered:i,currentTime:this.playbackSource.currentTime,isPaused:this.playbackSource.isPaused,playbackState:n})})),this.logger=e,this.emitter=t,this.trackContexts=i,this.playbackSource=n}static create(t,e,n,s,r){return E(this,null,(function*(){const a=new Map;for(const t of n)switch(t.type){case"audio":{const{OpusDecoderContext:e}=yield i.e(767).then(i.bind(i,6767));a.set(t.type,{buffer:[],decoderContext:yield e.create(48e3,2),decodeTime:new C(100),transportTime:new C(100),sampleDuration:40});break}case"video":{const{H264DecoderWorkerContext:e}=yield i.e(515).then(i.bind(i,6515));a.set(t.type,{buffer:[],decoderContext:yield e.create(r),decodeTime:new C(100),transportTime:new C(100),sampleDuration:40});break}}return new zi(t,e,a,s)}))}}const Vi=class{constructor(t){g(this,"emitter"),g(this,"isVisibleCount",0),g(this,"isHiddenCount",0),g(this,"isOnlineCount",0),g(this,"isOfflineCount",0),g(this,"isActive","visible"===document.visibilityState),g(this,"unload",(()=>{document.removeEventListener("visibilitychange",this.onVisibilityChanged),window.removeEventListener("pagehide",this.onPageHide),window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)})),g(this,"load",(()=>{document.addEventListener("visibilitychange",this.onVisibilityChanged),window.addEventListener("pagehide",this.onPageHide),window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)})),g(this,"unsuspend",(()=>{})),g(this,"getStatistics",(()=>{var t,e,i,n,s;return{isVisible:this.isVisible,isOnline:this.isOnline,isVisibleCount:this.isVisibleCount,isHiddenCount:this.isHiddenCount,isOnlineCount:this.isOnlineCount,isOfflineCount:this.isOfflineCount,navigatorRtt:null==(t=navigator.connection)?void 0:t.rtt,navigatorEffectiveType:null==(e=navigator.connection)?void 0:e.effectiveType,navigatorConnectionType:null==(i=navigator.connection)?void 0:i.type,navigatorSaveData:null==(n=navigator.connection)?void 0:n.saveData,navigatorDownlink:null==(s=navigator.connection)?void 0:s.downlink}})),g(this,"onOnline",(()=>this.isOnlineCount++)),g(this,"onOffline",(()=>this.isOfflineCount++)),g(this,"onPageHide",(t=>this.emitter.emit("pagehide",t))),g(this,"onVisibilityChanged",(()=>{this.setIsActive("visible"===document.visibilityState)})),g(this,"setIsActive",(t=>{t!==this.isActive&&(this.emitter.emit("page active",t),t?this.isVisibleCount++:this.isHiddenCount++),this.isActive=t})),this.emitter=t}get isOnline(){return navigator.onLine}get isVisible(){return"visible"===document.visibilityState}};g(Vi,"create",(t=>new Vi(t)));let Xi=Vi;const Qi=class t{constructor(e,i,n){var s;g(this,"logger"),g(this,"emitter"),g(this,"waitingEvents",[]),g(this,"isTriggered",(s=t.EVENT_TIMEOUT,(t,e,i)=>t.timestamp<=e||t.timestampAdded<=i-s)),g(this,"timeSource"),g(this,"timers",new dt),g(this,"load",(()=>{this.timers.setInterval(this.onBufferedStateChanged,t.EVENT_CHECK_INTERVAL),this.emitter.on("add event",this.addEvent)})),g(this,"unload",(()=>{this.timers.unload(),this.emitter.off("add event",this.addEvent)})),g(this,"addEvent",(t=>{this.logger.debug("Adding event",{event:t}),!this.waitingEvents.some((e=>void 0!==e.id&&e.id===t.id))&&this.waitingEvents.push(p(m({},t),{timestampAdded:Date.now()}))})),g(this,"extractEvent",((t,e)=>{"video"===e.type&&t.channelId!==e.channelId&&this.addEvent({type:"channel switch",channelId:e.channelId,timestamp:e.timestamp/e.timescale*1e3}),"audio"===e.type&&"audio"===t.type&&void 0!==e.language&&e.language!==t.language&&this.addEvent({type:"language switch",language:e.language,timestamp:e.timestamp/e.timescale*1e3})})),g(this,"onBufferedStateChanged",(()=>{var t;const e=Date.now(),i=null!=(t=this.timeSource.drift)?t:0,n=this.timeSource.serverCurrentTime-i;if(0===this.waitingEvents.length)return;const s=this.waitingEvents.filter((t=>this.isTriggered(t,n,e)));this.waitingEvents=this.waitingEvents.filter((t=>!this.isTriggered(t,n,e))),s.forEach((t=>{this.logger.debug("Emitting event",{event:t}),this.emitter.emit("event",t)}))})),this.logger=i,this.emitter=e,this.timeSource=n}};g(Qi,"EVENT_TIMEOUT",5e3),g(Qi,"EVENT_CHECK_INTERVAL",20),g(Qi,"create",((t,e,i)=>new Qi(t,e,i)));let ji=Qi;const qi=class t{constructor(e){g(this,"emitter"),g(this,"timers",dt.create()),g(this,"bytesReceived",new Map),g(this,"timeoutInterval"),g(this,"lastBytesUpdated",Date.now()),g(this,"load",(()=>{this.emitter.on("connection state",this.onConnectionState),this.timers.setInterval((()=>this.bytesReceived.forEach((t=>t.tick()))),100)})),g(this,"unload",(()=>{this.emitter.off("connection state",this.onConnectionState),this.timers.unload()})),g(this,"averageBitRate",(t=>{var e,i;return 8*(null!=(i=null==(e=this.bytesReceived.get(t))?void 0:e.average)?i:0)})),g(this,"totalBytesReceived",(()=>{let t=0;return this.bytesReceived.forEach((e=>{t+=e.total})),t})),g(this,"add",((e,i)=>{let n=this.bytesReceived.get(e);n||(n=new q(20),this.bytesReceived.set(e,n)),i>0&&(this.lastBytesUpdated=Date.now(),this.timeoutInterval||(this.timeoutInterval=this.timers.setInterval(this.checkTimeout,t.UPDATE_RECEIVED_BYTES_INTERVAL))),n.add(i)})),g(this,"getStatistics",(()=>({bytesReceived:this.totalBytesReceived(),videoBitRate:this.averageBitRate("video"),audioBitRate:this.averageBitRate("audio")}))),g(this,"onConnectionState",(e=>{this.clearTimeoutInterval(),"connected"===e&&(this.lastBytesUpdated=Date.now(),this.timeoutInterval=this.timers.setInterval(this.checkTimeout,t.UPDATE_RECEIVED_BYTES_INTERVAL))})),g(this,"checkTimeout",(()=>{const e=Date.now()-this.lastBytesUpdated;if(0===this.totalBytesReceived()&&e>t.NO_DATA_ERROR_TIMEOUT)return this.emitter.emit("error",new kt("No Incoming Data",{isFatal:!1,code:"no_incoming_data_error",source:undefined})),this.emitter.emit("reconnect","no incoming data"),void this.clearTimeoutInterval();e>t.NO_DATA_TIMEOUT&&this.totalBytesReceived()>0&&(this.emitter.emit("no data timeout",this.totalBytesReceived()),this.clearTimeoutInterval())})),g(this,"clearTimeoutInterval",(()=>{this.timeoutInterval&&(this.timers.clearInterval(this.timeoutInterval),this.timeoutInterval=void 0)})),this.emitter=e}};g(qi,"NO_DATA_ERROR_TIMEOUT",2e4),g(qi,"NO_DATA_TIMEOUT",5e3),g(qi,"UPDATE_RECEIVED_BYTES_INTERVAL",1e3),g(qi,"create",(t=>new qi(t)));let $i=qi;const Zi=class t extends n.E{constructor(){super(),g(this,"context",new(window.AudioContext||window.webkitAudioContext)),g(this,"timers",dt.create()),g(this,"previousCurrentTime",0),g(this,"_isStuck",!1),g(this,"mediaStreamDestination"),g(this,"unload",(()=>(this.timers.unload(),this.context.removeEventListener("statechange",this.onStateChange),"closed"!==this.context.state?this.context.close():Promise.resolve()))),g(this,"createGain",(()=>this.context.createGain())),g(this,"createBuffer",((t,e,i)=>this.context.createBuffer(t,e,i))),g(this,"createBufferSource",(()=>this.context.createBufferSource())),g(this,"getMediaStreamDestination",(()=>(this.mediaStreamDestination||(this.mediaStreamDestination=this.context.createMediaStreamDestination()),this.mediaStreamDestination))),g(this,"getDefaultDestination",(()=>this.context.destination)),g(this,"createSplitter",(()=>this.context.createChannelSplitter(2))),g(this,"resume",(()=>E(this,null,(function*(){try{return yield Promise.race([this.context.resume(),pt(1e3,new kt("Web Audio Context resume timeout",{isFatal:!1,code:"web_audio_context_resume_timeout"}))])}catch(t){throw this.suspend().catch(T),t}})))),g(this,"suspend",(()=>E(this,null,(function*(){var t;yield null!=(t=this.context.suspend())?t:Promise.resolve()})))),g(this,"onStateChange",(()=>this.emit("state",this.state))),this.context.addEventListener("statechange",this.onStateChange),this.timers.setInterval((()=>{this._isStuck=this.isRunning&&this.context.currentTime===this.previousCurrentTime,this._isStuck&&this.emit("stuck"),this.previousCurrentTime=this.context.currentTime}),t.CHECK_INTERVAL)}get isStuck(){return this._isStuck}get isRunning(){return"running"===this.state}get currentTime(){return this.context.currentTime}get sampleRate(){return this.context.sampleRate}get state(){return this.context.state}};g(Zi,"CHECK_INTERVAL",1e3);let Ki=Zi;const Ji=class extends n.E{constructor(t,e,{muted:i,reInitWhenStuck:n}){super(),g(this,"logger"),g(this,"audio"),g(this,"gainNode"),g(this,"splitter"),g(this,"_volume",1),g(this,"_userProvidedMuted",!1),g(this,"_muted",!1),g(this,"startTime",0),g(this,"samples",new Float32Array(new ArrayBuffer(38400))),g(this,"preInitSampleQueue",new C(500)),g(this,"unplayedBufferSources",new C(100)),g(this,"sampleRate",48e3),g(this,"channels",2),g(this,"index",0),g(this,"clockSource"),g(this,"clockDelta"),g(this,"startTimeIsInvalidated",!0),g(this,"lastSampleTimestamp",0),g(this,"reInitWhenStuck"),g(this,"ignoreSuspendCalls",!1),g(this,"isActivated",!1),g(this,"unload",(()=>E(this,null,(function*(){var t,e;null==(t=this.gainNode)||t.disconnect(),yield null==(e=this.audio)?void 0:e.unload(),this.reset(),this.audio=void 0,this.gainNode=void 0})))),g(this,"suspend",(()=>{this.setGain(0)})),g(this,"unsuspend",(()=>{var t;this.setGain(this._volume),this.ignoreSuspendCalls=!!this.audio,null==(t=this.audio)||t.suspend().then((()=>E(this,null,(function*(){yield this.resume(),this.ignoreSuspendCalls=!1})))).catch((()=>{this.ignoreSuspendCalls=!1,this.emit("state change","suspended")}))})),g(this,"flush",(()=>{if(!this.audio||!this.gainNode)throw new kt("AudioContext must be initialized to flush",{isFatal:!1,code:"audiocontext_must_be_initialized"});const t=this.samples.length/this.channels,e=this.audio.createBufferSource(),i=this.audio.createBuffer(this.channels,t,this.sampleRate);let n=0;for(let e=0;e<this.channels;e++){n=e;const s=i.getChannelData(e);for(let e=0;e<t;e++)s[e]=this.samples[n],n+=this.channels}const s=Math.max(this.startTime,0);e.buffer=i,e.connect(this.gainNode),this.splitter&&e.connect(this.splitter),e.start(s),this.unplayedBufferSources.push([s,e]),this.startTime+=i.duration})),g(this,"onDecodedFrame",(t=>{if(this.gainNode&&this.audio&&this.audio.isRunning){for(;!this.preInitSampleQueue.isEmpty();){const t=this.preInitSampleQueue.items();this.preInitSampleQueue.clear(),t.forEach(this.onDecodedFrame)}if(this.unplayedBufferSources.filterPop((([t,e])=>{var i,n;return(null!=(n=null==(i=this.audio)?void 0:i.currentTime)?n:0)<t})),"audio"===t.type){const e=t.timestamp/t.timescale*1e3;if(e<this.lastSampleTimestamp&&(this.logger.info("Unordered timestamp - invalidating start time"),this.startTimeIsInvalidated=!0),this.lastSampleTimestamp=e,this.startTimeIsInvalidated){const t=1e3*this.audio.currentTime,i=this.clockSource.currentTime,n=(t+e-i)/1e3;this.clockDelta=i-t,this.startTime=n,this.startTimeIsInvalidated=!1,this.unplayedBufferSources.items().forEach((([t,e])=>{n<=t&&e.stop()}))}this.samples.set(t.data,this.index),this.index+=t.data.length,this.channels=t.channels,this.sampleRate=t.sampleRate,this.samples.length<=this.index&&(this.index=0,this.flush())}}else if("audio"===t.type){this.preInitSampleQueue.push(p(m({},t),{data:t.data.slice(0,t.data.length)}));const e=this.clockSource.currentTime;this.preInitSampleQueue.filterPop((({timestamp:t,timescale:i})=>t/i*1e3>e))}})),g(this,"play",(()=>E(this,null,(function*(){this.audio=this.getAudioContext(),yield this.resume()})))),g(this,"pause",(()=>{})),g(this,"flushBuffer",(()=>{this.unplayedBufferSources.items().forEach((([t,e])=>e.stop())),this.index=0})),g(this,"resume",(()=>E(this,null,(function*(){var t;if(!this._userProvidedMuted)try{yield null==(t=this.audio)?void 0:t.resume(),this._muted=this._userProvidedMuted,this.startTimeIsInvalidated=!0}catch(t){throw this._muted=!0,t}})))),g(this,"getAudioContext",(()=>this.audio?this.audio:this.setupContext())),g(this,"setupContext",(()=>{var t,e,i;return null==(t=this.audio)||t.unload(),this.audio=new Ki,this.audio.on("state",(t=>{this.logger.info("AudioContext state change",{state:t}),"running"===t&&(this._muted=this._userProvidedMuted,this.setGain(this._volume)),!this.ignoreSuspendCalls&&this.emit("state change",t)})),this.audio.on("stuck",(()=>{this.reInitWhenStuck&&(this.logger.info("Re-init audio context"),this.setupContext(),this.resume().catch(T),this.emit("stuck"))})),null==(e=this.gainNode)||e.disconnect(),this.gainNode=this.audio.createGain(),this.setGain(this._volume),this.startTime=this.audio.currentTime,null==(i=this.splitter)||i.disconnect(),this.splitter=this.audio.createSplitter(),this.audio})),g(this,"setGain",(t=>{this.gainNode&&(this.gainNode.gain.value=this._muted?0:t)})),this._muted=i,this._userProvidedMuted=i,this.logger=t,this.clockSource=e,this.reInitWhenStuck=n}get isContextRunning(){var t;return"running"===(null==(t=this.audio)?void 0:t.state)}get volume(){return this._volume}set volume(t){this._volume=t,this.muted||this.setGain(t)}get seekTime(){return 0}get isSeeking(){return!1}get muted(){var t;return this._muted||!(null!=(t=this.audio)&&t.isRunning)}set muted(t){this._userProvidedMuted=t,this._muted=t,this.setGain(this._volume)}get isPaused(){return!1}get currentTime(){var t;return this.audio&&this.audio.isRunning&&!this.audio.isStuck?1e3*this.audio.currentTime+(null!=(t=this.clockDelta)?t:0):this.clockSource.currentTime}set currentTime(t){this.logger.debug("setting current time to",{currentTime:t}),this.startTimeIsInvalidated=!0}get audioNode(){return this.splitter}useMediaStreamDestination(){var t;const e=this.getAudioContext().getMediaStreamDestination();return null==(t=this.gainNode)||t.connect(e),e}useDefaultDestination(){var t;const e=this.getAudioContext().getDefaultDestination();return null==(t=this.gainNode)||t.connect(e),e}};g(Ji,"create",((t,e,i)=>new Ji(t,e,i)));let Yi=Ji;var tn;class en{constructor(){v(this,tn,[]),b(this,tn,[])}addTextTrack(t,e,i){const n=[],s={kind:t,label:e,language:i,mode:"disabled",cues:n,addCue:t=>{n.push(t)},removeCue:t=>{const e=n.findIndex((e=>e===t));-1!==e&&n.splice(e,1)}};return f(this,tn).push(s),s}set language(t){f(this,tn).forEach((e=>{e.language===t?e.mode="showing":e.mode="hidden"}))}get language(){var t;return null==(t=f(this,tn).find((t=>"showing"===t.mode)))?void 0:t.language}getActiveCues(t){const e=f(this,tn).find((t=>"showing"===t.mode));return e?e.cues.filter((({startTime:e,endTime:i})=>t>=e&&t<=i)):[]}}tn=new WeakMap;const nn=(t,e)=>{let i;for(i=e;t>1;t--)i+=e;return i};class sn{constructor(){g(this,"audio"),g(this,"unmute",(()=>this.audio.play().catch(T)));const t=document.createElement("div");t.innerHTML="<audio x-webkit-airplay='deny'></audio>";const e=t.children.item(0);if(!(e instanceof HTMLAudioElement))throw new Error("Failed to create audio tag");this.audio=e,this.audio.controls=!1,this.audio.disableRemotePlayback=!0,this.audio.preload="auto",this.audio.src="data:audio/mpeg;base64,//uQx"+nn(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+nn(16,"gICA")+nn(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+nn(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+nn(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+nn(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+nn(97,"V")+"Q==",this.audio.loop=!1,this.audio.load()}}var rn,an,on,ln,hn,cn,dn,un;class mn{constructor(){v(this,hn),v(this,rn,[]),v(this,an,document.createElement("canvas")),v(this,on),v(this,ln,window.devicePixelRatio||1),g(this,"config",{backgroundColor:"rgba(0,0,0,0.6)",textPadding:8,fontSize:"28px",lineGap:16});const t=f(this,an).getContext("2d",{alpha:!0});if(!t)throw new Error("Failed to create 2d context");b(this,on,t),w(this,hn,dn).call(this)}get canvas(){return f(this,an)}setActiveCues(t){b(this,rn,t)}render(t,e=!1){const i=f(this,rn).flatMap((e=>e.text.split("\n").flatMap((e=>w(this,hn,un).call(this,e,t.width))).map((t=>{w(this,hn,dn).call(this);const e=f(this,on).measureText(t);return{text:t,measurement:e,size:{height:e.fontBoundingBoxAscent+e.fontBoundingBoxDescent+2*this.config.textPadding,width:e.width+2*this.config.textPadding}}})))),n=Math.max(...i.map((t=>t.size.width))),s=i.reduce(((t,{size:e})=>t+e.height),0)+(i.length-1)*this.config.lineGap;let r=0;w(this,hn,cn).call(this,n,s),f(this,on).clearRect(0,0,f(this,an).width,f(this,an).height);for(const{size:t,text:e}of i)w(this,hn,dn).call(this),f(this,on).fillStyle=this.config.backgroundColor,f(this,on).fillRect(0,r,t.width,t.height),w(this,hn,dn).call(this),f(this,on).fillText(e,this.config.textPadding,r+this.config.textPadding),r+=t.height+this.config.lineGap;e&&(f(this,on).strokeStyle="red",f(this,on).strokeRect(0,0,t.width,f(this,an).height))}}rn=new WeakMap,an=new WeakMap,on=new WeakMap,ln=new WeakMap,hn=new WeakSet,cn=function(t,e){f(this,an).width=t*f(this,ln),f(this,an).height=e*f(this,ln),f(this,on).scale(f(this,ln),f(this,ln)),this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`},dn=function(){f(this,on).fillStyle="white",f(this,on).textAlign="left",f(this,on).textBaseline="top",f(this,on).font=`${this.config.fontSize} sans-serif`},un=function(t,e){const i=[],n=t.split(" ");let s="";for(;n.length>0;){w(this,hn,dn).call(this);let t=0;for(;f(this,on).measureText(s+(s.length>0?" ":"")+n[0]).width+2*this.config.textPadding<=e&&n.length>0;)t++,s+=(s.length>0?" ":"")+n.shift();0!=t?(i.push(s),s=""):(i.push(n.shift()||""),s="")}return i};const pn=(t,e)=>{let i=t.getContext("webgl",e);if(i||(i=t.getContext("experimental-webgl",e)),!i)throw new kt("Failed to create webgl context",{isFatal:!0,code:"failed_to_create_web_gl_context"});return i},gn=(t,e,i)=>{const n=t.createShader(e);if(!n)throw new kt("Failed to create shader",{isFatal:!0,code:"failed_to_create_shader"});if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(n);throw new kt(`Failed to compile shader: ${null!=e?e:""}`,{isFatal:!0,code:"failed_to_compile_shader"})}return n},An=t=>{const e=t.createTexture();if(!e)throw new kt("Failed to create texture",{isFatal:!0,code:"failed_to_create_texture"});return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},fn=(t,e)=>{const i=t.createBuffer();if(!i)throw new kt("Failed to create buffer",{isFatal:!0,code:"failed_to_create_buffer"});return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e.buffer,t.STATIC_DRAW),i},vn=(t,e,i)=>{const n=t.createProgram();if(!n)throw new kt("Failed to create program",{isFatal:!0,code:"failed_to_create_program"});if(t.attachShader(n,i),t.attachShader(n,e),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){const e=t.getShaderInfoLog(n);throw new kt(`Failed to link program: ${null!=e?e:""}`,{isFatal:!0,code:"failed_to_link_program"})}return n};var bn,wn,yn,En,Sn,kn,Cn,Tn,xn,In;class Rn{constructor(t){v(this,Cn),v(this,bn,96),v(this,wn),v(this,yn),v(this,En),v(this,Sn),v(this,kn),g(this,"subtitleRenderer",new mn),v(this,In,((t,e,i,n)=>[t,0,0,0,0,-e,0,0,0,0,1,0,i,n,0,1])),b(this,wn,t),b(this,yn,An(t)),b(this,En,gn(t,t.FRAGMENT_SHADER,"\nprecision mediump float;\nuniform sampler2D texture;\n\nvarying vec2 texture_coordinate;\n\nvoid main() {\n  float y = texture2D(texture, texture_coordinate).r;\n  float a = texture2D(texture, texture_coordinate).a;\n\n  gl_FragColor = vec4(y, y, y, a);\n}\n")),b(this,Sn,gn(t,t.VERTEX_SHADER,"\n  attribute vec2 position;\n  varying vec2 texture_coordinate;\n  uniform mat4 model;\n\n  void main() {\n    texture_coordinate = position;\n    gl_Position = model * vec4(position, 0.0, 1.0);\n  }\n")),b(this,kn,vn(t,f(this,Sn),f(this,En))),this.subtitleRenderer.config.fontSize="64px"}setActiveCues(t,e){this.subtitleRenderer.setActiveCues(t),this.subtitleRenderer.render(e)}render(t){const e=this.subtitleRenderer.canvas,i=(t.padding+f(this,bn))*window.devicePixelRatio;0!==e.width&&(f(this,wn).useProgram(f(this,kn)),w(this,Cn,Tn).call(this),w(this,Cn,xn).call(this,this.subtitleRenderer.canvas.width/t.width,this.subtitleRenderer.canvas.height/t.height,-this.subtitleRenderer.canvas.width/t.width/2,-(1-(this.subtitleRenderer.canvas.height+i)/t.height)),f(this,wn).uniform1i(f(this,wn).getUniformLocation(f(this,kn),"texture"),4),f(this,wn).activeTexture(f(this,wn).TEXTURE4),f(this,wn).bindTexture(f(this,wn).TEXTURE_2D,f(this,yn)),f(this,wn).enable(f(this,wn).BLEND),f(this,wn).blendFunc(f(this,wn).SRC_ALPHA,f(this,wn).ONE_MINUS_SRC_ALPHA),f(this,wn).texImage2D(f(this,wn).TEXTURE_2D,0,f(this,wn).RGBA,f(this,wn).RGBA,f(this,wn).UNSIGNED_BYTE,e),f(this,wn).texParameteri(f(this,wn).TEXTURE_2D,f(this,wn).TEXTURE_MAG_FILTER,f(this,wn).LINEAR),f(this,wn).drawArrays(f(this,wn).TRIANGLE_STRIP,0,4))}}bn=new WeakMap,wn=new WeakMap,yn=new WeakMap,En=new WeakMap,Sn=new WeakMap,kn=new WeakMap,Cn=new WeakSet,Tn=function(){const t=f(this,wn).getAttribLocation(f(this,kn),"position");f(this,wn).enableVertexAttribArray(t),f(this,wn).vertexAttribPointer(t,2,f(this,wn).FLOAT,!1,0,0)},xn=function(t,e,i,n){const s=f(this,wn).getUniformLocation(f(this,kn),"model");f(this,wn).uniformMatrix4fv(s,!1,f(this,In).call(this,t,e,i,n))},In=new WeakMap;const Ln="\nprecision mediump float;\nuniform sampler2D y_texture;\nuniform sampler2D u_texture;\nuniform sampler2D v_texture;\nuniform mat4 conversion;\n\nvarying vec2 texture_coordinate;\n\nvoid main() {\n  float y = texture2D(y_texture, texture_coordinate).r;\n  float u = texture2D(u_texture, texture_coordinate).r;\n  float v = texture2D(v_texture, texture_coordinate).r;\n\n  gl_FragColor = vec4(y, u, v, 1) * conversion;\n}\n",Mn="\n  attribute vec2 position;\n  varying vec2 texture_coordinate;\n  uniform mat4 model;\n\n  void main() {\n    texture_coordinate = position;\n    gl_Position = model * vec4(position, 0.0, 1.0);\n  }\n",Pn={width:256,codedWidth:256,height:144,codedHeight:144},Bn={preserveDrawingBuffer:!1,alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1},Un=class t extends n.E{constructor(){super(),g(this,"canvas",document.createElement("canvas")),g(this,"context",pn(this.canvas,Bn)),g(this,"pixelShader",gn(this.context,this.context.FRAGMENT_SHADER,Ln)),g(this,"vertexShader",gn(this.context,this.context.VERTEX_SHADER,Mn)),g(this,"buffer",fn(this.context,t.SQUARE_VERTICES)),g(this,"program",vn(this.context,this.vertexShader,this.pixelShader)),g(this,"textures",{y:An(this.context),u:An(this.context),v:An(this.context)}),g(this,"textRenderer"),g(this,"size",Pn),g(this,"onContextLost",(t=>{this.textRenderer=void 0;const e=new Error(t instanceof WebGLContextEvent?t.statusMessage:"webgl context lost");this.emit("context lost",new kt("WebGL Context Lost",{isFatal:!1,code:"webgl_context_lost_error",source:e,type:"internal"})),t.preventDefault()})),g(this,"onContextRestored",(()=>{this.emit("context restored"),this.context=pn(this.canvas,Bn),this.pixelShader=gn(this.context,this.context.FRAGMENT_SHADER,Ln),this.vertexShader=gn(this.context,this.context.VERTEX_SHADER,Mn),this.buffer=fn(this.context,t.SQUARE_VERTICES),this.program=vn(this.context,this.vertexShader,this.pixelShader),this.textures={y:An(this.context),u:An(this.context),v:An(this.context)},this.load()})),g(this,"load",(()=>{this.context.useProgram(this.program),this.setupPositionVertexAttributes(),this.setSize(Pn),this.context.uniform1i(this.context.getUniformLocation(this.program,"y_texture"),0),this.context.uniform1i(this.context.getUniformLocation(this.program,"u_texture"),1),this.context.uniform1i(this.context.getUniformLocation(this.program,"v_texture"),2),this.setConversionMatrix(this.rec709())})),g(this,"unload",(()=>{var t;this.setSize({width:1,height:1,codedHeight:1,codedWidth:1}),[this.textures.y,this.textures.u,this.textures.v].forEach((t=>this.context.deleteTexture(t))),this.context.deleteShader(this.pixelShader),this.context.deleteShader(this.vertexShader),this.context.deleteProgram(this.program),this.context.deleteBuffer(this.buffer),this.canvas.removeEventListener("webglcontextlost",this.onContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onContextRestored),null==(t=this.context.getExtension("WEBGL_lose_context"))||t.loseContext()})),g(this,"resetSize",(()=>{this.setSize({width:this.size.width/2,height:this.size.height/2,codedHeight:this.size.codedHeight/2,codedWidth:this.size.codedWidth/2})})),g(this,"render",((t,e)=>{var i;this.context.useProgram(this.program),this.setSize({width:t.width,height:t.height,codedWidth:t.codedWidth,codedHeight:t.codedHeight}),this.setConversionMatrix(this.rec709()),this.setModelMatrix(this.size.width/this.size.codedWidth,this.size.height/this.size.codedHeight),this.context.activeTexture(this.context.TEXTURE0),this.updateTexture(this.textures.y,this.size.codedWidth,this.size.codedHeight,t.data[0]),this.context.activeTexture(this.context.TEXTURE1),this.updateTexture(this.textures.u,this.size.codedWidth/2,this.size.codedHeight/2,t.data[1]),this.context.activeTexture(this.context.TEXTURE2),this.updateTexture(this.textures.v,this.size.codedWidth/2,this.size.codedHeight/2,t.data[2]),this.context.drawArrays(this.context.TRIANGLE_STRIP,0,4),this.textRenderer&&this.textRenderer.render({width:Math.max(e.clientWidth,960)*window.devicePixelRatio,height:Math.max(e.clientHeight,540)*window.devicePixelRatio,padding:-parseInt(null!=(i=e.style.getPropertyValue("--vindral-control-bar-offset"))?i:"0",10)})})),g(this,"updateTexture",((t,e,i,n)=>{const s=this.context.LUMINANCE,r=this.context.UNSIGNED_BYTE;this.context.bindTexture(this.context.TEXTURE_2D,t),this.context.texImage2D(this.context.TEXTURE_2D,0,s,e,i,0,s,r,n)})),g(this,"setupPositionVertexAttributes",(()=>{const t=this.context.getAttribLocation(this.program,"position");this.context.enableVertexAttribArray(t),this.context.vertexAttribPointer(t,2,this.context.FLOAT,!1,0,0)})),g(this,"setSize",(t=>{$(t,this.size)||(this.size=t,this.canvas.setAttribute("width",t.width.toString()),this.canvas.setAttribute("height",t.height.toString()),this.context.viewport(0,0,t.width,t.height),this.setModelMatrix(t.width/t.codedWidth,t.height/t.codedHeight))})),g(this,"setModelMatrix",((t,e)=>{const i=this.context.getUniformLocation(this.program,"model");this.context.uniformMatrix4fv(i,!1,this.transformMatrix(t,e))})),g(this,"setConversionMatrix",(t=>{const e=this.context.getUniformLocation(this.program,"conversion");this.context.uniformMatrix4fv(e,!1,t)})),g(this,"transformMatrix",((t,e)=>[2/t,0,0,0,0,-2/e,0,0,0,0,2,0,-1,1,0,1])),g(this,"rec709",(()=>[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1])),g(this,"rec601",(()=>[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1])),this.canvas.addEventListener("webglcontextlost",this.onContextLost),this.canvas.addEventListener("webglcontextrestored",this.onContextRestored,!1),this.canvas.style.width="100%",this.canvas.style.position="relative"}getTextRenderer(){return this.textRenderer||(this.textRenderer=new Rn(this.context)),this.textRenderer}};g(Un,"SQUARE_VERTICES",new Float32Array([0,0,0,1,1,0,1,1]));let _n=Un;const Nn=class{constructor(t,e,i,n){g(this,"oldTimestampLimit",400),g(this,"pool"),g(this,"logger"),g(this,"videoRenderer",new _n),g(this,"renderQueue",[]),g(this,"clockSource"),g(this,"isFirstFrame",!0),g(this,"animationFrameRequest"),g(this,"renderedFrameCount",0),g(this,"rendererDroppedFrameCount",0),g(this,"renderTargetSize"),g(this,"load",(()=>{this.videoRenderer.load()})),g(this,"unload",(()=>(this.stopRender(),this.videoRenderer.unload(),Promise.resolve()))),g(this,"suspend",(()=>{this.renderQueue=[],this.stopRender()})),g(this,"unsuspend",(()=>{this.animationFrameRequest=requestAnimationFrame(this.render)})),g(this,"element",(()=>this.videoRenderer.canvas)),g(this,"getStatistics",(()=>({renderedFrameCount:this.renderedFrameCount,rendererDroppedFrameCount:this.rendererDroppedFrameCount,contextLostCount:0,contextRestoredCount:0}))),g(this,"resetSize",(()=>{this.videoRenderer.resetSize()})),g(this,"setActiveCues",((t,e)=>{this.videoRenderer.getTextRenderer().setActiveCues(t,e)})),g(this,"onDecodedFrame",(t=>{if("video"===t.type)if(this.isFirstFrame)this.isFirstFrame=!1,requestAnimationFrame((()=>{this.renderSample(t)}));else{const e=(this.clockSource.currentTime-this.oldTimestampLimit)/1e3;this.renderQueue=this.renderQueue.filter((i=>{const n=i.timestamp/i.timescale,s=t.timestamp/t.timescale,r=n>e&&n<=s;return r||this.pool.reclaim(i.buffer),r})),this.renderQueue.push(t)}})),g(this,"render",(()=>{const t=this.clockSource.currentTime;let e,i=this.renderQueue[0],n=0;for(;i&&i.timestamp/i.timescale*1e3<=t;)i=this.renderQueue.shift(),i&&(n++,e&&this.pool.reclaim(e.buffer),e=i),i=this.renderQueue[0];e&&this.renderSample(e),this.rendererDroppedFrameCount+=Math.max(n-1,0),this.animationFrameRequest=requestAnimationFrame(this.render)})),g(this,"renderSample",(t=>{this.renderedFrameCount++,this.videoRenderer.render(t,this.renderTargetSize),this.pool.reclaim(t.buffer)})),g(this,"stopRender",(()=>{this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest)})),this.logger=t,this.clockSource=e,this.pool=i,this.renderTargetSize=n||this.videoRenderer.canvas}};g(Nn,"create",((t,e,i,n)=>new Nn(t,e,i,n)));let Dn=Nn;const On=class{constructor(t,e,i,n,s){g(this,"logger"),g(this,"emitter"),g(this,"audioPlayer"),g(this,"videoPlayer"),g(this,"pool"),g(this,"unmuter",new sn),g(this,"_isPaused",!1),g(this,"isDisconnected",!1),g(this,"timers",new dt),g(this,"textTracks",new en),g(this,"playbackRate"),g(this,"reset",(()=>{})),g(this,"load",(()=>{this.audioPlayer.useDefaultDestination(),this.emitter.on("decoded frame",this.onDecodedFrame),this.emitter.on("flush buffers",this.flushBuffers),this.videoPlayer.load(),this.timers.setInterval((()=>{if(!this.textTracks.language)return;const t=this.textTracks.getActiveCues(this.currentTime/1e3);this.videoPlayer.setActiveCues(t,{width:this.videoPlayer.element().clientWidth,height:this.videoPlayer.element().clientHeight})}),100)})),g(this,"unload",(()=>{this.emitter.off("decoded frame",this.onDecodedFrame),this.emitter.off("flush buffers",this.flushBuffers),this.audioPlayer.unload(),this.videoPlayer.unload(),this.timers.unload()})),g(this,"suspend",(()=>{this.videoPlayer.suspend(),this.audioPlayer.suspend()})),g(this,"unsuspend",(()=>{this.videoPlayer.unsuspend(),this.audioPlayer.unsuspend()})),g(this,"element",(()=>this.videoPlayer.element())),g(this,"getStatistics",(()=>this.videoPlayer.getStatistics())),g(this,"flushBuffers",(()=>{this.audioPlayer.flushBuffer()})),g(this,"activateAudioPlayer",(()=>(this.isDisconnected&&(this.isDisconnected=!1,this.audioPlayer.useDefaultDestination()),this._isPaused=!1,this.unmuter.unmute(),this.audioPlayer.play()))),g(this,"onDecodedFrame",(t=>{try{this.audioPlayer.onDecodedFrame(t)}catch(t){t instanceof Error&&this.emitter.emit("error",Tt(!1,t))}this.videoPlayer.onDecodedFrame(t)})),this.logger=e,this.emitter=t,this.pool=i,this.audioPlayer=Yi.create(this.logger.createContext("AudioPlayerModule"),n,{muted:s,reInitWhenStuck:!0}),this.audioPlayer.on("stuck",(()=>{this.isDisconnected=!0})),this.audioPlayer.on("state change",(()=>{this.emitter.emit("volume state",{volume:this.volume,isMuted:this.muted})})),this.videoPlayer=Dn.create(this.logger.createContext("VideoPlayerModule"),this.audioPlayer,this.pool)}get volume(){return this.audioPlayer.volume}set volume(t){this.audioPlayer.volume=t}get muted(){return this.audioPlayer.muted}set muted(t){const e=this.muted;this.audioPlayer.muted=t,!t&&e&&this.activateAudioPlayer().catch(T)}get currentTime(){return this.audioPlayer.currentTime}set currentTime(t){this.audioPlayer.currentTime=t}get isActivated(){return this.audioPlayer.isActivated}set isActivated(t){this.audioPlayer.isActivated=t}get seekTime(){return this.audioPlayer.seekTime}get isPaused(){return this._isPaused}get isSeeking(){return this.audioPlayer.isSeeking}get audioNode(){return this.audioPlayer.audioNode}play(){this.activateAudioPlayer().then((()=>{this.emitter.emit("media element state","playing")})).catch((()=>{this.emitter.emit("needs user input",{forAudio:!0,forVideo:!1})}))}pause(){this._isPaused=!0,this.audioPlayer.pause(),this.emitter.emit("media element state","paused")}};g(On,"create",((t,e,i,n,s)=>new On(t,e,i,n,s)));let Fn=On;const Wn=class{constructor(t,e,i,n,{muted:s,type:r,poster:a}){g(this,"logger"),g(this,"emitter"),g(this,"mediaElement"),g(this,"audioPlayer"),g(this,"videoPlayer"),g(this,"pool"),g(this,"isDisconnected",!0),g(this,"_userProvidedMuted",!1),g(this,"timers",new dt),g(this,"volumeState"),g(this,"textTracks",new en),g(this,"reset",(()=>{})),g(this,"load",(()=>{this.mediaElement.load(),this.emitter.on("decoded frame",this.onDecodedFrame),this.emitter.on("flush buffers",this.flushBuffers),this.emitter.on("ios-hack: reset size",this.resetCanvasSize),this.emitter.on("enter picture in picture",this.onEnterIOSHack),this.emitter.on("exit picture in picture",this.onExitIOSHack),this.element().element.addEventListener("webkitendfullscreen",this.onExitIOSHack),this.element().element.addEventListener("webkitbeginfullscreen",this.onEnterIOSHack),this.videoPlayer.load(),this.timers.setInterval((()=>{if(!this.textTracks.language)return;const t=this.textTracks.getActiveCues(this.currentTime/1e3);this.videoPlayer.setActiveCues(t,{width:this.mediaElement.element.clientWidth,height:this.mediaElement.element.clientHeight})}),100)})),g(this,"unload",(()=>{this.emitter.off("decoded frame",this.onDecodedFrame),this.emitter.off("flush buffers",this.flushBuffers),this.emitter.off("ios-hack: reset size",this.resetCanvasSize),this.emitter.off("enter picture in picture",this.onEnterIOSHack),this.emitter.off("exit picture in picture",this.onExitIOSHack),this.element().element.removeEventListener("webkitendfullscreen",this.onExitIOSHack),this.element().element.removeEventListener("webkitbeginfullscreen",this.onEnterIOSHack),this.mediaElement.unload(),this.timers.unload(),this.audioPlayer.unload(),this.videoPlayer.unload()})),g(this,"suspend",(()=>{this.videoPlayer.suspend(),this.audioPlayer.suspend()})),g(this,"unsuspend",(()=>{this.videoPlayer.unsuspend(),this.audioPlayer.unsuspend()})),g(this,"element",(()=>this.mediaElement)),g(this,"getStatistics",(()=>this.videoPlayer.getStatistics())),g(this,"activateAudioPlayer",(()=>(this.isDisconnected&&this.connectStreams(),this.audioPlayer.play()))),g(this,"flushBuffers",(()=>{this.audioPlayer.flushBuffer()})),g(this,"resetCanvasSize",(()=>{this.videoPlayer.resetSize()})),g(this,"onEnterIOSHack",(()=>{this.mediaElement._iosHackEnterPiPMode()})),g(this,"onExitIOSHack",(()=>{this.mediaElement._iosHackExitPiPMode()})),g(this,"onDecodedFrame",(t=>{try{this.audioPlayer.onDecodedFrame(t)}catch(t){t instanceof Error&&this.emitter.emit("error",Tt(!1,t))}this.videoPlayer.onDecodedFrame(t)})),g(this,"connectStreams",(()=>{const t=this.videoPlayer.element().captureStream(),e=this.audioPlayer.useMediaStreamDestination().stream,i=[];i.push(...t.getTracks(),...e.getTracks()),this.mediaElement.element.srcObject=new MediaStream(i),this.isDisconnected=!1})),g(this,"updateVolumeState",(()=>{const t={isMuted:this.muted,volume:this.volume};$(t,this.volumeState)||(this.volumeState=t,this.emitter.emit("volume state",this.volumeState))})),this.logger=e,this.emitter=t,this.pool=i,this._userProvidedMuted=s,this.mediaElement=new ui({poster:a,type:r,muted:s,autoplay:!1,logger:this.logger.createContext("MediaElement")}),this.mediaElement.on("volume state",(t=>{this.updateVolumeState(),!t.isMuted&&!this.audioPlayer.isContextRunning&&this.activateAudioPlayer().catch(T),t.isMuted||(this._userProvidedMuted=!1)})),this.mediaElement.on("media element state",(t=>{"paused"===t&&this.audioPlayer.flushBuffer(),this.emitter.emit("media element state",t)})),this.audioPlayer=Yi.create(this.logger.createContext("AudioPlayerModule"),n,{muted:!1,reInitWhenStuck:!1}),this.audioPlayer.on("stuck",(()=>{this.isDisconnected=!0})),this.audioPlayer.on("state change",(t=>{"suspended"===t||"interrupted"===t?this.mediaElement.muted=!0:"running"===t&&(this.mediaElement.muted=this._userProvidedMuted||"hidden"===document.visibilityState),this.updateVolumeState()})),this.videoPlayer=Dn.create(this.logger.createContext("VideoPlayerModule"),this.audioPlayer,this.pool,this.mediaElement.element),this.volumeState={volume:this.volume,isMuted:this.muted}}get volume(){return this.mediaElement.volume}set volume(t){this.mediaElement.volume=t}get muted(){return this.mediaElement.muted||this.audioPlayer.muted}set muted(t){const e=this.muted;this._userProvidedMuted=t,this.mediaElement.muted=t,!t&&e&&this.activateAudioPlayer().catch(T)}get currentTime(){return this.audioPlayer.currentTime}set currentTime(t){this.audioPlayer.currentTime=t}get isActivated(){return this.mediaElement.isActivated}set isActivated(t){this.mediaElement.isActivated=t}get seekTime(){return this.mediaElement.seekTime}get isPaused(){return this.mediaElement.isPaused}get isSeeking(){return this.mediaElement.isSeeking}get audioNode(){return this.audioPlayer.audioNode}play(){const t=this._userProvidedMuted;return this.activateAudioPlayer().catch((()=>{t||this.emitter.emit("needs user input",{forAudio:!0,forVideo:!1})})),this.mediaElement.play()}pause(){this.mediaElement.pause()}};g(Wn,"create",((t,e,i,n,s)=>new Wn(t,e,i,n,s)));let Gn=Wn;const Hn=()=>t=>zn(t.buffered.start(0),t.buffered.end(t.buffered.length-1)),zn=(t,e)=>i=>i.remove(Math.max(0,t),Math.min(Number.POSITIVE_INFINITY,e)),Vn=t=>e=>e.appendBuffer(t);class Xn{constructor(t){g(this,"commandQueue",[]),g(this,"sourceBuffer"),g(this,"currentInit"),g(this,"handleQueue",(()=>{var t;this.sourceBuffer.updating||null==(t=this.commandQueue.shift())||t.execute(this.sourceBuffer)})),g(this,"appendBuffer",((t,e)=>new Promise(((i,n)=>{if(e&&this.currentInit!==e){const t=new X(Vn(e),i,n);this.commandQueue.push(t),this.currentInit=e}const s=new X(Vn(t),i,n);this.commandQueue.push(s),this.handleQueue()})))),g(this,"execute",(t=>new Promise(((e,i)=>{const n=new X((s=t,t=>s(t)),e,i);var s;this.commandQueue.push(n),this.handleQueue()})))),g(this,"buffered",(()=>this.sourceBuffer.buffered)),g(this,"removeFromMediaSource",(t=>{t.removeSourceBuffer(this.sourceBuffer)})),g(this,"changeType",(t=>new Promise(((e,i)=>{const n=new X((s=t,t=>t.changeType(s)),e,i);var s;this.commandQueue.push(n),this.handleQueue()})))),g(this,"removeBuffer",((t,e)=>new Promise(((i,n)=>{const s=new X(zn(t,e),i,n);this.commandQueue.push(s),this.handleQueue()})))),g(this,"flush",(()=>new Promise(((t,e)=>{const i=new X(Hn,t,e);this.commandQueue.push(i),this.handleQueue()})))),this.sourceBuffer=t,this.sourceBuffer.addEventListener("updateend",this.handleQueue)}}class Qn extends n.E{constructor(){super(),g(this,"MediaSource",I()),g(this,"mediaSource",new this.MediaSource),g(this,"isOpen",(()=>"open"===this.mediaSource.readyState)),g(this,"isClosed",(()=>"closed"===this.mediaSource.readyState)),g(this,"isEnded",(()=>"ended"===this.mediaSource.readyState)),g(this,"createObjectURL",(()=>URL.createObjectURL(this.mediaSource))),g(this,"attach",(t=>{const e=t;if("srcObject"in e)try{e.srcObject=this.mediaSource}catch(t){if(t instanceof Error&&"TypeError"!==t.name)throw t;e.src=this.createObjectURL()}else t.src=this.createObjectURL()})),g(this,"detach",(t=>{if(this.mediaSource&&"open"===this.mediaSource.readyState)try{this.mediaSource.endOfStream()}catch(t){}t.srcObject&&(t.srcObject=null),""!==t.src&&(URL.revokeObjectURL(t.src),t.removeAttribute("src")),t.load()})),g(this,"addSourceBuffer",(t=>{const e=this.mediaSource.addSourceBuffer(t);return new Xn(e)})),g(this,"removeSourceBuffer",(t=>{t.removeFromMediaSource(this.mediaSource)})),g(this,"endOfStream",(t=>{this.mediaSource.endOfStream(t)})),g(this,"onSourceOpen",(()=>{this.setDurationIfNeeded(),this.emit("source open")})),g(this,"onSourceEnded",(()=>this.emit("source ended"))),g(this,"onSourceClosed",(()=>this.emit("source close"))),g(this,"setDurationIfNeeded",(()=>{if(Number.isNaN(this.mediaSource.duration)&&"open"===this.mediaSource.readyState){for(let t=0;t<this.mediaSource.sourceBuffers.length;t++){const e=this.mediaSource.sourceBuffers[t];if(null!=e&&e.updating)return}this.mediaSource.duration=Number.POSITIVE_INFINITY}})),this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.mediaSource.addEventListener("sourceclose",this.onSourceClosed),this.mediaSource.addEventListener("sourceended",this.onSourceEnded)}}g(Qn,"isTypeSupported",(t=>{var e,i;return null!=(i=null==(e=I())?void 0:e.isTypeSupported(t))&&i}));class jn{constructor(){g(this,"initSegments",new Map),g(this,"set",((t,e,i)=>{var n;const s=null!=(n=this.initSegments.get(t))?n:new Map;s.set(e,i),this.initSegments.set(t,s)})),g(this,"get",((t,e)=>{var i;return null==(i=this.initSegments.get(t))?void 0:i.get(e)}))}}function qn(t,{mediaSource:e,mimeType:i}){return p(m({},t),{state:"initialized",mimeType:i,sourceBuffer:e.addSourceBuffer(i),isWorkingOnPendingSamples:!1,sequenceNumber:0,lastBufferCleanupTime:Date.now()})}function $n({initSegments:t,pendingSamples:e}){return{state:"uninitialized",initSegments:null!=t?t:new jn,sequenceNumber:0,isWorkingOnPendingSamples:!1,hasFirstSync:!!e,pendingSamples:null!=e?e:[],consecutiveQuotaExceededErrorCount:0,successfulAppendCalls:0}}const Zn=class{constructor(t,e,i){g(this,"maxChunkSize",20),g(this,"minConsecutiveErrorsBeforeEmit",5),g(this,"maxSecondsInBuffer",60),g(this,"logger"),g(this,"timers",dt.create()),g(this,"emitter"),g(this,"mediaElement"),g(this,"mediaSource",new Qn),g(this,"trackContexts",new Map),g(this,"autoRecoverFromMediaErrors",!0),g(this,"quotaErrorCount",0),g(this,"recoveredFromErrorCount",0),g(this,"sourceOpenStartTime",Date.now()),g(this,"sourceOpenEndTime",Date.now()),g(this,"pendingTracksToAddSourceBuffers"),g(this,"hasAddedInitialPosterFrame",!0),g(this,"load",(()=>{this.emitter.on("init segment",this.init),this.emitter.on("coded sample",this.onCodedSample),this.emitter.on("flush buffers",this.flushBuffers),this.emitter.on("fragment",this.onFragment)})),g(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.emitter.off("init segment",this.init),this.emitter.off("coded sample",this.onCodedSample),this.emitter.off("flush buffers",this.flushBuffers),this.emitter.off("fragment",this.onFragment),this.mediaSource.off("source ended",this.onSourceEnded),this.mediaSource.off("source open",this.onSourceOpen),this.mediaSource.detach(this.mediaElement),this.trackContexts.forEach((t=>t.pendingSamples=[])),this.timers.unload(),this.logger.debug("Unloaded module")})),g(this,"getStatistics",(()=>{var t,e,i,n;const s={quotaErrorCount:this.quotaErrorCount,mediaSourceOpenTime:this.sourceOpenEndTime-this.sourceOpenStartTime,successfulAudioAppendsCalls:null==(t=this.trackContexts.get("audio"))?void 0:t.successfulAppendCalls,successfulVideoAppendCalls:null==(e=this.trackContexts.get("video"))?void 0:e.successfulAppendCalls};if(this.mediaElement instanceof HTMLVideoElement){const t=null==(n=(i=this.mediaElement).getVideoPlaybackQuality)?void 0:n.call(i);s.totalVideoFrames=null==t?void 0:t.totalVideoFrames,s.droppedVideoFrames=null==t?void 0:t.droppedVideoFrames}return s})),g(this,"flushBuffers",(()=>{this.trackContexts.forEach((t=>{t.pendingSamples=[],t.hasFirstSync=!1,"uninitialized"!==t.state&&this.mediaSource.isOpen()&&t.sourceBuffer.removeBuffer(0,Number.POSITIVE_INFINITY).catch((t=>{this.logger.error("Failed to remove buffer",t)}))}))})),g(this,"setTrackContexts",((t=new Map)=>{this.logger.debug("setTrackContexts"),["audio","video"].forEach((e=>{var i,n,s,r;const a=null!=(n=null==(i=t.get(e))?void 0:i.pendingSamples)?n:[],o=null==(s=t.get(e))?void 0:s.initSegments;for(;a.length>0&&(null==(r=a[0])||!r.isSync);)a.shift();this.trackContexts.set(e,$n({pendingSamples:a,initSegments:o}))}))})),g(this,"setSourceBuffers",(t=>E(this,null,(function*(){if(this.mediaSource.isClosed())return void(this.pendingTracksToAddSourceBuffers=t);let e=!0;for(const i of t){const t=this.trackContexts.get(i.type);if(!t||"uninitialized"===t.state||t.mimeType!==i.mimeType){e=!1;break}}if(e)this.logger.debug("Already setup with the correct mime types");else for(const e of t){let t=this.trackContexts.get(e.type);t||(t=$n({pendingSamples:[],initSegments:new jn}),this.trackContexts.set(e.type,t)),"initialized"===t.state?e.mimeType!==t.mimeType&&(yield t.sourceBuffer.changeType(e.mimeType)):this.trackContexts.set(e.type,qn(t,{mimeType:e.mimeType,mediaSource:this.mediaSource}))}})))),g(this,"getBuffer",(t=>{const e=[];if(this.mediaSource.isClosed())return[];const i=this.trackContexts.get(t);if(!i||"uninitialized"===i.state)return[];try{const t=i.sourceBuffer.buffered();if(!t)return[];for(let i=0;i<t.length;i++)e.push({start:1e3*t.start(i),end:1e3*t.end(i)});return e}catch(t){return[]}})),g(this,"init",(({initSegment:t,mimeType:e})=>{this.logger.debug("Added init segment",{channel:t.channelId,renditionId:t.renditionId});const i=this.trackContexts.get(t.type);if(!i)throw It(t.type,t.renditionId);"initialized"===i.state&&(i.mimeType=e);const n=((t,e,i)=>{switch(t){case"h264":return((t,e)=>((t,e)=>{const{sequenceParameterSets:i,pictureParameterSets:n}=ke(t),s=Ze(t);return qe([{type:"video",sequenceParameterSets:i.map((t=>new Uint8Array(t))),pictureParameterSets:n.map((t=>new Uint8Array(t))),width:s.width,height:s.height,timescale:e,duration:0,trackId:1}])})(t,e))(e,i);case"av1":return((t,e)=>((t,e)=>{const i=Ke(t);if(!i)throw new Error("Failed to parse sequence header");return qe([{type:"video",parsedSequenceHeader:i,sequenceHeader:new Uint8Array(t),width:i.maxFrameWidth,height:i.maxFrameHeight,timescale:e,duration:0,trackId:1}])})(t,e))(e,i);case"opus":return((t,e)=>((t,e,i)=>qe([{type:"audio",trackId:1,channelCount:2,timescale:i,codec:"opus",decoderConfig:t,duration:0,sampleRate:48e3}]))(new Uint8Array(t),0,e))(e,i);case"aac":return((t,e)=>((t,e,i,n)=>qe([{type:"audio",codec:"aac",decoderConfig:t,channelCount:2,sampleRate:i,timescale:n,duration:0,trackId:1}]))(new Uint8Array(t),0,e,e))(e,i);default:throw new Error(`Failed to initialize ${t} segment`)}})(t.codec,t.data,t.timescale);n&&i.initSegments.set(t.channelId,t.renditionId,n)})),g(this,"append",((t,e)=>E(this,null,(function*(){var i;const n=t[0];if(!n)return;const s=this.trackContexts.get(n.type),r=null==s?void 0:s.initSegments.get(n.channelId,n.renditionId);if(this.mediaSource.isClosed())return;if(!r)throw((t,e)=>new kt(`No init segment for rendition id ${t} for channel ${e}`,{isFatal:!1,code:"missing_init_segment",type:"internal"}))(n.renditionId,n.channelId);if(!s)throw It(n.type,n.renditionId);if("uninitialized"===s.state)throw Rt(n.type,n.renditionId);if(e){const t=(n.timestamp+(null!=(i=n.compositionTimeOffset)?i:0))/n.timescale;yield s.sourceBuffer.removeBuffer(t,Number.POSITIVE_INFINITY);const e=s.previousSample;if(e&&e.codec!==n.codec&&s.sourceBuffer.changeType)try{yield s.sourceBuffer.changeType(s.mimeType)}catch(t){}yield s.sourceBuffer.appendBuffer(r)}const a=Math.max(0,n.timestamp/n.timescale-this.maxSecondsInBuffer);a>0&&Date.now()-s.lastBufferCleanupTime>1e4&&(s.lastBufferCleanupTime=Date.now(),yield s.sourceBuffer.removeBuffer(0,a+10));try{let e=s.sequenceNumber;const i=((t,e)=>{if(!t[0])throw new Error("At least one sample must be provided");switch(t[0].codec){case"h264":return((t,e)=>{const i=t.map((t=>p(m({},t),{data:new Uint8Array(t.data)})));if(!i[0])throw new Error("At least one sample must be provided");const{isSync:n,timestamp:s,data:r,duration:a}=i[0];return $e({trackId:1,timestamp:s,sequenceNumber:e,defaultSize:r.byteLength,defaultFlags:n?33554432:16842752,defaultDuration:a,samples:i})})(t,e);case"opus":return((t,e)=>{const i=t.map((t=>p(m({},t),{data:new Uint8Array(t.data)})));if(!i[0])throw new Error("At least one sample must be provided");const{timestamp:n,data:s,duration:r}=i[0];return $e({trackId:1,timestamp:n,sequenceNumber:e,defaultSize:s.byteLength,defaultFlags:33554432,defaultDuration:r,samples:i})})(t,e);case"aac":return((t,e)=>{const i=t.map((t=>p(m({},t),{data:new Uint8Array(t.data)})));if(!i[0])throw new Error("At least one sample must be provided");const{timestamp:n,data:s,duration:r}=i[0];return $e({trackId:1,timestamp:n,sequenceNumber:e,defaultSize:s.byteLength,defaultFlags:33554432,defaultDuration:r,samples:i})})(t,e);case"av1":return((t,e)=>{const i=t.map((t=>p(m({},t),{data:new Uint8Array(t.data)})));if(!i[0])throw new Error("At least one sample must be provided");const{isSync:n,timestamp:s,data:r,duration:a}=i[0];return $e({trackId:1,timestamp:s,sequenceNumber:e,defaultSize:r.byteLength,defaultFlags:n?33554432:16842752,defaultDuration:a,samples:i})})(t,e);default:throw new Error(`Unsupported codec ${t[0].codec}`)}})(t,e++);yield s.sourceBuffer.appendBuffer(i),s.sequenceNumber=e,s.consecutiveQuotaExceededErrorCount=0,s.successfulAppendCalls++}catch(e){throw e instanceof DOMException&&(e.code===DOMException.QUOTA_EXCEEDED_ERR?(this.quotaErrorCount++,s.consecutiveQuotaExceededErrorCount++,this.logger.error("quota exceeded error",{error:e}),s.pendingSamples.unshift(...t)):this.mediaElement.error&&s.pendingSamples.unshift(...t)),e}})))),g(this,"onFragment",(({fragment:t})=>{const e=t.mediaType();if(!e)return;const i=this.trackContexts.get(e);if(!i)throw It(e);if(!this.mediaSource.isClosed()){if("uninitialized"===i.state)throw Rt(e);i.sourceBuffer.appendBuffer(t.rawBytes(),t.header().rawBytes()).catch((t=>console.log(t)))}})),g(this,"onCodedSample",(t=>{if(0===t.duration)return;const e=this.trackContexts.get(t.type);if(!e)throw It(t.type,t.renditionId);if(e.hasFirstSync||t.isSync){if(this.hasAddedInitialPosterFrame&&t.isSync&&"video"===t.type){this.hasAddedInitialPosterFrame=!1;const i=m({},t);i.timestamp=0,e.pendingSamples.push(i)}e.hasFirstSync=!0,e.pendingSamples.push(t),"uninitialized"!==e.state&&(e.isWorkingOnPendingSamples||Yn(e,this.append,this.maxChunkSize).catch((i=>{if(e.isWorkingOnPendingSamples=!1,i instanceof Error){if(this.logger.error("append failed",{message:i.message,name:i.name}),i instanceof DOMException&&i.code===DOMException.QUOTA_EXCEEDED_ERR){if(e.consecutiveQuotaExceededErrorCount>=this.minConsecutiveErrorsBeforeEmit){const n=xt(!1,i,e.consecutiveQuotaExceededErrorCount,t.type);this.emitter.emit("error",n)}}else{const n=xt(!1,i,e.consecutiveQuotaExceededErrorCount,t.type);this.emitter.emit("error",n)}this.mediaElement.error&&this.onSourceEnded()}})))}})),g(this,"onSourceOpen",(()=>{this.logger.debug("source opened"),this.sourceOpenEndTime=Date.now(),this.pendingTracksToAddSourceBuffers&&(this.setSourceBuffers(this.pendingTracksToAddSourceBuffers),this.pendingTracksToAddSourceBuffers=void 0)})),g(this,"onSourceEnded",(()=>{const{error:t}=this.mediaElement;if(t){const e=((t,e)=>new kt("MediaElement Error",{isFatal:t,code:"media_element_error",source:e},{mediaErrorCode:e.code}))(/AUDIO_RENDERER/.test(t.message)||!this.autoRecoverFromMediaErrors,t);if(this.logger.error("MediaElement error",{error:e}),this.emitter.emit("error",e),!e.isFatal()){this.logger.info("Re-opening MediaSource"),this.emitter.emit("recovered from media error",{error:e,count:this.recoveredFromErrorCount}),this.recoveredFromErrorCount++;const t=!this.mediaElement.paused,i=[];this.trackContexts.forEach(((t,e)=>{"initialized"===t.state&&i.push({type:e,mimeType:t.mimeType})})),this.sourceOpenStartTime=Date.now(),this.pendingTracksToAddSourceBuffers=i,this.mediaElement.src="",this.setTrackContexts(this.trackContexts),this.mediaSource.attach(this.mediaElement),t&&this.mediaElement.play().catch(T)}}this.logger.debug("source ended")})),this.logger=t,this.mediaElement=i,this.emitter=e}};g(Zn,"create",((t,e,i)=>{const n=new Zn(t,e,i);return n.setTrackContexts(),n.mediaSource.on("source ended",n.onSourceEnded),n.mediaSource.on("source open",n.onSourceOpen),n.mediaSource.attach(i),n}));let Kn=Zn;const Jn=(t,e)=>{var i;const n=t.renditionId!==e.renditionId,s=t.channelId!==e.channelId,r=(null!=(i=t.timestamp)?i:0)>e.timestamp,a="video"===t.type&&"video"===e.type&&t.levelIdc!==e.levelIdc;let o=!1;return"video"===t.type&&"video"===e.type&&(o=e.width!==t.width||e.height!==t.height),s||n||r||o||a},Yn=(t,e,i)=>E(void 0,null,(function*(){for(t.isWorkingOnPendingSamples=!0;t.pendingSamples.length>0;){const n=[];let s=0;for(let e=0;e<t.pendingSamples.length;e++){s=e;const r=t.pendingSamples[e],a=t.pendingSamples[e+1];if(r&&(n.push(r),a)){if(Jn(r,a))break;const t=(r.timestamp+r.duration)/r.timescale;if(a.timestamp/a.timescale-t>.1)break}if(e===i-1)break}const r=n[0];if(!r)break;const a=!t.previousSample||Jn(t.previousSample,r);yield e(n,a),t.pendingSamples=t.pendingSamples.slice(s+1),t.previousSample=n[n.length-1]}t.isWorkingOnPendingSamples=!1})),ts=class{constructor(t,e){g(this,"logger"),g(this,"emitter"),g(this,"element"),g(this,"pictureInPictureWindow"),g(this,"unload",(()=>{this.emitter.off("add picture in picture listener",this.onEnablePictureInPicture)})),g(this,"onEnablePictureInPicture",(t=>{this.element=t.element,t.element.addEventListener("leavepictureinpicture",(()=>{this.pictureInPictureWindow=void 0,this.logger.debug("Leave picture in picture"),this.emitter.emit("exit picture in picture")})),t.element.addEventListener("enterpictureinpicture",(t=>{this.pictureInPictureWindow=t.pictureInPictureWindow,this.logger.debug("Enter picture in picture"),this.emitter.emit("enter picture in picture",this)})),t.element.autopictureinpicture=!0})),g(this,"getPictureInPictureSize",(()=>this.pictureInPictureWindow)),g(this,"isPictureInPictureActive",(()=>this.isWebkitPresentationModeActive()||this.isStandardPictureInPictureActive())),g(this,"isPictureInPictureSupported",(()=>this.isWebkitPresentationModeSupported()||this.isStandardPictureInPictureSupported())),g(this,"requestPictureInPicture",(()=>(this.emitter.emit("ios-hack: reset size"),this.isStandardPictureInPictureSupported()?this.requestStandardPictureInPicture():this.isWebkitPresentationModeSupported()?this.requestWebkitPresentationMode("picture-in-picture"):Promise.reject(new Error("Picture in picture is not supported"))))),g(this,"exitPictureInPicture",(()=>this.isStandardPictureInPictureSupported()?this.exitStandardPictureInPicture():this.isWebkitPresentationModeSupported()?this.requestWebkitPresentationMode("inline"):Promise.reject(new Error("Picture in picture is not supported")))),g(this,"getStatistics",(()=>({isPictureInPictureActive:this.isPictureInPictureActive()}))),g(this,"requestStandardPictureInPicture",(()=>E(this,null,(function*(){return yield this.element.requestPictureInPicture()})))),g(this,"exitStandardPictureInPicture",(()=>E(this,null,(function*(){return yield document.exitPictureInPicture()})))),g(this,"isStandardPictureInPictureSupported",(()=>!!this.element&&!!this.element.requestPictureInPicture&&!!document.pictureInPictureEnabled)),g(this,"isStandardPictureInPictureActive",(()=>!!this.element&&!!document.pictureInPictureElement)),g(this,"isWebkitPresentationModeActive",(()=>!!this.element&&"picture-in-picture"===this.element.webkitPresentationMode)),g(this,"requestWebkitPresentationMode",(t=>E(this,null,(function*(){return this.element.webkitSetPresentationMode(t),Promise.resolve()})))),g(this,"isWebkitPresentationModeSupported",(()=>!!this.element&&!!this.element.webkitSetPresentationMode)),this.emitter=t,this.logger=e,this.emitter.on("add picture in picture listener",this.onEnablePictureInPicture)}};g(ts,"create",((t,e)=>new ts(t,e)));let es=ts;const is=class{constructor(t,e,i,n){g(this,"emitter"),g(this,"logger"),g(this,"clockSource"),g(this,"state","buffering"),g(this,"bufferFullness",0),g(this,"targetBufferTime"),g(this,"lastBufferStateEvent","drained"),g(this,"firstFrameTime"),g(this,"currentTimeIsInRange",!1),g(this,"needsInputForAudioCount",0),g(this,"needsInputForVideoCount",0),g(this,"unload",(()=>{this.emitter.off("buffer state",this.onBufferedStateChanged),this.emitter.off("needs user input",this.onNeedsUserInput)})),g(this,"setTargetBufferTime",(t=>{this.targetBufferTime=t})),g(this,"getTargetBufferTime",(()=>this.targetBufferTime)),g(this,"getBufferFullness",(()=>this.bufferFullness)),g(this,"getLastBufferStateEvent",(()=>this.lastBufferStateEvent)),g(this,"getState",(()=>this.state)),g(this,"getFirstFrameTime",(()=>this.firstFrameTime)),g(this,"getStatistics",(()=>({bufferTime:this.targetBufferTime,needsInputForAudioCount:this.needsInputForAudioCount,needsInputForVideoCount:this.needsInputForVideoCount}))),g(this,"onBufferedStateChanged",(({buffered:t,isPaused:e})=>{const i=this.clockSource.currentTime,n=t.some((t=>t.start<i&&i<t.end)),s=t[t.length-1],r=!!s&&s.end-s.start>=this.targetBufferTime,a=s?Math.max(0,s.end-i)/this.targetBufferTime:0,o=e?"paused":n?"playing":"buffering",l=this.state;this.currentTimeIsInRange===n||n?n&&r&&"drained"===this.lastBufferStateEvent&&(this.lastBufferStateEvent="filled",this.emitter.emit("buffer state event",this.lastBufferStateEvent)):(this.lastBufferStateEvent="drained",this.emitter.emit("buffer state event",this.lastBufferStateEvent)),"playing"===o&&!this.firstFrameTime&&(this.firstFrameTime=Date.now()),this.currentTimeIsInRange=n,this.state=o,this.bufferFullness=n?a:0,l!==o&&this.emitter.emit("playback state",o),this.emitter.emit("buffer fullness",this.bufferFullness)})),g(this,"onNeedsUserInput",(({forAudio:t,forVideo:e})=>{t&&this.needsInputForAudioCount++,e&&this.needsInputForVideoCount++})),this.emitter=t,this.logger=e,this.clockSource=i,this.targetBufferTime=n,this.emitter.on("buffer state",this.onBufferedStateChanged),this.emitter.on("needs user input",this.onNeedsUserInput)}};g(is,"create",((t,e,i,n)=>new is(t,e,i,n)));let ns=is;const ss=()=>({upgradesFromLevel:[],downgradesFromLevel:[],bufferingRanges:[],activeRanges:[],decodeRate:Number.MAX_SAFE_INTEGER}),rs=class{constructor(t,e){g(this,"minBufferFullnessLengthForRegression",6),g(this,"logger"),g(this,"emitter"),g(this,"timers",dt.create()),g(this,"metrics",{levels:{},levelDowngrades:[],levelUpgrades:[],bufferFullness:0,general:ss()}),g(this,"bufferFullness",new C(30)),g(this,"bufferFullnessRegression"),g(this,"currentLevel"),g(this,"isSuspended",!1),g(this,"_fatalQosCount",0),g(this,"hasAsserted",!1),g(this,"load",(()=>{this.emitter.on("playback state",this.onPlaybackState),this.emitter.on("buffer fullness",this.onBufferFullness),this.emitter.on("rendition level changed",this.onRenditionLevelChanged),this.emitter.on("video decode rate",this.onVideoDecodeRate)})),g(this,"unload",(()=>{this.emitter.off("playback state",this.onPlaybackState),this.emitter.off("buffer fullness",this.onBufferFullness),this.emitter.off("rendition level changed",this.onRenditionLevelChanged),this.emitter.off("video decode rate",this.onVideoDecodeRate),this.suspend()})),g(this,"suspend",(()=>{this.isSuspended=!0,this.timers.unload(),this.stopBuffering(),this.unsetActive()})),g(this,"unsuspend",(()=>{this.isSuspended=!1,this.currentLevel&&this.setActive()})),g(this,"fatalQosGraceTime",(()=>1e4*(this.fatalQosCount+1))),g(this,"incrementFatalQosCount",(()=>{this._fatalQosCount++})),g(this,"getMetrics",(()=>this.metrics)),g(this,"getLevelStats",(t=>{var e,i,n,s;const r=(null!=(i=null==(e=t.video)?void 0:e.bitRate)?i:0)+(null!=(s=null==(n=t.audio)?void 0:n.bitRate)?s:0);return this.metrics.levels[r]})),g(this,"getBufferFullnessRegression",(()=>this.bufferFullnessRegression)),g(this,"activeRatios",(()=>{const t=new Map,e=lt(this.metrics.general.activeRanges);if(Object.entries(this.metrics.levels).forEach((([i,n])=>{t.set(i,e?lt(n.activeRanges)/e:0)})),!this.hasAsserted){const e=!t.size||Math.abs(Array.from(t.values()).reduce(((t,e)=>t+e),0)-1)<=.02;e||(this.hasAsserted=!0,console.assert(e,`Active ratios should be close to 1 - actual: ${Array.from(t.values()).reduce(((t,e)=>t+e),0)}`))}return t})),g(this,"bufferingRatios",(()=>{const t=new Map,e=lt(this.metrics.general.bufferingRanges);if(Object.entries(this.metrics.levels).forEach((([i,n])=>{t.set(i,e?lt(n.bufferingRanges)/e:0)})),!this.hasAsserted){const e=Array.from(t.values()).reduce(((t,e)=>t+e),0)<=1;e||(this.hasAsserted=!0,console.assert(e,`Buffering ratios should be less than 1 - actual: ${Array.from(t.values()).reduce(((t,e)=>t+e),0)}`))}return t})),g(this,"bufferingEventsLast",(t=>this.metrics.general.bufferingRanges.filter((e=>e.start>=Date.now()-t)).length)),g(this,"timeSpentBufferingLast",(t=>ht(this.metrics.general.bufferingRanges,t))),g(this,"timeSpentActiveLast",(t=>ht(this.metrics.general.activeRanges,t))),g(this,"timeSpentPlayingInAtLeastLevelRatio",(t=>{var e,i,n,s;const r=this.timeSpentBuffering(),a=this.timeActive(),o=this.bufferingRatios(),l=this.activeRatios(),h=(null!=(i=null==(e=t.video)?void 0:e.bitRate)?i:0)+(null!=(s=null==(n=t.audio)?void 0:n.bitRate)?s:0),c=r/a;return Object.keys(this.metrics.levels).map((t=>parseInt(t,10))).filter((t=>t>=h)).reduce(((t,e)=>{var i,n;return(null!=(i=l.get(e.toString()))?i:0)-(null!=(n=o.get(e.toString()))?n:0)*c+t}),0)})),g(this,"timeSpentBuffering",(()=>lt(this.metrics.general.bufferingRanges))),g(this,"timeActive",(()=>lt(this.metrics.general.activeRanges))),g(this,"getStatistics",(()=>({timeSpentBuffering:this.timeSpentBuffering(),bufferingEventsCount:this.metrics.general.bufferingRanges.length,timeSpentRatio:[...this.activeRatios()].reduce(((t,[e,i])=>(t[e]=i,t)),{}),fatalQosCount:this.fatalQosCount}))),g(this,"onRenditionLevelChanged",(t=>{var e,i,n,s,r,a,o,l,h,c,d,u,m,p;const g=(null!=(n=null==(i=null==(e=t.from)?void 0:e.video)?void 0:i.bitRate)?n:0)+(null!=(a=null==(r=null==(s=t.from)?void 0:s.audio)?void 0:r.bitRate)?a:0),A=(null!=(h=null==(l=null==(o=t.to)?void 0:o.video)?void 0:l.bitRate)?h:0)+(null!=(u=null==(d=null==(c=t.to)?void 0:c.audio)?void 0:d.bitRate)?u:0);this.logger.info("rendition level changed",{fromLevel:g,toLevel:A}),0===this.metrics.general.activeRanges.length&&this.setActive(),t.from&&t.to&&(g<A?this.metrics.general.upgradesFromLevel.push(Date.now()):this.metrics.general.downgradesFromLevel.push(Date.now()));let f=!1;if(t.from){const t=null!=(m=this.metrics.levels[g])?m:ss();g<A?t.upgradesFromLevel.push(Date.now()):t.downgradesFromLevel.push(Date.now()),at(t.activeRanges);const e=t.bufferingRanges[t.bufferingRanges.length-1];f=!!e&&!e.end,at(t.bufferingRanges),this.metrics.levels[g]=t}if(t.to){const t=null!=(p=this.metrics.levels[A])?p:ss();ot(t.activeRanges),f&&ot(t.bufferingRanges),this.metrics.levels[A]=t,this.currentLevel=A}})),g(this,"onBufferFullness",(t=>{this.bufferFullness.push(t),this.metrics.bufferFullness=t,this.bufferFullness.items().length>=this.minBufferFullnessLengthForRegression&&(this.bufferFullnessRegression=this.calculateLinearRegression())})),g(this,"onPlaybackState",(t=>{switch(this.logger.info("Playback state",{state:t,currentLevel:this.currentLevel}),t){case"playing":this.stopBuffering();break;case"buffering":this.isSuspended||this.startBuffering()}})),g(this,"onVideoDecodeRate",(t=>{var e;if(this.metrics.general.decodeRate=t,!this.currentLevel)return;const i=this.metrics.levels[null!=(e=this.currentLevel)?e:0];i&&(i.decodeRate=t)})),g(this,"calculateLinearRegression",(()=>(t=>{let e=0,i=0,n=0,s=0,r=0;for(let a=0;a<t.length;a++){const{x:o,y:l}=t[a];e+=o,i+=l,n+=o*l,s+=o*o,r+=l*l}const a=(t.length*n-e*i)/(t.length*s-e*e),o=(i-a*e)/t.length,l=Math.pow((t.length*n-e*i)/Math.sqrt((t.length*s-e*e)*(t.length*r-i*i)),2);return{slope:a,intercept:o,r2:l,predict:e=>a*(t.length+e)+o}})(this.bufferFullness.items().map(((t,e)=>({x:e,y:t})))))),g(this,"stopBuffering",(()=>{if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&at(t.bufferingRanges)}at(this.metrics.general.bufferingRanges)})),g(this,"startBuffering",(()=>{if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&ot(t.bufferingRanges)}ot(this.metrics.general.bufferingRanges)})),g(this,"unsetActive",(()=>{if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&at(t.activeRanges)}at(this.metrics.general.activeRanges)})),this.logger=e,this.emitter=t}get fatalQosCount(){return this._fatalQosCount}setActive(){if(this.currentLevel){const t=this.metrics.levels[this.currentLevel];t&&ot(t.activeRanges)}ot(this.metrics.general.activeRanges)}};g(rs,"create",((t,e)=>new rs(t,e)));let as=rs;const os=class{constructor(t,e){g(this,"renditions",new Map),g(this,"renditionLevels",[]),g(this,"languages",[]),g(this,"emitter"),g(this,"subscriptionSource"),g(this,"renditionLevelChangeCount",0),g(this,"unload",(()=>{this.emitter.off("renditions",this.onRenditions),this.emitter.off("subscription changed",this.onSubscriptionChanged)})),g(this,"getRenditionLevels",(t=>t?this.createRenditionLevels(t):this.renditionLevels)),g(this,"getRenditionLevel",(t=>{var e;const i=null!=t?t:this.getCurrentSubscription(),n=t?this.createRenditionLevels(t):this.renditionLevels;if(!i.video)return n.length?n[0]:void 0;const s=i.video.bitRate||Number.MAX_SAFE_INTEGER,r=i.video.width||Number.MAX_SAFE_INTEGER,a=i.video.height||Number.MAX_SAFE_INTEGER;return null!=(e=n.filter((t=>!t.video||!i.video||t.video.bitRate<=s&&t.video.width<=r&&t.video.height<=a)).pop())?e:n[0]})),g(this,"setRenditions",((t,e)=>{this.renditions.set(t,e)})),g(this,"getLanguages",(()=>this.languages)),g(this,"getVideoRendition",((t,e=this.getCurrentSubscription().channelId)=>{const i=this.getRendition(t,e);if(i&&gt(i))return i})),g(this,"getAudioRenditions",(t=>{const e=this.renditions.get(t);return null==e?void 0:e.filter((t=>At(t)))})),g(this,"getVideoRenditions",(t=>{const e=this.renditions.get(t);return null==e?void 0:e.filter((t=>gt(t)))})),g(this,"getAudioRendition",((t,e=this.getCurrentSubscription().channelId)=>{const i=this.getRendition(t,e);if(i&&At(i))return i})),g(this,"getRendition",((t,e=this.getCurrentSubscription().channelId)=>{var i;return null==(i=this.renditions.get(e))?void 0:i.find((e=>e.id===t))})),g(this,"getStatistics",(()=>{var t,e,i,n,s,r,a,o,l,h;const c=this.getRenditionLevel();return{videoCodec:null==(t=null==c?void 0:c.video)?void 0:t.codec,audioCodec:null==(e=null==c?void 0:c.audio)?void 0:e.codec,videoRenditionId:null==(i=null==c?void 0:c.video)?void 0:i.id,audioRenditionId:null==(n=null==c?void 0:c.audio)?void 0:n.id,videoWidth:null==(s=null==c?void 0:c.video)?void 0:s.width,videoHeight:null==(r=null==c?void 0:c.video)?void 0:r.height,expectedVideoBitRate:null==(a=null==c?void 0:c.video)?void 0:a.bitRate,expectedAudioBitRate:null==(o=null==c?void 0:c.audio)?void 0:o.bitRate,frameRate:null==(l=null==c?void 0:c.video)?void 0:l.frameRate,language:null==(h=null==c?void 0:c.audio)?void 0:h.language,renditionLevelChangeCount:this.renditionLevelChangeCount}})),g(this,"onRenditions",(t=>{const e=this.subscriptionSource.getCurrentSubscription();this.renditions.set(t.channelId,t.renditions),this.updateRenditionLevels({to:e,from:e})})),g(this,"onSubscriptionChanged",(t=>{this.updateRenditionLevels(t)})),g(this,"updateRenditionLevels",(({to:t,from:e})=>{var i;const{channelId:n,initiator:s}=t,r=this.getRenditionLevel(e),a=new Set;(null!=(i=this.renditions.get(n))?i:[]).filter((t=>"webvtt"!==t.codec)).forEach((t=>t.language?a.add(t.language):void 0)),this.languages=Array.from(a),this.renditionLevels=this.createRenditionLevels(t);const o=this.getRenditionLevel(t);$(r,o)||(this.renditionLevelChangeCount++,this.emitter.emit("rendition level changed",{to:o,from:r,reason:s?"manual":"abr"}))})),g(this,"createRenditionLevels",(t=>{var e;const{video:i,audio:n,channelId:s}=t,r=null!=(e=this.renditions.get(s))?e:[],a=r.filter(gt).filter((t=>i&&t.codec===i.codec)),o=r.filter(At).filter((t=>n&&t.codec===n.codec&&t.language===n.language)),l=Math.max(a.length,o.length),h=[];for(let t=0;t<l;t++){const e=a[Math.min(a.length-1,t)],i=o[Math.min(o.length-1,t)];h.push({audio:i,video:e})}return h})),g(this,"getCurrentSubscription",(()=>this.subscriptionSource.getCurrentSubscription())),this.subscriptionSource=e,this.emitter=t,this.emitter.on("renditions",this.onRenditions),this.emitter.on("subscription changed",this.onSubscriptionChanged)}};g(os,"create",((t,e)=>new os(t,e)));let ls=os;const hs=t=>JSON.parse(JSON.stringify(t)),cs=class{constructor(t,e,i){g(this,"logger"),g(this,"timers",new dt),g(this,"emitter"),g(this,"targetSubscription"),g(this,"currentSubscription"),g(this,"_isSwitchingSubscription",!1),g(this,"pendingSubscriptionTimeoutId"),g(this,"burstMs",0),g(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.timers.unload(),this.emitter.off("subscription changed",this.onSubscriptionChanged),this.logger.debug("Unloaded module")})),g(this,"isSwitchingSubscription",(()=>this._isSwitchingSubscription)),g(this,"getTargetSubscription",(()=>this.targetSubscription)),g(this,"getCurrentSubscription",(()=>this.currentSubscription)),g(this,"enableBurst",(t=>{this.burstMs=t})),g(this,"setSize",(t=>{this.targetSubscription.video.width=t.width,this.targetSubscription.video.height=t.height,this.scheduleSubscriptionChange()})),g(this,"setVideoConstraint",(t=>{this.targetSubscription.video=t,this.scheduleSubscriptionChange()})),g(this,"setAudioConstraint",(t=>{this.targetSubscription.audio=t,this.scheduleSubscriptionChange()})),g(this,"setVideoBitRate",(t=>{this.targetSubscription.video.bitRate=t,this.scheduleSubscriptionChange()})),g(this,"setAudioBitRate",(t=>{this.targetSubscription.audio.bitRate=t,this.scheduleSubscriptionChange()})),g(this,"setChannelId",(t=>{this.targetSubscription.channelId=t,this.scheduleSubscriptionChange()})),g(this,"setLanguage",(t=>{this.targetSubscription.audio.language=t,this.scheduleSubscriptionChange()})),g(this,"setVideoCodec",(t=>{this.targetSubscription.video.codec=t,this.scheduleSubscriptionChange()})),g(this,"setAudioCodec",(t=>{this.targetSubscription.audio.codec=t,this.scheduleSubscriptionChange()})),g(this,"setBurst",(t=>{t?this.targetSubscription.burstMs=t:delete this.targetSubscription.burstMs})),g(this,"isNewSubscription",(()=>{const t=["burstMs","meta","initiator","channelGroupId"];return!$(rt(this.currentSubscription,t),rt(this.targetSubscription,t))})),g(this,"onSubscriptionChanged",(({to:t,reset:e})=>{this.logger.debug("onSubscriptionChanged",{to:t,reset:e}),e?this.targetSubscription=hs(this.currentSubscription):this.currentSubscription=hs(t),this._isSwitchingSubscription=this.isNewSubscription()})),g(this,"scheduleSubscriptionChange",(()=>{this.targetSubscription=hs(this.targetSubscription),this._isSwitchingSubscription=this.isNewSubscription();const t=this.currentSubscription.channelId,e=this.targetSubscription.channelId,i=t!==e;this._isSwitchingSubscription&&(i&&this.burstMs?this.setBurst(this.burstMs):this.setBurst(0),this.pendingSubscriptionTimeoutId&&(this.timers.clearTimeout(this.pendingSubscriptionTimeoutId),this.pendingSubscriptionTimeoutId=void 0),i&&this.timers.setTimeout((()=>{this.currentSubscription.channelId===t&&this.targetSubscription.channelId===e&&(this.logger.warn("Channel switch timeout",e),this.targetSubscription=hs(this.currentSubscription),this.emitter.emit("channel switch timeout",e))}),1e4),this.pendingSubscriptionTimeoutId=this.timers.setTimeout((()=>this.emitter.emit("send signal",{type:"subscribe",subscription:this.getTargetSubscription()})),0))})),this.logger=t,this.targetSubscription=e,this.currentSubscription=hs(e),this.emitter=i,this.emitter.on("subscription changed",this.onSubscriptionChanged)}};g(cs,"create",((t,e,i)=>new cs(t,i,e)));let ds=cs;const us=()=>U()||_()||-1!==L.indexOf("CrKey")?100:0,ms=t=>e=>e>t,ps=class{constructor(t,e,i,n,s){g(this,"emitter"),g(this,"logger"),g(this,"playbackSource"),g(this,"bufferSource"),g(this,"keyframeTimestamps",new C(10)),g(this,"lastSeekTime",Date.now()),g(this,"seekCooldownTime",1e3),g(this,"seekTimeoutTime",5e3),g(this,"seekKeyframeOvershoot",50),g(this,"syncMaxBehind"),g(this,"syncMaxBehindMultiplierStep",1),g(this,"syncMaxBehindIncreaseEvery",2),g(this,"syncMaxBehindMaximumAllowed",2e3),g(this,"syncMaxBehindMultiplier",1),g(this,"timeshiftOnAudio",!1),g(this,"syncMaxAhead",150),g(this,"timeshiftSync",{enabled:!1,maxBehind:50,multiplier:1,maxBehindAllowed:600,overshoot:us(),minOvershootAllowed:us(),maxOvershootAllowed:500}),g(this,"maxTimeSyncDifferenceTolerance",150),g(this,"timers",dt.create()),g(this,"rtt",0),g(this,"channelSyncInfo",new Map),g(this,"driftAdjustmentsCount",0),g(this,"timeshiftDriftAdjustmentCount",0),g(this,"driftAdjustments",[]),g(this,"timeShiftAdjustments",[]),g(this,"timestampOffset"),g(this,"currentChannelId"),g(this,"highestSeenTimestamps",new Map),g(this,"isSuspended",!1),g(this,"isSyncAdjustmentActivated",!1),g(this,"load",(()=>{this.timers.setInterval(this.onSync,100)})),g(this,"unload",(()=>{this.logger.debug("Unloading module..."),this.emitter.off("rtt",this.updateRtt),this.timers.unload(),this.logger.debug("Unloaded module")})),g(this,"suspend",(()=>{this.isSuspended=!0})),g(this,"unsuspend",(()=>{this.resetSyncState(),this.isSuspended=!1})),g(this,"deactivateSyncAdjustments",(()=>{this.isSyncAdjustmentActivated=!1})),g(this,"activateSyncAdjustments",(()=>{this.tryApplySyncInfo(0),this.lastSeekTime=Date.now(),this.isSyncAdjustmentActivated=!0})),g(this,"reset",(()=>{this.logger.info("Reset sync state"),this.currentChannelId=void 0,this.timestampOffset=void 0,this.resetSyncState(),this.highestSeenTimestamps.clear()})),g(this,"getTimeshiftOffset",(()=>{var t;return null!=(t=this.timestampOffset)?t:0})),g(this,"getCurrentChannelId",(()=>this.currentChannelId)),g(this,"resetSyncState",(()=>{this.timeshiftSync.multiplier=1,this.syncMaxBehindMultiplier=1,this.driftAdjustments=[],this.timeShiftAdjustments=[]})),g(this,"getLiveEdgeTime",(t=>{const e=this.channelSyncInfo.get(t);if(!e)return;const i=Date.now()-e.localTimestamp;return e.timestamp+i})),g(this,"getLiveEdgeTimeLatencyAdjusted",(t=>{const e=this.getLiveEdgeTime(t);if(e)return e+this.rtt/2})),g(this,"getWallclockTime",(t=>{const e=this.channelSyncInfo.get(t);if(!e)return;const i=Date.now()-e.localTimestamp;return e.wallclockTime+i})),g(this,"getWallclockTimeLatencyAdjusted",(t=>{const e=this.getWallclockTime(t);if(e)return e+this.rtt/2})),g(this,"processSample",(t=>{var e;if(!t.channelId)throw new Error("Sample must be assigned to a channel");this.currentChannelId||(this.currentChannelId=t.channelId),this.timestampOffset||(this.timestampOffset=t.timestamp/t.timescale*1e3-5e3);const i="video"===t.type&&t.isSync;if(this.currentChannelId!==t.channelId){let e=Number.MAX_SAFE_INTEGER;console.assert(0!==this.highestSeenTimestamps.size,"no known timestamps"),this.highestSeenTimestamps.forEach((t=>{e=Math.min(e,t)}));const i=t.timestamp/t.timescale*1e3;this.currentChannelId=t.channelId,this.timestampOffset=i-e}else(i||this.timeshiftOnAudio)&&this.tryTimeshiftSync();const n=this.timestampOffset*t.timescale/1e3;return t.timestamp-=n,i&&this.keyframeTimestamps.push(t.timestamp/t.timescale*1e3),this.highestSeenTimestamps.set(t.type,Math.max(null!=(e=this.highestSeenTimestamps.get(t.type))?e:0,t.timestamp/t.timescale*1e3)),t})),g(this,"processFragment",((t,e)=>{var i;this.currentChannelId||(this.currentChannelId=t);const n=e.mediaType();if(!n)throw new Error("Fragment must have a media type");this.timestampOffset||(this.timestampOffset=e.baseMediaDecodeTime()/e.timescale()*1e3-5e3);const s="video"===e.mediaType()&&e.startsWithKeyframe();this.currentChannelId!==t?(console.assert(0!==this.highestSeenTimestamps.size,"no known timestamps"),this.highestSeenTimestamps.forEach((t=>{})),this.currentChannelId=t):(s||this.timeshiftOnAudio)&&this.tryTimeshiftSync();const r=this.timestampOffset*e.timescale()/1e3;return e.updateBaseMediaDecodeTime(e.baseMediaDecodeTime()-r),s&&this.keyframeTimestamps.push(e.baseMediaDecodeTime()/e.timescale()*1e3),this.highestSeenTimestamps.set(n,Math.max(null!=(i=this.highestSeenTimestamps.get(n))?i:0,e.baseMediaDecodeTime()/e.timescale()*1e3)),e})),g(this,"getStatistics",(()=>({drift:this.drift,driftAdjustmentCount:this.driftAdjustmentsCount,timeshiftDriftAdjustmentCount:this.timeshiftDriftAdjustmentCount,seekTime:this.playbackSource.seekTime}))),g(this,"updateRtt",(t=>{this.rtt=t})),g(this,"isPlaybackSourceReadyToSeek",(()=>!this.isSeeking()&&this.isSeekCooldownExpired()&&this.isSyncAdjustmentActivated)),g(this,"isSeeking",(()=>!!this.playbackSource.isSeeking&&!this.isSeekTimeoutExpired())),g(this,"isAllowedToSync",(()=>this.isPlaybackSourceReadyToSeek()&&!!this.currentChannelId&&!this.isSuspended&&!this.playbackSource.isPaused)),g(this,"isSeekCooldownExpired",(()=>Date.now()-this.lastSeekTime>this.seekCooldownTime)),g(this,"isSeekTimeoutExpired",(()=>Date.now()-this.lastSeekTime>this.seekTimeoutTime)),g(this,"currentTimeshiftMaxBehind",(()=>Math.min(this.timeshiftSync.maxBehind*this.timeshiftSync.multiplier,this.timeshiftSync.maxBehindAllowed))),g(this,"currentSyncMaxBehind",(()=>Math.min(this.syncMaxBehindMultiplier*this.syncMaxBehind,this.syncMaxBehindMaximumAllowed))),g(this,"currentSyncMaxAhead",(()=>this.playbackSource.seekTime>500?Math.max(this.syncMaxAhead*this.syncMaxBehindMultiplier,300):this.syncMaxAhead)),g(this,"tryTimeshiftSync",(()=>{var t;if(!this.timeshiftSync.enabled||!this.isAllowedToSync())return;const e=null!=(t=this.drift)?t:0;if(e>=this.syncMaxBehind)return;if(e<this.currentTimeshiftMaxBehind())return void(this.timeshiftSync.overshoot=0);if(!this.timestampOffset)return;const i=Date.now()-this.seekTimeoutTime*this.timeshiftSync.multiplier,n=this.timeShiftAdjustments.filter(ms(i)).length;if(n&&this.timeshiftSync.multiplier>2)return this.logger.debug("Too many diff timeShifts within sliding window",{timeShiftsCooldownMs:i,timeShiftsWithinCooldownTime:n}),!1;const s=e+this.timeshiftSync.overshoot;this.logger.info("Adjusting for drift using timeshift",{drift:e,syncAmount:s,currentTime:this.playbackSource.currentTime,rtt:this.rtt,overshoot:this.timeshiftSync.overshoot}),this.timestampOffset+=s,this.lastSeekTime=Date.now(),!this.playbackSource.isPaused&&(this.timeShiftAdjustments.push(this.lastSeekTime),this.timeshiftDriftAdjustmentCount++,this.timeshiftSync.multiplier++,this.timeshiftSync.overshoot=Math.max(this.timeshiftSync.minOvershootAllowed,Math.min(this.timeshiftSync.multiplier*e/2,this.timeshiftSync.maxOvershootAllowed)))})),g(this,"onSync",(()=>{var t;if(!this.isAllowedToSync())return;const e=null!=(t=this.drift)?t:0;if(e<0&&-e<this.currentSyncMaxAhead()||e>0&&e<this.currentSyncMaxBehind()||Math.abs(e)<1||!this.isSeekCooldownExpired())return;const i=Date.now()-this.seekTimeoutTime*this.syncMaxBehindMultiplier,n=this.driftAdjustments.filter(ms(i)).length;if(n&&this.syncMaxBehindMultiplier>2)return this.logger.debug("Too many diff adjustments within sliding window",{adjustmentsCooldownMs:i,adjustmentsWithinCooldownTime:n}),!1;const s=this.playbackSource.seekTime,r=this.playbackSource.currentTime+e,a=this.findKeyframeCloseToTimestamp(r);if(a||this.keyframeTimestamps.isEmpty()){const t=a?a+this.seekKeyframeOvershoot:r;if(this.logger.info("Adjusting for drift using seek",{drift:e,currentTime:this.playbackSource.currentTime,targetCurrentTime:t,seekTime:s,rtt:this.rtt}),this.lastSeekTime=Date.now(),this.driftAdjustments.push(this.lastSeekTime),this.driftAdjustmentsCount++,this.playbackSource.currentTime=t+s,this.timeshiftSync.overshoot=Math.max(this.timeshiftSync.minOvershootAllowed,this.timeshiftSync.overshoot/2),this.driftAdjustmentsCount%this.syncMaxBehindIncreaseEvery==0&&!this.playbackSource.isPaused){const t=this.currentSyncMaxBehind;this.syncMaxBehindMultiplier+=this.syncMaxBehindMultiplierStep,t!==this.currentSyncMaxBehind&&this.logger.info("Increasing max drift behind allowed",{from:t,to:this.currentSyncMaxBehind})}}})),g(this,"findKeyframeCloseToTimestamp",(t=>{const e=this.keyframeTimestamps.items();for(const i of e)if(i>=t&&i<=t+200)return i})),this.logger=e,this.emitter=t,this.playbackSource=i,this.bufferSource=n,this.timeshiftSync.enabled=s,this.syncMaxBehind=this.timeshiftSync.enabled?1e3:200,this.emitter.on("rtt",this.updateRtt)}updateChannelSyncInfo(t,e){const i=Date.now(),n=this.channelSyncInfo.get(t),s=this.getLiveEdgeTime(t);if(this.isSuspended)return;if(!n||!s)return this.logger.info("Initial timing info",{syncInfo:e}),void this.channelSyncInfo.set(t,p(m({},e),{localTimestamp:i,timeDifferences:new C(12)}));const r=e.wallclockTime-n.wallclockTime,a=e.timestamp-n.timestamp,o=i-n.localTimestamp,l=a-o;if(n.timeDifferences.push(l),this.logger.debug("Timing info",{rtt:this.rtt,channelId:t,syncInfo:e,localTimestamp:i,diffFromEstimated:l,timestampDelta:a,wallclockDelta:r,localWallclockDelta:o}),Math.abs(l)>=2*this.bufferSource.getTargetBufferTime())return this.logger.info("Resetting sync info",{diffFromEstimated:l}),this.channelSyncInfo.set(t,p(m({},e),{localTimestamp:i,timeDifferences:new C(n.timeDifferences.maxSize+1)})),void(this.currentChannelId&&this.currentChannelId===t&&(this.reset(),this.emitter.emit("channel reset")));n.timeDifferences.isFull()&&this.tryApplySyncInfo(this.maxTimeSyncDifferenceTolerance)}tryApplySyncInfo(t){const e=this.getCurrentChannelId();if(!e)return;const i=this.channelSyncInfo.get(e);if(!i)return;const n=Q(i.timeDifferences.items());Math.abs(n)>t&&(this.logger.info("Adjusting sync info",{averageDifference:n}),i.timestamp+=n,i.timeDifferences.clear())}get serverCurrentTime(){return this.channelCurrentTime-this.getTimeshiftOffset()}get channelCurrentTime(){const t=this.getCurrentChannelId();if(!t)return 0;const e=this.getLiveEdgeTime(t);return e?e-this.bufferSource.getTargetBufferTime():0}get drift(){return this.serverCurrentTime-this.playbackSource.currentTime}};g(ps,"create",((t,e,i,n,s)=>new ps(t,e,i,n,s)));let gs=ps;const As={enabled:!0,interval:3e4,includeErrors:!0,includeEvents:!0,includeStats:!0,maxRetries:10,maxErrorReports:50,maxEvents:50},fs=(t,e)=>p(m({},e),{type:t,timestamp:(new Date).toISOString(),discriminator:"web"}),vs=class{constructor(t,e,i,n){g(this,"logger"),g(this,"timers",new dt),g(this,"emitter"),g(this,"options"),g(this,"parentContext"),g(this,"unsentLines",new C(100)),g(this,"retries",0),g(this,"errorCount",0),g(this,"eventCount",0),g(this,"statsCount",0),g(this,"unload",(()=>{this.logger.debug("Unloading module..."),window.removeEventListener("error",this.onError),window.removeEventListener("unhandledrejection",this.onRejection),this.timers.unload(),this.emitter.off("error",this.addError),this.emitter.off("visibilitystate",this.onVisibilityChange),this.emitter.off("pagehide",this.onPageHide),this.emitter.off("telemetry event",this.addEvent),this.addStats({isFinal:!0,initiator:"unload"}),this.send("beacon"),this.logger.debug("Unloaded module")})),g(this,"load",(()=>{window.addEventListener("error",this.onError),window.addEventListener("unhandledrejection",this.onRejection),this.emitter.on("error",this.addError),this.emitter.on("visibilitystate",this.onVisibilityChange),this.emitter.on("pagehide",this.onPageHide),this.emitter.on("telemetry event",this.addEvent),this.timers.setInterval((()=>{this.addStats(),this.send("fetch")}),this.options.interval)})),g(this,"addStats",(({isFinal:t,initiator:e}={isFinal:!1,initiator:"interval"},i={})=>{if(!this.options.includeStats)return;const n=this.parentContext.getStatistics(),s=fs("stats",p(m(m({},i),n),{isFinal:t,initiator:e,count:this.statsCount++}));this.unsentLines.push(s)})),g(this,"addEvent",(t=>{if(!this.options.includeEvents||this.eventCount>this.options.maxEvents)return;const e=this.parentContext.getStatistics(),i=fs("event",m(m({},e),t));this.eventCount++,this.unsentLines.push(i)})),g(this,"getStatistics",(()=>({errorCount:this.errorCount}))),g(this,"send",(t=>E(this,null,(function*(){if(this.options.enabled&&!(this.retries>=this.options.maxRetries)&&!this.unsentLines.isEmpty()){this.logger.debug("Sending telemetry",{lines:this.unsentLines.items()});try{const e=this.unsentLines.items().map((t=>JSON.stringify(t))).reverse().join("\n");"beacon"===t?navigator.sendBeacon(this.options.url,e):"connected"===this.parentContext.connectionState?this.emitter.emit("send signal",{type:"telemetry",body:e}):yield(0,s.p)(new URL(this.options.url),{body:e,headers:{"Content-Type":"text/plain"}}),this.retries=0,this.unsentLines.clear()}catch(t){this.retries++}}})))),g(this,"onVisibilityChange",(t=>{"hidden"===t&&(this.addStats({isFinal:!0,initiator:"visibilitychange"}),this.send("beacon"))})),g(this,"onPageHide",(t=>{this.addStats({isFinal:!0,initiator:"pagehide"},{persisted:t.persisted}),this.send("beacon")})),g(this,"onRejection",(t=>this.addError(t.reason))),g(this,"onError",(t=>this.addError(t.error))),g(this,"addError",(t=>{const{includeErrors:e,maxErrorReports:i}=this.options;if(e&&t instanceof kt){if(this.errorCount++,this.errorCount>i)return;const e=this.parentContext.getStatistics();this.unsentLines.push(fs("error",m(m({},e),t.toStringifiable())))}})),this.logger=t,this.emitter=e,this.options=m(m({},As),i),this.parentContext=n}};g(vs,"create",((t,e,i,n)=>new vs(t,e,i,n)));let bs=vs;const ws=class{constructor(t,e,i){g(this,"logger"),g(this,"element"),g(this,"documentState"),g(this,"timers",new dt),g(this,"unload",(()=>{this.timers.unload()})),g(this,"unpause",(()=>{this.element.userHasProvidedInput&&this.element.isPaused&&this.documentState.isVisible&&this.documentState.isOnline&&(this.logger.debug("Unpause video"),this.element.tryPlay())})),this.logger=t,this.element=e,this.documentState=i,this.timers.setInterval(this.unpause,100)}};g(ws,"create",((t,e,i)=>new ws(t,e,i)));let ys=ws;class Es{constructor(){var t;g(this,"highEntropyValues"),null==(t=self.navigator.userAgentData)||t.getHighEntropyValues(["architecture","model","platformVersion","fullVersionList"]).then((t=>{this.highEntropyValues=t}))}getUserAgentInformation(){var t,e,i,n,s,r;const a=window.location.origin,o=a&&"null"!=a?`${window.location.pathname}${window.location.search}`.substring(0,1e3):"",l={locationOrigin:window.location.origin,locationPath:o,ancestorOrigins:(null==(t=window.location.ancestorOrigins)?void 0:t.length)>0?Array.from(window.location.ancestorOrigins):void 0,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory};if(self.navigator.userAgentData&&this.highEntropyValues){const t="1",a=[...null!=(e=this.highEntropyValues.brands)?e:[]];a.sort(((t,e)=>t.brand.localeCompare(e.brand)));const o=[...null!=(i=this.highEntropyValues.fullVersionList)?i:[]];o.sort(((t,e)=>t.brand.localeCompare(e.brand)));const h=o.map((t=>t.version)),c=a.map((t=>t.brand)),d=a.map((t=>t.version)),u=parseInt(null!=(s=null==(n=this.highEntropyValues.platformVersion)?void 0:n.split(".")[0])?s:t);return m({userAgentLegacy:window.navigator.userAgent,ua:{browser:{brands:c,fullVersionBrands:h,majorVersions:d},device:this.highEntropyValues.model||"Other",os:{family:this.highEntropyValues.platform||"Other",version:null!=(r=this.highEntropyValues.platformVersion)?r:t,major_version:Number.isFinite(u)?u:0}}},l)}return m({userAgent:window.navigator.userAgent},l)}}var Ss,ks,Cs;const Ts=class t extends n.E{constructor(e){var i,r;super(),g(this,"pictureInPicture"),g(this,"browser",(()=>{var t;const e=!!I();let i=!1;return e&&(i=(()=>{var t,e;return!_()&&null!=(e=null==(t=I())?void 0:t.isTypeSupported('audio/mp4; codecs="opus"'))&&e})()),{isMobile:M,supportsMp4Opus:i,supportsMediaSource:e,supportsHls:P(),supportsWebAssembly:B(),platform:{iosVersion:null!=(t=O())?t:Number.MAX_SAFE_INTEGER,isIpadOS:_(),isMacOS:U(),isIOS:L.indexOf("iphone")>=0&&L.indexOf("like iphone")<0||L.indexOf("ipad")>=0&&L.indexOf("like ipad")<0||L.indexOf("ipod")>=0&&L.indexOf("like ipod")<0||_()}}})()),g(this,"options"),g(this,"element"),g(this,"playbackSource"),g(this,"emitter",new n.E),g(this,"logger"),g(this,"modules"),g(this,"clientIp"),g(this,"sessionId"),g(this,"clientId",ut()),g(this,"_channels",[]),g(this,"createdAt",Date.now()),g(this,"hasCalledConnect",!1),g(this,"latestEmittedLanguages",[]),g(this,"wakeLock"),g(this,"pool",new S(t.MAX_POOL_SIZE)),g(this,"userAgentInformation",new Es),g(this,"encryptedMediaExtensions"),v(this,Ss,0),v(this,ks,[]),g(this,"sampleProcessingSesssions",new Map),g(this,"sizes",new Map),g(this,"isSuspended",!0),g(this,"disconnectTimeout"),v(this,Cs),g(this,"attach",(t=>{var e;null==(e=this.wakeLock)||e.attach(t),t.appendChild(this.element)})),g(this,"getOptions",(()=>this.options.getOptions())),g(this,"getThumbnailUrl",(()=>{let t=this.options.get("edgeUrl")||this.options.get("url");t=t.replace("wss://","https://"),t=t.replace("ws://","http://"),t=t.endsWith("/")?t.slice(0,-1):t;const e=window.devicePixelRatio||1,i=Math.round(window.innerWidth*e),n=Math.round(window.innerHeight*e),s=this.options.get("authenticationToken"),r=s?`&auth.token=${s}`:"";return`${t}/api/thumbnail?channelId=${this.channelId}${r}&width=${i}&height=${n}`})),g(this,"updateAuthenticationToken",(t=>{this.logger.debug("Got new auth token",{token:t}),this.options.set("authenticationToken",t),this.emitter.emit("send signal",{type:"refresh auth",token:t})})),g(this,"connect",(()=>{this.hasCalledConnect||(this.play(),this._connect())})),g(this,"_connect",(()=>{var t,e;this.hasCalledConnect||(this.hasCalledConnect=!0,Object.values(this.modules).forEach((t=>{t&&"load"in t&&t.load()})),this.unsuspend(),this.playbackSource instanceof ui&&(null==(e=(t=this.playbackSource).load)||e.call(t)),this.modules.connection.connect())})),g(this,"getCastOptions",(()=>({url:this.options.get("url"),channelId:this.options.get("channelId"),channelGroupId:this.options.get("channelGroupId"),authenticationToken:this.options.get("authenticationToken"),language:this.options.get("language"),logLevel:this.options.get("logLevel"),minBufferTime:this.options.get("minBufferTime"),tags:this.options.get("tags"),ownerSessionId:this.sessionId,edgeUrl:this.options.get("edgeUrl"),media:this.options.get("media"),drm:this.options.get("drm")}))),g(this,"onConnectInfo",(t=>E(this,null,(function*(){var e;this.sessionId=ut();const i=this.modules.subscription.getTargetSubscription(),n=t.channels.find((t=>t.channelId===i.channelId));if(this.emitter.emit("connect info",t),this._channels=t.channels,this.updateTextTracks(null!=(e=null==n?void 0:n.renditions)?e:[]),!this.textTrack&&this.options.get("textTrack")&&(this.textTrack=this.options.get("textTrack")),yield Promise.all(t.channels.map((t=>E(this,null,(function*(){t.overrides&&this.options.addOverrides(t.channelId,t.overrides),t.renditions=yield this.filterRenditions(t.renditions),this.modules.renditions.setRenditions(t.channelId,t.renditions)}))))),!n)throw Pt("external");const s=this.options.getOverride("sizeBasedResolutionCapEnabled",this.channelId);void 0!==s&&(this.modules.constraintCap.sizeBasedResolutionCapEnabled=s);const r=this.options.getOverride("minBufferTime",this.channelId),a=this.options.getOverride("maxBufferTime",this.channelId);if((r||a)&&(this.modules.bufferTime.updateConfig({minBufferTime:this.options.get("minBufferTime",this.channelId),maxBufferTime:this.options.get("maxBufferTime",this.channelId)}),this.targetBufferTime=this.options.get("minBufferTime",this.channelId)),this.options.get("burstEnabled",this.channelId)&&this.modules.subscription.enableBurst(this.targetBufferTime),this.emit("is live",n.isLive),!n.isLive)throw new Error("Waiting for channel to go live");this.patchSubscription(n,this.modules.connection.estimatedBandwidth),yield this.initializeDecodingModule(),this.resetModules(),this.emit("rendition levels",this.modules.renditions.getRenditionLevels()),this.emit("channels",this.channels),this.emitLanguagesIfChanged(),this.sampleProcessingSesssions.clear();const o=this.options.get("burstEnabled",this.channelId);return{video:this.targetSubscription.video,audio:this.targetSubscription.audio,burstMs:o?this.targetBufferTime:void 0,sessionId:this.sessionId,clientId:this.clientId,channelId:this.channelId,channelGroupId:this.options.get("channelGroupId"),authToken:this.options.get("authenticationToken"),textTrack:this.textTrack}})))),g(this,"emitLanguagesIfChanged",(()=>{const t=this.modules.renditions.getLanguages(),e=this.latestEmittedLanguages;t.length==e.length&&t.every((t=>e.includes(t)))||(this.logger.debug("Emitting new languages",{currentLanguages:t}),this.latestEmittedLanguages=t,this.emit("languages",this.latestEmittedLanguages))})),g(this,"updateTextTracks",(t=>{const e=t.filter((t=>"webvtt"===t.codec));e.forEach((t=>{if(!f(this,ks).find((e=>e.language===t.language)))if(this.modules.canvasModule){const e=this.modules.canvasModule.textTracks.addTextTrack(t.kind,t.label||t.language||"",t.language||"");f(this,ks).push(e)}else if(this.mediaElement instanceof HTMLVideoElement){const e=this.mediaElement.addTextTrack(t.kind,t.label||t.language,t.language);f(this,ks).push(e)}}));for(const t of f(this,ks))e.find((e=>e.language===t.language))?"disabled"===t.mode&&(t.mode="hidden"):t.mode="disabled";this.emit("text tracks",this.textTracks)})),g(this,"cleanupTextTracks",((t=this.currentTime-2e4)=>{f(this,ks).forEach((e=>{if(e.cues)for(const i of e.cues)1e3*i.endTime<t-2e3&&e.removeCue(i)}))})),g(this,"filterRenditions",(t=>E(this,null,(function*(){const e=yield Promise.all(t.map((t=>E(this,null,(function*(){var e,i,n;if(At(t))return!0;if(!gt(t)||!this.isSupportedVideoCodecProfile(t.codec,t.codecString))return!1;if(!this.willUseMediaSource()){const s=this.options.get("advanced"),r=null!=(e=s.wasmDecodingConstraint.bitRate)?e:Number.MAX_SAFE_INTEGER,a=null!=(i=s.wasmDecodingConstraint.width)?i:Number.MAX_SAFE_INTEGER,o=null!=(n=s.wasmDecodingConstraint.height)?n:Number.MAX_SAFE_INTEGER;return t.bitRate<=r&&t.width<=a&&t.height<=o}const s=yield(t=>{if(!navigator.mediaCapabilities)return Promise.resolve({smooth:!0,supported:!0,powerEfficient:!0,failedToQuery:!0});if("webvtt"===t.codec)throw new Error("WebVTT is not supported");let e;return e=At(t)?{type:"media-source",audio:{contentType:ft(t),bitrate:t.bitRate,channels:t.channels.toString(),samplerate:t.sampleRate}}:{type:"media-source",video:{contentType:ft(t),bitrate:t.bitRate,width:t.width,height:t.height,framerate:t.frameRate[0]/t.frameRate[1]}},navigator.mediaCapabilities.decodingInfo(e)})(t);if(!s.supported||"av1"==t.codec&&!s.smooth&&!s.powerEfficient)return!1;const r=this.options.getOverride("maxVideoBitRate",this.channelId);return!r||r>=t.bitRate})))));let i=t.filter(((t,i)=>e[i]));const n=i.filter((t=>"h264"===t.codec)).reverse()[0],s=i.filter((t=>"av1"===t.codec)).reverse()[0];return n&&s&&n.width>s.width&&n.height>s.height&&(i=i.filter((t=>"av1"!==t.codec))),i})))),g(this,"patchSubscription",((e,i)=>{const n=Math.min(this.options.get("maxVideoBitRate"),t.INITIAL_MAX_BIT_RATE,i,this.targetSubscription.video.bitRate),s=Math.min(this.options.get("maxAudioBitRate"),t.INITIAL_MAX_BIT_RATE,i,this.targetSubscription.audio.bitRate),r="audio"===this.options.get("media")?[]:this.options.get("videoCodecs",this.channelId),a=this.supportedAudioCodecs(),o=e.renditions.filter(At),l=e.renditions.filter(gt),h=a.find((t=>void 0!==o.find((e=>e.codec===t)))),c=r.find((t=>void 0!==l.find((e=>e.codec===t)))),d=o.map((t=>t.language));if(this.logger.debug("supported and selected codecs",{audioCodecs:a,videoCodecs:r,audioCodec:h,videoCodec:c}),c){const t=this.options.get("maxSize");this.modules.subscription.setVideoConstraint(m({codec:c,bitRate:this.abrEnabled?n:this.options.get("maxVideoBitRate")},t))}h&&(this.modules.subscription.setAudioConstraint({codec:h,bitRate:this.abrEnabled?s:this.options.get("maxAudioBitRate"),language:this.options.get("language")}),(!d.includes(this.options.get("language"))||void 0===this.language)&&this.modules.subscription.setLanguage(d[0])),this.alignSizeAndBitRate(this.targetSubscription);const u=this.modules.subscription.getTargetSubscription();this.emitter.emit("subscription changed",{to:u,from:this.modules.subscription.getCurrentSubscription()})})),g(this,"isSupportedVideoCodecProfile",((t,e)=>{if(this.willUseMediaSource()){const i=I();return!i||i.isTypeSupported(ft({codec:t,codecString:e}))}if("h264"===t){const t=!(null==e||!e.startsWith("avc1.42")),i=!(null==e||!e.startsWith("avc1.66."));return t||i}return"av1"!==t})),g(this,"supportedAudioCodecs",(()=>{if("video"===this.options.get("media"))return[];const t=[];return(this.browser.supportsMp4Opus&&this.options.get("mseOpusEnabled")||!this.willUseMediaSource())&&t.push("opus"),this.willUseMediaSource()&&t.push("aac"),t})),g(this,"initializeDecodingModule",(()=>E(this,null,(function*(){var t,e;const i=this.currentRenditionLevel,n=[];if(!i)throw new kt("No currentRenditionLevel",{code:"no_current_rendition_level",isFatal:!1});if(null!=i&&i.video&&n.push({type:"video",mimeType:ft(i.video)}),null!=i&&i.audio&&n.push({type:"audio",mimeType:ft(i.audio)}),0===n.length)throw new kt("Can't initialize decoding module without tracks",{code:"no_tracks",isFatal:!1});if(this.willUseMediaSource()&&this.element instanceof HTMLMediaElement)this.emitter.emit("flush buffers"),yield null==(t=this.modules.mseModule)?void 0:t.setSourceBuffers(n);else{const t=yield zi.create(this.emitter,this.logger.createContext("DecoderModule"),n,this.playbackSource,this.pool);null==(e=this.modules.decoder)||e.unload(),this.modules.decoder=t,this.modules.decoder.load()}})))),g(this,"unload",(()=>E(this,null,(function*(){var e,i,n;this.logger.debug("Unloading modules..."),yield Promise.all(Object.values(this.modules).map((t=>null==t?void 0:t.unload()))),null==(e=this.wakeLock)||e.unload(),this.pool=new S(t.MAX_POOL_SIZE),null==(n=(i=this.playbackSource).unload)||n.call(i),this.element.remove(),this.emitter.reset(),this.encryptedMediaExtensions.unload(),this.reset(),this.logger.debug("Unloaded modules")})))),g(this,"userInput",(()=>{this.play()})),g(this,"pause",(()=>{this.options.get("pauseSupportEnabled")&&"paused"!==this.playbackState&&(this.playbackSource.pause(),this.hasCalledConnect&&this.suspend())})),g(this,"registerDebugInstance",(()=>{(t=>{const e=window;e.vindralInstances=e.vindralInstances||{},e.vindralInstances[t.getStatistics().clientId.substring(0,8)]=t})(this)})),g(this,"play",(()=>{var e;this.hasCalledConnect?this.unsuspend():"playing"!==this.playbackState&&(this._connect(),self.addEventListener("__vindral_register_debug__",this.registerDebugInstance),this.modules.timer.setInterval((()=>this.cleanupTextTracks()),t.REMOVE_CUE_THRESHOLD)),null==(e=this.wakeLock)||e.enable(),"paused"===this.playbackState&&(this.resetModules(),this.emitter.emit("flush buffers"),this.cleanupTextTracks(Number.MAX_SAFE_INTEGER)),this.playbackSource.play()})),g(this,"getStatistics",(()=>Object.values(this.modules).reduce(((t,e)=>e&&"getStatistics"in e?m(m({},t),e.getStatistics()):t),this.getRuntimeInfo()))),g(this,"resetModules",(()=>{Object.values(this.modules).forEach((t=>{t&&"reset"in t&&t.reset()})),this.sampleProcessingSesssions.clear(),this.playbackSource.currentTime=0,this.playbackSource.isActivated=!1})),g(this,"getRuntimeInfo",(()=>{const t=this.modules.canvasModule?this.options.get("iosMediaElementEnabled"):void 0;return m({uptime:Date.now()-this.createdAt,version:"4.0.0-106-g9e37c403",clientId:this.clientId,sessionId:this.sessionId,channelId:this.channelId,channelGroupId:this.options.get("channelGroupId"),ip:this.clientIp,url:this.options.get("url"),timeToFirstFrame:this.timeToFirstFrame(),iosMediaElementEnabled:t},this.userAgentInformation.getUserAgentInformation())})),g(this,"onMediaElementState",(t=>{this.logger.info("media element state",{state:t}),this.options.get("pauseSupportEnabled")&&("paused"===t?this.modules.documentState.isVisible&&(this.suspend(),this.modules.connection.disconnect()):(this.unsuspend(),"disconnected"===this.modules.connection.getState()&&this.modules.connection.unsuspend()))})),g(this,"onBufferEvent",(t=>{var e,i,n,s;this.emit("buffer state event",t);const r=!this.playbackSource.isActivated||this.playbackSource.isPaused;if("filled"===t&&r){const t=Math.max(this.currentTime,null!=(i=null==(e=this.videoBufferedRanges[0])?void 0:e.start)?i:0,null!=(s=null==(n=this.audioBufferedRanges[0])?void 0:n.start)?s:0);this.logger.info("Buffer filled - starting playback",{currentTime:t}),this.playbackSource.currentTime=t,this.modules.sync.activateSyncAdjustments(),this.playbackSource.isActivated=!0}else"drained"===t&&this.playbackSource.isPaused&&(this.playbackSource.isActivated=!1,this.modules.sync.deactivateSyncAdjustments())})),g(this,"timeToFirstFrame",(()=>{const t=this.modules.playback.getFirstFrameTime(),e=this.modules.connection.firstConnectionTime;if(e&&t)return t-e})),this.options=new pi(m(m({},yt),(t=>{if(!(t=>!("object"!=typeof t||!Nt(t,"channelId")||"string"!=typeof t.channelId||!Nt(t,"url")||"string"!=typeof t.url||0===t.channelId.length||0===t.url.length))(t))throw new kt("Invalid options",{isFatal:!0,code:"invalid_options"});const e=m({},t);return Object.keys(e).forEach((t=>{const i=e;void 0===i[t]&&delete i[t]})),e})(e))),void 0===e.telemetryEnabled&&["localhost","127.0.0.1"].includes(location.hostname)&&this.options.set("telemetryEnabled",!1);const a={channelId:this.options.get("channelId"),audio:{language:this.options.get("language"),bitRate:this.options.get("maxAudioBitRate")},video:{bitRate:this.options.get("maxVideoBitRate"),width:this.options.get("maxSize").width,height:this.options.get("maxSize").height}},o=nt.get();o.setLevel(this.options.get("logLevel")),o.setDebug(!1),this.logger=o;const l=es.create(this.emitter,this.logger.createContext("PictureInPictureModule")),h=dt.create(),c=Fi.create(this.emitter,this.logger.createContext("ConnectionModule"),{reconnectHandler:this.options.get("reconnectHandler"),options:this.options,onConnectInfo:this.onConnectInfo}),d=ds.create(this.logger.createContext("SubscriptionModule"),this.emitter,a),u=ls.create(this.emitter,d),A=as.create(this.emitter,this.logger.createContext("QualityOfServiceModule")),w=ns.create(this.emitter,this.logger.createContext("PlaybackModule"),this,this.options.get("minBufferTime"));this.encryptedMediaExtensions=new Ee(this.emitter,this.logger.createContext("EncryptedMediaExtensions"),null==(i=e.drm)?void 0:i.headers,null==(r=e.drm)?void 0:r.queryParams);const y=Xi.create(this.emitter),k=this.options.get("poster"),C=!0===k?this.getThumbnailUrl():k||void 0;let T,x,R;if(this.willUseMediaSource()){const t=new ui({type:"audio"==this.options.get("media")?"audio":"video",autoplay:!1,muted:this.options.get("muted")||"video"===this.options.get("media"),logger:this.logger.createContext("MediaElement"),poster:C});t.on("buffer state",(t=>this.emitter.emit("buffer state",t))),t.on("needs user input",(t=>this.emitter.emit("needs user input",t))),t.on("volume state",(t=>this.emit("volume state",t))),t.on("media element state",(t=>this.onMediaElementState(t))),this.element=t.element,this.playbackSource=t,Ee.isSupported()&&this.encryptedMediaExtensions.attach(t.element),T=Kn.create(this.logger.createContext("MseModule"),this.emitter,this.element),this.options.get("pauseSupportEnabled")||(x=ys.create(this.logger.createContext("UnpauseModule"),t,y)),this.options.get("pictureInPictureEnabled")&&this.emitter.emit("add picture in picture listener",{element:t.element})}else if(this.browser.platform.iosVersion>=15&&this.options.get("iosMediaElementEnabled")){const t=Gn.create(this.emitter,this.logger.createContext("ModernCanvasModule"),this.pool,this,{type:"audio"==this.options.get("media")?"audio":"video",muted:this.options.get("muted")||"video"===this.options.get("media"),poster:C}),e=t.element();this.element=e.element,this.playbackSource=t,R=t,this.options.get("pictureInPictureEnabled")&&this.browser.platform.iosVersion>15&&this.emitter.emit("add picture in picture listener",{element:this.element}),this.options.get("pauseSupportEnabled")||(x=ys.create(this.logger.createContext("UnpauseModule"),e,y))}else{const t=Fn.create(this.emitter,this.logger.createContext("LegacyCanvasModule"),this.pool,this,this.options.get("muted")||"video"===this.options.get("media"));this.element=t.element(),this.playbackSource=t,R=t,this.options.get("iosWakeLockEnabled")&&(this.wakeLock=new ni)}this.emitter.on("channel reset",this.resetModules),this.emitter.on("no data timeout",this.resetModules),this.emitter.on("media element state",(t=>this.onMediaElementState(t))),this.emitter.on("volume state",(t=>this.emit("volume state",t))),this.options.get("pauseSupportEnabled")||this.emitter.on("exit picture in picture",(()=>h.setTimeout((()=>this.play()),0))),this.emitter.on("constraint cap changed",(t=>{this.logger.info("new cap set",{cap:t}),this.alignSizeAndBitRate(this.targetSubscription)})),this.pictureInPicture={enter:()=>l.requestPictureInPicture(),exit:()=>l.exitPictureInPicture(),isActive:()=>l.isPictureInPictureActive(),isSupported:()=>l.isPictureInPictureSupported()},this.emitter.on("error",(t=>{if("external"===t.type()&&this.emit("error",t),t.isFatal())return()=>{this.unload()}}));const N=this.browser.platform.isIOS&&!this.browser.platform.isIpadOS,D=gs.create(this.emitter,this.logger.createContext("SyncModule"),this.playbackSource,w,this.willUseMediaSource()&&!N),W=(this.options.get("edgeUrl")||this.options.get("url")).replace("wss://","https://").replace("ws://","http://").replace("//lb.","//errors."),G=new URL("/telemetry",W).toString(),H=bs.create(this.logger.createContext("TelemetryModule"),this.emitter,{url:G,enabled:this.options.get("telemetryEnabled"),includeStats:!1,interval:5e3},this);let V;this.modules={telemetry:H,bufferTime:yi.create(this.emitter,this.logger.createContext("BufferTimeModule"),A,this,{maxBufferTime:this.options.get("maxBufferTime"),minBufferTime:this.options.get("minBufferTime")}),incomingData:$i.create(this.emitter),adaptivity:vi.create(this.emitter,this.logger.createContext("AdaptivityModule"),A,{cooldownTime:Math.max(this.options.get("minBufferTime"),2e3)}),constraintCap:Hi.create(this.emitter,this.element,u,!!this.options.get("abrEnabled")&&this.options.get("sizeBasedResolutionCapEnabled")),event:ji.create(this.emitter,this.logger.createContext("EventModule"),D),sync:D,documentState:y,connection:c,playback:w,pictureInPicture:l,timer:h,subscription:d,renditions:u,qualityOfService:A,mseModule:T,unpause:x,canvasModule:R},this.modules.adaptivity.isEnabled=this.options.get("abrEnabled"),this.emitter.on("page active",(e=>{var i;e&&"number"==typeof this.disconnectTimeout&&(this.modules.timer.clearInterval(this.disconnectTimeout),this.disconnectTimeout=void 0),e?this.playbackSource.isPaused||(this.logger.debug("Unsuspending"),this.unsuspend()):(this.logger.debug("Suspending"),this.suspend(),this.modules.decoder?this.options.get("iosBackgroundPlayEnabled")?(this.modules.decoder.unsuspend(),null==(i=this.modules.canvasModule)||i.unsuspend()):this.modules.connection.disconnect():(this.disconnectTimeout&&this.modules.timer.clearInterval(this.disconnectTimeout),this.disconnectTimeout=this.modules.timer.setInterval((()=>{const t="paused"===this.playbackState||this.muted;"connected"===this.connectionState&&t&&(this.emitter.emit("flush buffers"),this.modules.connection.disconnect("Page inactive timeout"))}),t.DISCONNECT_TIMEOUT)))})),this.emitter.on("context switch complete",(()=>{V||(V=window.setTimeout((()=>{window.clearTimeout(V),V=void 0,this.emit("context switch","completed"),this.emitLanguagesIfChanged()}),this.targetBufferTime))})),this.emitter.on("context switch started",(()=>this.emit("context switch","started"))),this.emitter.on("needs user input",(t=>this.emit("needs user input",t))),this.emitter.on("event",(t=>{switch(t.type){case"metadata":this.emit("metadata",t);break;case"channel switch":this.emit("channel switch",{channelId:t.channelId});break;case"language switch":this.emit("language switch",{language:t.language})}})),this.emitter.on("buffer state event",this.onBufferEvent),this.emitter.on("playback state",(t=>this.emit("playback state",t))),this.emitter.on("rendition level changed",(({to:t})=>{t&&this.emit("rendition level",t)})),this.emitter.on("connection state",(t=>{this.emit("connection state",t)})),this.emitter.on("recovered from media error",(()=>{this.modules.adaptivity.reset(2*this.targetBufferTime)})),this.emitter.once("connect info",(t=>{var e,i,n;const s=(null!=(i=null==(e=t.telemetry)?void 0:e.probability)?i:1)>=Math.random();t.telemetry&&(null==(n=this.modules.telemetry)||n.unload(),this.modules.telemetry=bs.create(this.logger.createContext("TelemetryModule"),this.emitter,p(m({},t.telemetry),{enabled:this.options.get("telemetryEnabled")&&s}),this),this.modules.telemetry.load())})),this.emitter.on("adapt level",(t=>{var e,i,n,s,r;this.logger.debug("adapt level",{direction:t});const a=this.modules.renditions.getRenditionLevels(),o=this.modules.renditions.getRenditionLevel(),l=a.findIndex((t=>t===o)),h=a.length-1;let c=l;switch(t){case"upgrade":{const t=Math.min(l+1,h),o=a[t],d=null!=(e=this.modules.connection.estimatedBandwidth)?e:vt(),u=(null!=(n=null==(i=null==o?void 0:o.audio)?void 0:i.bitRate)?n:0)+(null!=(r=null==(s=null==o?void 0:o.video)?void 0:s.bitRate)?r:0);o&&2*d>u&&this.modules.adaptivity.isQoSOk(o)&&(c=t)}break;case"downgrade":c=Math.max(l-1,0);break;case"double downgrade":c=Math.max(l-2,0);break;case"reconnect":if(0===l||this.modules.qualityOfService.timeSpentBufferingLast(6e3)>5e3){if(!this.modules.connection.lastConnectionTime||Date.now()-this.modules.connection.lastConnectionTime<this.modules.qualityOfService.fatalQosGraceTime()||"connected"!==this.modules.connection.getState())return;return this.modules.qualityOfService.incrementFatalQosCount(),this.logger.info("Reconnecting due to poor qos"),this.modules.connection.reconnect("Fatal QOS"),void this.emitter.emit("adapted level")}c=0}if(c===l)return;const d=a[c];this.alignSizeAndBitRate(p(m({},this.targetSubscription),{video:m(m({},this.targetSubscription.video),null==d?void 0:d.video),audio:m(m({},this.targetSubscription.audio),null==d?void 0:d.audio)})),this.emitter.emit("adapted level")})),this.emitter.on("text track data",(t=>{const e=f(this,ks).find((e=>e.language===t.language)),i=this.modules.sync.getTimeshiftOffset()/1e3,n=i-f(this,Ss);if(b(this,Ss,i),e){if(e.cues)for(const t of e.cues)t.startTime-=n,t.endTime-=n;for(const n of t.cues){const t=new VTTCue(n.startTime-i,n.endTime-i,n.text);e.addCue(t)}}})),this.emitter.on("received signal",(t=>{var e;const i=t,n=this.modules.subscription.getCurrentSubscription();switch(this.logger.debug("received",m({},i)),i.type){case"client ip":this.clientIp=i.ip;break;case"renditions":this.updateTextTracks(i.renditions),b(this,Cs,this.filterRenditions(i.renditions).then((t=>{this.emitter.emit("renditions",{renditions:t,channelId:this.currentSubscription.channelId}),this.emit("rendition levels",this.modules.renditions.getRenditionLevels()),this.emitLanguagesIfChanged()})).finally((()=>{b(this,Cs,void 0)})));break;case"subscription changed":try{(t=>{if("object"!=typeof t||null===t)throw new Error("not an object");if(!("video"in t))throw new Error("missing video in subscription");if(!("audio"in t))throw new Error("missing audio in subscription");if(!("channelId"in t))throw new Error("missing channelId")})(i.subscription)}catch(t){this.emitter.emit("error",new kt("Subscription failed validation",{source:t instanceof Error?t:void 0,isFatal:!1,code:"subscription_failed_validation"}))}this.emitter.emit("subscription changed",{reset:i.reset,to:i.subscription,from:this.modules.subscription.getCurrentSubscription()}),i.reset&&n.channelId!==i.subscription.channelId&&(this.emit("error",_t(i.subscription.channelId)),this.emit("channel switch failed",{channelId:n.channelId})),this.modules.sync.timeshiftOnAudio=!(null!=(e=i.subscription.video)&&e.codec),this.modules.adaptivity.reset();break;case"timing info":this.modules.sync.updateChannelSyncInfo(i.timingInfo.channelId,i.timingInfo),this.emit("server wallclock time",i.timingInfo.wallclockTime)}})),this.emitter.on("channel switch timeout",(t=>{this.emit("error",_t(t)),this.emit("channel switch failed",{channelId:this.currentSubscription.channelId})})),this.emitter.on("received data",(t=>{const e=this.modules.subscription.getCurrentSubscription(),i=(t=>{const e=new DataView(t,0),i=e.getUint8(0),n=e.getUint16(1),s=e.getUint8(3),r=e.getUint8(4),a=F(new Uint8Array(t),5,12),o=e.getUint32(13),l=(t=>!!(16&t))(s)?e.getInt16(17):void 0;return{version:i,renditionId:r,flags:s,timestamp:a,timescale:o,payload:t.slice(n),compositionTimeOffset:l}})(t);e?Q(p(m({},i),{channelId:e.channelId})):this.logger.warn("Received unwanted message",m({},i))})),this.emitter.on("received moq data",(t=>{var e,i,n;const s=t.payload.mediaType(),r=t.channelId,a=t.renditionId,o=this.modules.sync.processFragment(r,t.payload);if(this.modules.incomingData.add(s,t.payload.rawBytes().byteLength),o.fragment().emsgs.forEach((t=>{if(!t.presentationTime)return;const e=function(t){const e=new z(t),i=function(t){return{id:t.readBytes(3),majorVersion:t.readUint8(),minorVersion:t.readUint8(),flags:t.readUint8(),size:t.readUint32()}}(e);184549376&i.flags&&function(t){const e=t.readUint32();t.readBytes(e-4)}(e);const n=function(t){return{frameId:t.readBytes(4),size:t.readUint32(),flags:t.readUint16()}}(e);if("TXXX"===String.fromCharCode(...n.frameId))return{header:i,txx:Te(new z(e.readBytes(n.size)))}}(t.data);e&&this.modules.event.addEvent({id:t.id,timestamp:t.presentationTime/t.timescale*1e3-this.modules.sync.getTimeshiftOffset(),content:e.txx.value,type:"metadata"})})),this.modules.decoder){const t=null==(e=o.header().init().moov.traks[0])?void 0:e.mdia.minf.stbl.stsd,l=null==(i=null==t?void 0:t.avc1)?void 0:i.avcC.bytes,h=null!=(n=null==t?void 0:t.codec)?n:"h264";if(l){const t=l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength);if("text"===s)throw new Error("Subtitles are not supported");this.emitter.emit("init segment",{initSegment:{channelId:r,renditionId:a,data:t,timescale:1e3,type:s,codec:h},mimeType:s})}for(let t=0;t<o.samplesCount();t++){const e=o.sample(t);e&&this.emitter.emit("coded sample",p(m({},e),{renditionId:a,channelId:r,data:e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)}))}}else this.emitter.emit("fragment",{fragment:o,channelId:r})}));const X=this.options.get("container");X&&this.attach(X),this.logger.info("Created Vindral instance",{options:this.options});const Q=t=>E(this,null,(function*(){const e=t.channelId;f(this,Cs)&&(yield f(this,Cs));const i=this.modules.renditions.getRendition(t.renditionId,e);if(!(4&t.flags))if(8&t.flags){const e=(new TextDecoder).decode(t.payload),i=this.modules.sync.getTimeshiftOffset();if(0!==t.renditionId){const t=(0,s.t)(e);if(t&&void 0!==t.language){const e=(new di).parse(t.content||""),n=i/1e3,s=f(this,ks).find((e=>e.language===t.language)),r=n-f(this,Ss);if(b(this,Ss,n),s){if(s.cues)for(const t of s.cues)t.startTime-=r,t.endTime-=r;for(const t of e){const e=new VTTCue(t.startTime-n,t.endTime-n,t.text);s.addCue(e)}}}}else this.modules.event.addEvent({timestamp:t.timestamp/t.timescale*1e3-this.modules.sync.getTimeshiftOffset(),content:e,type:"metadata"})}else if(null!=i&&i.codec){const n=(0,s.d)(i.codec);if("text"===n)throw new Error("Subtitles are not supported");if(this.modules.incomingData.add(n,t.payload.byteLength),(t=>!!(2&t))(t.flags)){const s=p(m({type:n,data:t.payload,codec:i.codec},t),{channelId:e}),r=((t,e)=>{switch(t){case"h264":return Ze(e);case"av1":return(t=>{const e=Ke(t);if(e)return{width:e.maxFrameWidth,height:e.maxFrameHeight}})(e)}})(s.codec,s.payload);r&&this.sizes.set(s.renditionId,r);const a=ft({codec:i.codec,codecString:i.codecString});this.emitter.emit("init segment",{initSegment:s,mimeType:a}),this.emit("initialized media")}else{const e=((t,e,i)=>{if(gt(e))return m(p(m({},t),{type:"video",codec:e.codec,isSync:ei(t.flags),data:t.payload,duration:0,width:e.width,height:e.height}),i);if("webvtt"===e.codec)throw new Error("WebVTT is not supported");return p(m({},t),{type:"audio",channels:e.channels,sampleRate:e.sampleRate,codec:e.codec,language:e.language,isSync:ei(t.flags),data:t.payload,duration:0})})(t,i,this.sizes.get(t.renditionId));let s=this.sampleProcessingSesssions.get(n);if(s){const t=s(this.modules.sync.processSample(e),this.isSwitchingRenditionLevel&&"video"===e.type);let i=e;t.forEach((t=>{this.modules.event.extractEvent(t,i),this.emitter.emit("coded sample",t),i=t}))}else s=(t=>{let e=[t],i=0,n=0,s=!1;return(t,r=!1)=>{if(t.flags&&ei(t.flags)&&r&&(s=!s),!(r&&e.length<6&&s)&&e.length>0){s=!1;let r=t;for(let t=e.length-1;t>0;t--){const i=e[t];if(!i||!r)break;i.timestamp>=r.timestamp?e.splice(t,1):r=i}const a=e.map(((s,r)=>((t,e)=>{var s,r,a;t.flags&&ei(t.flags)&&(i=null!=(s=t.compositionTimeOffset)?s:0),t.timestamp+=i,t.compositionTimeOffset=(null!=(r=t.compositionTimeOffset)?r:0)-i;const o=t.timestamp/t.timescale,l=e.flags&&ei(e.flags)?null!=(a=e.compositionTimeOffset)?a:0:i,h=(e.timestamp+l)/e.timescale,c=Math.max(0,Math.round((h-o)*t.timescale));return c>0&&(n=c),p(m({},t),{duration:c>0?c:n})})(s,e[r+1]||t)));return e=[t],a}return e.push(t),[]}})(this.modules.sync.processSample(e)),this.sampleProcessingSesssions.set(n,s)}}}));this.options.get("maxVideoBitRate")!==Number.MAX_SAFE_INTEGER&&(this.maxVideoBitRate=this.options.get("maxVideoBitRate")),this.options.get("maxAudioBitRate")!==Number.MAX_SAFE_INTEGER&&(this.maxAudioBitRate=this.options.get("maxAudioBitRate")),$(this.options.get("maxSize"),bt())||(this.maxSize=this.options.get("maxSize")),this.options.get("burstEnabled")&&d.enableBurst(this.targetBufferTime)}set volume(t){this.playbackSource.volume=t}get volume(){return this.playbackSource.volume}set muted(t){if(t===this.muted)return;const e=this.playbackSource.muted;this.playbackSource.muted=t,!t&&e&&!this.playbackSource.isPaused&&this.playbackSource.play()}get muted(){return this.playbackSource.muted}get media(){return this.options.get("media")}get videoBitRate(){return this.modules.incomingData.averageBitRate("video")}get audioBitRate(){return this.modules.incomingData.averageBitRate("audio")}get connectionState(){return this.modules.connection.getState()}get playbackState(){return this.modules.playback.getState()}get bufferFullness(){return this.modules.playback.getBufferFullness()}get sizeBasedResolutionCapEnabled(){return this.modules.constraintCap.sizeBasedResolutionCapEnabled}set sizeBasedResolutionCapEnabled(t){this.modules.constraintCap.sizeBasedResolutionCapEnabled=t}get abrEnabled(){return this.modules.adaptivity.isEnabled}set abrEnabled(t){this.modules.constraintCap.sizeBasedResolutionCapEnabled=!!t&&this.options.get("sizeBasedResolutionCapEnabled"),this.modules.adaptivity.isEnabled=t,this.alignSizeAndBitRate(this.targetSubscription)}get serverEdgeTime(){return this.modules.sync.getLiveEdgeTimeLatencyAdjusted(this.currentSubscription.channelId)}get serverWallclockTime(){return this.modules.sync.getWallclockTimeLatencyAdjusted(this.currentSubscription.channelId)}get currentTime(){return this.modules.sync.serverCurrentTime}get channelCurrentTime(){return this.modules.sync.channelCurrentTime}get targetBufferTime(){return this.modules.playback.getTargetBufferTime()}set targetBufferTime(t){this.modules.playback.getTargetBufferTime()!==t&&(this.modules.playback.setTargetBufferTime(t),this.playbackSource.currentTime=this.modules.sync.serverCurrentTime,this.options.get("burstEnabled",this.channelId)?this.modules.subscription.enableBurst(this.targetBufferTime):this.modules.subscription.enableBurst(0))}get playbackLatency(){var t;if(0!==this.playbackSource.currentTime)return this.targetBufferTime+(null!=(t=this.modules.sync.drift)?t:0)+this.modules.connection.rtt/2}get playbackWallclockTime(){if(this.serverWallclockTime&&this.playbackLatency)return this.serverWallclockTime-this.playbackLatency}get channels(){return this._channels}get languages(){return this.modules.renditions.getLanguages()}get language(){return this.modules.subscription.getTargetSubscription().audio.language}set language(t){this.modules.subscription.setLanguage(t)}set textTrack(t){f(this,ks).forEach((e=>{e.label===t?e.mode="showing":e.mode="hidden"})),this.emitter.emit("text track",t)}get textTracks(){return f(this,ks).filter((t=>"disabled"!==t.mode)).map((t=>t.label))}get textTrack(){var t;return null==(t=f(this,ks).find((t=>"showing"===t.mode)))?void 0:t.label}get channelId(){var t,e;return null!=(e=null==(t=this.modules)?void 0:t.subscription.getTargetSubscription().channelId)?e:this.options.get("channelId")}set channelId(t){if(t===this.channelId)return;this.modules.subscription.setChannelId(t);const e="audio"===this.options.get("media")?[]:this.options.get("videoCodecs"),i=this.modules.renditions.getAudioRenditions(t),n=this.modules.renditions.getVideoRenditions(t),s=this.targetSubscription.audio.language,r=null==i?void 0:i.some((t=>t.language===s)),a=e.find((t=>void 0!==(null==n?void 0:n.find((e=>e.codec===t)))));a&&this.modules.subscription.setVideoCodec(a),this.logger.debug("Channel switch - started",{audioRenditions:i,targetSubscriptionLanguage:s,targetHasCurrentLanguage:r}),this.alignSizeAndBitRate(this.targetSubscription)}get maxSize(){var t,e;const{width:i,height:n}=null!=(e=null==(t=this.modules.constraintCap.getCurrentConstraintCap())?void 0:t.video)?e:bt();return{width:i,height:n}}set maxSize(t){this.modules.constraintCap.setUserSpecifiedCap({video:{width:t.width,height:t.height}}),this.alignSizeAndBitRate(this.targetSubscription)}get maxVideoBitRate(){var t,e;return null!=(e=null==(t=this.modules.constraintCap.getCurrentConstraintCap())?void 0:t.video.bitRate)?e:vt()}set maxVideoBitRate(t){this.modules.constraintCap.setUserSpecifiedCap({video:{bitRate:t}}),this.alignSizeAndBitRate(this.targetSubscription)}get maxAudioBitRate(){var t,e;return null!=(e=null==(t=this.modules.constraintCap.getCurrentConstraintCap())?void 0:t.audio.bitRate)?e:vt()}set maxAudioBitRate(t){this.modules.constraintCap.setUserSpecifiedCap({audio:{bitRate:t}}),this.alignSizeAndBitRate(this.targetSubscription)}get renditionLevels(){return this.modules.renditions.getRenditionLevels()}get currentRenditionLevel(){return this.modules.renditions.getRenditionLevel()}get targetRenditionLevel(){return this.modules.renditions.getRenditionLevel(this.modules.subscription.getTargetSubscription())}get isSwitchingRenditionLevel(){return this.modules.subscription.isSwitchingSubscription()}get videoBufferedRanges(){var t,e,i,n;return null!=(n=null!=(i=null==(t=this.modules.mseModule)?void 0:t.getBuffer("video"))?i:null==(e=this.modules.decoder)?void 0:e.getBuffer("video"))?n:[]}get audioBufferedRanges(){var t,e,i,n;return null!=(n=null!=(i=null==(t=this.modules.mseModule)?void 0:t.getBuffer("audio"))?i:null==(e=this.modules.decoder)?void 0:e.getBuffer("audio"))?n:[]}getApiClient(){return this.modules.connection.apiClient}get lastBufferEvent(){return this.modules.playback.getLastBufferStateEvent()}get activeRatios(){return this.modules.qualityOfService.activeRatios()}get bufferingRatios(){return this.modules.qualityOfService.bufferingRatios()}get timeSpentBuffering(){return this.modules.qualityOfService.timeSpentBuffering()}get timeActive(){return this.modules.qualityOfService.timeActive()}get mediaElement(){return this.element}get audioNode(){var t;return null!=(t=this.modules)&&t.canvasModule?this.modules.canvasModule.audioNode:void 0}get drmStatistics(){var t;return null==(t=this.encryptedMediaExtensions)?void 0:t.getStatistics()}get uptime(){return Date.now()-this.createdAt}suspend(){this.isSuspended||(Object.values(this.modules).forEach((t=>{t&&"suspend"in t&&t.suspend()})),this.isSuspended=!0)}unsuspend(){this.isSuspended&&(Object.values(this.modules).forEach((t=>{t&&"unsuspend"in t&&t.unsuspend()})),this.isSuspended=!1)}alignSizeAndBitRate(t){const e=this.modules.constraintCap.constrainSubscription(p(m({},t),{video:m({},t.video),audio:m({},t.audio)})),i=this.modules.constraintCap.getUserSpecifiedCap();!this.abrEnabled&&i&&(e.audio.bitRate=i.audio.bitRate,e.video.bitRate=i.video.bitRate,e.video.width=i.video.width,e.video.height=i.video.height);const n=this.modules.renditions.getRenditionLevel(e);if(n)if(n.video&&(this.modules.subscription.setVideoBitRate(n.video.bitRate),this.modules.subscription.setSize(n.video)),n.audio)this.modules.subscription.setAudioBitRate(n.audio.bitRate),this.modules.subscription.setLanguage(n.audio.language);else if(e.audio.language){let t=this.modules.renditions.getAudioRenditions(e.channelId);!this.abrEnabled&&i&&(t=null==t?void 0:t.filter((t=>t.bitRate<i.audio.bitRate)));const n=e.audio.language,s=null==t?void 0:t.some((t=>t.language===n)),r=null==t?void 0:t.find((t=>t.language)),a=(null==t?void 0:t.length)&&t[0]||void 0;s||(r?(this.logger.debug("Randomizing language since target did not have current language"),this.modules.subscription.setAudioBitRate(r.bitRate),this.modules.subscription.setLanguage(r.language)):(this.logger.debug("Randomizing audio rendition since target did not have current language"),null!=a&&a.bitRate&&this.modules.subscription.setAudioBitRate(a.bitRate),this.modules.subscription.setLanguage(null==a?void 0:a.language)))}}get currentSubscription(){return this.modules.subscription.getCurrentSubscription()}get targetSubscription(){return this.modules.subscription.getTargetSubscription()}willUseMediaSource(){return this.browser.supportsMediaSource&&this.options.get("mseEnabled")}};Ss=new WeakMap,ks=new WeakMap,Cs=new WeakMap,g(Ts,"MAX_POOL_SIZE",10),g(Ts,"INITIAL_MAX_BIT_RATE",25e5),g(Ts,"DISCONNECT_TIMEOUT",15e3),g(Ts,"REMOVE_CUE_THRESHOLD",1e4);let xs=Ts}},n={};function s(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={exports:{}};return i[t](r,r.exports,s),r.exports}s.m=i,s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.f={},s.e=t=>Promise.all(Object.keys(s.f).reduce(((e,i)=>(s.f[i](t,e),e)),[])),s.u=t=>t+"."+{487:"4fb5fea640ec45082140",515:"77283be08bf0a32d2ba9",767:"960208d03b9fbf7a14a5"}[t]+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="vindral-examples:",s.l=(i,n,r,a)=>{if(t[i])t[i].push(n);else{var o,l;if(void 0!==r)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var d=h[c];if(d.getAttribute("src")==i||d.getAttribute("data-webpack")==e+r){o=d;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.setAttribute("data-webpack",e+r),o.src=i),t[i]=[n];var u=(e,n)=>{o.onerror=o.onload=null,clearTimeout(m);var s=t[i];if(delete t[i],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((t=>t(n))),e)return e(n)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),(()=>{var t={268:0};s.f.j=(e,i)=>{var n=s.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise(((i,s)=>n=t[e]=[i,s]));i.push(n[2]=r);var a=s.p+s.u(e),o=new Error;s.l(a,(i=>{if(s.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",o.name="ChunkLoadError",o.type=r,o.request=a,n[1](o)}}),"chunk-"+e,e)}};var e=(e,i)=>{var n,r,[a,o,l]=i,h=0;if(a.some((e=>0!==t[e]))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);l&&l(s)}for(e&&e(i);h<a.length;h++)r=a[h],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0},i=self.webpackChunkvindral_examples=self.webpackChunkvindral_examples||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var r=s(4903),a=s(9633),o=Object.defineProperty,l=(t,e,i)=>((t,e,i)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),h=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{o(i.next(t))}catch(t){s(t)}},a=t=>{try{o(i.throw(t))}catch(t){s(t)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,a);o((i=i.apply(t,e)).next())}));class c extends a.E{constructor(t){super(),l(this,"state","not casting"),l(this,"config"),l(this,"unloaded",!1),l(this,"updateAuthenticationToken",(t=>{this.config&&(this.config.options.authenticationToken=t,this.send({type:"updateAuthToken",token:t}))})),l(this,"unload",(()=>{var t;this.unloaded=!0,null==(t=this.getSession())||t.removeMessageListener("urn:x-cast:com.vindral.castdata",this.onMessage)})),l(this,"init",(()=>h(this,null,(function*(){return new Promise(((t,e)=>{let i=!1;const n=setTimeout((()=>{i=!0,e()}),1e4);window.__onGCastApiAvailable=s=>{if(!i)return clearTimeout(n),s?void setTimeout((()=>{try{this.onGCastApiAvailable(),t()}catch(t){e()}}),1e3):e();i=!1},this.castLibrariesAdded()&&window.cast?window.__onGCastApiAvailable(!0):this.verifyCastLibraries()}))})))),l(this,"start",(()=>h(this,null,(function*(){var t;yield null==(t=this.getInstance())?void 0:t.requestSession()})))),l(this,"stop",(()=>{var t;null==(t=this.getSession())||t.endSession(!0)})),l(this,"getReceiverName",(()=>{var t,e;return(null==(e=null==(t=this.getSession())?void 0:t.getCastDevice())?void 0:e.friendlyName)||void 0})),l(this,"onGCastApiAvailable",(()=>{var t;const e=this.getInstance();if(!e)throw"cast context should exist";const i=e.getSessionState(),n=(null==(t=this.config)?void 0:t.receiverApplicationId)||"A5452297";e.setOptions({receiverApplicationId:n,autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED,resumeSavedSession:!0}),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.onSessionStateChanged),i===cast.framework.SessionState.SESSION_STARTED&&setTimeout((()=>{this.state="casting",this.emit("resumed")}))})),l(this,"send",(t=>{var e;null==(e=this.getSession())||e.sendMessage("urn:x-cast:com.vindral.castdata",t)})),l(this,"onMessage",((t,e)=>{if("urn:x-cast:com.vindral.castdata"===t)try{const t=JSON.parse(e);switch(t.type){case"metadata":this.emit("metadata",t.metadata);break;case"serverWallclockTime":this.emit("server wallclock time",t.serverWallclockTime)}}catch(t){}})),l(this,"onSessionStarted",(()=>{var t;null==(t=this.getSession())||t.addMessageListener("urn:x-cast:com.vindral.castdata",this.onMessage),this.send({type:"start",config:this.config})})),l(this,"onSessionStateChanged",(t=>{if(!this.unloaded)switch(t.sessionState){case cast.framework.SessionState.SESSION_START_FAILED:this.state="not casting",this.emit("failed");break;case cast.framework.SessionState.SESSION_ENDED:this.state="not casting",this.emit("disconnected");break;case cast.framework.SessionState.SESSION_ENDING:break;case cast.framework.SessionState.SESSION_RESUMED:this.onSessionStarted(),this.state="casting",this.emit("resumed");break;case cast.framework.SessionState.SESSION_STARTED:this.onSessionStarted(),this.state="casting",this.emit("connected");case cast.framework.SessionState.SESSION_STARTING:}})),l(this,"getInstance",(()=>{var t;return null==(t=window.cast)?void 0:t.framework.CastContext.getInstance()})),l(this,"getSession",(()=>{var t;return null==(t=this.getInstance())?void 0:t.getCurrentSession()})),l(this,"castLibrariesAdded",(()=>!(!document.querySelector("#vindralCastFrameworkLib")||!document.querySelector("#vindralCastSenderLib")))),l(this,"verifyCastLibraries",(()=>{if(this.castLibrariesAdded())return;const t=document.createElement("script");t.type="text/javascript",t.id="vindralCastFrameworkLib",t.src="//www.gstatic.com/cast/sdk/libs/sender/1.0/cast_framework.js",document.head.appendChild(t);const e=document.createElement("script");e.type="text/javascript",e.id="vindralCastSenderLib",e.src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js",document.head.appendChild(e)})),this.config=t}get casting(){return"casting"===this.state}get volume(){var t,e;return null!=(e=null==(t=this.getSession())?void 0:t.getVolume())?e:0}set volume(t){var e;null==(e=this.getSession())||e.setVolume(t)}get language(){var t,e;return null==(e=null==(t=this.config)?void 0:t.options)?void 0:e.language}set language(t){this.config&&(this.config.options.language=t,this.send({type:"setLanguage",language:t}))}get channelId(){var t;return(null==(t=this.config)?void 0:t.options.channelId)||""}set channelId(t){this.config&&(this.config.options.channelId=t,this.send({type:"setChannelId",channelId:t}))}}var d=s(119),u=Object.defineProperty,m=Object.getPrototypeOf,p=Reflect.get,g=t=>{throw TypeError(t)},A=(t,e,i)=>((t,e,i)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),f=(t,e,i)=>e.has(t)||g("Cannot "+i),v=(t,e,i)=>(f(t,e,"read from private field"),i?i.call(t):e.get(t)),b=(t,e,i)=>e.has(t)?g("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),w=(t,e,i,n)=>(f(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),y=(t,e,i)=>(f(t,e,"access private method"),i),E=(t,e,i)=>p(m(t),i,e),S=(t,e,i)=>new Promise(((n,s)=>{var r=t=>{try{o(i.next(t))}catch(t){s(t)}},a=t=>{try{o(i.throw(t))}catch(t){s(t)}},o=t=>t.done?n(t.value):Promise.resolve(t.value).then(r,a);o((i=i.apply(t,e)).next())}));const k=1e6,C=1e3*k,T=(t,e,i)=>t%e==0?t/e:(t/e).toFixed(i),x={PAUSED:"paused",MUTED:"muted",USER_INTERACTING:"user-interacting",IS_CASTING:"is-casting",CAST_AVAILABLE:"cast-available",CAST_RECEIVER_NAME:"cast-receiver-name",BUFFERING:"buffering",UI_LOCKED:"ui-locked",HIDE_UI_ON_PAUSE:"hide-ui-on-pause",FULLSCREEN:"is-fullscreen",FULLSCREEN_FALLBACK:"is-fullscreen-fallback",RENDITION_LEVELS:"rendition-levels",RENDITION_LEVEL:"rendition-level",MAX_VIDEO_BITRATE:"max-video-bit-rate",CHANNELS:"channels",CHANNEL_ID:"channel-id",CHANNEL_GROUP_ID:"channel-group-id",PIP_AVAILABLE:"pip-available",IS_PIP:"is-pip",AIRPLAY_AVAILABLE:"airplay-available",IS_AIRPLAYING:"is-airplaying",MEDIA:"media",LANGUAGES:"languages",LANGUAGE:"language",TEXT_TRACKS:"text-tracks",TEXT_TRACK:"text-track",NEEDS_USER_INPUT:"needs-user-input",AUTHENTICATION_TOKEN:"authentication-token",VOLUME:"volume",VOLUME_LEVEL:"volume-level",CAST_ENABLED:"cast",AIRPLAY_ENABLED:"airplay",PIP_ENABLED:"pip",FULLSCREEN_ENABLED:"fullscreen",VU_METER_ENABLED:"vu-meter",POSTER_SRC:"poster-src"},I=Object.values(x),R={PLAY:"play",PAUSE:"pause",MUTE:"mute",UNMUTE:"unmute",LOCK_UI:"lock-ui",UNLOCK_UI:"unlock-ui",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_FULLSCREEN:"exit-fullscreen",SET_RENDITION:"set-rendition",CHANNEL_GRID_OPENED:"channel-grid-opened",CHANNEL_GRID_CLOSED:"channel-grid-closed",ENTER_PIP:"enter-pip",EXIT_PIP:"exit-pip",REQUEST_AIRPLAY:"request-airplay",SET_LANGUAGE:"set-language",SET_TEXT_TRACK:"set-text-track",REQUEST_USER_INPUT:"request-user-input",SET_VOLUME:"set-volume"};function L(t){return"audio"===t||"video"===t||"audio+video"===t?t:"audio+video"}function M(t){return"trace"===t||"debug"===t||"info"===t||"warn"===t||"error"===t||"off"===t?t:"off"}function P(t){if(null!==t)return""===t||t}function B(t){if(null===t)return;const e=parseInt(t,10);return isNaN(e)?void 0:e}function U(t){return"string"==typeof t}function _(t,e){if(null===t)return null!=e?e:void 0;const i=t.toLowerCase();return"false"!==i&&("true"===i||""===i||null==e||e)}function N(t){if(null===t)return;const e={},i=t.split(",");for(const t of i){const[i,n]=t.split(":");i&&n&&(e[i.trim()]=n.trim())}return Object.keys(e).length>0?e:void 0}const D=document.createElement("template");var O,F,W,G;D.innerHTML="\n  <style>\n    :host {\n      cursor: pointer;\n      color: var(--fg-strong);\n      padding: var(--button-padding);\n      background: transparent;\n      transition: background 0.2s linear;\n      -webkit-tap-highlight-color: transparent;\n    }\n\n    :host(:focus-visible) {\n      box-shadow: inset 0 0 0 2px var(--fg-strong);\n      outline: 0;\n    }\n\n    :host(:where(:focus)) {\n      box-shadow: none;\n      outline: 0;\n    }\n\n    @media (hover: hover) and (pointer: fine) {\n      :host(:hover) {\n        background: rgba(255, 255, 255, 0.15);\n      }\n    }\n\n    :host(:active) {\n      background: rgba(255, 255, 255, 0.25);\n    }\n\n    :host(:active) svg {\n      scale: 0.9;\n    }\n\n    :host([disabled]) {\n      opacity: 0.5;\n      background: transparent;\n    }\n  </style>\n";class H extends HTMLElement{constructor(){super(),b(this,O,null),b(this,F,(t=>{this.handleClick(t)})),b(this,W,(t=>{const{key:e}=t;this.keysUsed.includes(e)?this.handleClick(t):this.removeEventListener("keyup",v(this,W))})),b(this,G,(t=>{const{metaKey:e,altKey:i,key:n}=t;e||i||!this.keysUsed.includes(n)?this.removeEventListener("keyup",v(this,W)):this.addEventListener("keyup",v(this,W),{once:!0})})),this.attachShadow({mode:"open"}).appendChild(D.content.cloneNode(!0))}get keysUsed(){return["Enter"," "]}connectedCallback(){var t;w(this,O,this.closest("vindral-controller")),null==(t=v(this,O))||t.connectListener(this),this.hasAttribute("disabled")||this.enable(),this.setAttribute("role","button")}enable(){this.addEventListener("click",v(this,F)),this.addEventListener("keydown",v(this,G)),this.tabIndex=0}disable(){this.removeEventListener("click",v(this,F)),this.removeEventListener("keydown",v(this,G)),this.removeEventListener("keyup",v(this,W)),this.tabIndex=-1}disconnectedCallback(){var t;null==(t=v(this,O))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){"disabled"===t&&(U(i)?this.disable():this.enable())}}O=new WeakMap,F=new WeakMap,W=new WeakMap,G=new WeakMap,A(H,"observedAttributes",["disabled"]);const z=document.createElement("template"),V='\n    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round" ><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 18a3 3 0 0 0 3 -3v-8a3 3 0 0 0 -3 -3h-12a3 3 0 0 0 -3 3v8a3 3 0 0 0 3 3" /><path d="M9 20h6l-3 -5z" /></svg>\n';var X,Q;z.innerHTML=`\n  <style>\n    :host {\n      display: var(--airplay-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host(:not([${x.AIRPLAY_AVAILABLE}])) {\n      display: none !important;\n    }\n\n    :host([${x.IS_AIRPLAYING}]) slot[name="exit"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.IS_AIRPLAYING}])) slot[name="enter"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="enter">${V}</slot>\n    <slot name="exit">${V}</slot>\n  </slot>\n`;const j=class extends H{constructor(){var t;super(),b(this,X),null==(t=this.shadowRoot)||t.appendChild(z.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),y(this,X,Q).call(this)}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.IS_AIRPLAYING&&y(this,X,Q).call(this)}set isAirPlaying(t){t?this.setAttribute(x.IS_AIRPLAYING,""):this.removeAttribute(x.IS_AIRPLAYING)}get isAirPlaying(){return this.hasAttribute(x.IS_AIRPLAYING)}handleClick(t){this.dispatchEvent(new CustomEvent(R.REQUEST_AIRPLAY,{bubbles:!0,composed:!0}))}};X=new WeakSet,Q=function(){this.setAttribute("aria-label",this.isAirPlaying?"Exit airplay":"Enter airplay")},A(j,"observedAttributes",[...E(j,j,"observedAttributes"),x.AIRPLAY_AVAILABLE,x.IS_AIRPLAYING]);let q=j;const $=document.createElement("template");var Z;$.innerHTML=`\n  <style>\n    :host {\n      color: var(--fg-strong);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host(:not([${x.BUFFERING}])) {\n      visibility: hidden !important;\n    }\n  </style>\n\n  <slot name="icon">\n<svg width="24" height="24" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <style>\n    .spinner-container {\n      transform-origin: center;\n      animation: rotate 2s linear infinite;\n    }\n    .spinner-circle {\n      stroke-linecap: round;\n      animation: dash 1.5s ease-in-out infinite;\n    }\n    @keyframes rotate {\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n    @keyframes dash {\n      0% {\n        stroke-dasharray: 0 150;\n        stroke-dashoffset: 0;\n      }\n      47.5% {\n        stroke-dasharray: 42 150;\n        stroke-dashoffset: -16;\n      }\n      95%, 100% {\n        stroke-dasharray: 42 150;\n        stroke-dashoffset: -59;\n      }\n    }\n  </style>\n  <g class="spinner-container">\n    <circle class="spinner-circle" cx="12" cy="12" r="9.5" fill="none" stroke-width="3"></circle>\n  </g>\n</svg>\n</slot>\n`;class K extends HTMLElement{constructor(){super(),b(this,Z,null),this.attachShadow({mode:"open"}).appendChild($.content.cloneNode(!0))}connectedCallback(){var t;w(this,Z,this.closest("vindral-controller")),null==(t=v(this,Z))||t.connectListener(this)}disconnectedCallback(){var t;null==(t=v(this,Z))||t.disconnectListener(this)}}Z=new WeakMap,A(K,"observedAttributes",[x.BUFFERING]);const J=document.createElement("template");var Y;J.innerHTML=`\n  <style>\n    :host {\n      display: var(--buffering-overlay-display);\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background-color: rgba(0, 0, 0, 0.3);\n      transition: opacity 250ms;\n      transition-delay: 1s;\n      opacity: 1;\n      pointer-events: none;\n      z-index: 1;\n    }\n\n    #buffering-indicator {\n      width: 40px;\n      height: 40px;\n      border-radius: 40px;\n      background-color: var(--fg-strong);\n      animation: scaleout 1s infinite ease-in-out;\n    }\n\n    @-webkit-keyframes scaleout {\n      0% {\n        -webkit-transform: scale(0);\n      }\n      100% {\n        -webkit-transform: scale(1);\n        opacity: 0;\n      }\n    }\n\n    @keyframes scaleout {\n      0% {\n        -webkit-transform: scale(0);\n        transform: scale(0);\n      }\n      100% {\n        -webkit-transform: scale(1);\n        transform: scale(1);\n        opacity: 0;\n      }\n    }\n\n    :host(:not([${x.BUFFERING}])) {\n      transition-delay: 0s;\n      opacity: 0 !important;\n    }\n  </style>\n\n  <div id="buffering-indicator"></div>\n`;class tt extends HTMLElement{constructor(){super(),b(this,Y,null),this.attachShadow({mode:"open"}).appendChild(J.content.cloneNode(!0))}connectedCallback(){var t;w(this,Y,this.closest("vindral-controller")),null==(t=v(this,Y))||t.connectListener(this)}disconnectedCallback(){var t;null==(t=v(this,Y))||t.disconnectListener(this)}}Y=new WeakMap,A(tt,"observedAttributes",[x.BUFFERING]);const et=document.createElement("template");var it,nt,st;et.innerHTML=`\n  <style>\n    :host {\n      display: var(--cast-button-display);\n    }\n\n    google-cast-launcher {\n      display: block;\n      width: 24px;\n      height: 24px;\n      cursor: pointer;\n      --connected-color: var(--fg-strong);\n      --disconnected-color: var(--fg-strong);\n    }\n\n    :host(:active) google-cast-launcher {\n      transform: scale(0.9);\n    }\n\n    :host(:not([${x.CAST_AVAILABLE}])) {\n      display: none !important;\n    }\n  </style>\n`;const rt=class extends H{constructor(){var t;super(),b(this,it),null==(t=this.shadowRoot)||t.appendChild(et.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),y(this,it,nt).call(this)}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.CAST_AVAILABLE&&y(this,it,st).call(this),t===x.IS_CASTING&&y(this,it,nt).call(this)}set isCasting(t){t?this.setAttribute(x.IS_CASTING,""):this.removeAttribute(x.IS_CASTING)}get isCasting(){return this.hasAttribute(x.IS_CASTING)}handleClick(t){}};it=new WeakSet,nt=function(){this.setAttribute("aria-label",this.isCasting?"Exit cast":"Enter cast")},st=function(){var t,e;if(null==(t=this.shadowRoot)||!t.querySelector("google-cast-launcher")){const t=document.createElement("google-cast-launcher");null==(e=this.shadowRoot)||e.appendChild(t)}},A(rt,"observedAttributes",[...E(rt,rt,"observedAttributes"),x.CAST_AVAILABLE,x.IS_CASTING]);let at=rt;const ot=document.createElement("template");var lt,ht;ot.innerHTML=`\n  <style>\n    :host {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      font-size: 20px;\n      text-align: center;\n      padding: 5% 0;\n      box-shadow: 0px 0px 20px black;\n      background: rgba(0, 0, 0, 0.5);\n      color: white;\n      pointer-events: none;\n      z-index: 1;\n      transition: opacity 0.3s ease-in-out;\n    }\n\n    @media only screen and (max-width: 600px) {\n      :host {\n        font-size: 14px;\n      }\n    }\n\n    :host(:not([${x.IS_CASTING}])) {\n      display: none;\n    }\n\n    #text {\n      margin: 0;\n      padding: 0;\n    }\n  </style>\n  <span id="text"></span>\n`;class ct extends HTMLElement{constructor(){super(),b(this,lt,null),b(this,ht,null),this.attachShadow({mode:"open"}).appendChild(ot.content.cloneNode(!0))}connectedCallback(){var t,e;w(this,lt,this.closest("vindral-controller")),null==(t=v(this,lt))||t.connectListener(this),w(this,ht,null==(e=this.shadowRoot)?void 0:e.querySelector("#text"))}disconnectedCallback(){var t;null==(t=v(this,lt))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){e===i||!v(this,ht)||"cast-receiver-name"===t&&"string"==typeof i&&(v(this,ht).innerText=`Casting to ${i||"device"}`)}}function dt(t=document){const e=null==t?void 0:t.activeElement;if(!e)return null;if(e.shadowRoot){const t=dt(e.shadowRoot);return null!=t?t:e}return e}lt=new WeakMap,ht=new WeakMap,A(ct,"observedAttributes",[x.IS_CASTING,x.CAST_RECEIVER_NAME]);const ut=document.createElement("template");var mt;ut.innerHTML='\n  <style>\n    :host {\n      position: relative;\n      aspect-ratio: 16 / 9;\n      object-fit: cover;\n      cursor: pointer;\n      border-radius: 6px;\n      box-sizing: border-box;\n      margin: 2px;\n\n      background-size: cover;\n      background-position: center;\n\n      transition-property: background-image;\n      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n      transition-duration: 200ms;\n\n      background-color: rgba(0, 0, 0, 0.5);\n      background-blend-mode: multiply;\n    }\n\n    :host([aria-selected="true"]) {\n      outline: 2px solid var(--fg-strong);\n      background-color: rgba(0, 0, 0, 0);\n    }\n\n    :host([offline]) {\n      display: var(--grid-item-offline-display);\n      background-image: repeating-linear-gradient(-45deg, #3d3d3d 0, #3d3d3d 4px, #1c2024 4px, #1c2024 8px) !important;\n      pointer-events: none;\n    }\n\n    :host::before {\n      content: "";\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(255, 255, 255, 0);\n      transition: background 0.2s ease;\n    }\n\n    :host(:hover)::before {\n      background: rgba(255, 255, 255, 0.1);\n    }\n\n    .channel-title {\n      position: absolute;\n      bottom: var(--padding-2);\n      left: var(--padding-2);\n      padding: var(--padding-1) var(--padding-2);\n      color: white;\n      font-size: 15px;\n      font-weight: 500;\n      text-overflow: ellipsis;\n      border-radius: 4px;\n\n      @container (max-width: 480px) {\n        font-size: 13px;\n      }\n    }\n  </style>\n  <slot></slot>\n';class pt extends HTMLElement{constructor(){super(),b(this,mt),A(this,"lastThumbnailUpdate");const t=this.attachShadow({mode:"open"});w(this,mt,document.createElement("span")),v(this,mt).className="channel-title",t.appendChild(v(this,mt)),t.appendChild(ut.content.cloneNode(!0))}attributeChangedCallback(t,e,i){if(e!==i)switch(t){case"url":this.updateThumbnail();break;case"title":v(this,mt).textContent=i}}updateThumbnail(){const t=this.getAttribute("url"),e=this.hasAttribute("offline"),i=this.hasAttribute("visible");if(e||!t||!i||this.lastThumbnailUpdate&&Date.now()-this.lastThumbnailUpdate<1e4)return;const n=new URL(t),s=new Image,r=this.getAttribute("authentication-token");r&&n.searchParams.set("auth.token",r),n.searchParams.set("t",Date.now().toString()),s.src=n.toString(),s.onload=()=>this.style.backgroundImage=`url(${n.toString()})`}}mt=new WeakMap,A(pt,"observedAttributes",["url","title","offline","authentication-token","visible"]);const gt=document.createElement("template");var At,ft,vt,bt,wt,yt,Et,St,kt,Ct,Tt,xt,It,Rt,Lt,Mt,Pt,Bt,Ut,_t,Nt,Dt;gt.innerHTML='\n  <style>\n    :host {\n      cursor: default;\n      display: flex;\n      flex-direction: column;\n      box-sizing: border-box;\n      border-radius: 4px;\n      background-color: var(--bg-subtle);\n      padding: var(--padding-2);\n\n      position: absolute;\n      bottom: 0;\n      right: 0;\n\n      z-index: 5;\n      width: 100%;\n      max-height: 75%;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    .wrapper {\n      overflow: auto;\n      -ms-overflow-style: none;\n      scrollbar-width: none;\n      height: 100%;\n    }\n\n    .wrapper::-webkit-scrollbar {\n      display: none;\n    }\n\n    slot#grid {\n      display: grid;\n      gap: var(--padding-2);\n      grid-template-columns: repeat(4, minmax(0, 1fr));\n\n      @container (width < 768px) {\n        grid-template-columns: repeat(2, minmax(0, 1fr));\n      }\n      @container (width < 1024px) and (width >= 768px) {\n        grid-template-columns: repeat(3, minmax(0, 1fr));\n      }\n      @container (width >= 1024px) {\n        grid-template-columns: repeat(4, minmax(0, 1fr));\n      }\n    }\n\n    /* Smart TV */\n    @media (width < 1024px) and (width >= 768px) and (-webkit-min-device-pixel-ratio: 2) {\n      slot#grid {\n        grid-template-columns: repeat(4, minmax(0, 1fr)) !important;\n      }\n    }\n\n    :host([mode="list"]) slot#grid {\n      grid-template-columns: repeat(1, minmax(0, 1fr));\n    }\n  </style>\n\n  <div class="wrapper">\n    <slot name="grid" id="grid"></slot>\n  </div>\n';class Ot extends HTMLElement{constructor(){super(),b(this,Ct),b(this,At,null),b(this,ft,null),b(this,vt,[]),b(this,bt,[]),b(this,wt),b(this,yt),b(this,Et),b(this,St),b(this,kt),A(this,"handleEvent",(t=>{"keydown"===t.type&&y(this,Ct,_t).call(this,t)})),this.attachShadow({mode:"open"}).appendChild(gt.content.cloneNode(!0))}connectedCallback(){var t,e,i;w(this,ft,this.closest("vindral-controller")),null==(t=v(this,ft))||t.connectListener(this),y(this,Ct,Tt).call(this),null==(i=v(this,At))||i.observe(null==(e=this.shadowRoot)?void 0:e.querySelector(".wrapper")),y(this,Ct,Rt).call(this),w(this,Et,window.setInterval((()=>{y(this,Ct,Bt).call(this)}),1e4))}disconnectedCallback(){var t;clearInterval(v(this,Et)),this.removeEventListener("keydown",this),null==(t=v(this,At))||t.disconnect()}attributeChangedCallback(t,e,i){if(e!==i)switch(t){case x.CHANNEL_ID:y(this,Ct,Pt).call(this,i);break;case x.CHANNELS:w(this,vt,JSON.parse(i)),y(this,Ct,Rt).call(this);break;case"authentication-token":w(this,yt,i)}}get keysUsed(){return["Enter","Escape","Tab"," ","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Home","End"]}focus(){var t;w(this,St,dt()),null==(t=v(this,wt))||t.focus()}}At=new WeakMap,ft=new WeakMap,vt=new WeakMap,bt=new WeakMap,wt=new WeakMap,yt=new WeakMap,Et=new WeakMap,St=new WeakMap,kt=new WeakMap,Ct=new WeakSet,Tt=function(){w(this,At,new IntersectionObserver((t=>{t.forEach((t=>{const{target:e,isIntersecting:i}=t;e instanceof pt?y(this,Ct,It).call(this,e,i):y(this,Ct,xt).call(this,i)}))}),{root:v(this,ft)}))},xt=function(t){var e,i;if(t){this.dispatchEvent(new CustomEvent(R.CHANNEL_GRID_OPENED,{bubbles:!0,composed:!0}));const t=()=>{window.clearTimeout(v(this,kt)),w(this,kt,window.setTimeout((()=>{var e;this.focus(),null==(e=this.parentElement)||e.removeEventListener("scroll",t)}),100))};null==(e=this.parentElement)||e.addEventListener("scroll",t),this.addEventListener("keydown",this),v(this,wt)&&(v(this,wt).tabIndex=0)}else v(this,wt)&&(v(this,wt).tabIndex=-1),this.dispatchEvent(new CustomEvent(R.CHANNEL_GRID_CLOSED,{bubbles:!0,composed:!0})),null==(i=v(this,St))||i.focus(),this.removeEventListener("keydown",this)},It=function(t,e){e?(t.setAttribute("visible",""),(!t.lastThumbnailUpdate||Date.now()-t.lastThumbnailUpdate>=1e4)&&(t.updateThumbnail(),t.lastThumbnailUpdate=Date.now())):t.removeAttribute("visible")},Rt=function(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector("slot[name=grid]"),i=new Map(v(this,bt).map((t=>[t.id,t]))),n=this.getAttribute("channel-id");w(this,bt,v(this,vt).map((t=>{var s;const r=i.get(t.channelId);if(r)return y(this,Ct,Lt).call(this,r.element,t),r;const a=y(this,Ct,Mt).call(this,t,n);return null==(s=v(this,At))||s.observe(a.element),e.contains(a.element)||e.appendChild(a.element),a}))),i.forEach(((t,e)=>{var i;v(this,vt).some((t=>t.channelId===e))||(null==(i=v(this,At))||i.unobserve(t.element),t.element.remove())})),v(this,bt).sort(((t,e)=>t.element.hasAttribute("offline")&&!e.element.hasAttribute("offline")?1:-1)).forEach((t=>{e.contains(t.element)||e.appendChild(t.element)}))},Lt=function(t,e){e.isLive?t.removeAttribute("offline"):t.setAttribute("offline",""),t.setAttribute("url",e.thumbnailUrls[0]||""),t.setAttribute("title",e.name)},Mt=function(t,e){const i=document.createElement("vindral-channel-grid-item");return i.setAttribute("url",t.thumbnailUrls[0]||""),i.setAttribute("title",t.name),v(this,yt)&&i.setAttribute("authentication-token",v(this,yt)),t.isLive||i.setAttribute("offline",""),t.channelId===e&&(i.setAttribute("aria-selected","true"),w(this,wt,i)),i.tabIndex=-1,i.onclick=()=>y(this,Ct,Ut).call(this,t),{element:i,thumbnail:t.thumbnailUrls[0]||"",id:t.channelId}},Pt=function(t){v(this,bt).forEach((e=>{e.id===t?(e.element.setAttribute("aria-selected","true"),e.element.tabIndex=0,w(this,wt,e.element)):(e.element.tabIndex=-1,e.element.setAttribute("aria-selected","false"))}))},Bt=function(){this.hasAttribute("hidden")||v(this,bt).forEach((t=>t.element.updateThumbnail()))},Ut=function(t){var e;null==(e=v(this,ft))||e.setAttribute("channel-id",t.channelId)},_t=function(t){var e,i,n;const{key:s,ctrlKey:r,altKey:a,metaKey:o}=t;r||a||o||this.keysUsed.includes(s)&&(t.preventDefault(),t.stopPropagation(),"Tab"===s||"Escape"===s?(null==(e=this.parentElement)||e.removeAttribute("open"),null==(i=v(this,ft))||i.focus()):"Enter"===s||" "===s?null==(n=v(this,wt))||n.click():y(this,Ct,Nt).call(this,t))},Nt=function(t){var e;if(!v(this,wt))return;const{key:i}=t;let n=v(this,bt).findIndex((t=>t.element===v(this,wt)));const s=v(this,wt).getBoundingClientRect();switch(i){case"ArrowUp":if(n=y(this,Ct,Dt).call(this,s,-1,0),n<0)return void(null==(e=this.parentElement)||e.removeAttribute("open"));break;case"ArrowDown":n=y(this,Ct,Dt).call(this,s,1,0);break;case"ArrowLeft":n=y(this,Ct,Dt).call(this,s,0,-1);break;case"ArrowRight":n=y(this,Ct,Dt).call(this,s,0,1);break;case"Home":n=0;break;case"End":n=v(this,bt).length-1}if(n>=0&&n<v(this,bt).length){const t=v(this,bt)[n];if(!t)return;v(this,wt).setAttribute("aria-selected","false"),v(this,wt).tabIndex=-1,w(this,wt,t.element),v(this,wt).setAttribute("aria-selected","true"),v(this,wt).tabIndex=0,v(this,wt).focus()}},Dt=function(t,e,i){let n=-1,s=1/0;return v(this,bt).filter((t=>t.element.getBoundingClientRect().width>0)).forEach(((r,a)=>{const o=r.element.getBoundingClientRect(),l=0===e||e<0&&o.top<t.top||e>0&&o.top>t.top,h=0===i||i<0&&o.left<t.left||i>0&&o.left>t.left;if(l&&h){const e=Math.sqrt(Math.pow(o.top-t.top,2)+Math.pow(o.left-t.left,2));e<s&&(s=e,n=a)}})),n},A(Ot,"observedAttributes",[x.CHANNELS,x.CHANNEL_ID,x.AUTHENTICATION_TOKEN,"mode","hidden"]);const Ft=document.createElement("template");var Wt,Gt,Ht,zt,Vt,Xt,Qt,jt,qt,$t;Ft.innerHTML='\n  <style>\n    :host {\n      display: var(--grid-button-display);\n      cursor: pointer;\n      flex-shrink: 0.5;\n      color: var(--fg-strong);\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    slot > svg {\n      display: block;\n    }\n  </style>\n  <slot name="button">\n<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-layout-grid" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="currentColor" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M4 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n  <path d="M14 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n  <path d="M4 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n  <path d="M14 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z" />\n</svg>\n</slot>\n';const Zt=class extends H{constructor(){var t,e;super(),b(this,Vt),b(this,Wt),b(this,Gt),b(this,Ht),b(this,zt,(t=>{t.composedPath().includes(this)||y(this,Vt,jt).call(this)})),null==(t=this.shadowRoot)||t.appendChild(Ft.content.cloneNode(!0)),w(this,Wt,null==(e=this.shadowRoot)?void 0:e.querySelector("slot[name=button]"))}connectedCallback(){var t;super.connectedCallback(),this.setAttribute("aria-haspopup","listbox"),this.enable(),y(this,Vt,qt).call(this);const e=this.getRootNode();(e instanceof Document||e instanceof ShadowRoot)&&(w(this,Gt,e.querySelector("vindral-channel-grid")),"vindral-scroll-overlay"===(null==(t=v(this,Gt).parentElement)?void 0:t.localName)&&(v(this,Gt).hidden=!1,v(this,Gt).style.position="relative",w(this,Ht,v(this,Gt).parentElement))),y(this,Vt,$t).call(this)}disconnectedCallback(){}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),(t===x.CHANNEL_GROUP_ID||t===x.CHANNELS)&&y(this,Vt,qt).call(this)}enable(){super.enable(),document.addEventListener("click",v(this,zt))}handleClick(t){y(this,Vt,Xt).call(this)}get isOpen(){var t,e;return(null==(t=v(this,Ht))?void 0:t.hasAttribute("open"))||!(null!=(e=v(this,Gt))&&e.hidden)}};Wt=new WeakMap,Gt=new WeakMap,Ht=new WeakMap,zt=new WeakMap,Vt=new WeakSet,Xt=function(){var t;v(this,Ht)?v(this,Ht).hasAttribute("open")?y(this,Vt,jt).call(this):y(this,Vt,Qt).call(this):null!=(t=v(this,Gt))&&t.hidden?y(this,Vt,Qt).call(this):y(this,Vt,jt).call(this),y(this,Vt,$t).call(this)},Qt=function(){var t;if(v(this,Ht))v(this,Ht).setAttribute("open","");else{if(null==(t=v(this,Gt))||!t.hidden)return;v(this,Gt).hidden=!1,v(this,Gt).focus()}v(this,Wt).setAttribute("aria-expanded","true")},jt=function(){if(v(this,Ht))v(this,Ht).removeAttribute("open");else{if(!v(this,Gt)||v(this,Gt).hidden)return;v(this,Gt).hidden=!0}v(this,Wt).setAttribute("aria-expanded","false")},qt=function(){this.getAttribute(x.CHANNEL_GROUP_ID)?this.removeAttribute("hidden"):this.setAttribute("hidden",""),this.hasAttribute(x.CHANNELS)?this.removeAttribute("disabled"):this.setAttribute("disabled","")},$t=function(){this.setAttribute("aria-label",this.isOpen?"Exit grid":"Enter grid")},A(Zt,"observedAttributes",[...E(Zt,Zt,"observedAttributes"),x.CHANNEL_GROUP_ID,x.CHANNELS,"hidden"]);let Kt=Zt;const Jt=document.createElement("template");Jt.innerHTML='\n  <style>\n    :host {\n      display: flex;\n      width: 100%;\n      align-items: center;\n    }\n\n    slot {\n      display: flex;\n      flex-grow: 1;\n      align-items: center;\n    }\n\n    :host([content-center]) slot {\n      justify-content: center;\n    }\n\n    slot[name="right"] {\n      justify-content: flex-end;\n    }\n  </style>\n\n  <slot name="bar">\n    <slot></slot>\n    <slot name="right"></slot>\n  </slot>\n';class Yt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}).appendChild(Jt.content.cloneNode(!0))}connectedCallback(){}disconnectedCallback(){}}A(Yt,"observedAttributes",[]);class te extends a.E{constructor(t){super(),A(this,"config"),A(this,"hlsUrl"),A(this,"element"),A(this,"connectingTimeout"),A(this,"updateAuthenticationToken",(t=>{})),A(this,"unload",(()=>{this.element&&(this.element.removeEventListener("webkitplaybacktargetavailabilitychanged",this.onAirPlayAvailable),this.element.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.onAirPlayPlaybackChanged),this.element.remove())})),A(this,"onAirPlayAvailable",(t=>{"available"===t.availability&&this.element.src!==this.hlsUrl&&this.checkHlsUrl(this.hlsUrl).then((t=>{t&&(this.element.src=this.hlsUrl,this.emit("available"))}))})),A(this,"onAirPlayPlaybackChanged",(()=>{window.clearTimeout(this.connectingTimeout),this.element.webkitCurrentPlaybackTargetIsWireless?(this.emit("connected"),this.element.style.display="block",this.element.paused&&this.element.play()):(this.emit("disconnected"),this.element.pause(),this.element.src="",this.element.src=this.hlsUrl,this.element.style.display="none")})),this.hlsUrl=new URL(`/api/hls?channelId=${t.channelId}`,t.url).toString(),this.config=t,this.element=document.createElement("video"),this.element.style.position="absolute",this.element.style.top="0",this.element.style.bottom="0",this.element.style.left="0",this.element.style.right="0",this.element.style.width="100%",this.element.style.height="100%",this.element.style.zIndex="1001",this.element.style.display="none",this.element.id="vindral-airplay-element",this.element.playsInline=!0,this.element.controls=!0,this.element.preload="metadata",this.element.addEventListener("webkitplaybacktargetavailabilitychanged",this.onAirPlayAvailable),this.element.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.onAirPlayPlaybackChanged),this.config.container.appendChild(this.element)}get casting(){return this.element.webkitCurrentPlaybackTargetIsWireless}set channelId(t){}showPlaybackTargetPicker(){this.element.paused&&(this.element.play(),this.connectingTimeout=window.setTimeout((()=>{this.element.webkitCurrentPlaybackTargetIsWireless||(this.element.pause(),this.element.src="",this.element.src=this.hlsUrl)}),3e4)),this.element.webkitShowPlaybackTargetPicker()}static isAirPlaySupported(){return!!window.WebKitPlaybackTargetAvailabilityEvent}checkHlsUrl(t){return S(this,null,(function*(){try{return(yield fetch(t,{method:"HEAD"})).ok}catch(t){return!1}}))}}const ee=class t extends a.E{constructor(e){super(),A(this,"container"),A(this,"unload",(()=>{document.removeEventListener("webkitfullscreenchange",this.onChange),document.removeEventListener("mozfullscreenchange",this.onChange),document.removeEventListener("fullscreenchange",this.onChange),this.container.removeEventListener("webkitendfullscreen",this.onChange)})),A(this,"request",(()=>S(this,null,(function*(){try{yield this.requestFn()}catch(t){throw this.onChange(),t}})))),A(this,"exit",(()=>S(this,null,(function*(){try{yield this.exitFn()}catch(t){throw this.onChange(),t}})))),A(this,"onChange",(()=>this.emit("on fullscreen change",this.isFullscreen()))),A(this,"isFullscreen",(()=>!!(document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen))),A(this,"isSupported",(()=>t.isFullscreenApiSupported(this.container)||!this.isInIframe())),A(this,"isFullscreenApiSupported",(()=>t.isFullscreenApiSupported(this.container))),A(this,"isInIframe",(()=>window.location!==window.parent.location)),this.container=e,document.addEventListener("webkitfullscreenchange",this.onChange),document.addEventListener("mozfullscreenchange",this.onChange),document.addEventListener("fullscreenchange",this.onChange),this.container.addEventListener("webkitendfullscreen",this.onChange)}get requestFn(){return t.isFullscreenApiSupported(this.container)?(this.container.requestFullscreen||this.container.webkitRequestFullscreen||this.container.webkitEnterFullscreen||this.container.mozRequestFullScreen).bind(this.container):()=>new Promise((t=>{t()}))}get exitFn(){if(t.isFullscreenApiSupported(this.container)&&this.isFullscreen()){const t=document.exitFullscreen,e=document.webkitFullscreenElement&&document.webkitExitFullscreen,i=document.mozFullscreenElement&&document.mozCancelFullScreen,n=t||e||i;return n?n.bind(document):this.container.webkitExitFullscreen.bind(this.container)}return()=>new Promise((t=>{t()}))}};A(ee,"isFullscreenApiSupported",(t=>void 0!==(t.requestFullscreen||t.webkitRequestFullscreen||t.webkitEnterFullscreen||t.mozRequestFullScreen)));let ie=ee;var ne,se,re,ae,oe,le,he,ce,de;class ue extends a.E{constructor(t){super(),A(this,"unload",(()=>{this.element.removeEventListener("enterpictureinpicture",this.onChange),this.element.removeEventListener("leavepictureinpicture",this.onChange)})),A(this,"request",(()=>S(this,null,(function*(){try{return yield v(this,ne).call(this)}catch(t){throw this.onChange(),t}})))),A(this,"exit",(()=>S(this,null,(function*(){try{return yield v(this,se).call(this)}catch(t){throw this.onChange(),t}})))),A(this,"onChange",(()=>{this.emit("on picture in picture change",this.isPictureInPictureActive())})),A(this,"isPictureInPictureActive",(()=>v(this,he).call(this)||v(this,le).call(this))),A(this,"isSupported",(()=>v(this,de).call(this)||v(this,oe).call(this))),b(this,ne,(()=>v(this,oe).call(this)?v(this,re).call(this):v(this,de).call(this)?v(this,ce).call(this,"picture-in-picture"):Promise.resolve())),b(this,se,(()=>this.isPictureInPictureActive()?v(this,oe).call(this)?v(this,ae).call(this):v(this,de).call(this)?v(this,ce).call(this,"inline"):Promise.resolve():Promise.resolve())),b(this,re,(()=>S(this,null,(function*(){yield this.element.requestPictureInPicture()})))),b(this,ae,(()=>S(this,null,(function*(){yield document.exitPictureInPicture()})))),b(this,oe,(()=>!!this.element.requestPictureInPicture&&!!document.pictureInPictureEnabled)),b(this,le,(()=>!!document.pictureInPictureElement)),b(this,he,(()=>"picture-in-picture"===this.element.webkitPresentationMode)),b(this,ce,(t=>(this.element.webkitSetPresentationMode&&this.element.webkitSetPresentationMode(t),Promise.resolve()))),b(this,de,(()=>!!this.element.webkitSetPresentationMode)),this.element=t,this.element.addEventListener("enterpictureinpicture",this.onChange),this.element.addEventListener("leavepictureinpicture",this.onChange),this.element.setAttribute("autopictureinpicture","")}}ne=new WeakMap,se=new WeakMap,re=new WeakMap,ae=new WeakMap,oe=new WeakMap,le=new WeakMap,he=new WeakMap,ce=new WeakMap,de=new WeakMap;class me extends a.E{constructor(t){if(super(),A(this,"audioContext"),A(this,"audioNode"),A(this,"bufferLength"),A(this,"animationFrameId",null),A(this,"canUseFloatTimeDomainData"),A(this,"byteSampleBuffer",null),A(this,"floatSampleBuffer",null),A(this,"leftAnalyser"),A(this,"rightAnalyser"),A(this,"mediaElementSource",null),A(this,"update",(()=>{const t=this.getDecibel(this.leftAnalyser,this.floatSampleBuffer||this.byteSampleBuffer),e=this.getDecibel(this.rightAnalyser,this.floatSampleBuffer||this.byteSampleBuffer);this.emit("on decibel change",{left:t,right:e}),this.animationFrameId=requestAnimationFrame(this.update)})),this.source=t,t instanceof HTMLMediaElement){const e=new AudioContext;this.mediaElementSource=e.createMediaElementSource(t),this.audioNode=e.createChannelSplitter(2),this.mediaElementSource.connect(this.audioNode),this.audioContext=e,this.mediaElementSource.connect(this.audioContext.destination)}else this.audioNode=t,this.audioContext=this.audioNode.context;this.leftAnalyser=this.audioNode.context.createAnalyser(),this.rightAnalyser=this.audioNode.context.createAnalyser(),this.audioNode.connect(this.leftAnalyser,0),this.audioNode.connect(this.rightAnalyser,1),this.canUseFloatTimeDomainData="function"==typeof this.leftAnalyser.getFloatTimeDomainData,this.leftAnalyser.fftSize=1024,this.rightAnalyser.fftSize=1024,this.bufferLength=this.leftAnalyser.fftSize,this.canUseFloatTimeDomainData?this.floatSampleBuffer=new Float32Array(this.bufferLength):this.byteSampleBuffer=new Uint8Array(this.bufferLength)}getDecibel(t,e){let i=0;if(this.canUseFloatTimeDomainData){t.getFloatTimeDomainData(e);for(let t=0;t<e.length;t++){const n=e[t];if(n){const t=n**2;i=Math.max(t,i)}}}else{t.getByteTimeDomainData(e);for(let t=0;t<e.length;t++){const n=e[t];if(n){const t=(n/128-1)**2;i=Math.max(t,i)}}}return 10*Math.log10(i)}start(){null===this.animationFrameId&&(this.audioContext instanceof AudioContext&&"suspended"===this.audioContext.state?this.audioContext.resume().then((()=>{this.update()})):this.update())}stop(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}unload(){var t;this.stop(),null==(t=this.mediaElementSource)||t.disconnect(),this.leftAnalyser.disconnect(),this.rightAnalyser.disconnect(),this.audioNode.disconnect()}get isMediaElementSource(){return this.source instanceof HTMLMediaElement}}const pe=t=>{var e;let i="observedAttributes"in t.constructor?t.constructor.observedAttributes:void 0;return!i&&null!=(e=t.nodeName)&&e.includes("-")&&(globalThis.customElements.upgrade(t),i="observedAttributes"in t.constructor?t.constructor.observedAttributes:void 0),Array.isArray(i)?i.filter((t=>I.includes(t))):[]},ge=document.createElement("template");var Ae,fe,ve,be,we,ye,Ee,Se,ke;ge.innerHTML="\n  <style>\n    :host {\n      position: relative;\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n  </style>\n";class Ce extends H{constructor(){var t;super(),b(this,Ee),b(this,Ae),b(this,fe),b(this,ve),b(this,be,null),b(this,we,(t=>{t.composedPath().includes(this)||this.hide()})),b(this,ye,(()=>{this.hide()})),null==(t=this.shadowRoot)||t.appendChild(ge.content.cloneNode(!0))}connectedCallback(){var t,e,i,n;super.connectedCallback(),this.setAttribute("role","button"),this.setAttribute("aria-haspopup","listbox");const s=null!=(t=this.getAttribute("list-position"))?t:"top";null==(e=v(this,fe))||e.setAttribute("list-position",s);const r=this.getRootNode(),a=[...null!=(n=null==(i=this.shadowRoot)?void 0:i.querySelectorAll(":not(:defined)"))?n:[]].map((t=>customElements.whenDefined(t.localName)));Promise.all(a).then((()=>{var t;(r instanceof Document||r instanceof ShadowRoot)&&(w(this,be,r.querySelector("vindral-controller")),null==(t=v(this,be))||t.connectListener(this))}))}set button(t){w(this,Ae,t)}set listbox(t){w(this,fe,t)}set listboxSlot(t){w(this,ve,t)}enable(){super.enable(),this.addEventListener("change",v(this,ye)),document.addEventListener("click",v(this,we))}hide(){var t,e;!v(this,ve)||null!=(t=v(this,ve))&&t.hidden||(v(this,ve).hidden=!0,null==(e=v(this,Ae))||e.setAttribute("aria-expanded","false"),this.dispatchEvent(new CustomEvent(R.UNLOCK_UI,{bubbles:!0,composed:!0})),this.focus())}handleClick(t){v(this,ve)&&!t.composedPath().includes(v(this,ve))&&y(this,Ee,Se).call(this)}}Ae=new WeakMap,fe=new WeakMap,ve=new WeakMap,be=new WeakMap,we=new WeakMap,ye=new WeakMap,Ee=new WeakSet,Se=function(){var t;null!=(t=v(this,ve))&&t.hidden?y(this,Ee,ke).call(this):this.hide()},ke=function(){var t,e,i;null!=(t=v(this,ve))&&t.hidden&&(v(this,ve).hidden=!1,null==(e=v(this,Ae))||e.setAttribute("aria-expanded","true"),null==(i=v(this,fe))||i.focus(),this.dispatchEvent(new CustomEvent(R.LOCK_UI,{bubbles:!0,composed:!0})))};const Te=document.createElement("template");Te.innerHTML=`\n  <style>\n    :host {\n      --fg-strong: var(--vindral-fg-strong, #eeeeee);\n      --fg-subtle: var(--vindral-fg-subtle, #b4b4b4);\n      --fg-extra-subtle: var(--vindral-fg-extra-subtle, #7b7b7b);\n\n      --bg-strong: var(--vindral-bg-strong, #111111);\n      --bg-subtle: var(--vindral-bg-subtle, #191919);\n      --bg-extra-subtle: var(--vindral-bg-extra-subtle, #222222);\n\n      --bg-component: var(--vindral-bg-component, #222222);\n      --bg-component-hover: var(--vindral-bg-component-hover, #2a2a2a);\n      --bg-component-active: var(--vindral-bg-component-active, #313131);\n\n      --padding-1: var(--vindral-padding-1, 4px);\n      --padding-2: var(--vindral-padding-2, 8px);\n      --padding-3: var(--vindral-padding-3, 16px);\n      --padding-4: var(--vindral-padding-4, 24px);\n      --padding-5: var(--vindral-padding-5, 32px);\n      --padding-6: var(--vindral-padding-6, 40px);\n\n      --control-padding: var(--vindral-control-padding, var(--padding-1));\n\n      --button-padding: var(--vindral-button-padding, var(--padding-2));\n\n      --ui-font: var(\n        --vindral-ui-font,\n        -apple-system,\n        BlinkMacSystemFont,\n        "Segoe UI",\n        Roboto,\n        "Helvetica Neue",\n        Arial,\n        sans-serif\n      );\n      --ui-display: var(--vindral-ui-display, flex);\n\n      --play-button-display: var(--vindral-play-button-display, flex);\n      --mute-button-display: var(--vindral-mute-button-display, flex);\n      --airplay-button-display: var(--vindral-airplay-button-display, flex);\n      --pip-button-display: var(--vindral-pip-button-display, flex);\n      --fullscreen-button-display: var(--vindral-fullscreen-button-display, flex);\n      --cast-button-display: var(--vindral-cast-button-display, flex);\n      --grid-button-display: var(--vindral-grid-button-display, flex);\n      --grid-item-offline-display: var(--vindral-grid-item-offline-display, flex);\n      --volume-range-display: var(--vindral-volume-range-display, flex);\n      --volume-meter-display: var(--vindral-volume-meter-display, flex);\n      --rendition-menu-display: var(--vindral-rendition-menu-display, flex);\n      --language-menu-display: var(--vindral-language-menu-display, flex);\n      --play-overlay-display: var(--vindral-play-overlay-display, flex);\n      --buffering-overlay-display: var(--vindral-buffering-overlay-display, flex);\n      --poster-overlay-display: var(--vindral-poster-overlay-display, flex);\n\n      position: relative;\n      display: flex;\n      background-color: var(--bg-strong);\n      width: 100%;\n      container-type: inline-size;\n      overflow: hidden;\n      font-family: var(--ui-font);\n    }\n\n    #ui {\n      position: absolute;\n      display: flex;\n      justify-content: space-between;\n      flex-direction: column;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      transition: opacity 0.5s;\n      user-select: none;\n      pointer-events: auto;\n\n      // Ensure the #ui element is above the video element on Safari\n      z-index: 1;\n    }\n\n    #ui > * {\n      pointer-events: auto;\n      display: var(--ui-display);\n    }\n\n    #video {\n      cursor: none;\n      display: flex;\n      width: 100%;\n      z-index: 0;\n    }\n\n    #video > canvas {\n      object-fit: contain;\n    }\n\n    slot#middle {\n      align-items: center;\n      justify-content: center;\n      flex-grow: 1;\n    }\n\n    slot#top-bar {\n      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0));\n      padding: var(--control-padding);\n    }\n\n    slot#bottom-bar {\n      padding: var(--control-padding);\n      background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.8));\n    }\n\n    :host(:focus-visible) {\n      outline: none;\n    }\n\n    :host(\n        :not([${x.USER_INTERACTING}]\n        ):not([${x.PAUSED}]:not([${x.HIDE_UI_ON_PAUSE}])\n        ):not([${x.IS_CASTING}]\n        ):not([${x.MEDIA}="audio"])\n      )\n      #ui {\n      opacity: 0;\n      cursor: none;\n      pointer-events: none;\n    }\n\n    :host(\n      :not([${x.USER_INTERACTING}]\n      ):not([${x.PAUSED}]:not([${x.HIDE_UI_ON_PAUSE}])\n      ):not([${x.IS_CASTING}]\n      ):not([${x.MEDIA}="audio"])\n    )\n    #ui > * {\n      pointer-events: none;\n    }\n\n    :host([${x.FULLSCREEN}][${x.FULLSCREEN_FALLBACK}]) {\n      position: fixed !important;\n      inset: 0 !important;\n      margin: 0 !important;\n      box-sizing: border-box !important;\n      min-width: 0 !important;\n      max-width: none !important;\n      min-height: 0 !important;\n      max-height: none !important;\n      width: 100% !important;\n      height: 100% !important;\n      transform: none !important;\n      z-index: 1000 !important;\n      background: black;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n\n      /* intentionally not !important */\n      object-fit: contain;\n    }\n\n    :host([${x.MEDIA}="audio"]) {\n      min-height: 100px;\n      overflow: visible;\n    }\n  </style>\n\n  <div id="video"></div>\n\n  <slot id="overlay" name="overlay"></slot>\n\n  <div id="ui">\n    <slot id="top-bar" name="top-bar"></slot>\n    <slot id="middle" name="middle"></slot>\n    <slot id="bottom-bar"></slot>\n    <slot id="overlay-interactive" name="overlay-interactive"></slot>\n  </div>\n`;const xe=["ArrowDown","ArrowLeft","ArrowRight","Tab","Enter"," ","f","m"];var Ie,Re,Le,Me,Pe,Be,Ue,_e,Ne,De,Oe,Fe,We,Ge,He,ze,Ve,Xe,Qe,je,qe,$e,Ze,Ke,Je,Ye,ti,ei,ii,ni,si,ri,ai,oi,li,hi,ci,di,ui,mi,pi,gi,Ai,fi,vi,bi,wi,yi,Ei,Si,ki;const Ci=class t extends HTMLElement{constructor(){super(),b(this,je),b(this,Re,new Map),b(this,Le,2e3),b(this,Me,null),b(this,Pe,null),b(this,Be),b(this,Ue,v(t,Ie)),b(this,_e),b(this,Ne),b(this,De),b(this,Oe),b(this,Fe),b(this,We),b(this,Ge),b(this,He),b(this,ze),b(this,Ve),b(this,Xe),b(this,Qe,null),b(this,ii,0),A(this,"handleEvent",(t=>{switch(t.type){case"pointerdown":w(this,ii,t.timeStamp);break;case"pointermove":y(this,je,ni).call(this,t);break;case"pointerup":y(this,je,si).call(this,t);break;case"mouseleave":y(this,je,gi).call(this);break;case"dblclick":y(this,je,ri).call(this,t);break;case"mousemove":y(this,je,ai).call(this,t);break;case"keydown":v(this,hi).call(this,t);break;case"keyup":y(this,je,gi).call(this),v(this,li).call(this,t)}})),b(this,oi,(t=>{var e;if(v(this,Be)&&(v(this,Xe).debug("Vindral event",{type:t.type}),t instanceof CustomEvent))switch(t.type){case R.PLAY:this.removeAttribute(x.PAUSED);break;case R.PAUSE:this.setAttribute(x.PAUSED,"");break;case R.MUTE:this.setAttribute(x.MUTED,"");break;case R.UNMUTE:this.removeAttribute(x.MUTED);break;case R.LOCK_UI:this.setAttribute(x.UI_LOCKED,"");break;case R.UNLOCK_UI:this.removeAttribute(x.UI_LOCKED);break;case R.ENTER_FULLSCREEN:this.setAttribute(x.FULLSCREEN,"");break;case R.EXIT_FULLSCREEN:this.removeAttribute(x.FULLSCREEN);break;case R.SET_RENDITION:{const e=t.detail;e.audio&&(v(this,Be).maxAudioBitRate=e.audio.bitRate),e.video&&(v(this,Be).maxVideoBitRate=e.video.bitRate,v(this,Be).maxSize=e.video,this.setAttribute(x.MAX_VIDEO_BITRATE,String(e.video.bitRate)))}break;case R.CHANNEL_GRID_OPENED:null===v(this,Qe)&&y(this,je,ui).call(this);break;case R.CHANNEL_GRID_CLOSED:null!==v(this,Qe)&&(clearTimeout(v(this,Qe)),w(this,Qe,null));break;case R.ENTER_PIP:this.setAttribute(x.IS_PIP,"");break;case R.EXIT_PIP:this.removeAttribute(x.IS_PIP);break;case R.REQUEST_AIRPLAY:null==(e=v(this,We))||e.showPlaybackTargetPicker();break;case R.SET_LANGUAGE:U(t.detail)?this.setAttribute(x.LANGUAGE,t.detail):this.removeAttribute(x.LANGUAGE);break;case R.SET_TEXT_TRACK:U(t.detail)?this.setAttribute(x.TEXT_TRACK,t.detail):this.removeAttribute(x.TEXT_TRACK);break;case R.REQUEST_USER_INPUT:y(this,je,ki).call(this,x.NEEDS_USER_INPUT),v(this,Be).play();break;case R.SET_VOLUME:{const e=t.detail;v(this,Be).muted&&e>0?v(this,Be).muted=!1:0===e&&(v(this,Be).muted=!0),this.setAttribute(x.VOLUME,e.toString())}}})),b(this,li,(t=>{const{key:e}=t;xe.includes(e)?y(this,je,ci).call(this,t):this.removeEventListener("keyup",this)})),b(this,hi,(t=>{const{metaKey:e,altKey:i,key:n}=t;e||i||!xe.includes(n)||this.addEventListener("keyup",this,{once:!0})})),b(this,di,null),b(this,wi,(()=>{var t,e,i;if(!("orientation"in screen)||!screen.orientation.lock)return;const n=null==(t=v(this,Be))?void 0:t.currentRenditionLevel;null!=n&&n.video&&screen.orientation.lock((null==(e=null==n?void 0:n.video)?void 0:e.width)>(null==(i=null==n?void 0:n.video)?void 0:i.height)?"landscape-primary":"portrait-primary").catch((()=>{}))})),b(this,yi,(()=>{!("orientation"in screen)||!screen.orientation.unlock||screen.orientation.unlock()})),this.attachShadow({mode:"open"}).appendChild(Te.content.cloneNode(!0));const e=M(this.getAttribute("log-level"));w(this,Xe,r.L.get().createContext("VindralController")),v(this,Xe).setLevel(e)}connectedCallback(){return S(this,null,(function*(){_(this.getAttribute("auto-instance-enabled"),!0)&&(yield y(this,je,qe).call(this));for(const t of Object.values(R))this.addEventListener(t,v(this,oi));window.PointerEvent?(this.addEventListener("pointerdown",this),this.addEventListener("pointermove",this),this.addEventListener("pointerup",this)):this.addEventListener("mousemove",this),this.addEventListener("mouseleave",this),this.addEventListener("keydown",this),this.addEventListener("resize",this),this.addEventListener("dblclick",this),this.connectListener(this)}))}disconnectedCallback(){var t,e,i,n;null==(t=v(this,Be))||t.unload(),null==(e=v(this,Oe))||e.unload(),null==(i=v(this,Fe))||i.unload(),null==(n=v(this,Ge))||n.unload();for(const t of Object.values(R))this.removeEventListener(t,v(this,oi));this.disconnectListener(this)}attributeChangedCallback(t,e,i){var n,s,r,a,o,l,h,c,d,u,m;if(e!=i)switch(v(this,Xe).debug("Attribute changed",{name:t,oldValue:e,newValue:i}),t){case"channel-id":w(this,_e,i),v(this,Be)&&i&&(v(this,Be).channelId=i,v(this,Be).play(),y(this,je,Si).call(this,x.BUFFERING,""),y(this,je,Si).call(this,x.CHANNEL_ID,i),y(this,je,Si).call(this,x.POSTER_SRC,v(this,Be).getThumbnailUrl()));break;case"channel-group-id":w(this,Ne,i);break;case"url":i&&w(this,Ue,i);break;case"paused":U(i)?null==(n=v(this,Be))||n.pause():null==(s=v(this,Be))||s.play();break;case"target-buffer-time":if(v(this,Be)&&i){const t=parseInt(i,10);Number.isNaN(t)||(v(this,Be).targetBufferTime=t)}break;case"user-interacting":U(i)?y(this,je,Si).call(this,x.USER_INTERACTING,""):y(this,je,ki).call(this,x.USER_INTERACTING);break;case"muted":v(this,Be)&&(U(i)?(v(this,Be).muted=!0,y(this,je,Si).call(this,x.MUTED,""),null!=(r=v(this,Ge))&&r.isMediaElementSource&&(null==(a=v(this,Ge))||a.stop(),y(this,je,Si).call(this,x.VOLUME_LEVEL,JSON.stringify({left:null,right:null})))):(v(this,Be).muted=!1,y(this,je,ki).call(this,x.MUTED),0===v(this,Be).volume&&(v(this,Be).volume=.3),null==(o=v(this,Ge))||o.start()));break;case"ui-locked":U(i)?y(this,je,pi).call(this):y(this,je,gi).call(this);break;case"is-fullscreen":U(i)?y(this,je,vi).call(this):y(this,je,bi).call(this);break;case"max-video-bit-rate":w(this,De,i),U(i)?y(this,je,Si).call(this,x.MAX_VIDEO_BITRATE,i):y(this,je,ki).call(this,x.MAX_VIDEO_BITRATE);break;case"is-pip":U(i)?y(this,je,Ai).call(this):y(this,je,fi).call(this);break;case"is-airplaying":U(i)?(null!=(l=v(this,Be))&&l.mediaElement&&(v(this,Be).mediaElement.style.display="hidden"),null==(h=v(this,Be))||h.pause()):null!=(c=v(this,Be))&&c.mediaElement&&(v(this,Be).mediaElement.style.display="block");break;case"is-casting":U(i)?(null!=(d=v(this,Fe))&&d.isFullscreen()&&y(this,je,bi).call(this),null==(u=v(this,Be))||u.pause()):document.hidden||null==(m=v(this,Be))||m.play();break;case"cast-receiver-id":w(this,ze,i);break;case"cast-background":w(this,Ve,i);break;case"language":v(this,Be)&&(v(this,Be).language=i,U(i)?y(this,je,Si).call(this,x.LANGUAGE,i):y(this,je,ki).call(this,x.LANGUAGE));break;case"text-track":v(this,Be)&&(v(this,Be).textTrack=i,U(i)?y(this,je,Si).call(this,x.TEXT_TRACK,i):y(this,je,ki).call(this,x.TEXT_TRACK));break;case"log-level":U(i)&&v(this,Xe).setLevel(M(i));break;case"authentication-token":U(i)?y(this,je,Si).call(this,x.AUTHENTICATION_TOKEN,i):y(this,je,ki).call(this,x.AUTHENTICATION_TOKEN);break;case"volume":if(v(this,Be)&&U(i)){const t=parseFloat(i);v(this,Be).volume=t}}}connectListener(t){pe(t).forEach((e=>{var i,n;const s=v(this,Re).get(e);switch(s?s.push(t):v(this,Re).set(e,[t]),e){case x.PAUSED:("paused"===(null==(i=v(this,Be))?void 0:i.playbackState)||this.hasAttribute(x.PAUSED))&&t.setAttribute(x.PAUSED,"");break;case x.MUTED:(null!=(n=v(this,Be))&&n.muted||this.hasAttribute(x.MUTED))&&t.setAttribute(x.MUTED,"");break;case x.MAX_VIDEO_BITRATE:v(this,De)&&t.setAttribute(x.MAX_VIDEO_BITRATE,v(this,De));break;case x.CHANNEL_ID:v(this,_e)&&t.setAttribute(x.CHANNEL_ID,v(this,_e));break;case x.CHANNEL_GROUP_ID:v(this,Ne)&&t.setAttribute(x.CHANNEL_GROUP_ID,v(this,Ne));break;case x.AUTHENTICATION_TOKEN:{const e=this.getAttribute("authentication-token");e&&t.setAttribute(x.AUTHENTICATION_TOKEN,e);break}}}))}disconnectListener(t){pe(t).forEach((e=>{const i=v(this,Re).get(e);i&&v(this,Re).set(e,i.filter((e=>e!=t)))}))}get instance(){return v(this,Be)}connect(){y(this,je,qe).call(this)}};Ie=new WeakMap,Re=new WeakMap,Le=new WeakMap,Me=new WeakMap,Pe=new WeakMap,Be=new WeakMap,Ue=new WeakMap,_e=new WeakMap,Ne=new WeakMap,De=new WeakMap,Oe=new WeakMap,Fe=new WeakMap,We=new WeakMap,Ge=new WeakMap,He=new WeakMap,ze=new WeakMap,Ve=new WeakMap,Xe=new WeakMap,Qe=new WeakMap,je=new WeakSet,qe=function(){return S(this,null,(function*(){var t,e;if(!v(this,_e))return;yield null==(t=v(this,Be))?void 0:t.unload();const i=this.hasAttribute(x.PAUSED),n=this.hasAttribute(x.MUTED),s=L(this.getAttribute(x.MEDIA)),a=this.getAttribute(x.TEXT_TRACK)||void 0,o=this.getAttribute("edge-url")||void 0,l=this.getAttribute("authentication-token")||void 0,h=B(this.getAttribute("max-video-bit-rate")),c=function(t){if(null!==t)try{const e=JSON.parse(t);if("object"==typeof e&&null!==e){const t=e;if("number"==typeof t.width&&"number"==typeof t.height)return t}}catch(t){return}}(this.getAttribute("max-size")),d=B(this.getAttribute("min-buffer-time")),u=B(this.getAttribute("max-buffer-time")),m=_(this.getAttribute("burst-enabled")),p=_(this.getAttribute("mse-enabled")),g=_(this.getAttribute("mse-opus-enabled")),A=_(this.getAttribute("ios-background-play-enabled")),f=_(this.getAttribute("ios-wake-lock-enabled")),b=_(this.getAttribute("ios-media-element-enabled")),E=_(this.getAttribute("abr-enabled")),S=_(this.getAttribute("size-based-resolution-cap-enabled")),k=_(this.getAttribute("telemetry-enabled")),C=function(t){if(null===t)return;const e=t.split(",").map((t=>t.trim())).filter((t=>"h264"===t||"av1"===t));return 0!==e.length?e:void 0}(this.getAttribute("video-codecs")),T=P(this.getAttribute("poster")),I=function(t){if(null!==t)try{const e=JSON.parse(t);if("object"==typeof e&&null!==e){const t=e;if(t.wasmDecodingConstraint){const e=t.wasmDecodingConstraint;if("number"!=typeof e.width||"number"!=typeof e.height||"number"!=typeof e.bitRate)return}return t}}catch(t){return}}(this.getAttribute("advanced")),R=M(this.getAttribute("log-level")),D=N(this.getAttribute("drm-headers")),O=N(this.getAttribute("drm-queryparams")),F=_(this.getAttribute("webtransport-enabled")),W=B(this.getAttribute("reconnect-retries")),G=void 0!==W?t=>t.reconnectRetries<W:void 0;w(this,Be,new r.V({url:v(this,Ue),channelId:v(this,_e),channelGroupId:v(this,Ne),edgeUrl:o,authenticationToken:l,muted:n,media:s,maxSize:c,maxVideoBitRate:h,minBufferTime:d,maxBufferTime:u,burstEnabled:m,mseEnabled:p,mseOpusEnabled:g,iosBackgroundPlayEnabled:A,iosWakeLockEnabled:f,iosMediaElementEnabled:b,abrEnabled:E,sizeBasedResolutionCapEnabled:S,telemetryEnabled:k,videoCodecs:C,poster:T,textTrack:a,advanced:I,logLevel:R,drm:{headers:D,queryParams:O},webtransportEnabled:F,reconnectHandler:G})),v(this,Be).on("rendition levels",(t=>{const e=t.filter((t=>{var e;return null==(e=t.video)?void 0:e.width}));y(this,je,Si).call(this,x.RENDITION_LEVELS,JSON.stringify(e))})),v(this,Be).on("rendition level",(t=>{y(this,je,Si).call(this,x.RENDITION_LEVEL,JSON.stringify(t))})),v(this,Be).on("playback state",(t=>{switch(t){case"playing":y(this,je,ki).call(this,x.PAUSED),y(this,je,ki).call(this,x.BUFFERING);break;case"paused":y(this,je,Si).call(this,x.PAUSED,""),y(this,je,ki).call(this,x.BUFFERING);break;case"buffering":y(this,je,ki).call(this,x.PAUSED),y(this,je,Si).call(this,x.BUFFERING,"")}})),v(this,Be).on("volume state",(t=>{y(this,je,Si).call(this,x.VOLUME,t.volume.toString()),t.isMuted?y(this,je,Si).call(this,x.MUTED,""):y(this,je,ki).call(this,x.MUTED)})),v(this,Be).on("channel switch failed",(({channelId:t})=>{var e;this.setAttribute(x.CHANNEL_ID,t),"buffering"!==(null==(e=v(this,Be))?void 0:e.playbackState)&&y(this,je,ki).call(this,x.BUFFERING)})),v(this,Be).on("channel switch",(({channelId:t})=>{var e;v(this,_e)!==t&&this.setAttribute(x.CHANNEL_ID,t),"buffering"!==(null==(e=v(this,Be))?void 0:e.playbackState)&&y(this,je,ki).call(this,x.BUFFERING)})),v(this,Be).on("channels",(t=>{w(this,di,Date.now()),y(this,je,Si).call(this,x.CHANNELS,JSON.stringify(t))})),v(this,Be).on("languages",(t=>{var e;y(this,je,Si).call(this,x.LANGUAGES,JSON.stringify(t)),null!=(e=v(this,Be))&&e.language&&y(this,je,Si).call(this,x.LANGUAGE,v(this,Be).language)})),v(this,Be).on("text tracks",(t=>{var e,i,n;y(this,je,Si).call(this,x.TEXT_TRACKS,JSON.stringify(t)),null!=(e=v(this,Be))&&e.textTrack&&y(this,je,Si).call(this,x.TEXT_TRACK,null!=(n=null==(i=v(this,Be))?void 0:i.textTrack)?n:"")})),v(this,Be).on("needs user input",(()=>{y(this,je,Si).call(this,x.NEEDS_USER_INPUT,"")})),v(this,Be).on("is live",(t=>{t||y(this,je,ki).call(this,x.BUFFERING)})),w(this,Pe,null==(e=this.shadowRoot)?void 0:e.querySelector("#video")),v(this,Pe)&&v(this,Be).attach(v(this,Pe)),this.setAttribute(x.MEDIA,v(this,Be).media),v(this,Be).muted&&y(this,je,Si).call(this,x.MUTED,""),y(this,je,Si).call(this,x.VOLUME,v(this,Be).volume.toString()),U(T)||y(this,je,Si).call(this,x.POSTER_SRC,v(this,Be).getThumbnailUrl());const H=_(this.getAttribute(x.AIRPLAY_ENABLED),!1),z=_(this.getAttribute(x.CAST_ENABLED),!0),V=_(this.getAttribute(x.FULLSCREEN_ENABLED),!0),X=_(this.getAttribute(x.PIP_ENABLED),!0),Q=_(this.getAttribute(x.VU_METER_ENABLED),!1);H&&y(this,je,ti).call(this,v(this,Be)),z&&y(this,je,Ke).call(this,v(this,Be)),V&&y(this,je,Ze).call(this,v(this,Be)),X&&y(this,je,$e).call(this,v(this,Be)),i||v(this,Be).play(),Q&&y(this,je,ei).call(this,v(this,Be)),this.dispatchEvent(new CustomEvent("vindral-instance-ready",{bubbles:!0,composed:!0,detail:v(this,Be)}))}))},$e=function(t){t.mediaElement instanceof HTMLVideoElement&&(w(this,Oe,new ue(t.mediaElement)),v(this,Oe).isSupported()&&(v(this,Xe).info("PIP is supported"),y(this,je,Si).call(this,x.PIP_AVAILABLE,"")),v(this,Oe).on("on picture in picture change",(t=>{t?y(this,je,Si).call(this,x.IS_PIP,""):y(this,je,ki).call(this,x.IS_PIP)})))},Ze=function(t){const e=!ie.isFullscreenApiSupported(this)&&ie.isFullscreenApiSupported(t.mediaElement)?t.mediaElement:this;w(this,Fe,new ie(e)),v(this,Fe).on("on fullscreen change",(t=>{t?y(this,je,Si).call(this,x.FULLSCREEN,""):y(this,je,ki).call(this,x.FULLSCREEN)}))},Ke=function(t){w(this,He,new c({background:v(this,Ve),receiverApplicationId:v(this,ze),options:t.getCastOptions()})),v(this,He).init().then((()=>{var t,e,i;y(this,je,Si).call(this,x.CAST_AVAILABLE,""),null==(t=v(this,He))||t.on("connected",y(this,je,Je).bind(this)),null==(e=v(this,He))||e.on("resumed",y(this,je,Je).bind(this)),null==(i=v(this,He))||i.on("disconnected",y(this,je,Ye).bind(this))})).catch((t=>{v(this,Xe).warn("Failed to initialize CastSender",t)}))},Je=function(){var t,e;y(this,je,Si).call(this,x.IS_CASTING,"");const i=null!=(e=null==(t=v(this,He))?void 0:t.getReceiverName())?e:"device";y(this,je,Si).call(this,x.CAST_RECEIVER_NAME,i)},Ye=function(){y(this,je,ki).call(this,x.IS_CASTING),y(this,je,ki).call(this,x.CAST_RECEIVER_NAME)},ti=function(t){const e=t.getCastOptions();w(this,We,new te({url:e.url,channelId:e.channelId,authenticationToken:e.authenticationToken,container:this})),v(this,We).once("available",(()=>{y(this,je,Si).call(this,x.AIRPLAY_AVAILABLE,"")})),v(this,We).on("connected",(()=>{y(this,je,Si).call(this,x.IS_AIRPLAYING,"")})),v(this,We).on("disconnected",(()=>{y(this,je,ki).call(this,x.IS_AIRPLAYING)}))},ei=function(t){var e;if(null==(e=v(this,Ge))||e.unload(),!(0,r.f)()){if(t.audioNode)w(this,Ge,new me(t.audioNode));else{if(!(t.mediaElement instanceof HTMLMediaElement))return;w(this,Ge,new me(t.mediaElement))}v(this,Ge).on("on decibel change",(t=>{y(this,je,Si).call(this,x.VOLUME_LEVEL,JSON.stringify(t))})),y(this,je,Si).call(this,x.VOLUME_LEVEL,JSON.stringify({left:null,right:null})),(!v(this,Ge).isMediaElementSource||!this.hasAttribute(x.MUTED))&&v(this,Ge).start()}},ii=new WeakMap,ni=function(t){"mouse"!==t.pointerType&&t.timeStamp-v(this,ii)<250||(y(this,je,pi).call(this),v(this,Me)&&clearTimeout(v(this,Me)),t.target instanceof HTMLElement&&([this,v(this,Pe)].includes(t.target)||"vindral-scroll-overlay"===t.target.localName)&&y(this,je,gi).call(this))},si=function(t){const e=this.hasAttribute(x.USER_INTERACTING);"touch"===t.pointerType&&t.target instanceof HTMLElement?[this,v(this,Pe)].includes(t.target)&&e?y(this,je,mi).call(this):y(this,je,gi).call(this):t.composedPath().some((t=>t instanceof HTMLElement&&["vindral-play-button"].includes(null==t?void 0:t.localName)))&&y(this,je,gi).call(this)},ri=function(t){!v(this,Fe)||t.target instanceof H||t.target instanceof Ce||(this.hasAttribute(x.FULLSCREEN)?this.removeAttribute(x.FULLSCREEN):this.setAttribute(x.FULLSCREEN,""))},ai=function(t){this.hasAttribute(x.USER_INTERACTING)||y(this,je,gi).call(this)},oi=new WeakMap,li=new WeakMap,hi=new WeakMap,ci=function(t){var e,i;const{metaKey:n,altKey:s,key:r}=t;if(!n&&!s&&xe.includes(r)&&!((null==(e=t.target)?void 0:e.keysUsed)||[]).includes(r))switch(r){case"f":this.hasAttribute(x.FULLSCREEN)?this.removeAttribute(x.FULLSCREEN):this.setAttribute(x.FULLSCREEN,"");break;case"m":this.hasAttribute(x.MUTED)?this.removeAttribute(x.MUTED):this.setAttribute(x.MUTED,"");break;case"ArrowDown":null==(i=this.querySelector("vindral-scroll-overlay"))||i.setAttribute("open","")}},di=new WeakMap,ui=function(){return S(this,null,(function*(){if(!v(this,Be)||!v(this,Ne))return;const t=Date.now();if(v(this,di)&&t-v(this,di)<1e4)v(this,Xe).debug("Skipping channel update, last update was less than 10 seconds ago.");else{w(this,di,t);const e=yield v(this,Be).getApiClient().getChannels(v(this,Ne));y(this,je,Si).call(this,x.CHANNELS,JSON.stringify(e))}w(this,Qe,window.setTimeout((()=>{y(this,je,ui).call(this)}),1e4))}))},mi=function(){!this.hasAttribute(x.USER_INTERACTING)||this.hasAttribute(x.UI_LOCKED)||(this.dispatchEvent(new CustomEvent("user-interacting",{bubbles:!0,composed:!0,detail:{active:!1}})),this.removeAttribute(x.USER_INTERACTING))},pi=function(){this.hasAttribute(x.USER_INTERACTING)||requestAnimationFrame((()=>{this.setAttribute(x.USER_INTERACTING,""),this.dispatchEvent(new CustomEvent("user-interacting",{bubbles:!0,composed:!0,detail:{active:!0}}))}))},gi=function(){y(this,je,pi).call(this),v(this,Me)&&clearTimeout(v(this,Me)),v(this,Le)&&w(this,Me,self.setTimeout((()=>{y(this,je,mi).call(this)}),v(this,Le)))},Ai=function(){var t;y(this,je,Ei).call(this),null==(t=v(this,Oe))||t.request().catch((t=>{v(this,Xe).warn("Failed to enter picture in picture:",t)}))},fi=function(){var t;null==(t=v(this,Oe))||t.exit().catch((t=>{v(this,Xe).warn("Failed to exit picture in picture:",t)}))},vi=function(){var t,e;null!=(t=v(this,Fe))&&t.isFullscreenApiSupported()?(y(this,je,Ei).call(this),null==(e=v(this,Fe))||e.request().then((()=>{v(this,wi).call(this)})).catch((t=>{v(this,Xe).warn("Failed to enter fullscreen:",t)}))):(this.setAttribute(x.FULLSCREEN_FALLBACK,""),y(this,je,Si).call(this,x.FULLSCREEN,""))},bi=function(){var t,e;null!=(t=v(this,Fe))&&t.isFullscreenApiSupported()?null==(e=v(this,Fe))||e.exit().then((()=>{v(this,yi).call(this)})).catch((t=>{v(this,Xe).warn("Failed to exit fullscreen:",t)})):(this.removeAttribute(x.FULLSCREEN_FALLBACK),y(this,je,ki).call(this,x.FULLSCREEN))},wi=new WeakMap,yi=new WeakMap,Ei=function(){v(this,Be)&&v(this,Be).emitter.emit("ios-hack: reset size")},Si=function(t,e){var i;null==(i=v(this,Re).get(t))||i.forEach((i=>i.setAttribute(t,e)))},ki=function(t){var e;null==(e=v(this,Re).get(t))||e.forEach((e=>e.removeAttribute(t)))},A(Ci,"observedAttributes",[...I,"url","edge-url","target-buffer-time","cast-receiver-id","cast-background","log-level","max-size","min-buffer-time","max-buffer-time","max-audio-bit-rate","burst-enabled","mse-enabled","mse-opus-enabled","ios-background-play-enabled","ios-wake-lock-enabled","ios-media-element-enabled","abr-enabled","size-based-resolution-cap-enabled","telemetry-enabled","video-codecs","poster","advanced","drm-headers","drm-queryparams","webtransport-enabled","reconnect-retries","auto-instance-enabled"]),b(Ci,Ie,"https://lb.cdn.vindral.com");let Ti=Ci;const xi=document.createElement("template");xi.innerHTML=`\n  <style>\n    :host {\n      display: var(--fullscreen-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([${x.FULLSCREEN}]) slot[name="enter"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.FULLSCREEN}])) slot[name="exit"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="enter">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-maximize"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 8v-2a2 2 0 0 1 2 -2h2" /><path d="M4 16v2a2 2 0 0 0 2 2h2" /><path d="M16 4h2a2 2 0 0 1 2 2v2" /><path d="M16 20h2a2 2 0 0 0 2 -2v-2" /></svg>\n</slot>\n    <slot name="exit">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-minimize"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 19v-2a2 2 0 0 1 2 -2h2" /><path d="M15 5v2a2 2 0 0 0 2 2h2" /><path d="M5 15h2a2 2 0 0 1 2 2v2" /><path d="M5 9h2a2 2 0 0 0 2 -2v-2" /></svg>\n</slot>\n  </slot>\n`;const Ii=class extends H{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(xi.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.isFullscreen?"Exit fullscreen":"Enter fullscreen")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.FULLSCREEN&&this.setAttribute("aria-label",this.isFullscreen?"Exit fullscreen":"Enter fullscreen")}set isFullscreen(t){t?this.setAttribute(x.FULLSCREEN,""):this.removeAttribute(x.FULLSCREEN)}get isFullscreen(){return this.hasAttribute(x.FULLSCREEN)}handleClick(t){const e=this.isFullscreen?R.EXIT_FULLSCREEN:R.ENTER_FULLSCREEN;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};A(Ii,"observedAttributes",[...E(Ii,Ii,"observedAttributes"),x.FULLSCREEN]);let Ri=Ii;const Li=document.createElement("template");var Mi,Pi;Li.innerHTML='\n  <style>\n    :host(:not([hidden])) {\n      display: var(--language-menu-display);\n    }\n  </style>\n\n  <slot name="button">\n    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7" /><path d="M9 3v2c0 4.418 -2.239 8 -5 8" /><path d="M5 9c0 2.144 2.952 3.908 6.7 4" /><path d="M12 20l4 -9l4 9" /><path d="M19.1 18h-6.2" /></svg>\n</slot>\n  <slot name="listbox" hidden>\n    <vindral-language-menu-list id="listbox" part="listbox"></vindral-language-menu-list>\n  </slot>\n';const Bi=class extends Ce{constructor(){var t,e,i,n;super(),b(this,Mi),null==(t=this.shadowRoot)||t.appendChild(Li.content.cloneNode(!0)),this.button=null==(e=this.shadowRoot)?void 0:e.querySelector("slot[name=button]"),this.listbox=null==(i=this.shadowRoot)?void 0:i.querySelector("[part=listbox]"),this.listboxSlot=null==(n=this.shadowRoot)?void 0:n.querySelector("slot[name=listbox]")}connectedCallback(){super.connectedCallback(),y(this,Mi,Pi).call(this),this.setAttribute("aria-label","Languages")}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),(t===x.LANGUAGES||t===x.TEXT_TRACKS)&&y(this,Mi,Pi).call(this)}};Mi=new WeakSet,Pi=function(){const t=t=>(t?JSON.parse(t):[]).length<2,e=t(this.getAttribute(x.LANGUAGES)),i=t(this.getAttribute(x.TEXT_TRACKS));e&&i?this.setAttribute("hidden",""):this.removeAttribute("hidden")},A(Bi,"observedAttributes",[...E(Bi,Bi,"observedAttributes"),x.LANGUAGES,x.TEXT_TRACKS]);let Ui=Bi;const _i=document.createElement("template");var Ni,Di,Oi,Fi,Wi,Gi,Hi,zi,Vi,Xi,Qi,ji,qi,$i,Zi,Ki,Ji,Yi,tn,en,nn,sn,rn,an,on,ln;_i.innerHTML=`\n  <style>\n    :host {\n      font: inherit;\n      cursor: default;\n      padding: var(--padding-2);\n      padding-top: var(--padding-3);\n      border-radius: 0.25em;\n      position: absolute;\n      min-width: 140px;\n      background: var(--bg-subtle);\n      z-index: 1;\n      overflow: auto;\n      display: flex;\n      flex-direction: row;\n      gap: var(--padding-3);\n    }\n\n    :host([list-position="top"]) {\n      bottom: calc(100% + 0.5em);\n      transform: translate(-50%);\n    }\n\n    :host([list-position="bottom"]) {\n      top: calc(100% + 0.5em);\n    }\n\n    :host::-webkit-scrollbar {\n      width: 5px;\n      padding-right: 5px;\n    }\n\n    :host::-webkit-scrollbar-thumb {\n      background-color: var(--fg-extra-subtle);\n      border-radius: 10px;\n      border: 0;\n    }\n\n    :host::-webkit-scrollbar-track {\n      border-radius: 10px;\n      background-color: transparent;\n    }\n\n    .menu {\n      display: grid;\n      gap: var(--padding-1);\n    }\n\n    .menu-container {\n      display: flex;\n      flex-direction: column;\n      flex: 1;\n    }\n\n    [role="menuitem"] {\n      position: relative;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      height: 44px;\n      padding: 0 var(--padding-3);\n      padding-left: var(--padding-6);\n      border-radius: 4px;\n      font-size: 14px;\n    }\n\n    [role="menuitem"]:hover {\n      background: var(--bg-component-hover);\n    }\n\n    [role="menuitem"][aria-selected="true"] {\n      background: var(--bg-component-active);\n    }\n\n    [role="menuitem"][aria-selected="true"]::before {\n      content: url("data:image/svg+xml,${encodeURIComponent('\n  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="#fff" viewBox="0 0 78.369 78.369" xml:space="preserve"><path d="M78.049 19.015 29.458 67.606a1.094 1.094 0 0 1-1.548 0L.32 40.015a1.094 1.094 0 0 1 0-1.547l6.704-6.704a1.095 1.095 0 0 1 1.548 0l20.113 20.112 41.113-41.113a1.095 1.095 0 0 1 1.548 0l6.703 6.704a1.094 1.094 0 0 1 0 1.548z"/></svg>\n')}");\n      position: absolute;\n      left: var(--padding-3);\n      top: calc(50% - 8px);\n    }\n\n    [role="menuitem"]:focus-visible {\n      box-shadow: inset 0 0 0 2px var(--fg-strong);\n      outline: 0;\n    }\n\n    .heading {\n      text-transform: uppercase;\n      margin-bottom: var(--padding-2);\n      padding: 0 var(--padding-3);\n      font-size: 11px;\n      font-weight: bold;\n    }\n\n    :host([${x.LANGUAGES}="[]"]) #languages,\n    :host(:not([${x.LANGUAGES}])) #languages {\n      display: none;\n    }\n\n    :host([${x.TEXT_TRACKS}="[]"]) #text-tracks,\n    :host(:not([${x.TEXT_TRACKS}])) #text-tracks {\n      display: none;\n    }\n  </style>\n\n  <div id="languages" class="menu-container">\n    <div class="heading">Language</div>\n    <div class="menu"></div>\n  </div>\n  <div id="text-tracks" class="menu-container">\n    <div class="heading">Subtitles</div>\n    <div class="menu"></div>\n  </div>\n`;class hn extends HTMLElement{constructor(){super(),b(this,qi),b(this,Ni,[]),b(this,Di,[]),b(this,Oi),b(this,Fi),b(this,Wi,[]),b(this,Gi,[]),b(this,Hi,null),b(this,zi,null),b(this,Vi,null),b(this,Xi,null),b(this,Qi,null),b(this,ji,null),A(this,"handleEvent",(t=>{"keydown"===t.type&&y(this,qi,sn).call(this,t)})),this.attachShadow({mode:"open"}).appendChild(_i.content.cloneNode(!0))}connectedCallback(){var t,e,i;const n=this.getRootNode();n instanceof ShadowRoot&&(w(this,Vi,n.host.closest("vindral-controller")),null==(t=v(this,Vi))||t.connectListener(this),w(this,Hi,null==(e=this.shadowRoot)?void 0:e.querySelector("#languages .menu")),w(this,zi,null==(i=this.shadowRoot)?void 0:i.querySelector("#text-tracks .menu")),y(this,qi,$i).call(this),y(this,qi,Zi).call(this),w(this,Xi,n.host),this.addEventListener("keydown",this))}disconnectedCallback(){this.removeEventListener("keydown",this)}attributeChangedCallback(t,e,i){e!==i&&(t===x.LANGUAGES&&i&&(this.languages=JSON.parse(i)),t===x.TEXT_TRACKS&&i&&(this.textTracks=JSON.parse(i)),t===x.LANGUAGE&&(this.language=i),t===x.TEXT_TRACK&&(this.textTrack=i))}set languages(t){w(this,Ni,t),y(this,qi,Ji).call(this),y(this,qi,tn).call(this)}set textTracks(t){w(this,Di,t),y(this,qi,Ki).call(this),y(this,qi,en).call(this)}set language(t){w(this,Oi,t),y(this,qi,tn).call(this)}set textTrack(t){w(this,Fi,t),y(this,qi,en).call(this)}get keysUsed(){return["Enter","Escape","Tab"," ","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Home","End"]}focus(){v(this,Qi)?v(this,Qi).focus():v(this,ji)&&v(this,ji).focus()}}Ni=new WeakMap,Di=new WeakMap,Oi=new WeakMap,Fi=new WeakMap,Wi=new WeakMap,Gi=new WeakMap,Hi=new WeakMap,zi=new WeakMap,Vi=new WeakMap,Xi=new WeakMap,Qi=new WeakMap,ji=new WeakMap,qi=new WeakSet,$i=function(){new IntersectionObserver((t=>{t.forEach((t=>{if(1!==t.intersectionRatio)if(t.intersectionRatio>0){const e=this.offsetHeight*t.intersectionRatio-24;this.style.height=`${e}px`}else this.style.height="auto"}))}),{root:v(this,Vi),threshold:0}).observe(this)},Zi=function(){v(this,Hi)&&(y(this,qi,Ji).call(this),y(this,qi,tn).call(this)),v(this,zi)&&(y(this,qi,Ki).call(this),y(this,qi,en).call(this))},Ki=function(){v(this,zi).innerHTML="",w(this,Gi,[]);const t=y(this,qi,Yi).call(this,"Off","textTrack",void 0);v(this,zi).appendChild(t),v(this,Gi).push({element:t,value:void 0}),v(this,Di).forEach((t=>{const e=y(this,qi,Yi).call(this,t,"textTrack",t);v(this,zi).appendChild(e),v(this,Gi).push({element:e,value:t})})),y(this,qi,en).call(this)},Ji=function(){v(this,Hi).innerHTML="",w(this,Wi,[]),v(this,Ni).forEach((t=>{const e=y(this,qi,Yi).call(this,t,"language",t);v(this,Hi).appendChild(e),v(this,Wi).push({element:e,value:t})})),y(this,qi,tn).call(this)},Yi=function(t,e,i){const n=document.createElement("div");return n.setAttribute("role","menuitem"),n.textContent=t,n.addEventListener("click",(()=>y(this,qi,nn).call(this,i,e))),n},tn=function(){v(this,Qi)&&(v(this,Qi).removeAttribute("aria-selected"),v(this,Qi).tabIndex=-1);const t=v(this,Wi).find((t=>t.value===v(this,Oi)));t&&(t.element.setAttribute("aria-selected","true"),t.element.tabIndex=0,w(this,Qi,t.element))},en=function(){v(this,ji)&&(v(this,ji).removeAttribute("aria-selected"),v(this,ji).tabIndex=-1);const t=v(this,Gi).find((t=>t.value===v(this,Fi)));if(t)t.element.setAttribute("aria-selected","true"),t.element.tabIndex=0,w(this,ji,t.element);else{const t=v(this,Gi).find((t=>void 0===t.value));t&&(t.element.setAttribute("aria-selected","true"),t.element.tabIndex=0,w(this,ji,t.element))}},nn=function(t,e){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}));const i="language"===e?R.SET_LANGUAGE:R.SET_TEXT_TRACK;this.dispatchEvent(new CustomEvent(i,{bubbles:!0,composed:!0,detail:t}))},sn=function(t){var e,i,n;const{key:s,ctrlKey:r,altKey:a,metaKey:o}=t;r||a||o||this.keysUsed.includes(s)&&(t.preventDefault(),t.stopPropagation(),"Tab"===s||"Escape"===s?null==(e=v(this,Xi))||e.hide():"Enter"===s||" "===s?null==(n=null==(i=y(this,qi,on).call(this))?void 0:i.element)||n.click():y(this,qi,rn).call(this,t))},rn=function(t){var e;const{key:i}=t,n=[...v(this,Wi),...v(this,Gi)],s=null!=(e=y(this,qi,on).call(this))?e:n[0];if(!s)return;const r=n.indexOf(s);let a=Math.max(0,r);"ArrowDown"===i?a++:"ArrowUp"===i?a--:"ArrowLeft"===i?a=y(this,qi,an).call(this,r,"left"):"ArrowRight"===i?a=y(this,qi,an).call(this,r,"right"):"Home"===t.key?a=0:"End"===t.key&&(a=n.length-1),a<0&&(a=n.length-1),a>n.length-1&&(a=0);const o=n[a];o&&(y(this,qi,ln).call(this,o.value),o.element.focus())},an=function(t,e){const i=v(this,Wi).length,n=v(this,Gi).length;return"left"===e?t<i?i+n-1:t-i-1:t>=i?0:t+i},on=function(){return[...v(this,Wi),...v(this,Gi)].find((t=>0===t.element.tabIndex))},ln=function(t){for(const e of[...v(this,Wi),...v(this,Gi)])e.element.tabIndex=e.value===t?0:-1},A(hn,"observedAttributes",[x.LANGUAGES,x.TEXT_TRACKS,x.LANGUAGE,x.TEXT_TRACK]);const cn=document.createElement("template");cn.innerHTML=`\n  <style>\n    :host {\n      display: var(--mute-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([${x.MUTED}]) slot[name="unmute"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.MUTED}])) slot[name="mute"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="mute">\n<svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  <g fill="none" stroke="currentColor">\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" />\n<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />\n</g></svg>\n</slot>\n    <slot name="unmute">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  <g fill="none" stroke="currentColor">\n  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>\n</slot>\n  </slot>\n`;const dn=class extends H{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(cn.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.muted?"UnMute":"Mute")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.MUTED&&this.setAttribute("aria-label",this.muted?"UnMute":"Mute")}set muted(t){t?this.setAttribute(x.MUTED,""):this.removeAttribute(x.MUTED)}get muted(){return this.hasAttribute(x.MUTED)}handleClick(t){const e=this.muted?R.UNMUTE:R.MUTE;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};A(dn,"observedAttributes",[...E(dn,dn,"observedAttributes"),x.MUTED]);let un=dn;const mn=document.createElement("template");mn.innerHTML=`\n  <style>\n    :host {\n      display: var(--pip-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host(:not([${x.PIP_AVAILABLE}])) {\n      display: none !important;\n    }\n  </style>\n  <slot name="icon">\n    <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 4a3 3 0 0 1 3 3v4a1 1 0 0 1 -2 0v-4a1 1 0 0 0 -1 -1h-14a1 1 0 0 0 -1 1v10a1 1 0 0 0 1 1h6a1 1 0 0 1 0 2h-6a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3z" /><path d="M20 13a2 2 0 0 1 2 2v3a2 2 0 0 1 -2 2h-5a2 2 0 0 1 -2 -2v-3a2 2 0 0 1 2 -2z" /></svg>\n</slot>\n`;const pn=class extends H{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(mn.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.isPictureInPictureActive?"Exit picture in picture":"Enter picture in picture")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.IS_PIP&&this.setAttribute("aria-label",this.isPictureInPictureActive?"Exit picture in picture":"Enter picture in picture")}set isPictureInPictureActive(t){t?this.setAttribute(x.IS_PIP,""):this.removeAttribute(x.IS_PIP)}get isPictureInPictureActive(){return this.hasAttribute(x.IS_PIP)}handleClick(t){const e=this.isPictureInPictureActive?R.EXIT_PIP:R.ENTER_PIP;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};A(pn,"observedAttributes",[...E(pn,pn,"observedAttributes"),x.IS_PIP,x.PIP_AVAILABLE]);let gn=pn;const An=document.createElement("template");An.innerHTML=`\n  <style>\n    :host {\n      display: var(--play-button-display);\n    }\n\n    slot > svg {\n      display: block;\n    }\n\n    :host([${x.PAUSED}]) slot[name="pause"] {\n      display: none !important;\n    }\n\n    :host(:not([${x.PAUSED}])) slot[name="play"] {\n      display: none !important;\n    }\n  </style>\n\n  <slot name="icon">\n    <slot name="play">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z" /></svg>\n</slot>\n    <slot name="pause">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 4h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h2a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2z" /><path d="M17 4h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h2a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2z" /></svg>\n</slot>\n  </slot>\n`;const fn=class extends H{constructor(){var t;super(),null==(t=this.shadowRoot)||t.appendChild(An.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.setAttribute("aria-label",this.paused?"Play":"Pause")}disconnectedCallback(){super.disconnectedCallback()}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.PAUSED&&this.setAttribute("aria-label",this.paused?"Play":"Pause")}set paused(t){t?this.setAttribute(x.PAUSED,""):this.removeAttribute(x.PAUSED)}get paused(){return this.hasAttribute(x.PAUSED)}handleClick(t){const e=this.paused?R.PLAY:R.PAUSE;this.dispatchEvent(new CustomEvent(e,{bubbles:!0,composed:!0}))}};A(fn,"observedAttributes",[...E(fn,fn,"observedAttributes"),x.PAUSED]);let vn=fn;const bn={TITLE:"title",OFFLINE:"offline",REFRESH_POSTER_ENABLED:"refresh-poster-enabled",STREAM_POLL_ENABLED:"stream-poll-enabled"},wn=Object.values(bn);var yn,En,Sn,kn,Cn,Tn,xn,In,Rn,Ln,Mn,Pn;class Bn extends a.E{constructor(t){super(),b(this,In),b(this,yn),b(this,En),b(this,Sn,!1),b(this,kn,!1),b(this,Cn,!0),b(this,Tn,null),b(this,xn,null),w(this,En,t),w(this,yn,new d.A({publicEndpoint:t.url,tokenFactory:()=>t.authenticationToken}))}start(t=5e3){v(this,xn)&&clearInterval(v(this,xn)),w(this,Sn,!1),w(this,kn,!1),y(this,In,Pn).call(this),y(this,In,Rn).call(this),w(this,xn,window.setInterval((()=>{!v(this,kn)&&!v(this,En).infiniteReconnect&&!v(this,Tn)&&v(this,Cn)&&w(this,Tn,window.setTimeout((()=>y(this,In,Ln).call(this)),3e5)),!v(this,kn)&&v(this,Cn)&&y(this,In,Rn).call(this)}),t))}stop(){y(this,In,Mn).call(this),v(this,xn)&&(window.clearInterval(v(this,xn)),w(this,xn,null))}}yn=new WeakMap,En=new WeakMap,Sn=new WeakMap,kn=new WeakMap,Cn=new WeakMap,Tn=new WeakMap,xn=new WeakMap,In=new WeakSet,Rn=function(){return S(this,null,(function*(){if(v(this,Sn))return;w(this,Sn,!0);let t="Stream is offline",e="Please stand by";try{const t=yield v(this,yn).getChannel(v(this,En).channelId);if(t.isLive)return w(this,kn,!0),y(this,In,Pn).call(this),this.emit("live",t),void w(this,Sn,!1)}catch(i){(0,d.b)(i)&&(403===i.status||401===i.status)&&(t="Forbidden",e="You do not have permission to view this stream")}v(this,Cn)&&this.emit("error",{title:t,message:e}),w(this,Sn,!1)}))},Ln=function(){this.stop(),w(this,Cn,!1),this.emit("timeout")},Mn=function(){v(this,Tn)&&(window.clearTimeout(v(this,Tn)),w(this,Tn,null))},Pn=function(){y(this,In,Mn).call(this),w(this,Cn,!0)};const Un=new RegExp("/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/","i"),_n=navigator.userAgent.toLowerCase(),Nn=`\n  <style>\n    :host {\n      container-type: inline-size;\n      position: relative;\n      overflow: hidden;\n      width: 100%;\n      display: flex;\n      justify-content: center;\n\n      --vindral-volume-range-display: ${Un.test(_n)?"none":"flex"};\n      --vindral-airplay-button-display: none;\n      --vindral-play-overlay-display: none;\n      --vindral-grid-item-offline-display: none;\n    }\n\n    vindral-control-bar[slot="top-bar"] {\n      display: none;\n    }\n\n    @container (max-width: 320px) {\n      vindral-controller {\n        --vindral-volume-range-display: none;\n        --vindral-control-padding: 0px;\n        --vindral-button-padding: 4px;\n      }\n\n      vindral-control-bar[slot="top-bar"] {\n        display: block;\n      }\n\n      vindral-control-bar:not([slot="top-bar"]) vindral-rendition-levels-menu,\n      vindral-control-bar:not([slot="top-bar"]) vindral-cast-button,\n      vindral-control-bar:not([slot="top-bar"]) vindral-airplay-button {\n        display: none;\n      }\n    }\n\n    :host([${bn.OFFLINE}]) {\n      aspect-ratio: 16 / 9;\n      vindral-controller {\n        --vindral-ui-display: none;\n      }\n    }\n\n    :host([${x.AIRPLAY_ENABLED}="false"]) {\n      --vindral-airplay-button-display: none;\n    }\n\n    :host([${x.CAST_ENABLED}="false"]) {\n      --vindral-cast-button-display: none;\n    }\n\n    :host([${x.FULLSCREEN_ENABLED}="false"]) {\n      --vindral-fullscreen-button-display: none;\n    }\n\n    :host([${x.PIP_ENABLED}="false"]) {\n      --vindral-pip-button-display: none;\n    }\n\n    :host(:not([${x.CHANNEL_GROUP_ID}])) vindral-scroll-overlay {\n      display: none;\n    }\n\n    :host([${x.MEDIA}="video"]) vindral-mute-button,\n    :host([${x.MEDIA}="video"]) vindral-volume-range {\n      display: none;\n    }\n  </style>\n`,Dn=`\n  ${Nn}\n\n  <vindral-controller>\n    <vindral-control-bar slot="top-bar">\n      <vindral-rendition-levels-menu list-position="bottom"></vindral-rendition-levels-menu>\n      <vindral-cast-button></vindral-cast-button>\n      <vindral-airplay-button></vindral-airplay-button>\n    </vindral-control-bar>\n    <vindral-control-bar>\n      <vindral-play-button></vindral-play-button>\n      <vindral-mute-button></vindral-mute-button>\n      <vindral-volume-range></vindral-volume-range>\n      <vindral-channel-grid-button slot="right"></vindral-channel-grid-button>\n      <vindral-language-menu slot="right"></vindral-language-menu>\n      <vindral-rendition-levels-menu slot="right"></vindral-rendition-levels-menu>\n      <vindral-pip-button slot="right"></vindral-pip-button>\n      <vindral-cast-button slot="right"></vindral-cast-button>\n      <vindral-airplay-button slot="right"></vindral-airplay-button>\n      <vindral-fullscreen-button slot="right"></vindral-fullscreen-button>\n    </vindral-control-bar>\n    <vindral-scroll-overlay slot="overlay">\n      <vindral-channel-grid id="listbox" part="listbox"></vindral-channel-grid>\n    </vindral-scroll-overlay>\n    <vindral-cast-overlay slot="overlay"></vindral-cast-overlay>\n    <vindral-buffering-overlay slot="overlay"></vindral-buffering-overlay>\n    <vindral-user-input-play-overlay slot="overlay"></vindral-user-input-play-overlay>\n    <vindral-poster-overlay slot="overlay" disabled></vindral-poster-overlay>\n\n    <vindral-play-overlay id="play-overlay" slot="overlay" hidden></vindral-play-overlay>\n    <vindral-message id="vindral-message" slot="overlay" hidden></vindral-message>\n  </vindral-controller>\n`,On=`\n  ${Nn}\n\n  <style>\n    #control-bar {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: var(--padding-3);\n    }\n  </style>\n\n  <vindral-controller>\n    <div id="control-bar" slot="middle">\n      <vindral-play-button></vindral-play-button>\n      <vindral-mute-button></vindral-mute-button>\n      <vindral-volume-range></vindral-volume-range>\n      <vindral-buffering-icon></vindral-buffering-icon>\n    </div>\n\n    <vindral-play-overlay id="play-overlay" slot="overlay" hidden></vindral-play-overlay>\n    <vindral-message id="vindral-message" slot="overlay" hidden></vindral-message>\n  </vindral-controller>\n`,Fn=document.createElement("template");var Wn,Gn,Hn,zn,Vn,Xn,Qn,jn,qn,$n,Zn,Kn,Jn,Yn;class ts extends HTMLElement{constructor(){super(),b(this,qn),b(this,Wn),b(this,Gn),b(this,Hn),b(this,zn),b(this,Vn),b(this,Xn,(()=>{Array.from(this.attributes).forEach((t=>{v(this,Qn).call(this,t.name,t.value)}))})),b(this,Qn,((t,e)=>{(t=>Ti.observedAttributes.includes(t))(t)&&(U(e)?v(this,Gn).setAttribute(t,e):v(this,Gn).removeAttribute(t))})),b(this,jn,(()=>"audio"===L(this.getAttribute(x.MEDIA))?On:Dn)),b(this,Kn,(()=>{const t=v(this,Gn).instance;t&&(t.on("is live",(t=>{t?(this.removeAttribute(bn.OFFLINE),v(this,Hn).setAttribute("hidden","")):(this.setAttribute(bn.OFFLINE,""),v(this,Hn).removeAttribute("hidden"),y(this,qn,Yn).call(this,"Stream is offline","Please stand by"))})),t.on("channels",(t=>{const e=v(this,Gn).getAttribute("channel-id"),i=t.find((t=>t.channelId===e));i&&y(this,qn,Jn).call(this,i.name)})),t.on("channel switch",(({channelId:e})=>{const i=t.channels.find((t=>t.channelId===e));i&&y(this,qn,Jn).call(this,i.name)})),t.on("error",(t=>{var e;let i="Stream is offline",n="Please stand by";t.isFatal()?(t.code()===r.A?(i="Forbidden",n="You do not have permission to view this stream",y(this,qn,Yn).call(this,i,n)):null==(e=v(this,Vn))||e.start(),this.setAttribute(bn.OFFLINE,"")):t.code()===r.C&&y(this,qn,Yn).call(this,i,n)})))})),w(this,Wn,this.attachShadow({mode:"open"})),y(this,qn,$n).call(this),w(this,Gn,v(this,Wn).querySelector("vindral-controller")),w(this,Hn,v(this,Wn).querySelector("#vindral-message")),w(this,zn,v(this,Wn).querySelector("#play-overlay"))}connectedCallback(){this.setAttribute(bn.OFFLINE,""),v(this,Gn).addEventListener("vindral-instance-ready",v(this,Kn)),y(this,qn,Zn).call(this)}disconnectedCallback(){var t;v(this,Gn).removeEventListener("vindral-instance-ready",v(this,Kn)),null==(t=v(this,Vn))||t.stop()}attributeChangedCallback(t,e,i){if(e!==i)if(t===x.MEDIA)y(this,qn,$n).call(this);else if(t===bn.REFRESH_POSTER_ENABLED){const t=v(this,Wn).querySelector("vindral-poster-overlay");t&&(t.disabled=!1===_(this.getAttribute(bn.REFRESH_POSTER_ENABLED),!1))}else v(this,Qn).call(this,t,i)}get instance(){return v(this,Gn).instance}}Wn=new WeakMap,Gn=new WeakMap,Hn=new WeakMap,zn=new WeakMap,Vn=new WeakMap,Xn=new WeakMap,Qn=new WeakMap,jn=new WeakMap,qn=new WeakSet,$n=function(){Fn.innerHTML=v(this,jn).call(this);const t=Fn.content.cloneNode(!0);w(this,Gn,t.querySelector("vindral-controller")),w(this,Hn,t.querySelector("#vindral-message")),w(this,zn,t.querySelector("#play-overlay")),this.children.length>0&&Array.from(this.children).forEach((t=>{v(this,Gn).appendChild(t)})),v(this,Xn).call(this),v(this,Wn).innerHTML="",v(this,Wn).appendChild(t)},Zn=function(){var t;if(!1===_(this.getAttribute(bn.STREAM_POLL_ENABLED),!0))return;const e=this.getAttribute("url"),i=this.getAttribute("channel-id"),n=null!=(t=this.getAttribute("authentication-token"))?t:void 0,s=this.hasAttribute("infinite-reconnect"),r=_(this.getAttribute("title"),!1);if(!e||!i)return this.setAttribute(bn.OFFLINE,""),void y(this,qn,Yn).call(this,"Invalid options","Please enter at least a channel id and url to start the stream");w(this,Vn,new Bn({url:e,channelId:i,authenticationToken:n,infiniteReconnect:s})),v(this,Vn).on("live",(t=>{v(this,Gn).connect(),this.removeAttribute("offline"),v(this,Hn).setAttribute("hidden",""),r&&y(this,qn,Jn).call(this,t.name)})),v(this,Vn).on("timeout",(()=>{v(this,Hn).setAttribute("hidden",""),v(this,zn).removeAttribute("hidden")})),v(this,Vn).on("error",(t=>{this.setAttribute(bn.OFFLINE,""),y(this,qn,Yn).call(this,t.title,t.message)})),v(this,zn).addEventListener("click",(()=>{v(this,Gn).connect(),v(this,zn).setAttribute("hidden","")})),this.hasAttribute("paused")&&v(this,Vn).start()},Kn=new WeakMap,Jn=function(t){if(!_(this.getAttribute("title"),!0))return;const e=P(this.getAttribute("poster"));(({title:t,subTitle:e="Live stream",poster:i})=>{document.title=t,"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:t,artist:e,artwork:i?[{src:i}]:[]}))})({title:t,poster:"string"==typeof e?e:void 0})},Yn=function(t,e){v(this,Hn).setAttribute("title",t),v(this,Hn).setAttribute("description",e);const i=this.getAttribute("poster");i&&v(this,Hn).setAttribute("background-image",i),v(this,Hn).removeAttribute("hidden")},A(ts,"observedAttributes",[...Ti.observedAttributes,...wn]);const es=document.createElement("template");var is,ns,ss,rs,as,os,ls,hs,cs;es.innerHTML=`\n  <style>\n    :host {\n      display: var(--poster-overlay-display);\n      position: absolute;\n      top: 0;\n      left: 0;\n      max-width: 100%;\n      max-height: 100%;\n      min-width: 100%;\n      min-height: 100%;\n      background-repeat: no-repeat;\n      background-position: 50% 50%;\n      background-size: contain;\n      transition-property: background-image;\n      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n      transition-duration: 200ms;\n    }\n\n    :host::before {\n      content: "";\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(255, 255, 255, 0);\n      transition: background 0.2s ease;\n    }\n\n    :host(:not([${x.PAUSED}])) {\n      display: none;\n    }\n  </style>\n`;class ds extends HTMLElement{constructor(){super(),b(this,as),b(this,is,null),b(this,ns,null),b(this,ss,null),b(this,rs,(()=>{!document.hidden&&this.hasAttribute("intersecting")&&this.paused&&!this.disabled?y(this,as,os).call(this):y(this,as,ls).call(this)})),b(this,cs,(t=>{t.forEach((t=>{t.isIntersecting?this.setAttribute("intersecting",""):this.removeAttribute("intersecting")}))})),this.attachShadow({mode:"open"}).appendChild(es.content.cloneNode(!0))}connectedCallback(){var t;w(this,is,this.closest("vindral-controller")),null==(t=v(this,is))||t.connectListener(this),document.addEventListener("visibilitychange",v(this,rs)),w(this,ss,new IntersectionObserver(v(this,cs))),v(this,ss).observe(this)}disconnectedCallback(){var t,e;null==(t=v(this,is))||t.disconnectListener(this),document.removeEventListener("visibilitychange",v(this,rs)),null==(e=v(this,ss))||e.disconnect(),w(this,ss,null),y(this,as,ls).call(this)}attributeChangedCallback(t,e,i){e!==i&&(t===x.POSTER_SRC&&this.paused&&!this.disabled&&y(this,as,hs).call(this),(t===x.PAUSED||"disabled"===t||"intersecting"===t)&&v(this,rs).call(this))}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get posterSrc(){return this.getAttribute(x.POSTER_SRC)}get paused(){return this.hasAttribute(x.PAUSED)}}is=new WeakMap,ns=new WeakMap,ss=new WeakMap,rs=new WeakMap,as=new WeakSet,os=function(){null===v(this,ns)&&(y(this,as,ls).call(this),w(this,ns,window.setInterval((()=>y(this,as,hs).call(this)),6e3)))},ls=function(){null!==v(this,ns)&&(clearInterval(v(this,ns)),w(this,ns,null)),this.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAJCAQAAACRI2S5AAAAEElEQVR42mNkIAAYRxWAAQAG9gAKqv6+AwAAAABJRU5ErkJggg==')"},hs=function(){if(!this.posterSrc)return;const t=new URL(this.posterSrc),e=new Image;t.searchParams.set("t",Date.now().toString()),e.src=t.toString(),e.onload=()=>this.style.backgroundImage=`url(${t.toString()})`},cs=new WeakMap,A(ds,"observedAttributes",[x.POSTER_SRC,x.PAUSED,"disabled","intersecting"]);const us=document.createElement("template");var ms,ps;us.innerHTML='\n  <style>\n    :host {\n      display: var(--rendition-menu-display);\n    }\n  </style>\n\n  <slot name="button">\n<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-settings-filled" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M14.647 4.081a.724 .724 0 0 0 1.08 .448c2.439 -1.485 5.23 1.305 3.745 3.744a.724 .724 0 0 0 .447 1.08c2.775 .673 2.775 4.62 0 5.294a.724 .724 0 0 0 -.448 1.08c1.485 2.439 -1.305 5.23 -3.744 3.745a.724 .724 0 0 0 -1.08 .447c-.673 2.775 -4.62 2.775 -5.294 0a.724 .724 0 0 0 -1.08 -.448c-2.439 1.485 -5.23 -1.305 -3.745 -3.744a.724 .724 0 0 0 -.447 -1.08c-2.775 -.673 -2.775 -4.62 0 -5.294a.724 .724 0 0 0 .448 -1.08c-1.485 -2.439 1.305 -5.23 3.744 -3.745a.722 .722 0 0 0 1.08 -.447c.673 -2.775 4.62 -2.775 5.294 0zm-2.647 4.919a3 3 0 1 0 0 6a3 3 0 0 0 0 -6z" stroke-width="0" fill="currentColor" />\n</svg>\n</slot>\n  <slot name="listbox" hidden>\n    <vindral-rendition-levels-menu-list id="listbox" part="listbox"></vindral-rendition-levels-menu-list>\n  </slot>\n';const gs=class extends Ce{constructor(){var t,e,i,n;super(),b(this,ms),null==(t=this.shadowRoot)||t.appendChild(us.content.cloneNode(!0)),this.button=null==(e=this.shadowRoot)?void 0:e.querySelector("slot[name=button]"),this.listbox=null==(i=this.shadowRoot)?void 0:i.querySelector("[part=listbox]"),this.listboxSlot=null==(n=this.shadowRoot)?void 0:n.querySelector("slot[name=listbox]")}connectedCallback(){super.connectedCallback(),y(this,ms,ps).call(this),this.setAttribute("aria-label","Rendition levels")}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),t===x.RENDITION_LEVELS&&y(this,ms,ps).call(this)}};ms=new WeakSet,ps=function(){const t=this.getAttribute(x.RENDITION_LEVELS);t&&"[]"!==t?this.removeAttribute("disabled"):this.setAttribute("disabled","")},A(gs,"observedAttributes",[...E(gs,gs,"observedAttributes"),x.RENDITION_LEVELS]);let As=gs;const fs=document.createElement("template");var vs,bs,ws,ys,Es,Ss,ks,Cs,Ts,xs,Is,Rs,Ls,Ms,Ps,Bs;fs.innerHTML=`\n  <style>\n    :host {\n      font: inherit;\n      cursor: default;\n      padding: var(--padding-2);\n      padding-top: var(--padding-3);\n      border-radius: 0.25em;\n      position: absolute;\n      min-width: 140px;\n      background: var(--bg-subtle);\n      z-index: 1;\n      overflow: auto;\n    }\n\n    :host([list-position="top"]) {\n      bottom: calc(100% + 0.5em);\n      transform: translate(-50%);\n    }\n\n    :host([list-position="bottom"]) {\n      top: calc(100% + 0.5em);\n    }\n\n    :host::-webkit-scrollbar {\n      width: 5px;\n      padding-right: 5px;\n    }\n\n    :host::-webkit-scrollbar-thumb {\n      background-color: var(--fg-extra-subtle);\n      border-radius: 10px;\n      border: 0;\n    }\n\n    :host::-webkit-scrollbar-track {\n      border-radius: 10px;\n      background-color: transparent;\n    }\n\n    .menu {\n      display: grid;\n      gap: var(--padding-1);\n    }\n\n    [role="menuitem"] {\n      flex: 1;\n      position: relative;\n      cursor: pointer;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      height: 44px;\n      padding: 0 var(--padding-5);\n      border-radius: 4px;\n      font-size: 14px;\n      font-style: normal;\n      font-weight: 500;\n      line-height: normal;\n      white-space: nowrap;\n      text-align: left;\n    }\n\n    [role="menuitem"]:hover {\n      background: var(--bg-component-hover);\n    }\n\n    [role="menuitem"][aria-selected="true"] {\n      background: var(--bg-component-active);\n    }\n\n    [role="menuitem"][aria-selected="true"]::before {\n      content: url("data:image/svg+xml,${encodeURIComponent('\n  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="#fff" viewBox="0 0 78.369 78.369" xml:space="preserve"><path d="M78.049 19.015 29.458 67.606a1.094 1.094 0 0 1-1.548 0L.32 40.015a1.094 1.094 0 0 1 0-1.547l6.704-6.704a1.095 1.095 0 0 1 1.548 0l20.113 20.112 41.113-41.113a1.095 1.095 0 0 1 1.548 0l6.703 6.704a1.094 1.094 0 0 1 0 1.548z"/></svg>\n')}");\n      position: absolute;\n      left: calc(var(--padding-3) - var(--padding-1));\n      top: calc(50% - 8px);\n    }\n\n    [role="menuitem"]:focus-visible {\n      box-shadow: inset 0 0 0 2px var(--fg-strong);\n      outline: 0;\n    }\n\n    .menu-item-subtitle {\n      font-size: 11px;\n      opacity: 0.6;\n    }\n\n    .heading {\n      text-transform: uppercase;\n      margin-bottom: var(--padding-2);\n      padding: 0 var(--padding-3);\n      font-size: 11px;\n      font-weight: bold;\n    }\n  </style>\n\n  <slot>\n    <div class="heading">Max quality</div>\n    <div class="menu"></div>\n  </slot>\n`;class Us extends HTMLElement{constructor(){super(),b(this,ks),b(this,vs,[]),b(this,bs,Number.MAX_SAFE_INTEGER),b(this,ws,null),b(this,ys,[]),b(this,Es,null),b(this,Ss,null),A(this,"handleEvent",(t=>{"keydown"===t.type&&y(this,ks,Ls).call(this,t)})),this.attachShadow({mode:"open"}).appendChild(fs.content.cloneNode(!0))}connectedCallback(){var t;const e=this.getRootNode();e instanceof ShadowRoot&&(w(this,Es,e.host.closest("vindral-controller")),null==(t=v(this,Es))||t.connectListener(this),y(this,ks,Cs).call(this),y(this,ks,Ts).call(this),w(this,Ss,e.host),this.addEventListener("keydown",this))}disconnectedCallback(){var t;null==(t=v(this,Es))||t.disconnectListener(this),this.removeEventListener("keydown",this)}attributeChangedCallback(t,e,i){e!==i&&(t===x.RENDITION_LEVELS&&i&&(this.list=JSON.parse(i)),t===x.MAX_VIDEO_BITRATE&&i&&(this.maxVideoBitrate=i?parseInt(i):Number.MAX_SAFE_INTEGER))}set list(t){w(this,vs,t),y(this,ks,Ts).call(this)}set maxVideoBitrate(t){w(this,bs,t),y(this,ks,Is).call(this)}get keysUsed(){return["Enter","Escape","Tab"," ","ArrowDown","ArrowUp","Home","End"]}focus(){var t;null==(t=v(this,ws))||t.focus()}}vs=new WeakMap,bs=new WeakMap,ws=new WeakMap,ys=new WeakMap,Es=new WeakMap,Ss=new WeakMap,ks=new WeakSet,Cs=function(){new IntersectionObserver((t=>{t.forEach((t=>{if(1!==t.intersectionRatio)if(t.intersectionRatio>0){const e=this.offsetHeight*t.intersectionRatio-24;this.style.height=`${e}px`}else this.style.height="auto"}))}),{root:v(this,Es),threshold:0}).observe(this)},Ts=function(){var t;const e=null==(t=this.shadowRoot)?void 0:t.querySelector(".menu");e&&(w(this,ys,[]),e.innerHTML="",v(this,vs).sort(((t,e)=>{var i,n;return null!=(i=t.video)&&i.bitRate&&null!=(n=e.video)&&n.bitRate?e.video.bitRate-t.video.bitRate:0})).forEach((t=>{var i,n,s,r,a,o,l,h;const c=document.createElement("div");c.setAttribute("role","menuitem"),c.setAttribute("value",String(null==(i=t.video)?void 0:i.height)),c.classList.add("menu-item"),c.tabIndex=-1;const d=y(this,ks,xs).call(this,null==(n=t.video)?void 0:n.frameRate);c.textContent=t.video?(({width:t,height:e})=>`${t}x${e}`)(t.video):"";const u=document.createElement("span");u.classList.add("menu-item-subtitle"),u.textContent=`${((t,e=1)=>t>=C?`${T(t,C,e)} Gbit/s`:t>=k?`${T(t,k,e)} Mbit/s`:t>=1e3?`${T(t,1e3,e)} Kbit/s`:`${t} bit/s`)((null!=(r=null==(s=t.video)?void 0:s.bitRate)?r:0)+(null!=(o=null==(a=t.audio)?void 0:a.bitRate)?o:0))}, ${d}p`,c.appendChild(u),c.addEventListener("click",(()=>y(this,ks,Rs).call(this,t))),v(this,ys).push({el:c,id:null!=(h=null==(l=t.video)?void 0:l.id)?h:-1}),e.appendChild(c)})),y(this,ks,Is).call(this))},xs=function(t){return t?t[0]%t[1]==0?(t[0]/t[1]).toString():(t[0]/t[1]).toFixed(2):""},Is=function(){v(this,ws)&&(v(this,ws).removeAttribute("aria-selected"),v(this,ws).tabIndex=-1);const t=v(this,vs).sort(((t,e)=>{var i,n;return null!=(i=t.video)&&i.bitRate&&null!=(n=e.video)&&n.bitRate?e.video.bitRate-t.video.bitRate:0})),e=v(this,vs).filter((t=>{var e;return(null==(e=t.video)?void 0:e.bitRate)&&t.video.bitRate<=v(this,bs)}))[0]||t[t.length-1];if(e){const t=v(this,ys).find((t=>{var i;return t.id===(null==(i=e.video)?void 0:i.id)}));t&&(t.el.tabIndex=0,t.el.setAttribute("aria-selected","true"),w(this,ws,t.el))}},Rs=function(t){this.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),this.dispatchEvent(new CustomEvent(R.SET_RENDITION,{bubbles:!0,composed:!0,detail:t}))},Ls=function(t){var e,i,n;const{key:s,ctrlKey:r,altKey:a,metaKey:o}=t;r||a||o||this.keysUsed.includes(s)&&(t.preventDefault(),t.stopPropagation(),"Tab"===s||"Escape"===s?null==(e=v(this,Ss))||e.hide():"Enter"===s||" "===s?null==(n=null==(i=y(this,ks,Ps).call(this))?void 0:i.el)||n.click():y(this,ks,Ms).call(this,t))},Ms=function(t){var e;const{key:i}=t,n=v(this,ys),s=null!=(e=y(this,ks,Ps).call(this))?e:n[0];if(!s)return;const r=n.indexOf(s);let a=Math.max(0,r);"ArrowDown"===i?a++:"ArrowUp"===i?a--:"Home"===t.key?a=0:"End"===t.key&&(a=n.length-1),a<0&&(a=n.length-1),a>n.length-1&&(a=0);const o=n[a];o&&(y(this,ks,Bs).call(this,o.id),o.el.focus())},Ps=function(){return v(this,ys).find((t=>0===t.el.tabIndex))},Bs=function(t){for(const e of v(this,ys))e.el.tabIndex=e.id===t?0:-1},A(Us,"observedAttributes",[x.RENDITION_LEVELS,x.MAX_VIDEO_BITRATE]);const _s=document.createElement("template");var Ns,Ds,Os,Fs,Ws,Gs,Hs,zs,Vs,Xs,Qs,js,qs,$s,Zs;_s.innerHTML=`\n  <style>\n    :host {\n      --scroll-overlay-offset: var(--vindral-scroll-overlay-offset, 0px);\n\n      position: absolute;\n      top: 0;\n      width: 100%;\n      height: 100%;\n      overflow-y: scroll !important;\n      pointer-events: none !important;\n      display: block;\n      transition: background-color 0.5s ease-in-out;\n      -ms-overflow-style: none;\n      scrollbar-width: none;\n    }\n\n    :host([snap]) {\n      scroll-snap-type: y mandatory;\n      scroll-behavior: smooth;\n    }\n\n    :host([snap-touch]) {\n      scroll-snap-type: y mandatory;\n      scroll-behavior: smooth;\n      pointer-events: auto !important;\n    }\n\n    :host([open]) #scroll-area {\n      width: 100%;\n      cursor: pointer;\n    }\n\n    :host([open]) {\n      background-color: rgba(0, 0, 0, 0.5);\n    }\n\n    :host::-webkit-scrollbar {\n      display: none;\n    }\n\n    #scroll-area {\n      margin: 0 auto;\n      width: 1px;\n      height: calc(100% - var(--scroll-overlay-offset));\n      pointer-events: auto;\n      scroll-snap-align: start;\n      min-height: 1px;\n    }\n\n    slot#content {\n      display: flex;\n      margin: 0 auto;\n      width: 100%;\n      pointer-events: auto;\n      scroll-snap-align: start;\n      flex-direction: column;\n    }\n\n    :host(:not([${x.USER_INTERACTING}])) {\n      overflow: hidden !important;\n    }\n  </style>\n\n  <div id="scroll-area"></div>\n  <slot id="content"></slot>\n`;class Ks extends HTMLElement{constructor(){super(),b(this,Ws),b(this,Ns,null),b(this,Ds,null),b(this,Os,null),b(this,Fs,0),A(this,"handleEvent",(t=>{switch(t.type){case"touchstart":y(this,Ws,Gs).call(this,t);break;case"touchmove":y(this,Ws,Hs).call(this,t);break;case"touchend":y(this,Ws,zs).call(this,t)}})),b(this,Vs,(()=>{0===this.scrollTop?(this.open=!1,this.removeAttribute("snap-touch"),y(this,Ws,Zs).call(this)):!this.visible&&this.scrollTop>0?y(this,Ws,$s).call(this):!this.hasAttribute("snap-touch")&&y(this,Ws,qs).call(this)&&(this.open=!0,this.setAttribute("snap-touch",""))})),b(this,Xs,(()=>{const t=v(this,Fs);w(this,Fs,this.scrollTop),y(this,Ws,Qs).call(this)?0===this.scrollTop?(this.open=!1,y(this,Ws,Zs).call(this)):!this.visible&&this.scrollTop>0?y(this,Ws,$s).call(this):y(this,Ws,qs).call(this)&&t<=this.scrollTop&&(this.open=!0):this.scrollTop=0})),this.attachShadow({mode:"open"}).appendChild(_s.content.cloneNode(!0))}connectedCallback(){var t,e,i,n,s,a;const o=this.getRootNode();if(o instanceof Document||o instanceof ShadowRoot){w(this,Ns,o.querySelector("vindral-controller")),null==(t=v(this,Ns))||t.connectListener(this),w(this,Ds,null==(e=this.shadowRoot)?void 0:e.querySelector("#scroll-area")),null==(i=v(this,Ds))||i.addEventListener("click",(()=>{this.open&&(this.open=!1)}));const l=this.hasAttribute("touch-enabled");if(!(0,r.g)()||!l)return this.setAttribute("snap",""),void this.addEventListener("scroll",v(this,Xs));this.addEventListener("scroll",v(this,Vs)),null==(n=v(this,Ns))||n.addEventListener("touchstart",this,{passive:!0}),null==(s=v(this,Ns))||s.addEventListener("touchmove",this,{passive:!1}),null==(a=v(this,Ns))||a.addEventListener("touchend",this,{passive:!0})}}disconnectedCallback(){var t;null==(t=v(this,Ns))||t.disconnectListener(this)}attributeChangedCallback(t,e,i){var n;e!==i&&(t===x.USER_INTERACTING&&null===i&&y(this,Ws,js).call(this)&&setTimeout((()=>{this.open=!1}),300),"open"===t&&this.scrollTo({top:null===i?0:null==(n=v(this,Ds))?void 0:n.clientHeight,behavior:"smooth"}))}set open(t){t?this.setAttribute("open",""):this.removeAttribute("open")}get open(){return this.hasAttribute("open")}set visible(t){t?this.setAttribute("visible",""):this.removeAttribute("visible")}get visible(){return this.hasAttribute("visible")}}Ns=new WeakMap,Ds=new WeakMap,Os=new WeakMap,Fs=new WeakMap,Ws=new WeakSet,Gs=function(t){y(this,Ws,Qs).call(this)&&t.touches[0]&&w(this,Os,t.touches[0].clientY)},Hs=function(t){if(y(this,Ws,Qs).call(this)&&v(this,Os)&&!this.hasAttribute("snap-touch")&&(t.preventDefault(),t.touches[0])){const e=t.touches[0].clientY,i=v(this,Os)-e;this.scrollTop=i}},zs=function(t){y(this,Ws,js).call(this)&&!this.hasAttribute("snap-touch")&&(this.open=!0)},Vs=new WeakMap,Xs=new WeakMap,Qs=function(){return this.hasAttribute(x.USER_INTERACTING)},js=function(){return this.scrollTop>0},qs=function(){var t;return Math.round(this.scrollTop)===this.scrollHeight-this.clientHeight||Math.round(this.scrollTop)===(null==(t=v(this,Ds))?void 0:t.clientHeight)},$s=function(){this.visible=!0,this.dispatchEvent(new CustomEvent(R.LOCK_UI,{bubbles:!0,composed:!0}))},Zs=function(){this.visible=!1,this.dispatchEvent(new CustomEvent(R.UNLOCK_UI,{bubbles:!0,composed:!0}))},A(Ks,"observedAttributes",[x.USER_INTERACTING,"open","touch-enabled"]);const Js=document.createElement("template");var Ys;Js.innerHTML='\n  <style>\n    :host {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      z-index: 1;\n      pointer-events: none;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    slot#play {\n      pointer-events: auto;\n      cursor: pointer;\n      color: var(--fg-strong);\n    }\n\n    slot#play > svg {\n      width: 48px;\n      height: 48px;\n    }\n  </style>\n\n  <slot id="play" name="icon">\n  <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z" /></svg>\n</slot>\n';class tr extends HTMLElement{constructor(){super(),b(this,Ys,null),this.attachShadow({mode:"open"}).appendChild(Js.content.cloneNode(!0))}connectedCallback(){var t;w(this,Ys,this.closest("vindral-controller")),null==(t=v(this,Ys))||t.connectListener(this),this.setAttribute("arial-label","Play")}disconnectedCallback(){var t;null==(t=v(this,Ys))||t.disconnectListener(this)}}Ys=new WeakMap,A(tr,"observedAttributes",["hidden"]);const er=document.createElement("template");var ir;er.innerHTML=`\n  <style>\n    :host {\n      display: var(--play-overlay-display);\n    }\n\n    :host(:not([${x.NEEDS_USER_INPUT}]):not([${x.PAUSED}])) #play {\n      display: none;\n    }\n  </style>\n`;const nr=class extends tr{constructor(){var t;super(),b(this,ir,(()=>{this.dispatchEvent(new CustomEvent(R.REQUEST_USER_INPUT,{bubbles:!0,composed:!0}))})),null==(t=this.shadowRoot)||t.appendChild(er.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.addEventListener("click",v(this,ir))}disconnectedCallback(){super.disconnectedCallback()}};ir=new WeakMap,A(nr,"observedAttributes",[...E(nr,nr,"observedAttributes"),x.NEEDS_USER_INPUT,x.PAUSED]);let sr=nr;const rr=document.createElement("template");var ar,or,lr;rr.innerHTML='\n  <style>\n    :host,\n    #background {\n      position: absolute;\n      overflow: hidden;\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      width: 100%;\n      top: 0;\n      left: 0;\n      justify-content: center;\n      align-items: center;\n      background-repeat: no-repeat;\n      background-position: 50% 50%;\n      background-size: contain;\n      font-size: 20px;\n      color: var(--fg-strong);\n      pointer-events: none;\n    }\n\n    :host([hidden]) {\n      display: none;\n    }\n\n    #background {\n      opacity: 0.7;\n    }\n\n    #title,\n    #description {\n      position: relative;\n      text-align: center;\n      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);\n    }\n\n    @container (max-width: 600px) {\n      :host {\n        font-size: 15px;\n      }\n    }\n\n    @container (max-width: 400px) {\n      :host {\n        font-size: 12px;\n      }\n      #title {\n        margin: 0;\n      }\n    }\n\n    @container (max-width: 150px) {\n      :host {\n        font-size: 10px;\n      }\n      #title,\n      #description {\n        font-size: 1.2em;\n        margin: 0;\n      }\n    }\n  </style>\n\n  <div id="background"></div>\n  <h1 id="title"></h1>\n  <p id="description"></p>\n';class hr extends HTMLElement{constructor(){super(),b(this,ar),b(this,or),b(this,lr);const t=this.attachShadow({mode:"open"});t.appendChild(rr.content.cloneNode(!0)),w(this,ar,t.querySelector("#title")),w(this,or,t.querySelector("#description")),w(this,lr,t.querySelector("#background"))}connectedCallback(){}disconnectedCallback(){}attributeChangedCallback(t,e,i){e!==i&&("title"===t?v(this,ar).textContent=i:"description"===t?v(this,or).textContent=i:"background-image"===t&&(v(this,lr).style.backgroundImage=`url(${i})`))}}ar=new WeakMap,or=new WeakMap,lr=new WeakMap,A(hr,"observedAttributes",["title","description","background-image","hidden"]);const cr=document.createElement("template");var dr,ur,mr,pr;cr.innerHTML='\n  <style>\n    :host {\n      --value: 0;\n      --_focus-box-shadow: none;\n      height: calc(24px + 2 * var(--button-padding));\n      width: 100%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      margin: 0;\n      position: relative;\n      cursor: pointer;\n      pointer-events: auto;\n      touch-action: none;\n      box-shadow: var(--_focus-visible-box-shadow, none);\n      outline: 0;\n      background: transparent;\n      transition: background 0.2s linear;\n    }\n\n    #range {\n      -webkit-appearance: none;\n      appearance: none;\n\n      height: 4px;\n      width: 100%;\n      margin: 0;\n      padding: 0;\n\n      background-color: #00000000;\n      outline: none;\n      z-index: 1;\n      cursor: pointer;\n    }\n\n    #range-track {\n      position: absolute;\n      top: calc(50% - 2px);\n      left: 1px;\n      width: calc(100% - 1px);\n      height: 4px;\n      background-color: rgb(255 255 255 / 0.2);\n      overflow: hidden;\n      cursor: pointer;\n    }\n\n    #range-track::before {\n      position: absolute;\n      content: "";\n      left: calc(-100%);\n      top: 0;\n      width: calc(100%);\n      height: 100%;\n      background-color: var(--fg-strong);\n      transition: background-color 300ms ease-out;\n      transform-origin: 100% 0%;\n      transform: translateX(calc(var(--value) * 100%)) scaleX(1.2);\n    }\n\n    #range::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background-color: var(--fg-strong);\n      cursor: pointer;\n      z-index: 1;\n    }\n\n    #range::-moz-range-thumb {\n      -moz-appearance: none;\n      appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background-color: var(--fg-strong);\n      cursor: pointer;\n      z-index: 1;\n    }\n\n    :host(:focus-visible) {\n      box-shadow: inset 0 0 0 2px var(--fg-strong);\n      outline: 0;\n    }\n\n    @media (hover: hover) and (pointer: fine) {\n      :host(:hover) {\n        background: rgba(255, 255, 255, 0.15);\n      }\n    }\n\n    :host(:active) {\n      background: rgba(255, 255, 255, 0.25);\n    }\n  </style>\n\n  <input type="range" id="range" min="0" max="1" step="any" value="0" />\n  <div id="range-track"></div>\n';class gr extends HTMLElement{constructor(){super(),b(this,dr,null),b(this,ur),A(this,"range"),b(this,mr,(()=>{this.range.matches(":focus-visible")&&this.style.setProperty("--_focus-visible-box-shadow","inset 0 0 0 2px var(--fg-strong)")})),b(this,pr,(()=>{this.style.removeProperty("--_focus-visible-box-shadow")})),w(this,ur,this.attachShadow({mode:"open"})),v(this,ur).appendChild(cr.content.cloneNode(!0)),this.range=v(this,ur).getElementById("range")}connectedCallback(){var t;w(this,dr,this.closest("vindral-controller")),null==(t=v(this,dr))||t.connectListener(this),this.hasAttribute("disabled")||this.enable(),this.range.addEventListener("focusin",v(this,mr)),this.range.addEventListener("focusout",v(this,pr))}disconnectedCallback(){var t;null==(t=v(this,dr))||t.disconnectListener(this),this.range.removeEventListener("focusin",v(this,mr)),this.range.removeEventListener("focusout",v(this,pr))}attributeChangedCallback(t,e,i){e!==i&&("disabled"===t&&i?this.disable():this.enable(),this.updateBar())}enable(){this.addEventListener("input",this)}disable(){this.range.removeEventListener("input",this)}handleEvent(t){"input"===t.type&&this.updateBar()}updateBar(){this.style.setProperty("--value",this.range.value)}get keysUsed(){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"]}}dr=new WeakMap,ur=new WeakMap,mr=new WeakMap,pr=new WeakMap,A(gr,"observedAttributes",["disabled"]);const Ar=document.createElement("template");var fr;Ar.innerHTML="\n  <style>\n    :host {\n      display: var(--volume-range-display);\n      width: 80px;\n    }\n  </style>\n";const vr=class extends gr{constructor(){var t;super(),b(this,fr,(()=>{const t=this.range.valueAsNumber;this.dispatchEvent(new CustomEvent(R.SET_VOLUME,{bubbles:!0,composed:!0,detail:t}))})),null==(t=this.shadowRoot)||t.appendChild(Ar.content.cloneNode(!0))}connectedCallback(){super.connectedCallback(),this.range.addEventListener("input",v(this,fr)),this.range.setAttribute("aria-label","volume")}disconnectedCallback(){super.disconnectedCallback(),this.range.removeEventListener("input",v(this,fr))}attributeChangedCallback(t,e,i){super.attributeChangedCallback(t,e,i),(t===x.MUTED||t===x.VOLUME)&&(this.range.valueAsNumber=this.muted?0:parseFloat(this.volume),this.range.setAttribute("aria-valuetext",(t=>`${Math.round(100*t)}%`)(this.range.valueAsNumber)),this.updateBar())}get volume(){var t;return null!=(t=this.getAttribute(x.VOLUME))?t:"1"}get muted(){return this.hasAttribute(x.MUTED)}};fr=new WeakMap,A(vr,"observedAttributes",[...E(vr,vr,"observedAttributes"),x.MUTED,x.VOLUME]);let br=vr;customElements.define("vindral-controller",Ti),customElements.define("vindral-control-bar",Yt),customElements.define("vindral-play-button",vn),customElements.define("vindral-mute-button",un),customElements.define("vindral-buffering-overlay",tt),customElements.define("vindral-scroll-overlay",Ks),customElements.define("vindral-play-overlay",tr),customElements.define("vindral-user-input-play-overlay",sr),customElements.define("vindral-fullscreen-button",Ri),customElements.define("vindral-rendition-levels-menu",As),customElements.define("vindral-rendition-levels-menu-list",Us),customElements.define("vindral-channel-grid-button",Kt),customElements.define("vindral-channel-grid",Ot),customElements.define("vindral-channel-grid-item",pt),customElements.define("vindral-pip-button",gn),customElements.define("vindral-airplay-button",q),customElements.define("vindral-cast-button",at),customElements.define("vindral-cast-overlay",ct),customElements.define("vindral-buffering-icon",K),customElements.define("vindral-language-menu",Ui),customElements.define("vindral-language-menu-list",hn),customElements.define("vindral-message",hr),customElements.define("vindral-volume-range",br),customElements.define("vindral-poster-overlay",ds),customElements.define("vindral-player",ts);const wr=document.querySelector("#vindral-container"),yr=document.querySelector("#vindral-player"),Er=document.querySelector("#playback-state");let Sr,kr,Cr,Tr,xr,Ir,Rr;yr.addEventListener("vindral-instance-ready",(()=>{yr.instance.on("error",(t=>{t.isFatal()&&console.log("fatal error: ",t.message)})),yr.instance.on("playback state",(t=>Er.textContent=t))}));let Lr=!1;function Mr(t){kr&&kr.contentComplete();const e=new google.ima.AdsRequest;e.adTagUrl="https://pubads.g.doubleclick.net/gampad/ads?iu=/21775744923/external/single_ad_samples&sz=640x480&cust_params=sample_ct%3Dredirectlinear&ciu_szs=300x250%2C728x90&gdfp_req=1&output=vast&unviewed_position_start=1&env=vp&impl=s&correlator=",e.linearAdSlotWidth=640,e.linearAdSlotHeight=360,e.nonLinearAdSlotWidth=640,e.nonLinearAdSlotHeight=150,e.liveStreamPrefetchSeconds=t,kr.requestAds(e)}function Pr(t){const e=t.getAd();switch(t.type){case google.ima.AdEvent.Type.LOADED:e.isLinear()||yr.instance.play();break;case google.ima.AdEvent.Type.STARTED:e.isLinear()&&(xr=setInterval((function(){}),300));break;case google.ima.AdEvent.Type.PAUSED:Lr=!0;break;case google.ima.AdEvent.Type.COMPLETE:e.isLinear()&&clearInterval(xr);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:Mr(0)}}function Br(t){console.log(t.getError()),Sr.destroy()}function Ur(){Cr.style.display="block",yr.instance.pause()}function _r(){Cr.style.display="none",yr.instance.play()}document.addEventListener("visibilitychange",(()=>{!document.hidden&&Lr&&Sr.resume()})),"undefined"!=typeof google?(Ir=document.getElementById("playButton"),Ir.addEventListener("click",(function(){Rr||(Tr.initialize(),Rr=!0);try{Sr.init(640,360,google.ima.ViewMode.NORMAL),Sr.start()}catch(t){yr.instance.play()}})),Cr=document.getElementById("adContainer"),Tr=new google.ima.AdDisplayContainer(Cr,wr),kr=new google.ima.AdsLoader(Tr),kr.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(function(t){const e=new google.ima.AdsRenderingSettings;e.restoreCustomPlaybackStateOnAdBreakComplete=!0,Sr=t.getAdsManager(wr,e),Sr.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,Br),Sr.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,Ur),Sr.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,_r),Sr.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,Pr),Sr.addEventListener(google.ima.AdEvent.Type.LOADED,Pr),Sr.addEventListener(google.ima.AdEvent.Type.STARTED,Pr),Sr.addEventListener(google.ima.AdEvent.Type.COMPLETE,Pr),Sr.addEventListener(google.ima.AdEvent.Type.PAUSED,Pr),Sr.addEventListener(google.ima.AdEvent.Type.RESUMED,Pr)}),!1),kr.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,Br,!1),Mr(0)):console.error("Google IMA SDK not loaded. Adblock may be enabled.")})();